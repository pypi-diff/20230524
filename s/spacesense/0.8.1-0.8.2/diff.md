# Comparing `tmp/spacesense-0.8.1-py3-none-any.whl.zip` & `tmp/spacesense-0.8.2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,24 +1,24 @@
-Zip file size: 41682 bytes, number of entries: 22
--rw-r--r--  2.0 unx      365 b- defN 23-Mar-24 23:17 spacesense/__init__.py
--rw-r--r--  2.0 unx       22 b- defN 23-Mar-24 23:17 spacesense/__version__.py
--rw-r--r--  2.0 unx      523 b- defN 23-Mar-24 23:17 spacesense/config.py
--rw-r--r--  2.0 unx    53752 b- defN 23-Mar-24 23:17 spacesense/core.py
--rw-r--r--  2.0 unx     6662 b- defN 23-Mar-24 23:17 spacesense/file_handler.py
--rw-r--r--  2.0 unx     2712 b- defN 23-Mar-24 23:17 spacesense/geoutils.py
--rw-r--r--  2.0 unx      210 b- defN 23-Mar-24 23:17 spacesense/grpc_auth.py
--rw-r--r--  2.0 unx     3636 b- defN 23-Mar-24 23:17 spacesense/grpc_client.py
--rw-r--r--  2.0 unx     7880 b- defN 23-Mar-24 23:17 spacesense/job.py
--rw-r--r--  2.0 unx     9985 b- defN 23-Mar-24 23:17 spacesense/ml_utils.py
--rw-r--r--  2.0 unx     5762 b- defN 23-Mar-24 23:17 spacesense/utils.py
--rw-r--r--  2.0 unx       65 b- defN 23-Mar-24 23:17 spacesense/collections/__init__.py
--rw-r--r--  2.0 unx    17704 b- defN 23-Mar-24 23:17 spacesense/collections/models.py
--rw-rw-rw-  2.0 unx   103308 b- defN 23-Mar-24 23:17 spacesense/common/proto/backend/backend_pb2.py
--rw-rw-rw-  2.0 unx    16801 b- defN 23-Mar-24 23:17 spacesense/common/proto/backend/backend_pb2_grpc.py
--rw-rw-rw-  2.0 unx       22 b- defN 23-Mar-24 23:17 spacesense/resources/config.json
--rw-rw-rw-  2.0 unx     1074 b- defN 23-Mar-24 23:17 spacesense/resources/server.crt
--rw-rw-rw-  2.0 unx      556 b- defN 23-Mar-24 23:18 spacesense-0.8.1.dist-info/LICENSE
--rw-r--r--  2.0 unx     2682 b- defN 23-Mar-24 23:18 spacesense-0.8.1.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Mar-24 23:18 spacesense-0.8.1.dist-info/WHEEL
--rw-r--r--  2.0 unx       11 b- defN 23-Mar-24 23:18 spacesense-0.8.1.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1830 b- defN 23-Mar-24 23:18 spacesense-0.8.1.dist-info/RECORD
-22 files, 235654 bytes uncompressed, 38710 bytes compressed:  83.6%
+Zip file size: 43229 bytes, number of entries: 22
+-rw-r--r--  2.0 unx      365 b- defN 23-Apr-21 14:48 spacesense/__init__.py
+-rw-r--r--  2.0 unx       22 b- defN 23-Apr-21 14:48 spacesense/__version__.py
+-rw-r--r--  2.0 unx      523 b- defN 23-Apr-21 14:48 spacesense/config.py
+-rw-r--r--  2.0 unx    53752 b- defN 23-Apr-21 14:48 spacesense/core.py
+-rw-r--r--  2.0 unx     6662 b- defN 23-Apr-21 14:48 spacesense/file_handler.py
+-rw-r--r--  2.0 unx     7342 b- defN 23-Apr-21 14:48 spacesense/geoutils.py
+-rw-r--r--  2.0 unx      210 b- defN 23-Apr-21 14:48 spacesense/grpc_auth.py
+-rw-r--r--  2.0 unx     3636 b- defN 23-Apr-21 14:48 spacesense/grpc_client.py
+-rw-r--r--  2.0 unx     7880 b- defN 23-Apr-21 14:48 spacesense/job.py
+-rw-r--r--  2.0 unx     9985 b- defN 23-Apr-21 14:48 spacesense/ml_utils.py
+-rw-r--r--  2.0 unx     5762 b- defN 23-Apr-21 14:48 spacesense/utils.py
+-rw-r--r--  2.0 unx       65 b- defN 23-Apr-21 14:48 spacesense/collections/__init__.py
+-rw-r--r--  2.0 unx    17704 b- defN 23-Apr-21 14:48 spacesense/collections/models.py
+-rw-rw-rw-  2.0 unx   103308 b- defN 23-Apr-21 14:48 spacesense/common/proto/backend/backend_pb2.py
+-rw-rw-rw-  2.0 unx    16801 b- defN 23-Apr-21 14:48 spacesense/common/proto/backend/backend_pb2_grpc.py
+-rw-rw-rw-  2.0 unx       22 b- defN 23-Apr-21 14:48 spacesense/resources/config.json
+-rw-rw-rw-  2.0 unx     1074 b- defN 23-Apr-21 14:48 spacesense/resources/server.crt
+-rw-rw-rw-  2.0 unx      556 b- defN 23-Apr-21 14:48 spacesense-0.8.2.dist-info/LICENSE
+-rw-r--r--  2.0 unx     2717 b- defN 23-Apr-21 14:48 spacesense-0.8.2.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-21 14:48 spacesense-0.8.2.dist-info/WHEEL
+-rw-r--r--  2.0 unx       11 b- defN 23-Apr-21 14:48 spacesense-0.8.2.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1830 b- defN 23-Apr-21 14:48 spacesense-0.8.2.dist-info/RECORD
+22 files, 240319 bytes uncompressed, 40257 bytes compressed:  83.2%
```

## zipnote {}

```diff
@@ -45,23 +45,23 @@
 
 Filename: spacesense/resources/config.json
 Comment: 
 
 Filename: spacesense/resources/server.crt
 Comment: 
 
-Filename: spacesense-0.8.1.dist-info/LICENSE
+Filename: spacesense-0.8.2.dist-info/LICENSE
 Comment: 
 
-Filename: spacesense-0.8.1.dist-info/METADATA
+Filename: spacesense-0.8.2.dist-info/METADATA
 Comment: 
 
-Filename: spacesense-0.8.1.dist-info/WHEEL
+Filename: spacesense-0.8.2.dist-info/WHEEL
 Comment: 
 
-Filename: spacesense-0.8.1.dist-info/top_level.txt
+Filename: spacesense-0.8.2.dist-info/top_level.txt
 Comment: 
 
-Filename: spacesense-0.8.1.dist-info/RECORD
+Filename: spacesense-0.8.2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## spacesense/__version__.py

```diff
@@ -1 +1 @@
-__version__ = "0.8.1"
+__version__ = "0.8.2"
```

## spacesense/geoutils.py

```diff
@@ -1,15 +1,19 @@
 import logging
+import os
 
 import geopandas as gpd
 import matplotlib.pyplot as plt
 import numpy as np
 import pandas as pd
 import xarray as xr
+from matplotlib.colors import ListedColormap
+from matplotlib.patches import Patch
 from shapely.geometry import Point
+from sklearn.cluster import KMeans
 
 logger = logging.getLogger(__name__)
 
 
 def measure_distance(ds: xr.Dataset, SCL_val: int, lon: float, lat: float, plot: bool = True) -> float:
     """
     Function to calculate the distance from a specified longitude and latitude to the scene classification specified. The scene classification is taken from the first index on the Sentinel-2 SCL
@@ -61,7 +65,124 @@
         circle1 = plt.Circle((gdf["geometry"].x, gdf["geometry"].y), min_dist, fill=False)
         ax.add_patch(circle1)
         vector.plot(ax=ax)
         gdf.plot(color="None", edgecolor="red", linewidth=2, zorder=1, ax=ax)
         plt.show()
 
     return min_dist
+
+
+def cluster(dataset, n_clusters=5, variable_prefixes=None, save=False, save_path=None):
+    """
+    Perform K-means clustering on an area of interest (AOI) dataset.
+
+    Args:
+    dataset (xarray.Dataset): The input dataset.
+    n_clusters (int): The number of clusters to create.
+    variable_prefixes (list): A list of variable prefixes to use for clustering.
+    save (bool): Whether to save the clustered image.
+    save_dir (str): The directory to save the clustered image to.
+
+    Returns:
+    xarray.Dataset: The clustered dataset.
+
+    """
+    filtered_dataset = None
+    if variable_prefixes is not None:
+        variables = [var for layer in variable_prefixes for var in dataset.data_vars if var.startswith(layer)]
+        filtered_dataset = dataset[variables]
+
+    if "time" in dataset.dims:
+        flattened_dataset = flatten_time_variables(filtered_dataset or dataset)
+    else:
+        flattened_dataset = dataset
+
+    # Stack x, y dimensions into a single 'pixel' dimension
+    stacked_data = flattened_dataset.stack(pixel=["x", "y"])
+
+    # Drop NaN values
+    stacked_data = stacked_data.dropna(dim="pixel", how="any")
+
+    # Convert the data to a 2D numpy array
+    data_array = stacked_data.to_array().values
+
+    # Transpose the array to have pixels as rows and bands as columns
+    data_array_T = np.reshape(data_array, (data_array.shape[0], -1)).T
+
+    # Perform K-means clustering
+    kmeans = KMeans(n_clusters=n_clusters, random_state=0).fit(data_array_T)
+    cluster_labels = kmeans.labels_
+
+    # Create a new DataArray with the same dimensions as the input dataset
+    new_data_array = xr.DataArray(
+        data=cluster_labels, coords={"pixel": stacked_data.pixel}, dims=["pixel"], name="cluster"
+    )
+
+    # Unstack the 'pixel' dimension back to the original 'x', 'y' dimensions
+    new_data_array = new_data_array.unstack("pixel")
+
+    # Assign the new cluster DataArray to the original dataset
+    clustered_dataset = dataset.assign(cluster=new_data_array)
+
+    # Add the cluster centers values to the dataset attributes
+    cluster_centers = kmeans.cluster_centers_
+    wrapper_dict = {"cluster_centers": {}}
+    for i in range(n_clusters):
+        cluster_centers_dict = {
+            f"cluster_{i}_{var}": cluster_centers[i, j] for j, var in enumerate(stacked_data.data_vars)
+        }
+        wrapper_dict["cluster_centers"].update(cluster_centers_dict)
+    clustered_dataset.attrs.update(wrapper_dict)
+
+    # Save the clustered image if requested
+    if save:
+        if not (save_path and os.path.isdir(os.path.dirname(save_path))):
+            raise ValueError("save_path must be specified if save is True")
+        clustered_dataset.to_netcdf(save_path, mode="w", format="NETCDF4")
+
+    return clustered_dataset
+
+
+def flatten_time_variables(dataset):
+    """
+    Flatten the time variables in a dataset by creating new variables for each band and date combination. Removes the time dimension.
+
+    Args:
+    dataset (xarray.Dataset): The input dataset with time variables.
+
+    Returns:
+    xarray.Dataset: A new dataset with flattened time variables.
+    """
+
+    flattened_dataset = xr.Dataset()
+    for var in dataset.data_vars:
+        for t in range(len(dataset.time)):
+            time_str = dataset.time[t].dt.strftime("%Y-%m-%d").item()
+            new_var_name = f"{var}_{time_str}"
+            flattened_dataset[new_var_name] = dataset[var].isel(time=t)
+        # Preserve the attributes of the original variable
+        flattened_dataset[new_var_name].attrs = dataset[var].attrs
+    # Preserve the attributes of the original dataset
+    flattened_dataset.attrs = dataset.attrs
+    return flattened_dataset
+
+
+def plot_clustered_dataset(clustered_dataset, n_clusters):
+    # Use the viridis colormap and truncate it to the number of clusters
+    cmap = plt.cm.get_cmap("viridis", n_clusters)
+    custom_cmap = ListedColormap(cmap.colors)
+
+    # Assuming 'clustered_dataset' is the result of the 'cluster_aoi' function
+    cluster_data = clustered_dataset["cluster"]
+    cluster_data = cluster_data.transpose("y", "x")
+
+    # Create a plot with the custom color map
+    im = cluster_data.plot(cmap=custom_cmap, add_colorbar=False)
+
+    # Create legend elements
+    legend_elements = [
+        Patch(facecolor=im.cmap(im.norm(c)), edgecolor="k", label=f"Cluster {c}") for c in range(n_clusters)
+    ]
+
+    # Add the legend to the plot
+    plt.legend(handles=legend_elements, bbox_to_anchor=(1.05, 1), loc="upper left", title="Clusters")
+    plt.show()
```

## Comparing `spacesense-0.8.1.dist-info/LICENSE` & `spacesense-0.8.2.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `spacesense-0.8.1.dist-info/METADATA` & `spacesense-0.8.2.dist-info/METADATA`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: spacesense
-Version: 0.8.1
+Version: 0.8.2
 Summary: Spacesense Client Library
 Home-page: https://spacesense.gitlab.io/client-library
 Author: SpaceSense
 Author-email: support@spacesense.ai
 License: Apache 2.0
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
@@ -20,14 +20,15 @@
 Requires-Dist: netCDF4 (>=1.5.8)
 Requires-Dist: protobuf (==3.20.3)
 Requires-Dist: pyjwt[crypto] (>=2.3.0)
 Requires-Dist: rasterio (>=1.1.8)
 Requires-Dist: rioxarray (>=0.9.1)
 Requires-Dist: sat-stac (>=0.4.1)
 Requires-Dist: scikit-image (>=0.18.2)
+Requires-Dist: scikit-learn (>1.0)
 Requires-Dist: tqdm (>=4.64.1)
 Requires-Dist: xarray (>=0.19.0)
 Provides-Extra: dev
 Requires-Dist: commitizen (==2.21.2) ; extra == 'dev'
 Requires-Dist: coverage (==5.3) ; extra == 'dev'
 Requires-Dist: google-auth (==2.13.0) ; extra == 'dev'
 Requires-Dist: grpc-interceptor (==0.13.1) ; extra == 'dev'
```

## Comparing `spacesense-0.8.1.dist-info/RECORD` & `spacesense-0.8.2.dist-info/RECORD`

 * *Files 24% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 spacesense/__init__.py,sha256=kKJ2e0upU3BnGVgETWOXUfdwcV2n07ccOIo-QlV1gWY,365
-spacesense/__version__.py,sha256=Ocl79hbbH8_jdr5dGC90VR1cAvZc05Rc0tkZttUnMjo,22
+spacesense/__version__.py,sha256=B7GiO0rd49YwtLYjvPg4lmCZEDlMTonslQKdSImaMJk,22
 spacesense/config.py,sha256=Be1saJ85PzTN7rA_XIqE_H0hLX9YMgKywboyTldIclY,523
 spacesense/core.py,sha256=G9Kj2VqnEUZWn_1i07y4WnhL295rt2bvatv6cBmGO0c,53752
 spacesense/file_handler.py,sha256=aBJd_wLnnmfqQuej_ccuNWWj8U1O5-tMdpsd1w7rkzc,6662
-spacesense/geoutils.py,sha256=MjS1sUw7pPtRF3T2i_jGRI-0OmyhC-efQ5Lx3o8UQDc,2712
+spacesense/geoutils.py,sha256=I5ew8x8aq4iPvbEP__EbYneC4wxMXzilE2wYfpnxbD4,7342
 spacesense/grpc_auth.py,sha256=SndAZSon9I6yiBNJeH3jHKXEMKAH3P6adw8wpw7J718,210
 spacesense/grpc_client.py,sha256=rti7YE_24SPGXU81dAtC45TyGPnEOaEMCZFk7NRK1zk,3636
 spacesense/job.py,sha256=lLVy-OisGYIe4bhfSh3hn_PNrGTQuQ2c89qkjrO1yPM,7880
 spacesense/ml_utils.py,sha256=dayy1Wc6_3NbP5RCfs7HqnJaxrlz2fEuHK778oflDHQ,9985
 spacesense/utils.py,sha256=M2uQa8leXVDXQoDxRWxUsKh2EVE79olhe5zRLYX-opI,5762
 spacesense/collections/__init__.py,sha256=Co1YhClwUm0tQ0hTWwgR92R49oS3iKuyrFQIs1Z8yas,65
 spacesense/collections/models.py,sha256=T3g2PtVccrY-TZzc5TI32lzCve3eA79lr5Os9JuBJd8,17704
 spacesense/common/proto/backend/backend_pb2.py,sha256=rAd1-pOX4jVKdcoaCIF7xbDngB0_qWYA5Zl1Dx4kdhk,103308
 spacesense/common/proto/backend/backend_pb2_grpc.py,sha256=2eOSXCmap3LV5Dova682Cw616gT8hoz15ExdaUZmy10,16801
 spacesense/resources/config.json,sha256=CBiHHmweZYEVVyTXNZYsbDPmC7cfbbb_jJ6_x8XvmtA,22
 spacesense/resources/server.crt,sha256=hWpmV4LnNcHpTKNz4hATuuSmOB_Wg2gmfUyJLUsHCF0,1074
-spacesense-0.8.1.dist-info/LICENSE,sha256=6gvhfpztIeEW5MA5AXwl8mibDTNDTxQoXOWnpZNC4SM,556
-spacesense-0.8.1.dist-info/METADATA,sha256=K0Q600q5DPDqux0YFQylwQl7RPyzZ2mXe9pyaeVpjMA,2682
-spacesense-0.8.1.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-spacesense-0.8.1.dist-info/top_level.txt,sha256=osepgwVg3MDesvKIFFmV7XKrzzsveLMnCfYQ2kWKhM8,11
-spacesense-0.8.1.dist-info/RECORD,,
+spacesense-0.8.2.dist-info/LICENSE,sha256=6gvhfpztIeEW5MA5AXwl8mibDTNDTxQoXOWnpZNC4SM,556
+spacesense-0.8.2.dist-info/METADATA,sha256=ZdXnF0IE0lVfCb97d1Gj3RBpVEk5U5CenxVmNHknzew,2717
+spacesense-0.8.2.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+spacesense-0.8.2.dist-info/top_level.txt,sha256=osepgwVg3MDesvKIFFmV7XKrzzsveLMnCfYQ2kWKhM8,11
+spacesense-0.8.2.dist-info/RECORD,,
```

