# Comparing `tmp/medicc2-0.9.2.tar.gz` & `tmp/medicc2-1.0.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "medicc2-0.9.2.tar", last modified: Tue May  2 13:33:53 2023, max compression
+gzip compressed data, was "medicc2-1.0.0.tar", last modified: Wed May 24 14:35:41 2023, max compression
```

## Comparing `medicc2-0.9.2.tar` & `medicc2-1.0.0.tar`

### file list

```diff
@@ -1,65 +1,64 @@
-drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-02 13:33:53.778024 medicc2-0.9.2/
--rw-r--r--   0 tom        (501) staff       (20)    36109 2023-05-02 11:56:04.000000 medicc2-0.9.2/LICENSE
--rw-r--r--   0 tom        (501) staff       (20)    19534 2023-05-02 13:33:53.777681 medicc2-0.9.2/PKG-INFO
--rw-r--r--   0 tom        (501) staff       (20)    18950 2023-05-02 12:03:22.000000 medicc2-0.9.2/README.md
-drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-02 13:33:53.751977 medicc2-0.9.2/fstlib/
--rw-r--r--   0 tom        (501) staff       (20)      527 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/__init__.py
--rw-r--r--   0 tom        (501) staff       (20)    16808 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/algos.py
-drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-02 13:33:53.760917 medicc2-0.9.2/fstlib/cext/
--rw-r--r--   0 tom        (501) staff       (20)        0 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/cext/__init__.py
--rw-r--r--   0 tom        (501) staff       (20)      578 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/cext/cintegral_types.pxd
--rw-r--r--   0 tom        (501) staff       (20)     2109 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/cext/cios.pxd
--rw-r--r--   0 tom        (501) staff       (20)      184 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/cext/cmemory.pxd
--rw-r--r--   0 tom        (501) staff       (20)     8608 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/cext/cops.h
--rw-r--r--   0 tom        (501) staff       (20)      565 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/cext/cops.pxd
--rw-r--r--   0 tom        (501) staff       (20)    22206 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/cext/cpywrapfst.pxd
--rw-r--r--   0 tom        (501) staff       (20)     1351 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/cext/cutility.pxd
--rw-r--r--   0 tom        (501) staff       (20)   246353 2023-05-02 13:33:51.000000 medicc2-0.9.2/fstlib/cext/ops.cpp
--rw-r--r--   0 tom        (501) staff       (20)     1526 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/cext/ops.pyx
--rw-r--r--   0 tom        (501) staff       (20)  2724666 2023-05-02 13:33:53.000000 medicc2-0.9.2/fstlib/cext/pywrapfst.cpp
--rw-r--r--   0 tom        (501) staff       (20)    15924 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/cext/pywrapfst.pxd
--rw-r--r--   0 tom        (501) staff       (20)   144735 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/cext/pywrapfst.pyx
--rw-r--r--   0 tom        (501) staff       (20)    17719 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/core.py
--rw-r--r--   0 tom        (501) staff       (20)     3139 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/ext.py
--rw-r--r--   0 tom        (501) staff       (20)    10679 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/factory.py
--rw-r--r--   0 tom        (501) staff       (20)      397 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/logging_conf.yaml
--rw-r--r--   0 tom        (501) staff       (20)     1446 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/test_fstlib.py
--rw-r--r--   0 tom        (501) staff       (20)     7631 2023-05-02 11:56:08.000000 medicc2-0.9.2/fstlib/tools.py
-drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-02 13:33:53.766334 medicc2-0.9.2/medicc/
--rw-r--r--   0 tom        (501) staff       (20)      629 2023-05-02 12:03:22.000000 medicc2-0.9.2/medicc/__init__.py
--rw-r--r--   0 tom        (501) staff       (20)     3540 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/ancestors.py
--rw-r--r--   0 tom        (501) staff       (20)    10115 2023-05-02 13:29:21.000000 medicc2-0.9.2/medicc/bootstrap.py
--rw-r--r--   0 tom        (501) staff       (20)    20683 2023-05-02 13:29:21.000000 medicc2-0.9.2/medicc/core.py
--rw-r--r--   0 tom        (501) staff       (20)    23763 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/event_reconstruction.py
--rw-r--r--   0 tom        (501) staff       (20)     8045 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/factory.py
--rw-r--r--   0 tom        (501) staff       (20)    15900 2023-05-02 13:32:43.000000 medicc2-0.9.2/medicc/io.py
--rw-r--r--   0 tom        (501) staff       (20)      780 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/logging_conf.yaml
--rw-r--r--   0 tom        (501) staff       (20)     5483 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/nj.py
-drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-02 13:33:53.774767 medicc2-0.9.2/medicc/objects/
--rw-r--r--   0 tom        (501) staff       (20)    56129 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/objects/Davoli_2013_TSG_OG_genes.bed
--rw-r--r--   0 tom        (501) staff       (20)     1382 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/objects/hg19_chromosome_arms.bed
--rw-r--r--   0 tom        (501) staff       (20)     1382 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/objects/hg38_chromosome_arms.bed
--rw-r--r--   0 tom        (501) staff       (20)   253982 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/objects/no_wgd_asymm.fst
--rw-r--r--   0 tom        (501) staff       (20)   572114 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/objects/wgd_1_asymm.fst
--rw-r--r--   0 tom        (501) staff       (20)   689774 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/objects/wgd_2_asymm.fst
--rw-r--r--   0 tom        (501) staff       (20)   783870 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/objects/wgd_asymm.fst
--rw-r--r--   0 tom        (501) staff       (20)   546246 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/objects/wgd_total_cn_1_asymm.fst
--rw-r--r--   0 tom        (501) staff       (20)   656310 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/objects/wgd_total_cn_asymm.fst
--rw-r--r--   0 tom        (501) staff       (20)   519890 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/objects/wgd_x2_1_asymm.fst
--rw-r--r--   0 tom        (501) staff       (20)   591554 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/objects/wgd_x2_asymm.fst
--rw-r--r--   0 tom        (501) staff       (20)    42216 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/plot.py
--rw-r--r--   0 tom        (501) staff       (20)     7644 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/sim.py
--rw-r--r--   0 tom        (501) staff       (20)     2646 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/stats.py
--rw-r--r--   0 tom        (501) staff       (20)     4934 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/test_fsts.py
--rw-r--r--   0 tom        (501) staff       (20)    21224 2023-05-02 13:29:21.000000 medicc2-0.9.2/medicc/test_medicc.py
--rw-r--r--   0 tom        (501) staff       (20)     5141 2023-05-02 11:56:04.000000 medicc2-0.9.2/medicc/tools.py
--rw-r--r--   0 tom        (501) staff       (20)    14892 2023-05-02 12:07:28.000000 medicc2-0.9.2/medicc2
-drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-02 13:33:53.777277 medicc2-0.9.2/medicc2.egg-info/
--rw-r--r--   0 tom        (501) staff       (20)    19534 2023-05-02 13:33:53.000000 medicc2-0.9.2/medicc2.egg-info/PKG-INFO
--rw-r--r--   0 tom        (501) staff       (20)     1327 2023-05-02 13:33:53.000000 medicc2-0.9.2/medicc2.egg-info/SOURCES.txt
--rw-r--r--   0 tom        (501) staff       (20)        1 2023-05-02 13:33:53.000000 medicc2-0.9.2/medicc2.egg-info/dependency_links.txt
--rw-r--r--   0 tom        (501) staff       (20)      120 2023-05-02 13:33:53.000000 medicc2-0.9.2/medicc2.egg-info/requires.txt
--rw-r--r--   0 tom        (501) staff       (20)       14 2023-05-02 13:33:53.000000 medicc2-0.9.2/medicc2.egg-info/top_level.txt
--rw-r--r--   0 tom        (501) staff       (20)       70 2023-05-02 11:56:04.000000 medicc2-0.9.2/pyproject.toml
--rw-r--r--   0 tom        (501) staff       (20)       38 2023-05-02 13:33:53.778112 medicc2-0.9.2/setup.cfg
--rw-r--r--   0 tom        (501) staff       (20)     2169 2023-05-02 13:29:21.000000 medicc2-0.9.2/setup.py
+drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-24 14:35:41.323091 medicc2-1.0.0/
+-rw-r--r--   0 tom        (501) staff       (20)    36109 2023-05-23 14:44:50.000000 medicc2-1.0.0/LICENSE
+-rw-r--r--   0 tom        (501) staff       (20)    19731 2023-05-24 14:35:41.322712 medicc2-1.0.0/PKG-INFO
+-rw-r--r--   0 tom        (501) staff       (20)    19147 2023-05-24 14:32:47.000000 medicc2-1.0.0/README.md
+drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-24 14:35:41.289239 medicc2-1.0.0/fstlib/
+-rw-r--r--   0 tom        (501) staff       (20)      550 2023-05-24 13:14:05.000000 medicc2-1.0.0/fstlib/__init__.py
+-rw-r--r--   0 tom        (501) staff       (20)    15634 2023-05-24 13:14:05.000000 medicc2-1.0.0/fstlib/algos.py
+drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-24 14:35:41.296795 medicc2-1.0.0/fstlib/cext/
+-rw-r--r--   0 tom        (501) staff       (20)        0 2023-05-23 14:44:52.000000 medicc2-1.0.0/fstlib/cext/__init__.py
+-rw-r--r--   0 tom        (501) staff       (20)     2100 2023-05-23 14:50:54.000000 medicc2-1.0.0/fstlib/cext/cios.pxd
+-rw-r--r--   0 tom        (501) staff       (20)      869 2023-05-23 14:50:54.000000 medicc2-1.0.0/fstlib/cext/cmemory.pxd
+-rw-r--r--   0 tom        (501) staff       (20)    16320 2023-05-23 14:50:54.000000 medicc2-1.0.0/fstlib/cext/cops.h
+-rw-r--r--   0 tom        (501) staff       (20)     1018 2023-05-23 14:50:54.000000 medicc2-1.0.0/fstlib/cext/cops.pxd
+-rw-r--r--   0 tom        (501) staff       (20)    22785 2023-05-23 14:50:54.000000 medicc2-1.0.0/fstlib/cext/cpywrapfst.pxd
+-rw-r--r--   0 tom        (501) staff       (20)   287465 2023-05-24 14:35:39.000000 medicc2-1.0.0/fstlib/cext/ops.cpp
+-rw-r--r--   0 tom        (501) staff       (20)     2419 2023-05-24 13:14:05.000000 medicc2-1.0.0/fstlib/cext/ops.pyx
+-rw-r--r--   0 tom        (501) staff       (20)  2752037 2023-05-24 14:35:40.000000 medicc2-1.0.0/fstlib/cext/pywrapfst.cpp
+-rw-r--r--   0 tom        (501) staff       (20)    16028 2023-05-23 14:50:54.000000 medicc2-1.0.0/fstlib/cext/pywrapfst.pxd
+-rw-r--r--   0 tom        (501) staff       (20)   149233 2023-05-23 14:50:54.000000 medicc2-1.0.0/fstlib/cext/pywrapfst.pyx
+-rw-r--r--   0 tom        (501) staff       (20)    18739 2023-05-24 13:14:05.000000 medicc2-1.0.0/fstlib/core.py
+-rw-r--r--   0 tom        (501) staff       (20)     7036 2023-05-24 13:14:05.000000 medicc2-1.0.0/fstlib/ext.py
+-rw-r--r--   0 tom        (501) staff       (20)    10235 2023-05-24 13:14:05.000000 medicc2-1.0.0/fstlib/factory.py
+-rw-r--r--   0 tom        (501) staff       (20)      397 2023-05-23 14:44:52.000000 medicc2-1.0.0/fstlib/logging_conf.yaml
+-rw-r--r--   0 tom        (501) staff       (20)     2609 2023-05-24 13:14:05.000000 medicc2-1.0.0/fstlib/paths.py
+-rw-r--r--   0 tom        (501) staff       (20)     1446 2023-05-23 14:44:52.000000 medicc2-1.0.0/fstlib/test_fstlib.py
+-rw-r--r--   0 tom        (501) staff       (20)     5794 2023-05-24 13:14:05.000000 medicc2-1.0.0/fstlib/tools.py
+drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-24 14:35:41.302316 medicc2-1.0.0/medicc/
+-rw-r--r--   0 tom        (501) staff       (20)      629 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/__init__.py
+-rw-r--r--   0 tom        (501) staff       (20)     3540 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/ancestors.py
+-rw-r--r--   0 tom        (501) staff       (20)    10115 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/bootstrap.py
+-rw-r--r--   0 tom        (501) staff       (20)    20683 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/core.py
+-rw-r--r--   0 tom        (501) staff       (20)    23763 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/event_reconstruction.py
+-rw-r--r--   0 tom        (501) staff       (20)     8045 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/factory.py
+-rw-r--r--   0 tom        (501) staff       (20)    15900 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/io.py
+-rw-r--r--   0 tom        (501) staff       (20)      780 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/logging_conf.yaml
+-rw-r--r--   0 tom        (501) staff       (20)     5483 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/nj.py
+drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-24 14:35:41.317004 medicc2-1.0.0/medicc/objects/
+-rw-r--r--   0 tom        (501) staff       (20)    56129 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/objects/Davoli_2013_TSG_OG_genes.bed
+-rw-r--r--   0 tom        (501) staff       (20)     1382 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/objects/hg19_chromosome_arms.bed
+-rw-r--r--   0 tom        (501) staff       (20)     1382 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/objects/hg38_chromosome_arms.bed
+-rw-r--r--   0 tom        (501) staff       (20)   253982 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/objects/no_wgd_asymm.fst
+-rw-r--r--   0 tom        (501) staff       (20)   572114 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/objects/wgd_1_asymm.fst
+-rw-r--r--   0 tom        (501) staff       (20)   689774 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/objects/wgd_2_asymm.fst
+-rw-r--r--   0 tom        (501) staff       (20)   783870 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/objects/wgd_asymm.fst
+-rw-r--r--   0 tom        (501) staff       (20)   546246 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/objects/wgd_total_cn_1_asymm.fst
+-rw-r--r--   0 tom        (501) staff       (20)   656310 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/objects/wgd_total_cn_asymm.fst
+-rw-r--r--   0 tom        (501) staff       (20)   519890 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/objects/wgd_x2_1_asymm.fst
+-rw-r--r--   0 tom        (501) staff       (20)   591554 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/objects/wgd_x2_asymm.fst
+-rw-r--r--   0 tom        (501) staff       (20)    42216 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/plot.py
+-rw-r--r--   0 tom        (501) staff       (20)     7644 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/sim.py
+-rw-r--r--   0 tom        (501) staff       (20)     2646 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/stats.py
+-rw-r--r--   0 tom        (501) staff       (20)     4934 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/test_fsts.py
+-rw-r--r--   0 tom        (501) staff       (20)    21224 2023-05-23 14:44:50.000000 medicc2-1.0.0/medicc/test_medicc.py
+-rw-r--r--   0 tom        (501) staff       (20)     5150 2023-05-24 14:32:47.000000 medicc2-1.0.0/medicc/tools.py
+-rw-r--r--   0 tom        (501) staff       (20)    14892 2023-05-24 13:15:32.000000 medicc2-1.0.0/medicc2
+drwxr-xr-x   0 tom        (501) staff       (20)        0 2023-05-24 14:35:41.322245 medicc2-1.0.0/medicc2.egg-info/
+-rw-r--r--   0 tom        (501) staff       (20)    19731 2023-05-24 14:35:41.000000 medicc2-1.0.0/medicc2.egg-info/PKG-INFO
+-rw-r--r--   0 tom        (501) staff       (20)     1286 2023-05-24 14:35:41.000000 medicc2-1.0.0/medicc2.egg-info/SOURCES.txt
+-rw-r--r--   0 tom        (501) staff       (20)        1 2023-05-24 14:35:41.000000 medicc2-1.0.0/medicc2.egg-info/dependency_links.txt
+-rw-r--r--   0 tom        (501) staff       (20)      120 2023-05-24 14:35:41.000000 medicc2-1.0.0/medicc2.egg-info/requires.txt
+-rw-r--r--   0 tom        (501) staff       (20)       14 2023-05-24 14:35:41.000000 medicc2-1.0.0/medicc2.egg-info/top_level.txt
+-rw-r--r--   0 tom        (501) staff       (20)       70 2023-05-23 14:44:50.000000 medicc2-1.0.0/pyproject.toml
+-rw-r--r--   0 tom        (501) staff       (20)       38 2023-05-24 14:35:41.323259 medicc2-1.0.0/setup.cfg
+-rw-r--r--   0 tom        (501) staff       (20)     2169 2023-05-24 14:32:47.000000 medicc2-1.0.0/setup.py
```

### Comparing `medicc2-0.9.2/LICENSE` & `medicc2-1.0.0/LICENSE`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/PKG-INFO` & `medicc2-1.0.0/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: medicc2
-Version: 0.9.2
+Version: 1.0.0
 Summary: Whole-genome doubling-aware copy number phylogenies for cancer evolution
 Home-page: https://bitbucket.org/schwarzlab/medicc2
 Author: Tom L Kaufmann, Marina Petkovic, Roland F Schwarz
 Author-email: tkau93@gmail.com, marina.55kovic@gmail.com, roland.f.schwarz@gmail.com
 License: GPL-3
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: MIT License
@@ -21,30 +21,32 @@
 For more information see the accompanying publication [Whole-genome doubling-aware copy number phylogenies for cancer evolution with MEDICC2](https://genomebiology.biomedcentral.com/articles/10.1186/s13059-022-02794-9).
 
 # Installation
 Install MEDICC2 via conda (recommended), pip or from source. MEDICC2 was developed and tested on unix-built systems (Linux and MacOS). For Windows users we recommended WSL2.
 
 Note that the notebooks and examples are not included when installing from conda or pip. When installing from pip or source, you need to make sure to have a working version of `gcc` and `gxx` installed.
 
-Due to dependencies we recommend using Python version 3.7-3.9.
 
 ## Installation via conda (recommended)
-It is best to use a dedicated conda environment for your MEDICC2 installation with `conda create -n medicc_env python=3.9`.
+It is best to use a dedicated conda environment for your MEDICC2 installation with `conda create -n medicc_env`.
 
 After activating the environment with `conda activate medicc_env` you can install MEDICC2 via `conda install -c bioconda -c conda-forge medicc2`.
 
 ## Installation via pip
-As MEDICC2 relies on OpenFST version 1.8.1 which is not packaged on PyPi you have to first install it using conda with `conda install -c conda-forge openfst=1.8.1`. Next you can install MEDICC2 via `pip install medicc2`.
+As MEDICC2 relies on OpenFST version 1.8.2 which is not packaged on PyPi you have to first install it using conda with `conda install -c conda-forge openfst=1.8.2`. Next you can install MEDICC2 via `pip install medicc2`.
 
 ## Installation from source
 Clone the MEDICC2 repository and its submodules using `git clone --recursive https://bitbucket.org/schwarzlab/medicc2.git`. It is important to use the `--recursive` flag to also download the modified OpenFST submodule.
 
-All dependencies including OpenFST (v1.8.1) should be directly installable via conda. A yaml file with a suggested MEDICC2 conda environment is provided in 'doc/medicc2.yml'. You can create a new conda environment with all requirements using `conda env create -f doc/medicc2.yml -n medicc_env`.
+All dependencies including OpenFST (v1.8.2) should be directly installable via conda. A yaml file with a suggested MEDICC2 conda environment is provided in 'doc/medicc2.yml'. You can create a new conda environment with all requirements using `conda env create -f doc/medicc2.yml -n medicc_env`.
 
-Then, inside the `medicc2` folder, run `pip install .` to install MEDICC2 to your environment. 
+Then, inside the `medicc2` folder, run `pip install .` to install MEDICC2 to your environment.
+
+## Development mode
+If you want to make changes to the MEDICC2 source code, install MEDICC2 as explained above in "Installation from source" but install in editable mode (with `pip install -e .`). Any changes to the local files will now be reflected in your environment.
 
 # Usage
 After installing MEDICC2, you can use MEDICC2 functions in python scripts (through `import medicc`) and from the command line. General usage from the command line is `medicc2 path/to/input/file path/to/output/folder`. Run `medicc2 --help` for information on optional arguments.
 
 Logging settings can be changed using the `medicc/logging_conf.yaml` file with the standard python logging syntax.
 
 ## Command line Flags
```

### Comparing `medicc2-0.9.2/README.md` & `medicc2-1.0.0/README.md`

 * *Files 0% similar despite different names*

```diff
@@ -6,30 +6,32 @@
 For more information see the accompanying publication [Whole-genome doubling-aware copy number phylogenies for cancer evolution with MEDICC2](https://genomebiology.biomedcentral.com/articles/10.1186/s13059-022-02794-9).
 
 # Installation
 Install MEDICC2 via conda (recommended), pip or from source. MEDICC2 was developed and tested on unix-built systems (Linux and MacOS). For Windows users we recommended WSL2.
 
 Note that the notebooks and examples are not included when installing from conda or pip. When installing from pip or source, you need to make sure to have a working version of `gcc` and `gxx` installed.
 
-Due to dependencies we recommend using Python version 3.7-3.9.
 
 ## Installation via conda (recommended)
-It is best to use a dedicated conda environment for your MEDICC2 installation with `conda create -n medicc_env python=3.9`.
+It is best to use a dedicated conda environment for your MEDICC2 installation with `conda create -n medicc_env`.
 
 After activating the environment with `conda activate medicc_env` you can install MEDICC2 via `conda install -c bioconda -c conda-forge medicc2`.
 
 ## Installation via pip
-As MEDICC2 relies on OpenFST version 1.8.1 which is not packaged on PyPi you have to first install it using conda with `conda install -c conda-forge openfst=1.8.1`. Next you can install MEDICC2 via `pip install medicc2`.
+As MEDICC2 relies on OpenFST version 1.8.2 which is not packaged on PyPi you have to first install it using conda with `conda install -c conda-forge openfst=1.8.2`. Next you can install MEDICC2 via `pip install medicc2`.
 
 ## Installation from source
 Clone the MEDICC2 repository and its submodules using `git clone --recursive https://bitbucket.org/schwarzlab/medicc2.git`. It is important to use the `--recursive` flag to also download the modified OpenFST submodule.
 
-All dependencies including OpenFST (v1.8.1) should be directly installable via conda. A yaml file with a suggested MEDICC2 conda environment is provided in 'doc/medicc2.yml'. You can create a new conda environment with all requirements using `conda env create -f doc/medicc2.yml -n medicc_env`.
+All dependencies including OpenFST (v1.8.2) should be directly installable via conda. A yaml file with a suggested MEDICC2 conda environment is provided in 'doc/medicc2.yml'. You can create a new conda environment with all requirements using `conda env create -f doc/medicc2.yml -n medicc_env`.
 
-Then, inside the `medicc2` folder, run `pip install .` to install MEDICC2 to your environment. 
+Then, inside the `medicc2` folder, run `pip install .` to install MEDICC2 to your environment.
+
+## Development mode
+If you want to make changes to the MEDICC2 source code, install MEDICC2 as explained above in "Installation from source" but install in editable mode (with `pip install -e .`). Any changes to the local files will now be reflected in your environment.
 
 # Usage
 After installing MEDICC2, you can use MEDICC2 functions in python scripts (through `import medicc`) and from the command line. General usage from the command line is `medicc2 path/to/input/file path/to/output/folder`. Run `medicc2 --help` for information on optional arguments.
 
 Logging settings can be changed using the `medicc/logging_conf.yaml` file with the standard python logging syntax.
 
 ## Command line Flags
```

### Comparing `medicc2-0.9.2/fstlib/algos.py` & `medicc2-1.0.0/fstlib/algos.py`

 * *Files 24% similar despite different names*

```diff
@@ -5,537 +5,385 @@
 
 FST algorithms
 '''
 
 import array
 import functools
 import logging
+import collections
 
 import numpy as np
 
 import fstlib.core
 #from fstlib.core import *
 import fstlib.tools
 
 log = logging.getLogger(__name__)
 
 class FstAlgoError(Exception):
-	pass
+    pass
 
 class ConfusionNetworkFromLattice(object):
-	""" Expects lattice in the form of a FST object. 
-	Requires lattice to be topologically sorted
-	(arcs are always directed from lower to higher state ids). It might require (not sure)
+    """ Expects lattice in the form of a FST object. 
+    Requires lattice to be topologically sorted
+    (arcs are always directed from lower to higher state ids). It might require (not sure)
    the initial state to have index 0. """
-	def __init__(self, lattice):
-		self.lattice = lattice
-		self.state2set = None ## state set ids for each state in lattice
-		self.statesets = None ## list of lists of state ids contained in the state sets
-		self.edgesets = None ## new edges between state sets
-		
-	def run(self, collapse_arcs=True):
-		log.info('Constructing confusion network...')
-		lattice = self.lattice
-		outfst = fstlib.core.Fst(arc_type = self.lattice.arc_type())
-		outfst.set_input_symbols(self.lattice.input_symbols())
-		outfst.set_output_symbols(self.lattice.output_symbols())
-		timeslices = fstlib.shortestdistance(fstlib.arcmap(fstlib.arcmap(fstlib.arcmap(self.lattice, map_type='rmweight'), map_type='times', weight=1), map_type='to_std'))
-		statemap = np.array([int(float(t)) for t in timeslices])
-		newstates = np.array(outfst.add_states(np.unique(statemap).shape[0]))
-		outfst.set_start(newstates[0])
-		for s in newstates:
-			weights = [self.lattice.final(t) for t in np.flatnonzero(statemap==s) if self.lattice.is_final(t)]
-			if len(weights)>0: ## newstate is final if any of the merged states were final (have non-inf weights)
-				total_weight = functools.reduce(fstlib.times, weights)
-				outfst.set_final(s, total_weight)
-
-		for state in self.lattice.states():
-			newstate = statemap[state]
-			for arc in self.lattice.arcs(state):
-				newnextstate = statemap[arc.nextstate]
-				outfst.add_arc(newstate, (arc.ilabel, arc.olabel, arc.weight, newnextstate))
-
-		if collapse_arcs:
-			outfst=fstlib.determinize(outfst)
-		return outfst
+    def __init__(self, lattice):
+        self.lattice = lattice
+        self.state2set = None ## state set ids for each state in lattice
+        self.statesets = None ## list of lists of state ids contained in the state sets
+        self.edgesets = None ## new edges between state sets
+        
+    def run(self, collapse_arcs=True):
+        log.info('Constructing confusion network...')
+        lattice = self.lattice
+        outfst = fstlib.core.Fst(arc_type = self.lattice.arc_type())
+        outfst.set_input_symbols(self.lattice.input_symbols())
+        outfst.set_output_symbols(self.lattice.output_symbols())
+        timeslices = fstlib.shortestdistance(fstlib.arcmap(fstlib.arcmap(fstlib.arcmap(self.lattice, map_type='rmweight'), map_type='times', weight=1), map_type='to_std'))
+        statemap = np.array([int(float(t)) for t in timeslices])
+        newstates = np.array(outfst.add_states(np.unique(statemap).shape[0]))
+        outfst.set_start(newstates[0])
+        for s in newstates:
+            weights = [self.lattice.final(t) for t in np.flatnonzero(statemap==s) if self.lattice.is_final(t)]
+            if len(weights)>0: ## newstate is final if any of the merged states were final (have non-inf weights)
+                total_weight = functools.reduce(fstlib.times, weights)
+                outfst.set_final(s, total_weight)
+
+        for state in self.lattice.states():
+            newstate = statemap[state]
+            for arc in self.lattice.arcs(state):
+                newnextstate = statemap[arc.nextstate]
+                outfst.add_arc(newstate, (arc.ilabel, arc.olabel, arc.weight, newnextstate))
+
+        if collapse_arcs:
+            outfst=fstlib.determinize(outfst)
+        return outfst
 
 class PosteriorDecoding(object):
-	""" expects pFSA in binary (i.e. openfst) format """
-	def __init__(self, ifst):
-		self.ifst = ifst
-
-	def run(self):
-		alpha = fstlib.shortestdistance(self.ifst)
-		beta = fstlib.shortestdistance(self.ifst, reverse=True)
-		
-		outfst = fstlib.core.Fst(arc_type=self.ifst.arc_type())
-		outfst.set_input_symbols(self.ifst.input_symbols())
-		outfst.set_output_symbols(self.ifst.output_symbols())
-		
-		for state in self.ifst.states():
-			newstate = outfst.add_state()
-			if self.ifst.is_final(state):
-				outfst.set_final(newstate, self.ifst.final(state))
-			if state != newstate:
-				raise FSTError('State mapping error') 
-				## this must not happen; I'm not sure it can currently due to the way the states are handled
-		initial_state = self.ifst.start()
-		outfst.set_start(initial_state)
-		for state in self.ifst.states():
-			for arc in self.ifst.arcs(state):
-				posterior = float(alpha[state]) + float(arc.weight) + float(beta[arc.nextstate]) - float(beta[initial_state])
-				outfst.add_arc(state, (arc.ilabel, arc.olabel, posterior, arc.nextstate))
-		return outfst
+    """ expects pFSA in binary (i.e. openfst) format """
+    def __init__(self, ifst):
+        self.ifst = ifst
+
+    def run(self):
+        alpha = fstlib.shortestdistance(self.ifst)
+        beta = fstlib.shortestdistance(self.ifst, reverse=True)
+        
+        outfst = fstlib.core.Fst(arc_type=self.ifst.arc_type())
+        outfst.set_input_symbols(self.ifst.input_symbols())
+        outfst.set_output_symbols(self.ifst.output_symbols())
+        
+        for state in self.ifst.states():
+            newstate = outfst.add_state()
+            if self.ifst.is_final(state):
+                outfst.set_final(newstate, self.ifst.final(state))
+            if state != newstate:
+                raise FSTlibAlgosError('State mapping error') 
+                ## this must not happen; I'm not sure it can currently due to the way the states are handled
+        initial_state = self.ifst.start()
+        outfst.set_start(initial_state)
+        for state in self.ifst.states():
+            for arc in self.ifst.arcs(state):
+                posterior = float(alpha[state]) + float(arc.weight) + float(beta[arc.nextstate]) - float(beta[initial_state])
+                outfst.add_arc(state, (arc.ilabel, arc.olabel, posterior, arc.nextstate))
+        return outfst
 
 class AbstractCountDP(object):
-	def __init__(self, fst, trans_cache=None, state_depth_cache=None):
-		""" constructor """
-		self.fst = fst
-		
-		## if transition cache was given use it, otherwise create it
-		if trans_cache == None:
-			self._build_trans_cache()
-		else:
-			self._trans_cache = trans_cache
-		
-		## if state depth cache was given use it, otherwise create it
-		if state_depth_cache == None:
-			self._build_state_depth_cache()
-		else:
-			self._state_depth_cache = state_depth_cache
-			
-		assert(fst != None)
-
-	def _build_trans_cache(self):
-		#self._trans_cache = numpy.empty( (len(self.fst.states), len(self.fst.states)), dtype="object")
-		self._trans_cache = [0] * len(self.fst.states)
-		self._trans_cache = [[i] * len(self.fst.states) for i in self._trans_cache]
-		
-		for i in range(0, len(self.fst.states)):
-			from_transs = [t for t in self.fst.arcs if t.state_from.id == i]
-			for j in range(0, len(self.fst.states)):
-				transs = len([t for t in from_transs if t.state_to.id == j])
-				self._trans_cache[i][j] = transs
-				
-	def _build_state_depth_cache(self):
-		""" tries to speed up the algo """
-		self._state_depth_cache=list()
-		depth = 0
-		self._build_state_depth_cache_recurse(self.fst.states[0], depth)
-		
-	def _build_state_depth_cache_recurse(self, state, depth):
-		""" recursion function of the pre inspection """
-		
-		if len(self._state_depth_cache) <= depth:
-			self._state_depth_cache.append(set())
-		self._state_depth_cache[depth].add(state.id)
-		
-		targets = list(set([t.state_to for t in state.get_outgoing_transitions()]))
-		for s in targets:
-			self._build_state_depth_cache_recurse(s, depth + 1)
-
-	def max_seq_len(self):
-		return len(self._state_depth_cache)-1
-
-	def get_transition_cache(self):
-		return self._trans_cache
-	
-	def get_state_depth_cache(self):
-		return self._state_depth_cache
-				
-		
+    def __init__(self, fst, trans_cache=None, state_depth_cache=None):
+        """ constructor """
+        self.fst = fst
+        
+        ## if transition cache was given use it, otherwise create it
+        if trans_cache == None:
+            self._build_trans_cache()
+        else:
+            self._trans_cache = trans_cache
+        
+        ## if state depth cache was given use it, otherwise create it
+        if state_depth_cache == None:
+            self._build_state_depth_cache()
+        else:
+            self._state_depth_cache = state_depth_cache
+            
+        assert(fst != None)
+
+    def _build_trans_cache(self):
+        #self._trans_cache = numpy.empty( (len(self.fst.states), len(self.fst.states)), dtype="object")
+        self._trans_cache = [0] * len(self.fst.states)
+        self._trans_cache = [[i] * len(self.fst.states) for i in self._trans_cache]
+        
+        for i in range(0, len(self.fst.states)):
+            from_transs = [t for t in self.fst.arcs if t.state_from.id == i]
+            for j in range(0, len(self.fst.states)):
+                transs = len([t for t in from_transs if t.state_to.id == j])
+                self._trans_cache[i][j] = transs
+                
+    def _build_state_depth_cache(self):
+        """ tries to speed up the algo """
+        self._state_depth_cache=list()
+        depth = 0
+        self._build_state_depth_cache_recurse(self.fst.states[0], depth)
+        
+    def _build_state_depth_cache_recurse(self, state, depth):
+        """ recursion function of the pre inspection """
+        
+        if len(self._state_depth_cache) <= depth:
+            self._state_depth_cache.append(set())
+        self._state_depth_cache[depth].add(state.id)
+        
+        targets = list(set([t.state_to for t in state.get_outgoing_transitions()]))
+        for s in targets:
+            self._build_state_depth_cache_recurse(s, depth + 1)
+
+    def max_seq_len(self):
+        return len(self._state_depth_cache)-1
+
+    def get_transition_cache(self):
+        return self._trans_cache
+    
+    def get_state_depth_cache(self):
+        return self._state_depth_cache
+                
+        
 class ForwardCountDP(AbstractCountDP):
-	""" Dynamic programming forward algorithm.
-	This is not in log space and very generic. """
-	
-	def __init__(self, fst, trans_cache=None, state_depth_cache=None):
-		""" constructor """
-		super(ForwardCountDP, self).__init__(fst, trans_cache, state_depth_cache)
-		self.alpha = None
-		self._run()
-		
-	def _run(self):
-		""" main algorithm """
-		
-		nstates = len(self.fst.states)
-		## initialize the forward matrix
-		# the sequence index starts with 1, 0 means "no part of the sequence seen so far"
-		##self.alpha = numpy.zeros((nstates, 1))
-		self.alpha = list()
-		for i in range(0, self.max_seq_len() + 1):
-			self.alpha.append(array.array("L", [0] * nstates))
-		
-		# we assume the starting state is always state 0
-		self.alpha[0][0] = 1 
-
-		for seqpos in range(1, self.max_seq_len() + 1):
-			for stateid_to in self._state_depth_cache[seqpos]:
-				value = 0
-				for stateid_from in self._state_depth_cache[seqpos-1]:
-					value += self._trans_cache[stateid_from][stateid_to] * self.alpha[seqpos-1][stateid_from]
-				self.alpha[seqpos][stateid_to] = value
-	
+    """ Dynamic programming forward algorithm.
+    This is not in log space and very generic. """
+    
+    def __init__(self, fst, trans_cache=None, state_depth_cache=None):
+        """ constructor """
+        super(ForwardCountDP, self).__init__(fst, trans_cache, state_depth_cache)
+        self.alpha = None
+        self._run()
+        
+    def _run(self):
+        """ main algorithm """
+        
+        nstates = len(self.fst.states)
+        ## initialize the forward matrix
+        # the sequence index starts with 1, 0 means "no part of the sequence seen so far"
+        ##self.alpha = numpy.zeros((nstates, 1))
+        self.alpha = list()
+        for i in range(0, self.max_seq_len() + 1):
+            self.alpha.append(array.array("L", [0] * nstates))
+        
+        # we assume the starting state is always state 0
+        self.alpha[0][0] = 1 
+
+        for seqpos in range(1, self.max_seq_len() + 1):
+            for stateid_to in self._state_depth_cache[seqpos]:
+                value = 0
+                for stateid_from in self._state_depth_cache[seqpos-1]:
+                    value += self._trans_cache[stateid_from][stateid_to] * self.alpha[seqpos-1][stateid_from]
+                self.alpha[seqpos][stateid_to] = value
+    
 class BackwardCountDP(AbstractCountDP):
-	def __init__(self, fst, trans_cache=None, state_depth_cache=None):
-		""" constructor """
-		super(BackwardCountDP, self).__init__(fst, trans_cache, state_depth_cache)
-		self.beta = None
-		self._run()
-
-	
-	def _run(self):
-		""" main algorithm """
-		
-		## initialize the forward matrix
-		# the sequence index starts with 1, 0 means "no part of the sequence seen so far"
-		nstates = len(self.fst.states)
-		self.beta = list()
-		for stateid_from in range(0, self.max_seq_len() + 1):
-			self.beta.append(array.array("L", [0] * nstates))
-		
-		# all final states are assigned 1
-		for id in self._state_depth_cache[self.max_seq_len()]:
-			self.beta[self.max_seq_len()][id] = 1 
-
-		for seqpos in range(self.max_seq_len()-1, -1, -1):
-			for stateid_from in self._state_depth_cache[seqpos]:
-				value = 0
-				for stateid_to in self._state_depth_cache[seqpos + 1]:
-					value += self.beta[seqpos+1][stateid_to] * self._trans_cache[stateid_from][stateid_to]  
-				self.beta[seqpos][stateid_from] = value
+    def __init__(self, fst, trans_cache=None, state_depth_cache=None):
+        """ constructor """
+        super(BackwardCountDP, self).__init__(fst, trans_cache, state_depth_cache)
+        self.beta = None
+        self._run()
+
+    
+    def _run(self):
+        """ main algorithm """
+        
+        ## initialize the forward matrix
+        # the sequence index starts with 1, 0 means "no part of the sequence seen so far"
+        nstates = len(self.fst.states)
+        self.beta = list()
+        for stateid_from in range(0, self.max_seq_len() + 1):
+            self.beta.append(array.array("L", [0] * nstates))
+        
+        # all final states are assigned 1
+        for id in self._state_depth_cache[self.max_seq_len()]:
+            self.beta[self.max_seq_len()][id] = 1 
+
+        for seqpos in range(self.max_seq_len()-1, -1, -1):
+            for stateid_from in self._state_depth_cache[seqpos]:
+                value = 0
+                for stateid_to in self._state_depth_cache[seqpos + 1]:
+                    value += self.beta[seqpos+1][stateid_to] * self._trans_cache[stateid_from][stateid_to]  
+                self.beta[seqpos][stateid_from] = value
 
 class PosteriorDecodingCountDP(AbstractCountDP):
-	""" Dynamic programming algorithm for posterior decoding of counts """
-	
-	def __init__(self, fst):
-		
-		""" constructor """
-		self.forward_algo = ForwardCountDP(fst)
-		self.backward_algo = BackwardCountDP(fst,  
-								   self.forward_algo.get_transition_cache(),
-								   self.forward_algo.get_state_depth_cache())
-		super(PosteriorDecodingCountDP, self).__init__(fst, 
-												  self.forward_algo.get_transition_cache(),
-												  self.forward_algo.get_state_depth_cache())        
-		self.posterior = [dict() for i in range(0, self.max_seq_len())]
-		self._run()
-		
-	def _run(self):
-		""" main algorithm """
-		nstates = len(self.fst.states)
-		
-		for pos in range(0, self.max_seq_len()):
-			for state_from in self._state_depth_cache[pos]:
-				all_transitions = self.fst.states[state_from].get_outgoing_transitions()
-				for state_to in self._state_depth_cache[pos+1]:
-					transitions = [t for t in all_transitions if t.state_to.id == state_to]
-					fw = self.forward_algo.alpha[pos][state_from]
-					bw = self.backward_algo.beta[pos+1][state_to]
-					for trans in transitions:
-						try:
-							value = self.posterior[pos][trans.isymbol]
-						except KeyError:
-							value = 0
-						value += fw * numpy.exp(-trans.weight) * bw
-						self.posterior[pos][trans.isymbol] = value
+    """ Dynamic programming algorithm for posterior decoding of counts """
+    
+    def __init__(self, fst):
+        
+        """ constructor """
+        self.forward_algo = ForwardCountDP(fst)
+        self.backward_algo = BackwardCountDP(fst,  
+                                   self.forward_algo.get_transition_cache(),
+                                   self.forward_algo.get_state_depth_cache())
+        super(PosteriorDecodingCountDP, self).__init__(fst, 
+                                                  self.forward_algo.get_transition_cache(),
+                                                  self.forward_algo.get_state_depth_cache())        
+        self.posterior = [dict() for i in range(0, self.max_seq_len())]
+        self._run()
+        
+    def _run(self):
+        """ main algorithm """
+        nstates = len(self.fst.states)
+        
+        for pos in range(0, self.max_seq_len()):
+            for state_from in self._state_depth_cache[pos]:
+                all_transitions = self.fst.states[state_from].get_outgoing_transitions()
+                for state_to in self._state_depth_cache[pos+1]:
+                    transitions = [t for t in all_transitions if t.state_to.id == state_to]
+                    fw = self.forward_algo.alpha[pos][state_from]
+                    bw = self.backward_algo.beta[pos+1][state_to]
+                    for trans in transitions:
+                        try:
+                            value = self.posterior[pos][trans.isymbol]
+                        except KeyError:
+                            value = 0
+                        value += fw * np.exp(-trans.weight) * bw
+                        self.posterior[pos][trans.isymbol] = value
 
 
 
 class AbstractDP(object):
-	def __init__(self, fst, trans_cache=None):
-		""" constructor """
-		self.fst = fst
-		if trans_cache == None:
-			self._build_cache()
-		else:
-			self._trans_cache = trans_cache
-		assert(fst != None)
-
-	def _get_transitions(self, state_from, state_to):
-		""" returns all transitions between states with caching.
-		Expects numerical state ids. """
-		
-		return self._trans_cache[state_from][state_to]
-	
-	def _build_cache(self):
-		#self._trans_cache = numpy.empty( (len(self.fst.states), len(self.fst.states)), dtype="object")
-		self._trans_cache = [None] * len(self.fst.states)
-		self._trans_cache = [[i] * len(self.fst.states) for i in self._trans_cache]
-		
-		for i in range(0, len(self.fst.states)):
-			from_transs = [t for t in self.fst.arcs if t.state_from.id == i]
-			for j in range(0, len(self.fst.states)):
-				transs = array.array('f', [t.weight for t in from_transs if t.state_to.id == j])
-				self._trans_cache[i][j] = transs
-				
-				
-		
+    def __init__(self, fst, trans_cache=None):
+        """ constructor """
+        self.fst = fst
+        if trans_cache == None:
+            self._build_cache()
+        else:
+            self._trans_cache = trans_cache
+        assert(fst != None)
+
+    def _get_transitions(self, state_from, state_to):
+        """ returns all transitions between states with caching.
+        Expects numerical state ids. """
+        
+        return self._trans_cache[state_from][state_to]
+    
+    def _build_cache(self):
+        #self._trans_cache = numpy.empty( (len(self.fst.states), len(self.fst.states)), dtype="object")
+        self._trans_cache = [None] * len(self.fst.states)
+        self._trans_cache = [[i] * len(self.fst.states) for i in self._trans_cache]
+        
+        for i in range(0, len(self.fst.states)):
+            from_transs = [t for t in self.fst.arcs if t.state_from.id == i]
+            for j in range(0, len(self.fst.states)):
+                transs = array.array('f', [t.weight for t in from_transs if t.state_to.id == j])
+                self._trans_cache[i][j] = transs
+                
+                
+        
 class PosteriorDecodingDP(AbstractDP):
-	""" Dynamic programming algorithm for posterior decoding """
-	
-	def __init__(self, fst):
-		""" constructor """
-		super(PosteriorDecodingDP, self).__init__(fst)        
-		self.forward_algo = ForwardDP(self.fst)
-		self.backward_algo = BackwardDP(self.fst, 
-								   self.forward_algo.get_sequence_length(), 
-								   self.forward_algo.get_transition_cache())
-		self._trans_cache = self.forward_algo.get_transition_cache()
-		self.posterior = [dict() for i in range(0, self.forward_algo.get_sequence_length())]
-		self._run()
-		
-	def _run(self):
-		""" main algorithm """
-		
-		
-		for pos in range(0, self.forward_algo.get_sequence_length()):
-			for state_from in range(0, len(self.fst.states)):
-				for state_to in range(0, len(self.fst.states)):
-					transitions = self._get_transitions(state_from, state_to)
-					fw = self.forward_algo.alpha[state_from, pos]
-					bw = self.backward_algo.beta[state_to, pos+1]
-					for trans in transitions:
-						try:
-							value = self.posterior[pos][trans.isymbol]
-						except KeyError:
-							value = 0
-						value += fw * numpy.exp(-trans.weight) * bw
-						self.posterior[pos][trans.isymbol] = value
-						
-		
+    """ Dynamic programming algorithm for posterior decoding """
+    
+    def __init__(self, fst):
+        """ constructor """
+        super(PosteriorDecodingDP, self).__init__(fst)        
+        self.forward_algo = ForwardDP(self.fst)
+        self.backward_algo = BackwardDP(self.fst, 
+                                   self.forward_algo.get_sequence_length(), 
+                                   self.forward_algo.get_transition_cache())
+        self._trans_cache = self.forward_algo.get_transition_cache()
+        self.posterior = [dict() for i in range(0, self.forward_algo.get_sequence_length())]
+        self._run()
+        
+    def _run(self):
+        """ main algorithm """
+        
+        
+        for pos in range(0, self.forward_algo.get_sequence_length()):
+            for state_from in range(0, len(self.fst.states)):
+                for state_to in range(0, len(self.fst.states)):
+                    transitions = self._get_transitions(state_from, state_to)
+                    fw = self.forward_algo.alpha[state_from, pos]
+                    bw = self.backward_algo.beta[state_to, pos+1]
+                    for trans in transitions:
+                        try:
+                            value = self.posterior[pos][trans.isymbol]
+                        except KeyError:
+                            value = 0
+                        value += fw * np.exp(-trans.weight) * bw
+                        self.posterior[pos][trans.isymbol] = value
+                        
+        
 class ForwardDP(AbstractDP):
-	""" Dynamic programming forward algorithm.
-	This is not in log space and very generic. """
-	
-	def __init__(self, fst, trans_cache=None):
-		""" constructor """
-		super(ForwardDP, self).__init__(fst, trans_cache)
-		self.alpha = None        
-		self._run()
-		
-	def _run(self):
-		""" main algorithm """
-		
-		nstates = len(self.fst.states)
-		## initialize the forward matrix
-		# the sequence index starts with 1, 0 means "no part of the sequence seen so far"
-		##self.alpha = numpy.zeros((nstates, 1))
-		self.alpha = list()
-		self.alpha.append(array.array("f", [0] * nstates))
-		
-		# we assume the starting state is always state 0
-		self.alpha[0][0] = 1 
-
-		j=0
-		while j<len(self.alpha):
-			j+=1
-			column = array.array("f", [0] * nstates)
-			any_weight = False        
-			for i in range(0, nstates):
-				value = 0
-				for k in range(0, nstates):
-					transitions = self._trans_cache[k][i]
-					for t in transitions:
-						value += self.alpha[j-1][k] * math.exp(-t)  
-				column[i] = value
-				if value > 0.0: any_weight = True
-			if any_weight:
-				self.alpha.append(column)
-	
-	def get_sequence_length(self):
-		return len(self.alpha)
-	
-	def get_transition_cache(self):
-		return self._trans_cache
-				
+    """ Dynamic programming forward algorithm.
+    This is not in log space and very generic. """
+    
+    def __init__(self, fst, trans_cache=None):
+        """ constructor """
+        super(ForwardDP, self).__init__(fst, trans_cache)
+        self.alpha = None        
+        self._run()
+        
+    def _run(self):
+        """ main algorithm """
+        
+        nstates = len(self.fst.states)
+        ## initialize the forward matrix
+        # the sequence index starts with 1, 0 means "no part of the sequence seen so far"
+        ##self.alpha = numpy.zeros((nstates, 1))
+        self.alpha = list()
+        self.alpha.append(array.array("f", [0] * nstates))
+        
+        # we assume the starting state is always state 0
+        self.alpha[0][0] = 1 
+
+        j=0
+        while j<len(self.alpha):
+            j+=1
+            column = array.array("f", [0] * nstates)
+            any_weight = False        
+            for i in range(0, nstates):
+                value = 0
+                for k in range(0, nstates):
+                    transitions = self._trans_cache[k][i]
+                    for t in transitions:
+                        value += self.alpha[j-1][k] * np.exp(-t)  
+                column[i] = value
+                if value > 0.0: any_weight = True
+            if any_weight:
+                self.alpha.append(column)
+    
+    def get_sequence_length(self):
+        return len(self.alpha)
+    
+    def get_transition_cache(self):
+        return self._trans_cache
+                
 class BackwardDP(AbstractDP):
-	""" Dynamic programming backward algorithm.
-	This is not in log space and very generic. """
-	
-	def __init__(self, fst, seqlen, trans_cache=None):
-		""" constructor """
-		super(BackwardDP, self).__init__(fst, trans_cache)
-		self.seqlen = seqlen
-		self.beta = None
-		self._run()
-		
-	def _run(self):
-		""" main algorithm """
-		
-		## initialize the forward matrix
-		# the sequence index starts with 1, 0 means "no part of the sequence seen so far"
-		self.beta = numpy.zeros((len(self.fst.states), self.seqlen + 1))
-		
-		# all final states are assigned 1
-		for state in self.fst.states:
-			if state.is_final:
-				self.beta[state.id, self.seqlen] = 1 
-
-		for j in range(self.seqlen-1, -1, -1):
-			for i in range(0, len(self.fst.states)):
-				value = 0
-				for k in range(0, len(self.fst.states)):
-					transitions = self._get_transitions(i, k)
-					for t in transitions:
-						value += self.beta[k, j+1] * numpy.exp(-t)  
-				self.beta[i,j] = value
-		
-		
-
-class PathDepthFirstSearch(object):
-	""" recursively walks through the FST and prints the paths.
-	Make sure the FST does not contain loops, otherwise the function will not terminate. """
-	
-	def __init__(self, fst):
-		'''
-		Constructor
-		'''
-		self.fst = fst
-	
-	def get_paths(self):
-		""" generator that returns paths """
-
-		if self.fst.num_states()==0:
-			return
-
-		state = self.fst.start()
-		next_arc = {}
-		stack = []
-		path = fstlib.core.Path()
-
-		while state != None:
-			arcs = [a for a in self.fst.arcs(state)]
-			i = 0
-			try:
-				i = next_arc[state]
-			except KeyError:
-				pass
-			
-			if self.fst.num_arcs(state) > i: ## move forward
-				arc = arcs[i]  ## get forward transition
-				path.append(arc) ## save transition
-				stack.append(state) ## put state on stack
-				next_arc[state] = i + 1 ## increase trans counter by 1
-				state = arc.nextstate ## move to next state
-			else: ## move back
-				if self.fst.is_final(state): ## end node
-					path.finalWeight = self.fst.final(state)
-					yield path.copy()
-
-				next_arc[state] = 0    
-				try:
-					state = stack.pop()
-					path.pop()
-				except IndexError:
-					state = None
-				
-				
-							
-class FeatureDepthFirstSearch(object):
-	""" recursively walks through the FST and prints the paths.
-	Make sure the FST does not contain loops, otherwise the function will not terminate. """
-	
-	def __init__(self, fst):
-		'''
-		Constructor
-		'''
-		self.fst = fst
-		self.paths = []
-		self.path_limit = None
-		assert(fst != None)
-	
-	def run(self):
-		""" starts the recursion """
-		self.paths = []
-
-		self._iteration()
-	
-	def _iteration(self):
-		""" interative walk through the DAG """
-		
-		state = self.fst.states[0]
-		suffix_cache = {}
-		next_trans = {}
-		stack = []
-		counter = 0
-		max_depth = 0
-		while state != None:
-			transitions_out = state.get_outgoing_transitions()
-			i = 0
-			try:
-				i = next_trans[state]
-			except KeyError:
-				pass
-			
-			if len(transitions_out) > i: ## move forward
-				max_depth += 1
-				trans = transitions_out[i]  ## get forward transition
-				stack.append(state) ## put state on stack
-				next_trans[state] = i + 1 ## increase trans counter by 1
-				state = trans.state_to ## move to next state                
-				
-			else: ## generate suffixes and jump back
-				## do the jump back
-				#print counter
-				#counter += 1
-				
-				previous_state = None
-				try:
-					previous_state = stack.pop()
-				except IndexError:
-					pass
-				
-				if previous_state != None:
-					prev_trans_id = next_trans[previous_state] - 1
-					prev_trans = previous_state.get_outgoing_transitions()[prev_trans_id]
-					suffixes_current = [[max_depth - 0, -1, -1]]
-					try:
-						suffixes_current = suffix_cache[state]
-						#print suffixes_current
-					except KeyError:
-						pass
-					#print "word: %s" % str(word)
-					#print "concatenating..."
-					#new_suffixes = [[word] + s for s in suffixes]
-					#print "new suffixes:"
-					#print [[str(t) for t in s] for s in new_suffixes]
-						
-					suffixes_prev = None
-					try:
-						suffixes_prev = suffix_cache[previous_state]
-					except KeyError:
-						suffixes_prev = []
-						suffix_cache[previous_state] = suffixes_prev
-
-					for suf in suffixes_current:
-						new_suffix = [suf[0] - 1, suf[1], suf[2]]
-						if prev_trans.osymbol == "X":
-							assert( not(new_suffix[1] > -1 and new_suffix[2] > -1) )
-							if new_suffix[2] == -1:
-								new_suffix[2] = suf[0] - 2
-							elif new_suffix[1] == -1:
-								new_suffix[1] = suf[0]
-								
-						suffixes_prev.append(new_suffix)
-					
-					#print suffixes_prev
-						
-						#sc = sc + new_suffixes
-						#print "sc:"
-						#print [[str(t) for t in s] for s in sc]
-					
-						
-				
-				state = previous_state
-		
-		self.paths = suffix_cache[self.fst.states[0]]
-
+    """ Dynamic programming backward algorithm.
+    This is not in log space and very generic. """
+    
+    def __init__(self, fst, seqlen, trans_cache=None):
+        """ constructor """
+        super(BackwardDP, self).__init__(fst, trans_cache)
+        self.seqlen = seqlen
+        self.beta = None
+        self._run()
+        
+    def _run(self):
+        """ main algorithm """
+        
+        ## initialize the forward matrix
+        # the sequence index starts with 1, 0 means "no part of the sequence seen so far"
+        self.beta = np.zeros((len(self.fst.states), self.seqlen + 1))
+        
+        # all final states are assigned 1
+        for state in self.fst.states:
+            if state.is_final:
+                self.beta[state.id, self.seqlen] = 1 
+
+        for j in range(self.seqlen-1, -1, -1):
+            for i in range(0, len(self.fst.states)):
+                value = 0
+                for k in range(0, len(self.fst.states)):
+                    transitions = self._get_transitions(i, k)
+                    for t in transitions:
+                        value += self.beta[k, j+1] * np.exp(-t)  
+                self.beta[i,j] = value
+        
 def posterior_decoding(ifst, collapse_arcs=True):
-	pd = PosteriorDecoding(ifst).run()
-	conf = ConfusionNetworkFromLattice(pd).run(collapse_arcs)
-	return conf
-
-def map_log_to_real(x):
-	return np.exp(-float(x))
+    pd = PosteriorDecoding(ifst).run()
+    conf = ConfusionNetworkFromLattice(pd).run(collapse_arcs)
+    return conf
 
-def map_real_to_log(x):
-	return -np.log(float(x))
+class FSTlibAlgosError(Exception):
+    pass
```

### Comparing `medicc2-0.9.2/fstlib/cext/cops.h` & `medicc2-1.0.0/fstlib/cext/cops.h`

 * *Files 25% similar despite different names*

```diff
@@ -5,22 +5,25 @@
 #include <fst/script/fstscript.h>
 #include <fst/script/script-impl.h>
 #include <stdio.h>
 #include <iostream>
 #include <iomanip>
 #include <set>
 #include <map>
+// #include <chrono>
+
 
 //DEFINE_int32(v, 10, "v");
 const float mydelta = 1.0F/(8192.0F*4);
 
 using namespace fst;
+// using namespace std::chrono;
 
 //void shortest_path(script::FstClass &model, script::FstClass &input, script::FstClass &output, script::MutableFstClass* path, std::vector<script::WeightClass>* distance) {
-void shortest_path(script::FstClass &model, script::FstClass &input, script::FstClass &output, script::MutableFstClass* path) {	
+void align_std_impl(script::FstClass &model, script::FstClass &input, script::FstClass &output, script::MutableFstClass* path) {	
 	const Fst<StdArc> *tfst = model.GetFst<StdArc>();
 	const Fst<StdArc> *ifst1 = input.GetFst<StdArc>();
 	const Fst<StdArc> *ifst2 = output.GetFst<StdArc>();
 	MutableFst<StdArc> *ofst = path->GetMutableFst<StdArc>();
 
 	ArcSortFst<StdArc, OLabelCompare<StdArc> > input_sorted = ArcSortFst<StdArc, OLabelCompare<StdArc> >(*ifst1, OLabelCompare<StdArc>());
 	ArcSortFst<StdArc, ILabelCompare<StdArc> > output_sorted = ArcSortFst<StdArc, ILabelCompare<StdArc> >(*ifst2, ILabelCompare<StdArc>());
@@ -43,19 +46,20 @@
 	ShortestPath(result, ofst, &typed_distance, opts);
 	//StdArc::StateId start = path->Start();
 
 	//distance = script::WeightClass(typed_distance[start]);
 	//return distance;
 }
 
-script::WeightClass shortest_distance_std(script::FstClass &model, script::FstClass &input, script::FstClass &output) {	
-	const Fst<StdArc> *tfst = model.GetFst<StdArc>();
+script::WeightClass score_std_impl(script::FstClass &model, script::FstClass &input, script::FstClass &output) {	
+    const Fst<StdArc> *tfst = model.GetFst<StdArc>();
 	const Fst<StdArc> *ifst1 = input.GetFst<StdArc>();
 	const Fst<StdArc> *ifst2 = output.GetFst<StdArc>();
-	
+
+	// auto start = high_resolution_clock::now();	
 	ArcSortFst<StdArc, OLabelCompare<StdArc> > input_sorted = ArcSortFst<StdArc, OLabelCompare<StdArc> >(*ifst1, OLabelCompare<StdArc>());
 	ArcSortFst<StdArc, ILabelCompare<StdArc> > output_sorted = ArcSortFst<StdArc, ILabelCompare<StdArc> >(*ifst2, ILabelCompare<StdArc>());
 
 	// set compose options
 	ComposeFstOptions<StdArc> co;
 	co.gc_limit=0;
 
@@ -90,18 +94,21 @@
 		if (typed_distance.size() == 1 && !typed_distance[0].Member()) {
 			retval = StdArc::Weight::NoWeight();
 		}
 		retval = state != kNoStateId && state < typed_distance.size() ? typed_distance[state] : Weight::Zero();
 	}
 	
 	distance = script::WeightClass(retval);
+    // auto stop = high_resolution_clock::now();
+    // auto duration = duration_cast<milliseconds>(stop - start);
+    // std::cout << duration.count() << std::endl;
 	return distance;
 }
 
-script::WeightClass shortest_distance_log(script::FstClass &model, script::FstClass &input, script::FstClass &output) {	
+script::WeightClass score_log_impl(script::FstClass &model, script::FstClass &input, script::FstClass &output) {	
 	const Fst<LogArc> *tfst = model.GetFst<LogArc>();
 	const Fst<LogArc> *ifst1 = input.GetFst<LogArc>();
 	const Fst<LogArc> *ifst2 = output.GetFst<LogArc>();
 	
 	ArcSortFst<LogArc, OLabelCompare<LogArc> > input_sorted = ArcSortFst<LogArc, OLabelCompare<LogArc> >(*ifst1, OLabelCompare<LogArc>());
 	ArcSortFst<LogArc, ILabelCompare<LogArc> > output_sorted = ArcSortFst<LogArc, ILabelCompare<LogArc> >(*ifst2, ILabelCompare<LogArc>());
 
@@ -169,14 +176,171 @@
 
 	std::vector<StdArc::Weight> typed_distance;
 	StdArc::Weight retval;
 	script::WeightClass distance;
 
 	NaturalShortestFirstQueue<StdArc::StateId, StdArc::Weight> state_queue(typed_distance);
 	ShortestDistanceOptions<StdArc, NaturalShortestFirstQueue<StdArc::StateId, StdArc::Weight>, AnyArcFilter<StdArc> > opts(&state_queue, AnyArcFilter<StdArc>());
+	opts.first_path=true;
+	
+	using StateId = typename StdArc::StateId;
+	using Weight = typename StdArc::Weight;
+
+	if (Weight::Properties() & kRightSemiring) {
+		ShortestDistance(result, &typed_distance, opts);
+		if (typed_distance.size() == 1 && !typed_distance[0].Member()) {
+			retval =  StdArc::Weight::NoWeight();
+		}
+		Adder<Weight> adder;  // maintains cumulative sum accurately
+		for (StateId state = 0; state < typed_distance.size(); ++state) {
+			adder.Add(Times(typed_distance[state], result.Final(state)));
+		}
+		retval = adder.Sum();
+	} else {
+		ShortestDistance(result, &typed_distance, true, mydelta);
+		const auto state = result.Start();
+		if (typed_distance.size() == 1 && !typed_distance[0].Member()) {
+			retval = StdArc::Weight::NoWeight();
+		}
+		retval = state != kNoStateId && state < typed_distance.size() ? typed_distance[state] : Weight::Zero();
+	}
+	
+	distance = script::WeightClass(retval);
+	return distance;
+}
+
+script::WeightClass kernel_score_log_impl(script::FstClass &model, script::FstClass &input, script::FstClass &output) {	
+	const Fst<LogArc> *tfst = model.GetFst<LogArc>();
+	const Fst<LogArc> *ifst1 = input.GetFst<LogArc>();
+	const Fst<LogArc> *ifst2 = output.GetFst<LogArc>();
+	
+	ArcSortFst<LogArc, ILabelCompare<LogArc> > input_sorted = ArcSortFst<LogArc, ILabelCompare<LogArc> >(*ifst1, ILabelCompare<LogArc>());
+	ArcSortFst<LogArc, ILabelCompare<LogArc> > output_sorted = ArcSortFst<LogArc, ILabelCompare<LogArc> >(*ifst2, ILabelCompare<LogArc>());
+
+	// set compose options
+	ComposeFstOptions<LogArc> co;
+	//co.gc_limit=0;
+
+	// Container for composition result.
+	InvertFst<LogArc> middle1 = InvertFst<LogArc>(ComposeFst<LogArc>(*tfst, input_sorted, co));
+	ComposeFst<LogArc> middle2 = ComposeFst<LogArc>(*tfst, output_sorted, co);
+	ArcSortFst<LogArc, ILabelCompare<LogArc> > middle2_sorted = ArcSortFst<LogArc, ILabelCompare<LogArc> >(middle2, ILabelCompare<LogArc>());
+	//ArcSortFst<LogArc, OLabelCompare<LogArc> > middle1_sorted = ArcSortFst<LogArc, OLabelCompare<LogArc> >(middle1, OLabelCompare<LogArc>());
+	ComposeFst<LogArc> result = ComposeFst<LogArc>(middle1, middle2_sorted, co);
+	
+
+	std::vector<LogArc::Weight> typed_distance;
+	LogArc::Weight retval;
+	script::WeightClass distance;
+
+	//NaturalShortestFirstQueue<LogArc::StateId, LogArc::Weight> state_queue(typed_distance);
+	//ShortestDistanceOptions<LogArc, NaturalShortestFirstQueue<LogArc::StateId, LogArc::Weight>, AnyArcFilter<LogArc> > opts(&state_queue, AnyArcFilter<LogArc>());
+	//opts.first_path=true;
+	
+	using StateId = typename LogArc::StateId;
+	using Weight = typename LogArc::Weight;
+
+	if (Weight::Properties() & kRightSemiring) {
+		ShortestDistance(result, &typed_distance);
+		if (typed_distance.size() == 1 && !typed_distance[0].Member()) {
+			retval =  LogArc::Weight::NoWeight();
+		}
+		Adder<Weight> adder;  // maintains cumulative sum accurately
+		for (StateId state = 0; state < typed_distance.size(); ++state) {
+			adder.Add(Times(typed_distance[state], result.Final(state)));
+		}
+		retval = adder.Sum();
+	} else {
+		ShortestDistance(result, &typed_distance, true, mydelta);
+		const auto state = result.Start();
+		if (typed_distance.size() == 1 && !typed_distance[0].Member()) {
+			retval = LogArc::Weight::NoWeight();
+		}
+		retval = state != kNoStateId && state < typed_distance.size() ? typed_distance[state] : Weight::Zero();
+	}
+	
+	distance = script::WeightClass(retval);
+	return distance;
+}
+
+script::WeightClass multi_score_std_impl(script::FstClass &loh, script::FstClass &wgd, script::FstClass &gl, script::FstClass &input, script::FstClass &output) {	
+	const Fst<StdArc> *lohfst = loh.GetFst<StdArc>();
+    const Fst<StdArc> *wgdfst = wgd.GetFst<StdArc>();
+    const Fst<StdArc> *glfst = gl.GetFst<StdArc>();
+	const Fst<StdArc> *ifst1 = input.GetFst<StdArc>();
+	const Fst<StdArc> *ifst2 = output.GetFst<StdArc>();
+	
+	ArcSortFst<StdArc, ILabelCompare<StdArc> > ifst_sorted = ArcSortFst<StdArc, ILabelCompare<StdArc> >(*ifst1, ILabelCompare<StdArc>());
+	ArcSortFst<StdArc, ILabelCompare<StdArc> > ofst_sorted = ArcSortFst<StdArc, ILabelCompare<StdArc> >(*ifst2, ILabelCompare<StdArc>());
+
+	// set compose options
+	ComposeFstOptions<StdArc> co;
+	//co.gc_limit=0;
+
+    ComposeFst<StdArc> result = ComposeFst<StdArc>(ComposeFst<StdArc>(ComposeFst<StdArc>(ComposeFst<StdArc>(ifst_sorted, *lohfst, co), *wgdfst, co), *glfst, co), ofst_sorted, co);
+
+	std::vector<StdArc::Weight> typed_distance;
+	StdArc::Weight retval;
+	script::WeightClass distance;
+
+	NaturalShortestFirstQueue<StdArc::StateId, StdArc::Weight> state_queue(typed_distance);
+	ShortestDistanceOptions<StdArc, NaturalShortestFirstQueue<StdArc::StateId, StdArc::Weight>, AnyArcFilter<StdArc> > opts(&state_queue, AnyArcFilter<StdArc>());
+	opts.first_path=true;
+	
+	using StateId = typename StdArc::StateId;
+	using Weight = typename StdArc::Weight;
+
+	if (Weight::Properties() & kRightSemiring) {
+		ShortestDistance(result, &typed_distance, opts);
+		if (typed_distance.size() == 1 && !typed_distance[0].Member()) {
+			retval =  StdArc::Weight::NoWeight();
+		}
+		Adder<Weight> adder;  // maintains cumulative sum accurately
+		for (StateId state = 0; state < typed_distance.size(); ++state) {
+			adder.Add(Times(typed_distance[state], result.Final(state)));
+		}
+		retval = adder.Sum();
+	} else {
+		ShortestDistance(result, &typed_distance, true, mydelta);
+		const auto state = result.Start();
+		if (typed_distance.size() == 1 && !typed_distance[0].Member()) {
+			retval = StdArc::Weight::NoWeight();
+		}
+		retval = state != kNoStateId && state < typed_distance.size() ? typed_distance[state] : Weight::Zero();
+	}
+	
+	distance = script::WeightClass(retval);
+	return distance;
+}
+script::WeightClass multi_kernel_score_std_impl(script::FstClass &loh, script::FstClass &wgd, script::FstClass &gain, script::FstClass &loss, script::FstClass &input, script::FstClass &output) {	
+	const Fst<StdArc> *lohfst = loh.GetFst<StdArc>();
+    const Fst<StdArc> *wgdfst = wgd.GetFst<StdArc>();
+    const Fst<StdArc> *gainfst = gain.GetFst<StdArc>();
+    const Fst<StdArc> *lossfst = loss.GetFst<StdArc>();
+	const Fst<StdArc> *ifst1 = input.GetFst<StdArc>();
+	const Fst<StdArc> *ifst2 = output.GetFst<StdArc>();
+	
+	ArcSortFst<StdArc, ILabelCompare<StdArc> > input_sorted = ArcSortFst<StdArc, ILabelCompare<StdArc> >(*ifst1, ILabelCompare<StdArc>());
+	ArcSortFst<StdArc, ILabelCompare<StdArc> > output_sorted = ArcSortFst<StdArc, ILabelCompare<StdArc> >(*ifst2, ILabelCompare<StdArc>());
+
+	// set compose options
+	ComposeFstOptions<StdArc> co;
+	//co.gc_limit=0;
+
+    InvertFst<StdArc> left = InvertFst<StdArc>(ComposeFst<StdArc>(*lohfst, ComposeFst<StdArc>(*wgdfst, ComposeFst<StdArc>(*gainfst, ComposeFst<StdArc>(*lossfst, input_sorted, co), co), co), co));
+    ComposeFst<StdArc> right = ComposeFst<StdArc>(*lohfst, ComposeFst<StdArc>(*wgdfst, ComposeFst<StdArc>(*gainfst, ComposeFst<StdArc>(*lossfst, output_sorted, co), co), co), co);
+    ArcSortFst<StdArc, ILabelCompare<StdArc> > right_sorted = ArcSortFst<StdArc, ILabelCompare<StdArc> >(right, ILabelCompare<StdArc>());
+	ComposeFst<StdArc> result = ComposeFst<StdArc>(left, right_sorted, co);
+
+	std::vector<StdArc::Weight> typed_distance;
+	StdArc::Weight retval;
+	script::WeightClass distance;
+
+	NaturalShortestFirstQueue<StdArc::StateId, StdArc::Weight> state_queue(typed_distance);
+	ShortestDistanceOptions<StdArc, NaturalShortestFirstQueue<StdArc::StateId, StdArc::Weight>, AnyArcFilter<StdArc> > opts(&state_queue, AnyArcFilter<StdArc>());
 	opts.first_path=true;
 	
 	using StateId = typename StdArc::StateId;
 	using Weight = typename StdArc::Weight;
 
 	if (Weight::Properties() & kRightSemiring) {
 		ShortestDistance(result, &typed_distance, opts);
```

### Comparing `medicc2-0.9.2/fstlib/cext/cpywrapfst.pxd` & `medicc2-1.0.0/fstlib/cext/cpywrapfst.pxd`

 * *Files 8% similar despite different names*

```diff
@@ -12,112 +12,119 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 # See www.openfst.org for extensive documentation on this weighted
 # finite-state transducer library.
 
+from libc.stdint cimport int8_t
+from libc.stdint cimport int16_t
+from libc.stdint cimport int32_t
+from libc.stdint cimport int64_t
+from libc.stdint cimport uint8_t
+from libc.stdint cimport uint16_t
+from libc.stdint cimport uint32_t
+from libc.stdint cimport uint64_t
 
 from libcpp cimport bool
 from libcpp.memory cimport unique_ptr
 from libcpp.string cimport string
 from libcpp.vector cimport vector
 from libcpp.utility cimport pair
 
 from cios cimport *
-from cintegral_types cimport *
 
 
 cdef extern from "<fst/util.h>" nogil:
 
   bool FST_FLAGS_fst_error_fatal
 
 
 cdef extern from "<fst/fstlib.h>" namespace "fst" nogil:
 
   # FST properties.
-  const uint64 kExpanded
-  const uint64 kMutable
-  const uint64 kError
-  const uint64 kAcceptor
-  const uint64 kNotAcceptor
-  const uint64 kIDeterministic
-  const uint64 kNonIDeterministic
-  const uint64 kODeterministic
-  const uint64 kNonODeterministic
-  const uint64 kEpsilons
-  const uint64 kNoEpsilons
-  const uint64 kIEpsilons
-  const uint64 kNoIEpsilons
-  const uint64 kOEpsilons
-  const uint64 kNoOEpsilons
-  const uint64 kILabelSorted
-  const uint64 kNotILabelSorted
-  const uint64 kOLabelSorted
-  const uint64 kNotOLabelSorted
-  const uint64 kWeighted
-  const uint64 kUnweighted
-  const uint64 kCyclic
-  const uint64 kAcyclic
-  const uint64 kInitialCyclic
-  const uint64 kInitialAcyclic
-  const uint64 kTopSorted
-  const uint64 kNotTopSorted
-  const uint64 kAccessible
-  const uint64 kNotAccessible
-  const uint64 kCoAccessible
-  const uint64 kNotCoAccessible
-  const uint64 kString
-  const uint64 kNotString
-  const uint64 kWeightedCycles
-  const uint64 kUnweightedCycles
-  const uint64 kNullProperties
-  const uint64 kCopyProperties
-  const uint64 kIntrinsicProperties
-  const uint64 kExtrinsicProperties
-  const uint64 kSetStartProperties
-  const uint64 kSetFinalProperties
-  const uint64 kAddStateProperties
-  const uint64 kAddArcProperties
-  const uint64 kSetArcProperties
-  const uint64 kDeleteStatesProperties
-  const uint64 kDeleteArcsProperties
-  const uint64 kStateSortProperties
-  const uint64 kArcSortProperties
-  const uint64 kILabelInvariantProperties
-  const uint64 kOLabelInvariantProperties
-  const uint64 kWeightInvariantProperties
-  const uint64 kAddSuperFinalProperties
-  const uint64 kRmSuperFinalProperties
-  const uint64 kBinaryProperties
-  const uint64 kTrinaryProperties
-  const uint64 kPosTrinaryProperties
-  const uint64 kNegTrinaryProperties
-  const uint64 kFstProperties
+  const uint64_t kExpanded
+  const uint64_t kMutable
+  const uint64_t kError
+  const uint64_t kAcceptor
+  const uint64_t kNotAcceptor
+  const uint64_t kIDeterministic
+  const uint64_t kNonIDeterministic
+  const uint64_t kODeterministic
+  const uint64_t kNonODeterministic
+  const uint64_t kEpsilons
+  const uint64_t kNoEpsilons
+  const uint64_t kIEpsilons
+  const uint64_t kNoIEpsilons
+  const uint64_t kOEpsilons
+  const uint64_t kNoOEpsilons
+  const uint64_t kILabelSorted
+  const uint64_t kNotILabelSorted
+  const uint64_t kOLabelSorted
+  const uint64_t kNotOLabelSorted
+  const uint64_t kWeighted
+  const uint64_t kUnweighted
+  const uint64_t kCyclic
+  const uint64_t kAcyclic
+  const uint64_t kInitialCyclic
+  const uint64_t kInitialAcyclic
+  const uint64_t kTopSorted
+  const uint64_t kNotTopSorted
+  const uint64_t kAccessible
+  const uint64_t kNotAccessible
+  const uint64_t kCoAccessible
+  const uint64_t kNotCoAccessible
+  const uint64_t kString
+  const uint64_t kNotString
+  const uint64_t kWeightedCycles
+  const uint64_t kUnweightedCycles
+  const uint64_t kNullProperties
+  const uint64_t kCopyProperties
+  const uint64_t kIntrinsicProperties
+  const uint64_t kExtrinsicProperties
+  const uint64_t kSetStartProperties
+  const uint64_t kSetFinalProperties
+  const uint64_t kAddStateProperties
+  const uint64_t kAddArcProperties
+  const uint64_t kSetArcProperties
+  const uint64_t kDeleteStatesProperties
+  const uint64_t kDeleteArcsProperties
+  const uint64_t kStateSortProperties
+  const uint64_t kArcSortProperties
+  const uint64_t kILabelInvariantProperties
+  const uint64_t kOLabelInvariantProperties
+  const uint64_t kWeightInvariantProperties
+  const uint64_t kAddSuperFinalProperties
+  const uint64_t kRmSuperFinalProperties
+  const uint64_t kBinaryProperties
+  const uint64_t kTrinaryProperties
+  const uint64_t kPosTrinaryProperties
+  const uint64_t kNegTrinaryProperties
+  const uint64_t kFstProperties
 
   # ArcIterator flags.
-  const uint8 kArcILabelValue
-  const uint8 kArcOLabelValue
-  const uint8 kArcWeightValue
-  const uint8 kArcNextStateValue
-  const uint8 kArcNoCache
-  const uint8 kArcValueFlags
-  const uint8 kArcFlags
+  const uint8_t kArcILabelValue
+  const uint8_t kArcOLabelValue
+  const uint8_t kArcWeightValue
+  const uint8_t kArcNextStateValue
+  const uint8_t kArcNoCache
+  const uint8_t kArcValueFlags
+  const uint8_t kArcFlags
 
   # EncodeMapper flags.
-  const uint8 kEncodeLabels
-  const uint8 kEncodeWeights
-  const uint8 kEncodeFlags
+  const uint8_t kEncodeLabels
+  const uint8_t kEncodeWeights
+  const uint8_t kEncodeFlags
 
   # Default argument constants.
   const float kDelta
   const float kShortestDelta
   const int kNoLabel
   const int kNoStateId
-  const int64 kNoSymbol
+  const int64_t kNoSymbol
 
   enum ClosureType:
     CLOSURE_STAR
     CLOSURE_PLUS
 
   enum ComposeFilter:
     AUTO_FILTER
@@ -161,15 +168,15 @@
     AUTO_QUEUE
     OTHER_QUEUE
 
   # This is a templated struct at the C++ level, but Cython does not support
   # templated structs unless we pretend they are full-blown classes.
   cdef cppclass RandGenOptions[RandArcSelection]:
 
-    RandGenOptions(const RandArcSelection &, int32, int32, bool, bool)
+    RandGenOptions(const RandArcSelection &, int32_t, int32_t, bool, bool)
 
   enum ReplaceLabelType:
     REPLACE_LABEL_NEITHER
     REPLACE_LABEL_INPUT
     REPLACE_LABEL_OUTPUT
     REPLACE_LABEL_BOTH
 
@@ -184,15 +191,15 @@
   # This is actually a nested class, but Cython doesn't need to know that.
   cdef cppclass SymbolTableIterator "fst::SymbolTable::iterator":
 
       SymbolTableIterator(const SymbolTableIterator &)
 
       cppclass value_type:
 
-        int64 Label()
+        int64_t Label()
         string Symbol()
 
       # When wrapped in a unique_ptr siter.Label() and siter.Symbol() are
       # ambiguous to Cython because there's no way to make the -> explicit.
       # This hacks around that.
       const value_type &Pair "operator*"()
 
@@ -203,15 +210,15 @@
       bool operator!=(const SymbolTableIterator &, const SymbolTableIterator &)
 
 
   # Symbol tables.
   cdef cppclass SymbolTable:
 
     @staticmethod
-    int64 kNoSymbol
+    int64_t kNoSymbol
 
     SymbolTable()
 
     SymbolTable(const string &)
 
     @staticmethod
     SymbolTable *Read(const string &)
@@ -219,35 +226,35 @@
     # Aliased for overload.
     @staticmethod
     SymbolTable *ReadStream "Read"(istream &, const string &)
 
     @staticmethod
     SymbolTable *ReadText(const string &, const SymbolTableTextOptions &)
 
-    int64 AddSymbol(const string &, int64)
+    int64_t AddSymbol(const string &, int64_t)
 
-    int64 AddSymbol(const string &)
+    int64_t AddSymbol(const string &)
 
     SymbolTable *Copy()
 
     # Aliased for overload.
-    string FindSymbol "Find"(int64)
+    string FindSymbol "Find"(int64_t)
 
     # Aliased for overload.
-    int64 FindIndex "Find"(const string &)
+    int64_t FindIndex "Find"(const string &)
 
     # Aliased for overload.
     bool MemberSymbol "Member"(const string &)
 
     # Aliased for overload.
-    bool MemberIndex "Member"(int64)
+    bool MemberIndex "Member"(int64_t)
 
     void AddTable(const SymbolTable &)
 
-    int64 GetNthKey(ssize_t)
+    int64_t GetNthKey(ssize_t)
 
     const string &Name()
 
     void SetName(const string &)
 
     const string &CheckSum()
 
@@ -261,15 +268,15 @@
 
     bool WriteText(const string &)
 
     SymbolTableIterator begin()
 
     SymbolTableIterator end()
 
-    int64 AvailableKey()
+    int64_t AvailableKey()
 
     size_t NumSymbols()
 
   SymbolTable *CompactSymbolTable(const SymbolTable &syms)
 
   SymbolTable *MergeSymbolTable(const SymbolTable &, const SymbolTable &,
                                 bool *)
@@ -323,41 +330,41 @@
 
   cdef WeightClass Power(const WeightClass &, size_t)
 
   cdef cppclass ArcClass:
 
     ArcClass(const ArcClass &)
 
-    ArcClass(int64, int64, const WeightClass &, int64)
+    ArcClass(int64_t, int64_t, const WeightClass &, int64_t)
 
-    int64 ilabel
-    int64 olabel
+    int64_t ilabel
+    int64_t olabel
     WeightClass weight
-    int64 nextstate
+    int64_t nextstate
 
   cdef cppclass FstClass:
 
     FstClass(const FstClass &)
 
     @staticmethod
-    FstClass *Read(const string &)
+    unique_ptr[FstClass] Read(const string &)
 
     # Aliased for overload.
     @staticmethod
-    FstClass *ReadStream "Read"(istream &, const string &)
+    unique_ptr[FstClass] ReadStream "Read"(istream &, const string &)
 
-    int64 Start()
+    int64_t Start()
 
-    WeightClass Final(int64)
+    WeightClass Final(int64_t)
 
-    size_t NumArcs(int64)
+    size_t NumArcs(int64_t)
 
-    size_t NumInputEpsilons(int64)
+    size_t NumInputEpsilons(int64_t)
 
-    size_t NumOutputEpsilons(int64)
+    size_t NumOutputEpsilons(int64_t)
 
     const string &ArcType()
 
     const string &FstType()
 
     const SymbolTable *InputSymbols()
 
@@ -365,81 +372,81 @@
 
     const string &WeightType()
 
     bool Write(const string &)
 
     bool Write(ostream &, const string &)
 
-    uint64 Properties(uint64, bool)
+    uint64_t Properties(uint64_t, bool)
 
-    bool ValidStateId(int64)
+    bool ValidStateId(int64_t)
 
   cdef cppclass MutableFstClass(FstClass):
 
-    bool AddArc(int64, const ArcClass &)
+    bool AddArc(int64_t, const ArcClass &)
 
-    int64 AddState()
+    int64_t AddState()
 
     void AddStates(size_t)
 
-    bool DeleteArcs(int64, size_t)
+    bool DeleteArcs(int64_t, size_t)
 
-    bool DeleteArcs(int64)
+    bool DeleteArcs(int64_t)
 
-    bool DeleteStates(const vector[int64] &)
+    bool DeleteStates(const vector[int64_t] &)
 
     void DeleteStates()
 
     SymbolTable *MutableInputSymbols()
 
     SymbolTable *MutableOutputSymbols()
 
-    int64 NumStates()
+    int64_t NumStates()
 
-    bool ReserveArcs(int64, size_t)
+    bool ReserveArcs(int64_t, size_t)
 
-    void ReserveStates(int64)
+    void ReserveStates(int64_t)
 
-    bool SetStart(int64)
+    bool SetStart(int64_t)
 
-    bool SetFinal(int64, const WeightClass &)
+    bool SetFinal(int64_t, const WeightClass &)
 
     void SetInputSymbols(const SymbolTable *)
 
     void SetOutputSymbols(const SymbolTable *)
 
-    void SetProperties(uint64, uint64)
+    void SetProperties(uint64_t, uint64_t)
 
   cdef cppclass VectorFstClass(MutableFstClass):
 
    VectorFstClass(const FstClass &)
 
    VectorFstClass(const string &)
 
   cdef cppclass EncodeMapperClass:
 
-    EncodeMapperClass(const string &, uint32, EncodeType)
+    EncodeMapperClass(const string &, uint32_t, EncodeType)
 
     # Aliased to __call__ as Cython doesn't have good support for operator().
     ArcClass __call__ "operator()"(const ArcClass &)
 
     const string &ArcType()
 
     const string &WeightType()
 
-    uint32 Flags()
+    uint32_t Flags()
 
-    uint64 Properties(uint64)
+    uint64_t Properties(uint64_t)
 
     @staticmethod
-    EncodeMapperClass *Read(const string &)
+    unique_ptr[EncodeMapperClass] Read(const string &)
 
     # Aliased for overload.
     @staticmethod
-    EncodeMapperClass *ReadStream "Read"(istream &, const string &)
+    unique_ptr[EncodeMapperClass] ReadStream "Read"(istream &, const string &)
 
     bool Write(const string &)
 
     # Aliased for overload.
     bool WriteStream "Write"(ostream &, const string &)
 
     const SymbolTable *InputSymbols()
@@ -448,35 +455,35 @@
 
     void SetInputSymbols(const SymbolTable *)
 
     void SetOutputSymbols(const SymbolTable *)
 
   cdef cppclass ArcIteratorClass:
 
-    ArcIteratorClass(const FstClass &, int64)
+    ArcIteratorClass(const FstClass &, int64_t)
 
     bool Done()
 
     ArcClass Value()
 
     void Next()
 
     void Reset()
 
     void Seek(size_t)
 
     size_t Position()
 
-    uint8 Flags()
+    uint8_t Flags()
 
-    void SetFlags(uint8, uint8)
+    void SetFlags(uint8_t, uint8_t)
 
   cdef cppclass MutableArcIteratorClass:
 
-    MutableArcIteratorClass(MutableFstClass *, int64)
+    MutableArcIteratorClass(MutableFstClass *, int64_t)
 
     bool Done()
 
     ArcClass Value()
 
     void Next()
 
@@ -484,34 +491,34 @@
 
     void Seek(size_t)
 
     void SetValue(const ArcClass &)
 
     size_t Position()
 
-    uint8 Flags()
+    uint8_t Flags()
 
-    void SetFlags(uint8, uint8)
+    void SetFlags(uint8_t, uint8_t)
 
   cdef cppclass StateIteratorClass:
 
     StateIteratorClass(const FstClass &)
 
     bool Done()
 
-    int64 Value()
+    int64_t Value()
 
     void Next()
 
     void Reset()
 
 
-ctypedef pair[int64, const FstClass *] LabelFstClassPair
+ctypedef pair[int64_t, const FstClass *] LabelFstClassPair
 
-ctypedef pair[int64, int64] LabelPair
+ctypedef pair[int64_t, int64_t] LabelPair
 
 
 cdef extern from "<fst/script/fstscript.h>" namespace "fst::script" nogil:
 
   # TODO(wolfsonkin): Don't do this hack if Cython gets proper enum class
   # support: https://github.com/cython/cython/issues/1603
   ctypedef enum ArcFilterType:
@@ -524,30 +531,30 @@
   # support: https://github.com/cython/cython/issues/1603
   ctypedef enum ArcSortType:
     ILABEL_SORT "fst::script::ArcSortType::ILABEL"
     OLABEL_SORT "fst::script::ArcSortType::OLABEL"
 
   cdef void ArcSort(MutableFstClass *, ArcSortType)
 
-  cdef ClosureType GetClosureType(bool)
+  cdef bool GetClosureType(const string &, ClosureType *)
 
   cdef void Closure(MutableFstClass *, ClosureType)
 
-  cdef unique_ptr[FstClass] CompileFstInternal(istream &,
-                                               const string &,
-                                               const string &,
-                                               const string &,
-                                               const SymbolTable *,
-                                               const SymbolTable *,
-                                               const SymbolTable*,
-                                               bool,
-                                               bool,
-                                               bool,
-                                               bool,
-                                               bool)
+  cdef unique_ptr[FstClass] CompileInternal(istream &,
+                                            const string &,
+                                            const string &,
+                                            const string &,
+                                            const SymbolTable *,
+                                            const SymbolTable *,
+                                            const SymbolTable*,
+                                            bool,
+                                            bool,
+                                            bool,
+                                            bool,
+                                            bool)
 
   cdef void Compose(FstClass &, FstClass &, MutableFstClass *,
                     const ComposeOptions &)
 
   cdef void Concat(MutableFstClass *, const FstClass &)
 
   cdef void Connect(MutableFstClass *)
@@ -556,26 +563,26 @@
 
   cdef void Decode(MutableFstClass *, const EncodeMapperClass &)
 
   cdef cppclass DeterminizeOptions:
 
     DeterminizeOptions(float,
                        const WeightClass &,
-                       int64,
-                       int64,
+                       int64_t,
+                       int64_t,
                        DeterminizeType,
                        bool)
 
   cdef void Determinize(const FstClass &,
                         MutableFstClass *,
                         const DeterminizeOptions &)
 
   cdef cppclass DisambiguateOptions:
 
-    DisambiguateOptions(float, const WeightClass &, int64, int64)
+    DisambiguateOptions(float, const WeightClass &, int64_t, int64_t)
 
   cdef void Disambiguate(const FstClass &,
                          MutableFstClass *,
                          const DisambiguateOptions &)
 
   cdef void Difference(const FstClass &,
                        const FstClass &,
@@ -599,15 +606,15 @@
                  const string &,
                  bool,
                  ostream &,
                  const string &)
 
   cdef void Encode(MutableFstClass *, EncodeMapperClass *)
 
-  cdef EpsNormalizeType GetEpsNormalizeType(bool)
+  cdef bool GetEpsNormalizeType(const string &, EpsNormalizeType *)
 
   cdef void EpsNormalize(const FstClass &, MutableFstClass *, EpsNormalizeType)
 
   cdef bool Equal(const FstClass &, const FstClass &, float)
 
   cdef bool Equivalent(const FstClass &, const FstClass &, float)
 
@@ -658,43 +665,43 @@
                   bool,
                   bool,
                   const string &)
 
   cdef void Prune(const FstClass &,
                   MutableFstClass *,
                   const WeightClass &,
-                  int64, float)
+                  int64_t, float)
 
-  cdef void Prune(MutableFstClass *, const WeightClass &, int64, float)
+  cdef void Prune(MutableFstClass *, const WeightClass &, int64_t, float)
 
   cdef void Push(const FstClass &,
                  MutableFstClass *,
-                 uint8 flags,
+                 uint8_t flags,
                  ReweightType, float)
 
   cdef void Push(MutableFstClass *, ReweightType, float, bool)
 
   # TODO(wolfsonkin): Don't do this hack if Cython gets proper enum class
   # support: https://github.com/cython/cython/issues/1603
   ctypedef enum RandArcSelection:
     UNIFORM_ARC_SELECTOR "fst::script::RandArcSelection::UNIFORM"
     LOG_PROB_ARC_SELECTOR "fst::script::RandArcSelection::LOG_PROB"
     FAST_LOG_PROB_ARC_SELECTOR "fst::script::RandArcSelection::FAST_LOG_PROB"
 
   cdef bool RandEquivalent(const FstClass &,
                            const FstClass &,
-                           int32,
+                           int32_t,
                            const RandGenOptions[RandArcSelection] &,
                            float,
-                           uint64)
+                           uint64_t)
 
   cdef void RandGen(const FstClass &,
                     MutableFstClass *,
                     const RandGenOptions[RandArcSelection] &,
-                    uint64)
+                    uint64_t)
 
   cdef void Relabel(MutableFstClass *,
                     const SymbolTable *,
                     const SymbolTable *,
                     const string &, bool,
                     const SymbolTable *,
                     const SymbolTable *,
@@ -703,52 +710,52 @@
 
   cdef void Relabel(MutableFstClass *,
                     const vector[LabelPair] &,
                     const vector[LabelPair] &)
 
   cdef cppclass ReplaceOptions:
 
-     ReplaceOptions(int64, ReplaceLabelType, ReplaceLabelType, int64)
+     ReplaceOptions(int64_t, ReplaceLabelType, ReplaceLabelType, int64_t)
 
   cdef void Replace(const vector[LabelFstClassPair] &,
                     MutableFstClass *,
                     const ReplaceOptions &)
 
   cdef void Reverse(const FstClass &, MutableFstClass *, bool)
 
   cdef void Reweight(MutableFstClass *,
                      const vector[WeightClass] &,
                      ReweightType)
 
   cdef cppclass RmEpsilonOptions:
 
-    RmEpsilonOptions(QueueType, bool, const WeightClass &, int64, float)
+    RmEpsilonOptions(QueueType, bool, const WeightClass &, int64_t, float)
 
   cdef void RmEpsilon(MutableFstClass *, const RmEpsilonOptions &)
 
   cdef cppclass ShortestDistanceOptions:
 
-    ShortestDistanceOptions(QueueType, ArcFilterType, int64, float)
+    ShortestDistanceOptions(QueueType, ArcFilterType, int64_t, float)
 
   cdef void ShortestDistance(const FstClass &,
                              vector[WeightClass] *,
                              const ShortestDistanceOptions &)
 
   cdef void ShortestDistance(const FstClass &,
                              vector[WeightClass] *, bool,
                              float)
 
   cdef cppclass ShortestPathOptions:
 
     ShortestPathOptions(QueueType,
-                        int32,
+                        int32_t,
                         bool,
                         float,
                         const WeightClass &,
-                        int64)
+                        int64_t)
 
   cdef void ShortestPath(const FstClass &,
                          MutableFstClass *,
                          const ShortestPathOptions &)
 
   cdef void Synchronize(const FstClass &, MutableFstClass *)
 
@@ -763,27 +770,27 @@
 
   cdef bool GetArcSortType(const string &, ArcSortType *)
 
   cdef bool GetComposeFilter(const string &, ComposeFilter *)
 
   cdef bool GetDeterminizeType(const string &, DeterminizeType *)
 
-  cdef uint8 GetEncodeFlags(bool, bool)
+  cdef uint8_t GetEncodeFlags(bool, bool)
 
   cdef bool GetMapType(const string &, MapType *)
 
-  cdef uint8 GetPushFlags(bool, bool, bool, bool)
+  cdef uint8_t GetPushFlags(bool, bool, bool, bool)
 
   cdef bool GetQueueType(const string &, QueueType *)
 
   cdef bool GetRandArcSelection(const string &, RandArcSelection *)
 
   cdef bool GetReplaceLabelType(string, bool, ReplaceLabelType *)
 
-  cdef ReweightType GetReweightType(bool)
+  cdef bool GetReweightType(const string &, ReweightType *)
 
   cdef bool GetTokenType(const string &, TokenType *)
 
 
 cdef extern from "<fst/extensions/far/far.h>" namespace "fst" nogil:
 
   # TODO(wolfsonkin): Don't do this hack if Cython gets proper enum class
```

### Comparing `medicc2-0.9.2/fstlib/cext/ops.cpp` & `medicc2-1.0.0/fstlib/cext/ops.cpp`

 * *Files 9% similar despite different names*

```diff
@@ -787,14 +787,15 @@
 #define __PYX_HAVE_API__fstlib__cext__ops
 /* Early includes */
 #include "ios"
 #include "new"
 #include "stdexcept"
 #include "typeinfo"
 #include <vector>
+#include <stdint.h>
 #include <memory>
 #include <string.h>
 #include <string>
 #include <utility>
 
     #if __cplusplus >= 201103L || (defined(_MSC_VER) && _MSC_VER >= 1600)
     // move should be defined for these versions of MSVC, but __cplusplus isn't set usefully
@@ -803,15 +804,14 @@
     namespace cython_std {
     template <typename T> typename std::remove_reference<T>::type&& move(T& t) noexcept { return std::move(t); }
     template <typename T> typename std::remove_reference<T>::type&& move(T&& t) noexcept { return std::move(t); }
     }
 
     #endif
     
-#include <stdint.h>
 #include <iostream>
 #include <fstream>
 #include <sstream>
 #include <fst/util.h>
 #include <fst/fstlib.h>
 #include <fst/script/fstscript.h>
 #include <fst/script/getters.h>
@@ -1050,31 +1050,31 @@
 struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator;
 struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator;
 struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator;
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler;
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader;
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter;
 
-/* "cpywrapfst.pxd":508
+/* "cpywrapfst.pxd":515
  * 
  * 
- * ctypedef pair[int64, const FstClass *] LabelFstClassPair             # <<<<<<<<<<<<<<
+ * ctypedef pair[int64_t, const FstClass *] LabelFstClassPair             # <<<<<<<<<<<<<<
  * 
- * ctypedef pair[int64, int64] LabelPair
+ * ctypedef pair[int64_t, int64_t] LabelPair
  */
-typedef std::pair<int64,fst::script::FstClass const *>  __pyx_t_10cpywrapfst_LabelFstClassPair;
+typedef std::pair<int64_t,fst::script::FstClass const *>  __pyx_t_10cpywrapfst_LabelFstClassPair;
 
-/* "cpywrapfst.pxd":510
- * ctypedef pair[int64, const FstClass *] LabelFstClassPair
+/* "cpywrapfst.pxd":517
+ * ctypedef pair[int64_t, const FstClass *] LabelFstClassPair
  * 
- * ctypedef pair[int64, int64] LabelPair             # <<<<<<<<<<<<<<
+ * ctypedef pair[int64_t, int64_t] LabelPair             # <<<<<<<<<<<<<<
  * 
  * 
  */
-typedef std::pair<int64,int64>  __pyx_t_10cpywrapfst_LabelPair;
+typedef std::pair<int64_t,int64_t>  __pyx_t_10cpywrapfst_LabelPair;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_draw;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_print;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__arcsort;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__closure;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states;
@@ -1124,21 +1124,21 @@
  * 
  */
 typedef fst::SymbolTable const *__pyx_t_6fstlib_4cext_9pywrapfst_const_SymbolTable_ptr;
 
 /* "pywrapfst.pxd":160
  *   cdef fst.SymbolTable *_mutable_raw_ptr_or_raise(self) except *
  * 
- *   cpdef int64 add_symbol(self, symbol, int64 key=?) except *             # <<<<<<<<<<<<<<
+ *   cpdef int64_t add_symbol(self, symbol, int64_t key=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cpdef void add_table(self, SymbolTableView syms) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol {
   int __pyx_n;
-  int64 key;
+  int64_t key;
 };
 
 /* "pywrapfst.pxd":207
  * 
  * 
  * ctypedef fst.EncodeMapperClass * EncodeMapperClass_ptr             # <<<<<<<<<<<<<<
  * 
@@ -1198,16 +1198,16 @@
   PyObject *title;
   double width;
   double height;
   bool portrait;
   bool vertical;
   double ranksep;
   double nodesep;
-  int32 fontsize;
-  int32 precision;
+  int32_t fontsize;
+  int32_t precision;
   PyObject *float_format;
   bool show_weight_one;
 };
 
 /* "pywrapfst.pxd":292
  *   cpdef _FstSymbolTableView output_symbols(self)
  * 
@@ -1226,47 +1226,47 @@
 };
 
 /* "pywrapfst.pxd":325
  *   cpdef void add_states(self, size_t)
  * 
  *   cdef void _arcsort(self, sort_type=?) except *             # <<<<<<<<<<<<<<
  * 
- *   cdef void _closure(self, bool closure_plus=?)
+ *   cdef void _closure(self, closure_type=?)
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__arcsort {
   int __pyx_n;
   PyObject *sort_type;
 };
 
 /* "pywrapfst.pxd":327
  *   cdef void _arcsort(self, sort_type=?) except *
  * 
- *   cdef void _closure(self, bool closure_plus=?)             # <<<<<<<<<<<<<<
+ *   cdef void _closure(self, closure_type=?)             # <<<<<<<<<<<<<<
  * 
  *   cdef void _concat(self, Fst fst2) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__closure {
   int __pyx_n;
-  bool closure_plus;
+  PyObject *closure_type;
 };
 
 /* "pywrapfst.pxd":335
  *   cdef void _decode(self, EncodeMapper) except *
  * 
- *   cdef void _delete_arcs(self, int64 state, size_t n=?) except *             # <<<<<<<<<<<<<<
+ *   cdef void _delete_arcs(self, int64_t state, size_t n=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cdef void _delete_states(self, states=?) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs {
   int __pyx_n;
   size_t n;
 };
 
 /* "pywrapfst.pxd":337
- *   cdef void _delete_arcs(self, int64 state, size_t n=?) except *
+ *   cdef void _delete_arcs(self, int64_t state, size_t n=?) except *
  * 
  *   cdef void _delete_states(self, states=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cdef void _encode(self, EncodeMapper) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states {
   int __pyx_n;
@@ -1274,52 +1274,52 @@
 };
 
 /* "pywrapfst.pxd":343
  *   cdef void _invert(self)
  * 
  *   cdef void _minimize(self, float delta=?, bool allow_nondet=?) except *             # <<<<<<<<<<<<<<
  * 
- *   cpdef _MutableArcIterator mutable_arcs(self, int64 state)
+ *   cpdef _MutableArcIterator mutable_arcs(self, int64_t state)
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__minimize {
   int __pyx_n;
   float delta;
   bool allow_nondet;
 };
 
 /* "pywrapfst.pxd":351
  *   cdef void _project(self, project_type) except *
  * 
- *   cdef void _prune(self, float delta=?, int64 nstate=?, weight=?) except *             # <<<<<<<<<<<<<<
+ *   cdef void _prune(self, float delta=?, int64_t nstate=?, weight=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cdef void _push(self,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__prune {
   int __pyx_n;
   float delta;
-  int64 nstate;
+  int64_t nstate;
   PyObject *weight;
 };
 
 /* "pywrapfst.pxd":353
- *   cdef void _prune(self, float delta=?, int64 nstate=?, weight=?) except *
+ *   cdef void _prune(self, float delta=?, int64_t nstate=?, weight=?) except *
  * 
  *   cdef void _push(self,             # <<<<<<<<<<<<<<
  *                   float delta=?,
  *                   bool remove_total_weight=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__push {
   int __pyx_n;
   float delta;
   bool remove_total_weight;
-  bool to_final;
+  PyObject *reweight_type;
 };
 
 /* "pywrapfst.pxd":358
- *                   bool to_final=?)
+ *                   reweight_type=?)
  * 
  *   cdef void _relabel_pairs(self, ipairs=?, opairs=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cdef void _relabel_tables(self,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_pairs {
   int __pyx_n;
@@ -1343,332 +1343,332 @@
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *old_osymbols;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *new_osymbols;
   PyObject *unknown_osymbol;
   bool attach_new_osymbols;
 };
 
 /* "pywrapfst.pxd":374
- *   cdef void _reserve_states(self, int64 n)
+ *   cdef void _reserve_states(self, int64_t n)
  * 
- *   cdef void _reweight(self, potentials, bool to_final=?) except *             # <<<<<<<<<<<<<<
+ *   cdef void _reweight(self, potentials, reweight_type=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cdef void _rmepsilon(self,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__reweight {
   int __pyx_n;
-  bool to_final;
+  PyObject *reweight_type;
 };
 
 /* "pywrapfst.pxd":376
- *   cdef void _reweight(self, potentials, bool to_final=?) except *
+ *   cdef void _reweight(self, potentials, reweight_type=?) except *
  * 
  *   cdef void _rmepsilon(self,             # <<<<<<<<<<<<<<
  *                        queue_type=?,
  *                        bool connect=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__rmepsilon {
   int __pyx_n;
   PyObject *queue_type;
   bool connect;
   PyObject *weight;
-  int64 nstate;
+  int64_t nstate;
   float delta;
 };
 
 /* "pywrapfst.pxd":383
  *                        float delta=?) except *
  * 
- *   cdef void _set_final(self, int64 state, weight=?) except *             # <<<<<<<<<<<<<<
+ *   cdef void _set_final(self, int64_t state, weight=?) except *             # <<<<<<<<<<<<<<
  * 
- *   cdef void _set_start(self, int64 state) except *
+ *   cdef void _set_start(self, int64_t state) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final {
   int __pyx_n;
   PyObject *weight;
 };
 
-/* "pywrapfst.pxd":489
+/* "pywrapfst.pxd":491
  * 
  * 
  * cdef Fst _map(Fst ifst, float delta=?, map_type=?, double power=?, weight=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef Fst arcmap(Fst ifst, float delta=?, map_type=?, double power=?, weight=?)
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst__map {
   int __pyx_n;
   float delta;
   PyObject *map_type;
   double power;
   PyObject *weight;
 };
 
-/* "pywrapfst.pxd":491
+/* "pywrapfst.pxd":493
  * cdef Fst _map(Fst ifst, float delta=?, map_type=?, double power=?, weight=?)
  * 
  * cpdef Fst arcmap(Fst ifst, float delta=?, map_type=?, double power=?, weight=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef MutableFst compose(Fst ifst1,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_arcmap {
   int __pyx_n;
   float delta;
   PyObject *map_type;
   double power;
   PyObject *weight;
 };
 
-/* "pywrapfst.pxd":493
+/* "pywrapfst.pxd":495
  * cpdef Fst arcmap(Fst ifst, float delta=?, map_type=?, double power=?, weight=?)
  * 
  * cpdef MutableFst compose(Fst ifst1,             # <<<<<<<<<<<<<<
  *                          Fst ifst2,
  *                          compose_filter=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_compose {
   int __pyx_n;
   PyObject *compose_filter;
   bool connect;
 };
 
-/* "pywrapfst.pxd":498
+/* "pywrapfst.pxd":500
  *                          bool connect=?)
  * 
  * cpdef Fst convert(Fst ifst, fst_type=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef MutableFst determinize(Fst ifst,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_convert {
   int __pyx_n;
   PyObject *fst_type;
 };
 
-/* "pywrapfst.pxd":500
+/* "pywrapfst.pxd":502
  * cpdef Fst convert(Fst ifst, fst_type=?)
  * 
  * cpdef MutableFst determinize(Fst ifst,             # <<<<<<<<<<<<<<
  *                              float delta=?,
  *                              det_type=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_determinize {
   int __pyx_n;
   float delta;
   PyObject *det_type;
-  int64 nstate;
-  int64 subsequential_label;
+  int64_t nstate;
+  int64_t subsequential_label;
   PyObject *weight;
   bool increment_subsequential_label;
 };
 
-/* "pywrapfst.pxd":508
+/* "pywrapfst.pxd":510
  *                              bool increment_subsequential_label=?)
  * 
  * cpdef MutableFst difference(Fst ifst1,             # <<<<<<<<<<<<<<
  *                             Fst ifst2,
  *                             compose_filter=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_difference {
   int __pyx_n;
   PyObject *compose_filter;
   bool connect;
 };
 
-/* "pywrapfst.pxd":513
+/* "pywrapfst.pxd":515
  *                             bool connect=?)
  * 
  * cpdef MutableFst disambiguate(Fst ifst,             # <<<<<<<<<<<<<<
  *                               float delta=?,
- *                               int64 nstate=?,
+ *                               int64_t nstate=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_disambiguate {
   int __pyx_n;
   float delta;
-  int64 nstate;
-  int64 subsequential_label;
+  int64_t nstate;
+  int64_t subsequential_label;
   PyObject *weight;
 };
 
-/* "pywrapfst.pxd":519
+/* "pywrapfst.pxd":521
  *                               weight=?)
  * 
- * cpdef MutableFst epsnormalize(Fst ifst, bool eps_norm_output=?)             # <<<<<<<<<<<<<<
+ * cpdef MutableFst epsnormalize(Fst ifst, eps_norm_type=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef bool equal(Fst ifst1, Fst ifst2, float delta=?)
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_epsnormalize {
   int __pyx_n;
-  bool eps_norm_output;
+  PyObject *eps_norm_type;
 };
 
-/* "pywrapfst.pxd":521
- * cpdef MutableFst epsnormalize(Fst ifst, bool eps_norm_output=?)
+/* "pywrapfst.pxd":523
+ * cpdef MutableFst epsnormalize(Fst ifst, eps_norm_type=?)
  * 
  * cpdef bool equal(Fst ifst1, Fst ifst2, float delta=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef bool equivalent(Fst ifst1, Fst ifst2, float delta=?) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_equal {
   int __pyx_n;
   float delta;
 };
 
-/* "pywrapfst.pxd":523
+/* "pywrapfst.pxd":525
  * cpdef bool equal(Fst ifst1, Fst ifst2, float delta=?)
  * 
  * cpdef bool equivalent(Fst ifst1, Fst ifst2, float delta=?) except *             # <<<<<<<<<<<<<<
  * 
  * cpdef MutableFst intersect(Fst ifst1,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_equivalent {
   int __pyx_n;
   float delta;
 };
 
-/* "pywrapfst.pxd":525
+/* "pywrapfst.pxd":527
  * cpdef bool equivalent(Fst ifst1, Fst ifst2, float delta=?) except *
  * 
  * cpdef MutableFst intersect(Fst ifst1,             # <<<<<<<<<<<<<<
  *                            Fst ifst2,
  *                            compose_filter=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_intersect {
   int __pyx_n;
   PyObject *compose_filter;
   bool connect;
 };
 
-/* "pywrapfst.pxd":530
+/* "pywrapfst.pxd":532
  *                            bool connect=?)
  * 
  * cpdef bool isomorphic(Fst ifst1, Fst ifst2, float delta=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef MutableFst prune(Fst ifst,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_isomorphic {
   int __pyx_n;
   float delta;
 };
 
-/* "pywrapfst.pxd":532
+/* "pywrapfst.pxd":534
  * cpdef bool isomorphic(Fst ifst1, Fst ifst2, float delta=?)
  * 
  * cpdef MutableFst prune(Fst ifst,             # <<<<<<<<<<<<<<
  *                        float delta=?,
- *                        int64 nstate=?,
+ *                        int64_t nstate=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_prune {
   int __pyx_n;
   float delta;
-  int64 nstate;
+  int64_t nstate;
   PyObject *weight;
 };
 
-/* "pywrapfst.pxd":537
+/* "pywrapfst.pxd":539
  *                        weight=?)
  * 
  * cpdef MutableFst push(Fst ifst,             # <<<<<<<<<<<<<<
  *                       float delta=?,
  *                       bool push_weights=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_push {
   int __pyx_n;
   float delta;
   bool push_weights;
   bool push_labels;
   bool remove_common_affix;
   bool remove_total_weight;
-  bool to_final;
+  PyObject *reweight_type;
 };
 
-/* "pywrapfst.pxd":545
- *                       bool to_final=?)
+/* "pywrapfst.pxd":547
+ *                       reweight_type=?)
  * 
  * cpdef bool randequivalent(Fst ifst1,             # <<<<<<<<<<<<<<
  *                           Fst ifst2,
- *                           int32 npath=?,
+ *                           int32_t npath=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_randequivalent {
   int __pyx_n;
-  int32 npath;
+  int32_t npath;
   float delta;
   PyObject *select;
-  int32 max_length;
-  uint64 seed;
+  int32_t max_length;
+  uint64_t seed;
 };
 
-/* "pywrapfst.pxd":553
- *                           uint64 seed=?) except *
+/* "pywrapfst.pxd":555
+ *                           uint64_t seed=?) except *
  * 
  * cpdef MutableFst randgen(Fst ifst,             # <<<<<<<<<<<<<<
- *                          int32 npath=?,
+ *                          int32_t npath=?,
  *                          select=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_randgen {
   int __pyx_n;
-  int32 npath;
+  int32_t npath;
   PyObject *select;
-  int32 max_length;
+  int32_t max_length;
   bool remove_total_weight;
   bool weighted;
-  uint64 seed;
+  uint64_t seed;
 };
 
-/* "pywrapfst.pxd":561
- *                          uint64 seed=?)
+/* "pywrapfst.pxd":563
+ *                          uint64_t seed=?)
  * 
  * cpdef MutableFst replace(pairs,             # <<<<<<<<<<<<<<
  *                          call_arc_labeling=?,
  *                          return_arc_labeling=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_replace {
   int __pyx_n;
   PyObject *call_arc_labeling;
   PyObject *return_arc_labeling;
   bool epsilon_on_replace;
-  int64 return_label;
+  int64_t return_label;
 };
 
-/* "pywrapfst.pxd":567
- *                          int64 return_label=?)
+/* "pywrapfst.pxd":569
+ *                          int64_t return_label=?)
  * 
  * cpdef MutableFst reverse(Fst ifst, bool require_superinitial=?)             # <<<<<<<<<<<<<<
  * 
  * cdef void _shortestdistance(Fst ifst,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_reverse {
   int __pyx_n;
   bool require_superinitial;
 };
 
-/* "pywrapfst.pxd":569
+/* "pywrapfst.pxd":571
  * cpdef MutableFst reverse(Fst ifst, bool require_superinitial=?)
  * 
  * cdef void _shortestdistance(Fst ifst,             # <<<<<<<<<<<<<<
  *                             vector[fst.WeightClass] *,
  *                             float delta=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst__shortestdistance {
   int __pyx_n;
   float delta;
-  int64 nstate;
+  int64_t nstate;
   PyObject *queue_type;
   bool reverse;
 };
 
-/* "pywrapfst.pxd":576
+/* "pywrapfst.pxd":578
  *                             bool reverse=?) except *
  * 
  * cpdef MutableFst shortestpath(Fst ifst,             # <<<<<<<<<<<<<<
  *                               float delta=?,
- *                               int32 nshortest=?,
+ *                               int32_t nshortest=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_shortestpath {
   int __pyx_n;
   float delta;
-  int32 nshortest;
-  int64 nstate;
+  int32_t nshortest;
+  int64_t nstate;
   PyObject *queue_type;
   bool unique;
   PyObject *weight;
 };
 
 /* "pywrapfst.pxd":71
  * 
@@ -1886,15 +1886,15 @@
   PyObject_HEAD
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_vtab;
   std::shared_ptr<fst::script::FstClass>  _fst;
   std::unique_ptr<fst::script::StateIteratorClass>  _siter;
 };
 
 
-/* "pywrapfst.pxd":592
+/* "pywrapfst.pxd":594
  * 
  * 
  * cdef class Compiler:             # <<<<<<<<<<<<<<
  * 
  *   cdef unique_ptr[stringstream] _sstrm
  */
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler {
@@ -1910,29 +1910,29 @@
   bool _keep_isymbols;
   bool _keep_osymbols;
   bool _keep_state_numbering;
   bool _allow_negative_labels;
 };
 
 
-/* "pywrapfst.pxd":613
+/* "pywrapfst.pxd":615
  * # FarReader.
  * 
  * cdef class FarReader:             # <<<<<<<<<<<<<<
  * 
  *   cdef unique_ptr[fst.FarReaderClass] _reader
  */
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader {
   PyObject_HEAD
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *__pyx_vtab;
   std::unique_ptr<fst::script::FarReaderClass>  _reader;
 };
 
 
-/* "pywrapfst.pxd":638
+/* "pywrapfst.pxd":640
  * # FarWriter.
  * 
  * cdef class FarWriter:             # <<<<<<<<<<<<<<
  * 
  *   cdef unique_ptr[fst.FarWriterClass] _writer
  */
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter {
@@ -1969,18 +1969,18 @@
  *   cdef const fst.SymbolTable *_raw(self)
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView {
   fst::SymbolTable const *(*_raw)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
   void (*_raise_nonexistent)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
   fst::SymbolTable const *(*_raw_ptr_or_raise)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
-  int64 (*available_key)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
+  int64_t (*available_key)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   PyObject *(*checksum)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *(*copy)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
-  int64 (*get_nth_key)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, Py_ssize_t, int __pyx_skip_dispatch);
+  int64_t (*get_nth_key)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, Py_ssize_t, int __pyx_skip_dispatch);
   PyObject *(*labeled_checksum)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   bool (*member)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, PyObject *, int __pyx_skip_dispatch);
   std::string (*name)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   size_t (*num_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   void (*write)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, PyObject *, int __pyx_skip_dispatch);
   void (*write_text)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, PyObject *, int __pyx_skip_dispatch);
   PyObject *(*write_to_string)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
@@ -2024,15 +2024,15 @@
  *   cdef fst.SymbolTable *_mutable_raw(self)
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable {
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView __pyx_base;
   fst::SymbolTable *(*_mutable_raw)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *);
   fst::SymbolTable *(*_mutable_raw_ptr_or_raise)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *);
-  int64 (*add_symbol)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol *__pyx_optional_args);
+  int64_t (*add_symbol)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol *__pyx_optional_args);
   void (*add_table)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   void (*set_name)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, PyObject *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableSymbolTable;
 
 
 /* "pywrapfst.pxd":167
@@ -2070,15 +2070,15 @@
  * 
  *   cdef shared_ptr[fst.EncodeMapperClass] _mapper
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_EncodeMapper {
   std::string (*arc_type)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
   std::string (*weight_type)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
-  uint8 (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
+  uint8_t (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
   void (*write)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, PyObject *, int __pyx_skip_dispatch);
   PyObject *(*write_to_string)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *(*input_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *(*output_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
   void (*_set_input_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
   void (*_set_output_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
 };
@@ -2092,26 +2092,26 @@
  * 
  *   cdef shared_ptr[fst.FstClass] _fst
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst {
   std::string (*_local_render_svg)(std::string const &);
   std::string (*arc_type)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
-  struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *(*arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch);
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *(*arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *(*copy)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   void (*draw)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_draw *__pyx_optional_args);
-  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *(*final)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch);
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *(*final)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch);
   std::string (*fst_type)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *(*input_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
-  size_t (*num_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch);
-  size_t (*num_input_epsilons)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch);
-  size_t (*num_output_epsilons)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch);
+  size_t (*num_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch);
+  size_t (*num_input_epsilons)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch);
+  size_t (*num_output_epsilons)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *(*output_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   std::string (*print)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_print *__pyx_optional_args);
-  int64 (*start)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
+  int64_t (*start)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *(*states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   bool (*verify)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   std::string (*weight_type)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   void (*write)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, PyObject *, int __pyx_skip_dispatch);
   PyObject *(*write_to_string)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_Fst;
@@ -2124,40 +2124,40 @@
  * 
  *   cdef shared_ptr[fst.MutableFstClass] _mfst
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst {
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst __pyx_base;
   void (*_check_mutating_imethod)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *);
-  void (*_add_arc)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *);
-  int64 (*add_state)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch);
+  void (*_add_arc)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *);
+  int64_t (*add_state)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch);
   void (*add_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, size_t, int __pyx_skip_dispatch);
   void (*_arcsort)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__arcsort *__pyx_optional_args);
   void (*_closure)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__closure *__pyx_optional_args);
   void (*_concat)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *);
   void (*_connect)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *);
   void (*_decode)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *);
-  void (*_delete_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs *__pyx_optional_args);
+  void (*_delete_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs *__pyx_optional_args);
   void (*_delete_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states *__pyx_optional_args);
   void (*_encode)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *);
   void (*_invert)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *);
   void (*_minimize)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__minimize *__pyx_optional_args);
-  struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *(*mutable_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, int __pyx_skip_dispatch);
-  int64 (*num_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch);
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *(*mutable_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, int __pyx_skip_dispatch);
+  int64_t (*num_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch);
   void (*_project)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, PyObject *);
   void (*_prune)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__prune *__pyx_optional_args);
   void (*_push)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__push *__pyx_optional_args);
   void (*_relabel_pairs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_pairs *__pyx_optional_args);
   void (*_relabel_tables)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_tables *__pyx_optional_args);
-  void (*_reserve_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, size_t);
-  void (*_reserve_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64);
+  void (*_reserve_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, size_t);
+  void (*_reserve_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t);
   void (*_reweight)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, PyObject *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__reweight *__pyx_optional_args);
   void (*_rmepsilon)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__rmepsilon *__pyx_optional_args);
-  void (*_set_final)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final *__pyx_optional_args);
-  void (*_set_start)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64);
+  void (*_set_final)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final *__pyx_optional_args);
+  void (*_set_start)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t);
   void (*_set_input_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
   void (*_set_output_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
   void (*_topsort)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_MutableFst;
 
 
@@ -2195,43 +2195,43 @@
  * cdef class _ArcIterator:             # <<<<<<<<<<<<<<
  * 
  *   cdef shared_ptr[fst.FstClass] _fst
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__ArcIterator {
   bool (*done)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
-  uint8 (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
+  uint8_t (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
   void (*next)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
   size_t (*position)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
   void (*reset)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
   void (*seek)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, size_t, int __pyx_skip_dispatch);
-  void (*set_flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, uint8, uint8, int __pyx_skip_dispatch);
-  PyObject *(*value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
+  void (*set_flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, uint8_t, uint8_t, int __pyx_skip_dispatch);
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *(*_value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__ArcIterator;
 
 
 /* "pywrapfst.pxd":448
  * 
  * 
  * cdef class _MutableArcIterator:             # <<<<<<<<<<<<<<
  * 
  *   cdef shared_ptr[fst.MutableFstClass] _mfst
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator {
   bool (*done)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
-  uint8 (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
+  uint8_t (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
   void (*next)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
   size_t (*position)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
   void (*reset)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
   void (*seek)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, size_t, int __pyx_skip_dispatch);
-  void (*set_flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, uint8, uint8, int __pyx_skip_dispatch);
-  void (*set_value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *, int __pyx_skip_dispatch);
-  PyObject *(*value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
+  void (*set_flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, uint8_t, uint8_t, int __pyx_skip_dispatch);
+  void (*_set_value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *);
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *(*_value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableArcIterator;
 
 
 /* "pywrapfst.pxd":472
  * 
  * 
@@ -2240,35 +2240,36 @@
  *   cdef shared_ptr[fst.FstClass] _fst
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator {
   bool (*done)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch);
   void (*next)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch);
   void (*reset)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch);
-  int64 (*value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch);
+  int64_t (*_value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *);
+  int64_t (*value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__StateIterator;
 
 
-/* "pywrapfst.pxd":592
+/* "pywrapfst.pxd":594
  * 
  * 
  * cdef class Compiler:             # <<<<<<<<<<<<<<
  * 
  *   cdef unique_ptr[stringstream] _sstrm
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Compiler {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *(*compile)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *, int __pyx_skip_dispatch);
   void (*write)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *, PyObject *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Compiler *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_Compiler;
 
 
-/* "pywrapfst.pxd":613
+/* "pywrapfst.pxd":615
  * # FarReader.
  * 
  * cdef class FarReader:             # <<<<<<<<<<<<<<
  * 
  *   cdef unique_ptr[fst.FarReaderClass] _reader
  */
 
@@ -2282,15 +2283,15 @@
   std::string (*get_key)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch);
   void (*next)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch);
   void (*reset)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarReader;
 
 
-/* "pywrapfst.pxd":638
+/* "pywrapfst.pxd":640
  * # FarWriter.
  * 
  * cdef class FarWriter:             # <<<<<<<<<<<<<<
  * 
  *   cdef unique_ptr[fst.FarWriterClass] _writer
  */
 
@@ -2553,28 +2554,26 @@
 
 /* InitStrings.proto */
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);
 
 
 /* Module declarations from 'libcpp.vector' */
 
+/* Module declarations from 'libc.stdint' */
+
 /* Module declarations from 'libcpp' */
 
 /* Module declarations from 'libcpp.memory' */
 
 /* Module declarations from 'libc.string' */
 
 /* Module declarations from 'libcpp.string' */
 
 /* Module declarations from 'libcpp.utility' */
 
-/* Module declarations from 'libc.stdint' */
-
-/* Module declarations from 'cintegral_types' */
-
 /* Module declarations from 'cios' */
 
 /* Module declarations from 'cpywrapfst' */
 
 /* Module declarations from 'fstlib.cext.pywrapfst' */
 static PyTypeObject *__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight = 0;
 static PyTypeObject *__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView = 0;
@@ -2600,68 +2599,88 @@
 /* Module declarations from 'fstlib.cext.cops' */
 
 /* Module declarations from 'fstlib.cext.ops' */
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_3ops_align(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_3ops_score_std(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_3ops_score_log(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_3ops_kernel_score_std(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch); /*proto*/
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_3ops_kernel_score_log(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch); /*proto*/
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_3ops_multi_score_std(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch); /*proto*/
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_3ops_multi_kernel_score_std(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyObject_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyUnicode_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyStr_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyBytes_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyByteArray_string_to_py_std__in_string(std::string const &); /*proto*/
 #define __Pyx_MODULE_NAME "fstlib.cext.ops"
 extern int __pyx_module_is_main_fstlib__cext__ops;
 int __pyx_module_is_main_fstlib__cext__ops = 0;
 
 /* Implementation of 'fstlib.cext.ops' */
 static PyObject *__pyx_builtin_print;
+static const char __pyx_k_gl[] = "gl";
 static const char __pyx_k_np[] = "np";
+static const char __pyx_k_loh[] = "loh";
+static const char __pyx_k_wgd[] = "wgd";
+static const char __pyx_k_gain[] = "gain";
+static const char __pyx_k_loss[] = "loss";
 static const char __pyx_k_main[] = "__main__";
 static const char __pyx_k_name[] = "__name__";
 static const char __pyx_k_test[] = "__test__";
+static const char __pyx_k_DELTA[] = "DELTA";
 static const char __pyx_k_ifst1[] = "ifst1";
 static const char __pyx_k_ifst2[] = "ifst2";
 static const char __pyx_k_model[] = "model";
 static const char __pyx_k_numpy[] = "numpy";
 static const char __pyx_k_print[] = "print";
 static const char __pyx_k_runme[] = "runme";
 static const char __pyx_k_import[] = "__import__";
 static const char __pyx_k_This_works[] = "This works";
 static const char __pyx_k_pyx_vtable[] = "__pyx_vtable__";
+static const char __pyx_k_SHORTEST_DELTA[] = "SHORTEST_DELTA";
 static const char __pyx_k_fstlib_cext_ops[] = "fstlib.cext.ops";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_fstlib_cext_ops_pyx[] = "fstlib/cext/ops.pyx";
+static PyObject *__pyx_n_s_DELTA;
+static PyObject *__pyx_n_s_SHORTEST_DELTA;
 static PyObject *__pyx_kp_u_This_works;
 static PyObject *__pyx_n_s_cline_in_traceback;
 static PyObject *__pyx_n_s_fstlib_cext_ops;
 static PyObject *__pyx_kp_s_fstlib_cext_ops_pyx;
+static PyObject *__pyx_n_s_gain;
+static PyObject *__pyx_n_s_gl;
 static PyObject *__pyx_n_s_ifst1;
 static PyObject *__pyx_n_s_ifst2;
 static PyObject *__pyx_n_s_import;
+static PyObject *__pyx_n_s_loh;
+static PyObject *__pyx_n_s_loss;
 static PyObject *__pyx_n_s_main;
 static PyObject *__pyx_n_s_model;
 static PyObject *__pyx_n_s_name;
 static PyObject *__pyx_n_s_np;
 static PyObject *__pyx_n_s_numpy;
 static PyObject *__pyx_n_s_print;
 static PyObject *__pyx_n_s_pyx_vtable;
 static PyObject *__pyx_n_s_runme;
 static PyObject *__pyx_n_s_test;
+static PyObject *__pyx_n_s_wgd;
 static PyObject *__pyx_pf_6fstlib_4cext_3ops_runme(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_3ops_2align(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_model, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_3ops_4score_std(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_model, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_3ops_6score_log(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_model, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_3ops_8kernel_score_std(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_model, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_3ops_10kernel_score_log(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_model, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_3ops_12multi_score_std(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loh, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_wgd, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_gl, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_3ops_14multi_kernel_score_std(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loh, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_wgd, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_gain, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loss, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2); /* proto */
 static PyObject *__pyx_tuple_;
 static PyObject *__pyx_codeobj__2;
 /* Late includes */
 
-/* "fstlib/cext/ops.pyx":17
- * import numpy as np
+/* "fstlib/cext/ops.pyx":22
+ * 
  * 
  * def runme():             # <<<<<<<<<<<<<<
  *     print('This works')
  * 
  */
 
 /* Python wrapper */
@@ -2683,27 +2702,27 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("runme", 0);
 
-  /* "fstlib/cext/ops.pyx":18
+  /* "fstlib/cext/ops.pyx":23
  * 
  * def runme():
  *     print('This works')             # <<<<<<<<<<<<<<
  * 
  * cpdef MutableFst align(Fst model, Fst ifst1, Fst ifst2):
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/ops.pyx":17
- * import numpy as np
+  /* "fstlib/cext/ops.pyx":22
+ * 
  * 
  * def runme():             # <<<<<<<<<<<<<<
  *     print('This works')
  * 
  */
 
   /* function exit code */
@@ -2715,15 +2734,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/ops.pyx":20
+/* "fstlib/cext/ops.pyx":25
  *     print('This works')
  * 
  * cpdef MutableFst align(Fst model, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
  * 
  *   cdef unique_ptr[fst.VectorFstClass] tfst
  */
 
@@ -2734,63 +2753,63 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("align", 0);
 
-  /* "fstlib/cext/ops.pyx":23
+  /* "fstlib/cext/ops.pyx":28
  * 
  *   cdef unique_ptr[fst.VectorFstClass] tfst
  *   tfst.reset(new fst.VectorFstClass(ifst1.arc_type()))             # <<<<<<<<<<<<<<
  * 
- *   cdef fst.WeightClass distance
+ *   align_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst), tfst.get())
  */
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 23, __pyx_L1_error)
+    __PYX_ERR(0, 28, __pyx_L1_error)
   }
   __pyx_v_tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst1->__pyx_vtab)->arc_type(__pyx_v_ifst1, 0)));
 
-  /* "fstlib/cext/ops.pyx":26
+  /* "fstlib/cext/ops.pyx":30
+ *   tfst.reset(new fst.VectorFstClass(ifst1.arc_type()))
  * 
- *   cdef fst.WeightClass distance
- *   shortest_path(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst), tfst.get())             # <<<<<<<<<<<<<<
+ *   align_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst), tfst.get())             # <<<<<<<<<<<<<<
  * 
  *   return _init_MutableFst(tfst.release())
  */
   if (unlikely(((PyObject *)__pyx_v_model) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 26, __pyx_L1_error)
+    __PYX_ERR(0, 30, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 26, __pyx_L1_error)
+    __PYX_ERR(0, 30, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 26, __pyx_L1_error)
+    __PYX_ERR(0, 30, __pyx_L1_error)
   }
-  shortest_path((*__pyx_v_model->_fst), (*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst), __pyx_v_tfst.get());
+  align_std_impl((*__pyx_v_model->_fst), (*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst), __pyx_v_tfst.get());
 
-  /* "fstlib/cext/ops.pyx":28
- *   shortest_path(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst), tfst.get())
+  /* "fstlib/cext/ops.pyx":32
+ *   align_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst), tfst.get())
  * 
  *   return _init_MutableFst(tfst.release())             # <<<<<<<<<<<<<<
  * 
  * cpdef Weight score_std(Fst model, Fst ifst1, Fst ifst2):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v_tfst.release())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v_tfst.release())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 32, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/ops.pyx":20
+  /* "fstlib/cext/ops.pyx":25
  *     print('This works')
  * 
  * cpdef MutableFst align(Fst model, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
  * 
  *   cdef unique_ptr[fst.VectorFstClass] tfst
  */
 
@@ -2838,48 +2857,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("align", 1, 3, 3, 1); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("align", 1, 3, 3, 1); __PYX_ERR(0, 25, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("align", 1, 3, 3, 2); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("align", 1, 3, 3, 2); __PYX_ERR(0, 25, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "align") < 0)) __PYX_ERR(0, 20, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "align") < 0)) __PYX_ERR(0, 25, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_model = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
     __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[2]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("align", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 20, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("align", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 25, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.ops.align", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_model), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "model", 0))) __PYX_ERR(0, 20, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 20, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 20, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_model), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "model", 0))) __PYX_ERR(0, 25, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 25, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 25, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_3ops_2align(__pyx_self, __pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -2892,15 +2911,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("align", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_3ops_align(__pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_3ops_align(__pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -2909,19 +2928,19 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/ops.pyx":30
+/* "fstlib/cext/ops.pyx":34
  *   return _init_MutableFst(tfst.release())
  * 
  * cpdef Weight score_std(Fst model, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
- *   distance = shortest_distance_std(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   distance = score_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_3ops_5score_std(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_3ops_score_std(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_model, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch) {
   fst::script::WeightClass __pyx_v_distance;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_v_retval = NULL;
@@ -2931,81 +2950,81 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("score_std", 0);
 
-  /* "fstlib/cext/ops.pyx":31
+  /* "fstlib/cext/ops.pyx":35
  * 
  * cpdef Weight score_std(Fst model, Fst ifst1, Fst ifst2):
- *   distance = shortest_distance_std(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))             # <<<<<<<<<<<<<<
+ *   distance = score_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))             # <<<<<<<<<<<<<<
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  *   return retval
  */
   if (unlikely(((PyObject *)__pyx_v_model) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 31, __pyx_L1_error)
+    __PYX_ERR(0, 35, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 31, __pyx_L1_error)
+    __PYX_ERR(0, 35, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 31, __pyx_L1_error)
+    __PYX_ERR(0, 35, __pyx_L1_error)
   }
-  __pyx_v_distance = shortest_distance_std((*__pyx_v_model->_fst), (*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst));
+  __pyx_v_distance = score_std_impl((*__pyx_v_model->_fst), (*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst));
 
-  /* "fstlib/cext/ops.pyx":32
+  /* "fstlib/cext/ops.pyx":36
  * cpdef Weight score_std(Fst model, Fst ifst1, Fst ifst2):
- *   distance = shortest_distance_std(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   distance = score_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())             # <<<<<<<<<<<<<<
  *   return retval
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_model) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 32, __pyx_L1_error)
+    __PYX_ERR(0, 36, __pyx_L1_error)
   }
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_model->_fst.get()->WeightType()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 32, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_model->_fst.get()->WeightType()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_distance.ToString()); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 32, __pyx_L1_error)
+  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_distance.ToString()); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 32, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 32, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_retval = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "fstlib/cext/ops.pyx":33
- *   distance = shortest_distance_std(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+  /* "fstlib/cext/ops.pyx":37
+ *   distance = score_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  *   return retval             # <<<<<<<<<<<<<<
  * 
- * 
+ * cpdef Weight score_log(Fst model, Fst ifst1, Fst ifst2):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_retval));
   __pyx_r = __pyx_v_retval;
   goto __pyx_L0;
 
-  /* "fstlib/cext/ops.pyx":30
+  /* "fstlib/cext/ops.pyx":34
  *   return _init_MutableFst(tfst.release())
  * 
  * cpdef Weight score_std(Fst model, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
- *   distance = shortest_distance_std(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   distance = score_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
@@ -3052,48 +3071,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("score_std", 1, 3, 3, 1); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("score_std", 1, 3, 3, 1); __PYX_ERR(0, 34, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("score_std", 1, 3, 3, 2); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("score_std", 1, 3, 3, 2); __PYX_ERR(0, 34, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "score_std") < 0)) __PYX_ERR(0, 30, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "score_std") < 0)) __PYX_ERR(0, 34, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_model = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
     __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[2]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("score_std", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 30, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("score_std", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 34, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.ops.score_std", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_model), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "model", 0))) __PYX_ERR(0, 30, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 30, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 30, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_model), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "model", 0))) __PYX_ERR(0, 34, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 34, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 34, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_3ops_4score_std(__pyx_self, __pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -3106,15 +3125,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("score_std", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_3ops_score_std(__pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_3ops_score_std(__pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 34, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -3123,19 +3142,19 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/ops.pyx":36
- * 
+/* "fstlib/cext/ops.pyx":39
+ *   return retval
  * 
  * cpdef Weight score_log(Fst model, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
- *   distance = shortest_distance_log(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   distance = score_log_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_3ops_7score_log(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_3ops_score_log(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_model, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch) {
   fst::script::WeightClass __pyx_v_distance;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_v_retval = NULL;
@@ -3145,81 +3164,81 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("score_log", 0);
 
-  /* "fstlib/cext/ops.pyx":37
+  /* "fstlib/cext/ops.pyx":40
  * 
  * cpdef Weight score_log(Fst model, Fst ifst1, Fst ifst2):
- *   distance = shortest_distance_log(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))             # <<<<<<<<<<<<<<
+ *   distance = score_log_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))             # <<<<<<<<<<<<<<
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  *   return retval
  */
   if (unlikely(((PyObject *)__pyx_v_model) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 37, __pyx_L1_error)
+    __PYX_ERR(0, 40, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 37, __pyx_L1_error)
+    __PYX_ERR(0, 40, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 37, __pyx_L1_error)
+    __PYX_ERR(0, 40, __pyx_L1_error)
   }
-  __pyx_v_distance = shortest_distance_log((*__pyx_v_model->_fst), (*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst));
+  __pyx_v_distance = score_log_impl((*__pyx_v_model->_fst), (*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst));
 
-  /* "fstlib/cext/ops.pyx":38
+  /* "fstlib/cext/ops.pyx":41
  * cpdef Weight score_log(Fst model, Fst ifst1, Fst ifst2):
- *   distance = shortest_distance_log(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   distance = score_log_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())             # <<<<<<<<<<<<<<
  *   return retval
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_model) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 38, __pyx_L1_error)
+    __PYX_ERR(0, 41, __pyx_L1_error)
   }
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_model->_fst.get()->WeightType()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_model->_fst.get()->WeightType()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_distance.ToString()); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_distance.ToString()); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 41, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 41, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 41, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_retval = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "fstlib/cext/ops.pyx":39
- *   distance = shortest_distance_log(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+  /* "fstlib/cext/ops.pyx":42
+ *   distance = score_log_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  *   return retval             # <<<<<<<<<<<<<<
  * 
  * cpdef Weight kernel_score_std(Fst model, Fst ifst1, Fst ifst2):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_retval));
   __pyx_r = __pyx_v_retval;
   goto __pyx_L0;
 
-  /* "fstlib/cext/ops.pyx":36
- * 
+  /* "fstlib/cext/ops.pyx":39
+ *   return retval
  * 
  * cpdef Weight score_log(Fst model, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
- *   distance = shortest_distance_log(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   distance = score_log_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
@@ -3266,48 +3285,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("score_log", 1, 3, 3, 1); __PYX_ERR(0, 36, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("score_log", 1, 3, 3, 1); __PYX_ERR(0, 39, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("score_log", 1, 3, 3, 2); __PYX_ERR(0, 36, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("score_log", 1, 3, 3, 2); __PYX_ERR(0, 39, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "score_log") < 0)) __PYX_ERR(0, 36, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "score_log") < 0)) __PYX_ERR(0, 39, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_model = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
     __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[2]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("score_log", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 36, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("score_log", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 39, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.ops.score_log", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_model), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "model", 0))) __PYX_ERR(0, 36, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 36, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 36, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_model), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "model", 0))) __PYX_ERR(0, 39, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 39, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 39, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_3ops_6score_log(__pyx_self, __pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -3320,15 +3339,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("score_log", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_3ops_score_log(__pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_3ops_score_log(__pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -3337,15 +3356,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/ops.pyx":41
+/* "fstlib/cext/ops.pyx":44
  *   return retval
  * 
  * cpdef Weight kernel_score_std(Fst model, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
  *   distance = kernel_score_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  */
 
@@ -3359,77 +3378,77 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("kernel_score_std", 0);
 
-  /* "fstlib/cext/ops.pyx":42
+  /* "fstlib/cext/ops.pyx":45
  * 
  * cpdef Weight kernel_score_std(Fst model, Fst ifst1, Fst ifst2):
  *   distance = kernel_score_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))             # <<<<<<<<<<<<<<
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  *   return retval
  */
   if (unlikely(((PyObject *)__pyx_v_model) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 42, __pyx_L1_error)
+    __PYX_ERR(0, 45, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 42, __pyx_L1_error)
+    __PYX_ERR(0, 45, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 42, __pyx_L1_error)
+    __PYX_ERR(0, 45, __pyx_L1_error)
   }
   __pyx_v_distance = kernel_score_std_impl((*__pyx_v_model->_fst), (*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst));
 
-  /* "fstlib/cext/ops.pyx":43
+  /* "fstlib/cext/ops.pyx":46
  * cpdef Weight kernel_score_std(Fst model, Fst ifst1, Fst ifst2):
  *   distance = kernel_score_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())             # <<<<<<<<<<<<<<
  *   return retval
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_model) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 43, __pyx_L1_error)
+    __PYX_ERR(0, 46, __pyx_L1_error)
   }
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_model->_fst.get()->WeightType()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_model->_fst.get()->WeightType()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_distance.ToString()); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_distance.ToString()); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 46, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 46, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 46, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_retval = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "fstlib/cext/ops.pyx":44
+  /* "fstlib/cext/ops.pyx":47
  *   distance = kernel_score_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  *   return retval             # <<<<<<<<<<<<<<
  * 
- * 
+ * cpdef Weight kernel_score_log(Fst model, Fst ifst1, Fst ifst2):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_retval));
   __pyx_r = __pyx_v_retval;
   goto __pyx_L0;
 
-  /* "fstlib/cext/ops.pyx":41
+  /* "fstlib/cext/ops.pyx":44
  *   return retval
  * 
  * cpdef Weight kernel_score_std(Fst model, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
  *   distance = kernel_score_std_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
  *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
  */
 
@@ -3480,48 +3499,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("kernel_score_std", 1, 3, 3, 1); __PYX_ERR(0, 41, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("kernel_score_std", 1, 3, 3, 1); __PYX_ERR(0, 44, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("kernel_score_std", 1, 3, 3, 2); __PYX_ERR(0, 41, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("kernel_score_std", 1, 3, 3, 2); __PYX_ERR(0, 44, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "kernel_score_std") < 0)) __PYX_ERR(0, 41, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "kernel_score_std") < 0)) __PYX_ERR(0, 44, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_model = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
     __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[2]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("kernel_score_std", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 41, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("kernel_score_std", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 44, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.ops.kernel_score_std", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_model), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "model", 0))) __PYX_ERR(0, 41, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 41, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 41, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_model), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "model", 0))) __PYX_ERR(0, 44, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 44, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 44, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_3ops_8kernel_score_std(__pyx_self, __pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -3534,15 +3553,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("kernel_score_std", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_3ops_kernel_score_std(__pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_3ops_kernel_score_std(__pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 44, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -3551,14 +3570,735 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "fstlib/cext/ops.pyx":49
+ *   return retval
+ * 
+ * cpdef Weight kernel_score_log(Fst model, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
+ *   distance = kernel_score_log_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
+ */
+
+static PyObject *__pyx_pw_6fstlib_4cext_3ops_11kernel_score_log(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_3ops_kernel_score_log(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_model, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch) {
+  fst::script::WeightClass __pyx_v_distance;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_v_retval = NULL;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("kernel_score_log", 0);
+
+  /* "fstlib/cext/ops.pyx":50
+ * 
+ * cpdef Weight kernel_score_log(Fst model, Fst ifst1, Fst ifst2):
+ *   distance = kernel_score_log_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))             # <<<<<<<<<<<<<<
+ *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
+ *   return retval
+ */
+  if (unlikely(((PyObject *)__pyx_v_model) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 50, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 50, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 50, __pyx_L1_error)
+  }
+  __pyx_v_distance = kernel_score_log_impl((*__pyx_v_model->_fst), (*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst));
+
+  /* "fstlib/cext/ops.pyx":51
+ * cpdef Weight kernel_score_log(Fst model, Fst ifst1, Fst ifst2):
+ *   distance = kernel_score_log_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(model._fst.get().WeightType(), distance.ToString())             # <<<<<<<<<<<<<<
+ *   return retval
+ * 
+ */
+  if (unlikely(((PyObject *)__pyx_v_model) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 51, __pyx_L1_error)
+  }
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_model->_fst.get()->WeightType()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_distance.ToString()); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
+  __pyx_t_1 = 0;
+  __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_v_retval = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_2);
+  __pyx_t_2 = 0;
+
+  /* "fstlib/cext/ops.pyx":52
+ *   distance = kernel_score_log_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
+ *   return retval             # <<<<<<<<<<<<<<
+ * 
+ * cpdef Weight multi_score_std(Fst loh, Fst wgd, Fst gl, Fst ifst1, Fst ifst2):
+ */
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
+  __Pyx_INCREF(((PyObject *)__pyx_v_retval));
+  __pyx_r = __pyx_v_retval;
+  goto __pyx_L0;
+
+  /* "fstlib/cext/ops.pyx":49
+ *   return retval
+ * 
+ * cpdef Weight kernel_score_log(Fst model, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
+ *   distance = kernel_score_log_impl(deref(model._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(model._fst.get().WeightType(), distance.ToString())
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("fstlib.cext.ops.kernel_score_log", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_retval);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* Python wrapper */
+static PyObject *__pyx_pw_6fstlib_4cext_3ops_11kernel_score_log(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pw_6fstlib_4cext_3ops_11kernel_score_log(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_model = 0;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1 = 0;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2 = 0;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("kernel_score_log (wrapper)", 0);
+  {
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_model,&__pyx_n_s_ifst1,&__pyx_n_s_ifst2,0};
+    PyObject* values[3] = {0,0,0};
+    if (unlikely(__pyx_kwds)) {
+      Py_ssize_t kw_args;
+      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
+      switch (pos_args) {
+        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = PyDict_Size(__pyx_kwds);
+      switch (pos_args) {
+        case  0:
+        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_model)) != 0)) kw_args--;
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("kernel_score_log", 1, 3, 3, 1); __PYX_ERR(0, 49, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  2:
+        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("kernel_score_log", 1, 3, 3, 2); __PYX_ERR(0, 49, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "kernel_score_log") < 0)) __PYX_ERR(0, 49, __pyx_L3_error)
+      }
+    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+    }
+    __pyx_v_model = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
+    __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
+    __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[2]);
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("kernel_score_log", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 49, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("fstlib.cext.ops.kernel_score_log", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_model), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "model", 0))) __PYX_ERR(0, 49, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 49, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 49, __pyx_L1_error)
+  __pyx_r = __pyx_pf_6fstlib_4cext_3ops_10kernel_score_log(__pyx_self, __pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2);
+
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_6fstlib_4cext_3ops_10kernel_score_log(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_model, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("kernel_score_log", 0);
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_3ops_kernel_score_log(__pyx_v_model, __pyx_v_ifst1, __pyx_v_ifst2, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("fstlib.cext.ops.kernel_score_log", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "fstlib/cext/ops.pyx":54
+ *   return retval
+ * 
+ * cpdef Weight multi_score_std(Fst loh, Fst wgd, Fst gl, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
+ *   distance = multi_score_std_impl(deref(loh._fst), deref(wgd._fst), deref(gl._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(loh._fst.get().WeightType(), distance.ToString())
+ */
+
+static PyObject *__pyx_pw_6fstlib_4cext_3ops_13multi_score_std(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_3ops_multi_score_std(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loh, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_wgd, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_gl, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch) {
+  fst::script::WeightClass __pyx_v_distance;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_v_retval = NULL;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("multi_score_std", 0);
+
+  /* "fstlib/cext/ops.pyx":55
+ * 
+ * cpdef Weight multi_score_std(Fst loh, Fst wgd, Fst gl, Fst ifst1, Fst ifst2):
+ *   distance = multi_score_std_impl(deref(loh._fst), deref(wgd._fst), deref(gl._fst), deref(ifst1._fst), deref(ifst2._fst))             # <<<<<<<<<<<<<<
+ *   retval = Weight(loh._fst.get().WeightType(), distance.ToString())
+ *   return retval
+ */
+  if (unlikely(((PyObject *)__pyx_v_loh) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 55, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_wgd) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 55, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_gl) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 55, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 55, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 55, __pyx_L1_error)
+  }
+  __pyx_v_distance = multi_score_std_impl((*__pyx_v_loh->_fst), (*__pyx_v_wgd->_fst), (*__pyx_v_gl->_fst), (*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst));
+
+  /* "fstlib/cext/ops.pyx":56
+ * cpdef Weight multi_score_std(Fst loh, Fst wgd, Fst gl, Fst ifst1, Fst ifst2):
+ *   distance = multi_score_std_impl(deref(loh._fst), deref(wgd._fst), deref(gl._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(loh._fst.get().WeightType(), distance.ToString())             # <<<<<<<<<<<<<<
+ *   return retval
+ * 
+ */
+  if (unlikely(((PyObject *)__pyx_v_loh) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 56, __pyx_L1_error)
+  }
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_loh->_fst.get()->WeightType()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 56, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_distance.ToString()); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 56, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 56, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
+  __pyx_t_1 = 0;
+  __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 56, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_v_retval = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_2);
+  __pyx_t_2 = 0;
+
+  /* "fstlib/cext/ops.pyx":57
+ *   distance = multi_score_std_impl(deref(loh._fst), deref(wgd._fst), deref(gl._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(loh._fst.get().WeightType(), distance.ToString())
+ *   return retval             # <<<<<<<<<<<<<<
+ * 
+ * cpdef Weight multi_kernel_score_std(Fst loh, Fst wgd, Fst gain, Fst loss, Fst ifst1, Fst ifst2):
+ */
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
+  __Pyx_INCREF(((PyObject *)__pyx_v_retval));
+  __pyx_r = __pyx_v_retval;
+  goto __pyx_L0;
+
+  /* "fstlib/cext/ops.pyx":54
+ *   return retval
+ * 
+ * cpdef Weight multi_score_std(Fst loh, Fst wgd, Fst gl, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
+ *   distance = multi_score_std_impl(deref(loh._fst), deref(wgd._fst), deref(gl._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(loh._fst.get().WeightType(), distance.ToString())
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("fstlib.cext.ops.multi_score_std", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_retval);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* Python wrapper */
+static PyObject *__pyx_pw_6fstlib_4cext_3ops_13multi_score_std(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pw_6fstlib_4cext_3ops_13multi_score_std(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loh = 0;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_wgd = 0;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_gl = 0;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1 = 0;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2 = 0;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("multi_score_std (wrapper)", 0);
+  {
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_loh,&__pyx_n_s_wgd,&__pyx_n_s_gl,&__pyx_n_s_ifst1,&__pyx_n_s_ifst2,0};
+    PyObject* values[5] = {0,0,0,0,0};
+    if (unlikely(__pyx_kwds)) {
+      Py_ssize_t kw_args;
+      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
+      switch (pos_args) {
+        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
+        CYTHON_FALLTHROUGH;
+        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
+        CYTHON_FALLTHROUGH;
+        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = PyDict_Size(__pyx_kwds);
+      switch (pos_args) {
+        case  0:
+        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_loh)) != 0)) kw_args--;
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_wgd)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("multi_score_std", 1, 5, 5, 1); __PYX_ERR(0, 54, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  2:
+        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_gl)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("multi_score_std", 1, 5, 5, 2); __PYX_ERR(0, 54, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  3:
+        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("multi_score_std", 1, 5, 5, 3); __PYX_ERR(0, 54, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  4:
+        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("multi_score_std", 1, 5, 5, 4); __PYX_ERR(0, 54, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "multi_score_std") < 0)) __PYX_ERR(0, 54, __pyx_L3_error)
+      }
+    } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
+      values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
+    }
+    __pyx_v_loh = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
+    __pyx_v_wgd = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
+    __pyx_v_gl = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[2]);
+    __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[3]);
+    __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[4]);
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("multi_score_std", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 54, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("fstlib.cext.ops.multi_score_std", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_loh), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "loh", 0))) __PYX_ERR(0, 54, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_wgd), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "wgd", 0))) __PYX_ERR(0, 54, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_gl), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "gl", 0))) __PYX_ERR(0, 54, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 54, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 54, __pyx_L1_error)
+  __pyx_r = __pyx_pf_6fstlib_4cext_3ops_12multi_score_std(__pyx_self, __pyx_v_loh, __pyx_v_wgd, __pyx_v_gl, __pyx_v_ifst1, __pyx_v_ifst2);
+
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_6fstlib_4cext_3ops_12multi_score_std(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loh, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_wgd, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_gl, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("multi_score_std", 0);
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_3ops_multi_score_std(__pyx_v_loh, __pyx_v_wgd, __pyx_v_gl, __pyx_v_ifst1, __pyx_v_ifst2, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 54, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("fstlib.cext.ops.multi_score_std", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "fstlib/cext/ops.pyx":59
+ *   return retval
+ * 
+ * cpdef Weight multi_kernel_score_std(Fst loh, Fst wgd, Fst gain, Fst loss, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
+ *   distance = multi_kernel_score_std_impl(deref(loh._fst), deref(wgd._fst), deref(gain._fst), deref(loss._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(loh._fst.get().WeightType(), distance.ToString())
+ */
+
+static PyObject *__pyx_pw_6fstlib_4cext_3ops_15multi_kernel_score_std(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_3ops_multi_kernel_score_std(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loh, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_wgd, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_gain, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loss, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch) {
+  fst::script::WeightClass __pyx_v_distance;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_v_retval = NULL;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("multi_kernel_score_std", 0);
+
+  /* "fstlib/cext/ops.pyx":60
+ * 
+ * cpdef Weight multi_kernel_score_std(Fst loh, Fst wgd, Fst gain, Fst loss, Fst ifst1, Fst ifst2):
+ *   distance = multi_kernel_score_std_impl(deref(loh._fst), deref(wgd._fst), deref(gain._fst), deref(loss._fst), deref(ifst1._fst), deref(ifst2._fst))             # <<<<<<<<<<<<<<
+ *   retval = Weight(loh._fst.get().WeightType(), distance.ToString())
+ *   return retval
+ */
+  if (unlikely(((PyObject *)__pyx_v_loh) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 60, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_wgd) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 60, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_gain) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 60, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_loss) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 60, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 60, __pyx_L1_error)
+  }
+  if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 60, __pyx_L1_error)
+  }
+  __pyx_v_distance = multi_kernel_score_std_impl((*__pyx_v_loh->_fst), (*__pyx_v_wgd->_fst), (*__pyx_v_gain->_fst), (*__pyx_v_loss->_fst), (*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst));
+
+  /* "fstlib/cext/ops.pyx":61
+ * cpdef Weight multi_kernel_score_std(Fst loh, Fst wgd, Fst gain, Fst loss, Fst ifst1, Fst ifst2):
+ *   distance = multi_kernel_score_std_impl(deref(loh._fst), deref(wgd._fst), deref(gain._fst), deref(loss._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(loh._fst.get().WeightType(), distance.ToString())             # <<<<<<<<<<<<<<
+ *   return retval
+ * 
+ */
+  if (unlikely(((PyObject *)__pyx_v_loh) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
+    __PYX_ERR(0, 61, __pyx_L1_error)
+  }
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_loh->_fst.get()->WeightType()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 61, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_distance.ToString()); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 61, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 61, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
+  __pyx_t_1 = 0;
+  __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 61, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_v_retval = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_2);
+  __pyx_t_2 = 0;
+
+  /* "fstlib/cext/ops.pyx":62
+ *   distance = multi_kernel_score_std_impl(deref(loh._fst), deref(wgd._fst), deref(gain._fst), deref(loss._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(loh._fst.get().WeightType(), distance.ToString())
+ *   return retval             # <<<<<<<<<<<<<<
+ * 
+ */
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
+  __Pyx_INCREF(((PyObject *)__pyx_v_retval));
+  __pyx_r = __pyx_v_retval;
+  goto __pyx_L0;
+
+  /* "fstlib/cext/ops.pyx":59
+ *   return retval
+ * 
+ * cpdef Weight multi_kernel_score_std(Fst loh, Fst wgd, Fst gain, Fst loss, Fst ifst1, Fst ifst2):             # <<<<<<<<<<<<<<
+ *   distance = multi_kernel_score_std_impl(deref(loh._fst), deref(wgd._fst), deref(gain._fst), deref(loss._fst), deref(ifst1._fst), deref(ifst2._fst))
+ *   retval = Weight(loh._fst.get().WeightType(), distance.ToString())
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("fstlib.cext.ops.multi_kernel_score_std", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_retval);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* Python wrapper */
+static PyObject *__pyx_pw_6fstlib_4cext_3ops_15multi_kernel_score_std(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pw_6fstlib_4cext_3ops_15multi_kernel_score_std(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loh = 0;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_wgd = 0;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_gain = 0;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loss = 0;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1 = 0;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2 = 0;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("multi_kernel_score_std (wrapper)", 0);
+  {
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_loh,&__pyx_n_s_wgd,&__pyx_n_s_gain,&__pyx_n_s_loss,&__pyx_n_s_ifst1,&__pyx_n_s_ifst2,0};
+    PyObject* values[6] = {0,0,0,0,0,0};
+    if (unlikely(__pyx_kwds)) {
+      Py_ssize_t kw_args;
+      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
+      switch (pos_args) {
+        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
+        CYTHON_FALLTHROUGH;
+        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
+        CYTHON_FALLTHROUGH;
+        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
+        CYTHON_FALLTHROUGH;
+        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = PyDict_Size(__pyx_kwds);
+      switch (pos_args) {
+        case  0:
+        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_loh)) != 0)) kw_args--;
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_wgd)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("multi_kernel_score_std", 1, 6, 6, 1); __PYX_ERR(0, 59, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  2:
+        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_gain)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("multi_kernel_score_std", 1, 6, 6, 2); __PYX_ERR(0, 59, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  3:
+        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_loss)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("multi_kernel_score_std", 1, 6, 6, 3); __PYX_ERR(0, 59, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  4:
+        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("multi_kernel_score_std", 1, 6, 6, 4); __PYX_ERR(0, 59, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  5:
+        if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("multi_kernel_score_std", 1, 6, 6, 5); __PYX_ERR(0, 59, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "multi_kernel_score_std") < 0)) __PYX_ERR(0, 59, __pyx_L3_error)
+      }
+    } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
+      values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
+      values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
+    }
+    __pyx_v_loh = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
+    __pyx_v_wgd = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
+    __pyx_v_gain = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[2]);
+    __pyx_v_loss = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[3]);
+    __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[4]);
+    __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[5]);
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("multi_kernel_score_std", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 59, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("fstlib.cext.ops.multi_kernel_score_std", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_loh), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "loh", 0))) __PYX_ERR(0, 59, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_wgd), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "wgd", 0))) __PYX_ERR(0, 59, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_gain), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "gain", 0))) __PYX_ERR(0, 59, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_loss), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "loss", 0))) __PYX_ERR(0, 59, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 59, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 59, __pyx_L1_error)
+  __pyx_r = __pyx_pf_6fstlib_4cext_3ops_14multi_kernel_score_std(__pyx_self, __pyx_v_loh, __pyx_v_wgd, __pyx_v_gain, __pyx_v_loss, __pyx_v_ifst1, __pyx_v_ifst2);
+
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_6fstlib_4cext_3ops_14multi_kernel_score_std(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loh, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_wgd, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_gain, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_loss, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("multi_kernel_score_std", 0);
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_3ops_multi_kernel_score_std(__pyx_v_loh, __pyx_v_wgd, __pyx_v_gain, __pyx_v_loss, __pyx_v_ifst1, __pyx_v_ifst2, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 59, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("fstlib.cext.ops.multi_kernel_score_std", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
 /* "string.to_py":31
  * 
  * @cname("__pyx_convert_PyObject_string_to_py_std__in_string")
  * cdef inline object __pyx_convert_PyObject_string_to_py_std__in_string(const string& s):             # <<<<<<<<<<<<<<
  *     return __Pyx_PyObject_FromStringAndSize(s.data(), s.size())
  * cdef extern from *:
  */
@@ -3805,14 +4545,17 @@
 }
 
 static PyMethodDef __pyx_methods[] = {
   {"align", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6fstlib_4cext_3ops_3align, METH_VARARGS|METH_KEYWORDS, 0},
   {"score_std", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6fstlib_4cext_3ops_5score_std, METH_VARARGS|METH_KEYWORDS, 0},
   {"score_log", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6fstlib_4cext_3ops_7score_log, METH_VARARGS|METH_KEYWORDS, 0},
   {"kernel_score_std", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6fstlib_4cext_3ops_9kernel_score_std, METH_VARARGS|METH_KEYWORDS, 0},
+  {"kernel_score_log", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6fstlib_4cext_3ops_11kernel_score_log, METH_VARARGS|METH_KEYWORDS, 0},
+  {"multi_score_std", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6fstlib_4cext_3ops_13multi_score_std, METH_VARARGS|METH_KEYWORDS, 0},
+  {"multi_kernel_score_std", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6fstlib_4cext_3ops_15multi_kernel_score_std, METH_VARARGS|METH_KEYWORDS, 0},
   {0, 0, 0, 0}
 };
 
 #if PY_MAJOR_VERSION >= 3
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
 static int __pyx_pymod_exec_ops(PyObject* module); /*proto*/
@@ -3850,62 +4593,69 @@
     #define CYTHON_SMALL_CODE __attribute__((cold))
 #else
     #define CYTHON_SMALL_CODE
 #endif
 #endif
 
 static __Pyx_StringTabEntry __pyx_string_tab[] = {
+  {&__pyx_n_s_DELTA, __pyx_k_DELTA, sizeof(__pyx_k_DELTA), 0, 0, 1, 1},
+  {&__pyx_n_s_SHORTEST_DELTA, __pyx_k_SHORTEST_DELTA, sizeof(__pyx_k_SHORTEST_DELTA), 0, 0, 1, 1},
   {&__pyx_kp_u_This_works, __pyx_k_This_works, sizeof(__pyx_k_This_works), 0, 1, 0, 0},
   {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
   {&__pyx_n_s_fstlib_cext_ops, __pyx_k_fstlib_cext_ops, sizeof(__pyx_k_fstlib_cext_ops), 0, 0, 1, 1},
   {&__pyx_kp_s_fstlib_cext_ops_pyx, __pyx_k_fstlib_cext_ops_pyx, sizeof(__pyx_k_fstlib_cext_ops_pyx), 0, 0, 1, 0},
+  {&__pyx_n_s_gain, __pyx_k_gain, sizeof(__pyx_k_gain), 0, 0, 1, 1},
+  {&__pyx_n_s_gl, __pyx_k_gl, sizeof(__pyx_k_gl), 0, 0, 1, 1},
   {&__pyx_n_s_ifst1, __pyx_k_ifst1, sizeof(__pyx_k_ifst1), 0, 0, 1, 1},
   {&__pyx_n_s_ifst2, __pyx_k_ifst2, sizeof(__pyx_k_ifst2), 0, 0, 1, 1},
   {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
+  {&__pyx_n_s_loh, __pyx_k_loh, sizeof(__pyx_k_loh), 0, 0, 1, 1},
+  {&__pyx_n_s_loss, __pyx_k_loss, sizeof(__pyx_k_loss), 0, 0, 1, 1},
   {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {&__pyx_n_s_model, __pyx_k_model, sizeof(__pyx_k_model), 0, 0, 1, 1},
   {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
   {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
   {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
   {&__pyx_n_s_print, __pyx_k_print, sizeof(__pyx_k_print), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_vtable, __pyx_k_pyx_vtable, sizeof(__pyx_k_pyx_vtable), 0, 0, 1, 1},
   {&__pyx_n_s_runme, __pyx_k_runme, sizeof(__pyx_k_runme), 0, 0, 1, 1},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
+  {&__pyx_n_s_wgd, __pyx_k_wgd, sizeof(__pyx_k_wgd), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_print = __Pyx_GetBuiltinName(__pyx_n_s_print); if (!__pyx_builtin_print) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_builtin_print = __Pyx_GetBuiltinName(__pyx_n_s_print); if (!__pyx_builtin_print) __PYX_ERR(0, 23, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "fstlib/cext/ops.pyx":18
+  /* "fstlib/cext/ops.pyx":23
  * 
  * def runme():
  *     print('This works')             # <<<<<<<<<<<<<<
  * 
  * cpdef MutableFst align(Fst model, Fst ifst1, Fst ifst2):
  */
-  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_This_works); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_This_works); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple_);
   __Pyx_GIVEREF(__pyx_tuple_);
 
-  /* "fstlib/cext/ops.pyx":17
- * import numpy as np
+  /* "fstlib/cext/ops.pyx":22
+ * 
  * 
  * def runme():             # <<<<<<<<<<<<<<
  *     print('This works')
  * 
  */
-  __pyx_codeobj__2 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_ops_pyx, __pyx_n_s_runme, 17, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__2)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_codeobj__2 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_ops_pyx, __pyx_n_s_runme, 22, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__2)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
@@ -4027,24 +4777,24 @@
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableArcIterator = (struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator*)__Pyx_GetVtable(__pyx_ptype_6fstlib_4cext_9pywrapfst__MutableArcIterator->tp_dict); if (unlikely(!__pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableArcIterator)) __PYX_ERR(2, 448, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst__StateIterator = __Pyx_ImportType(__pyx_t_1, "fstlib.cext.pywrapfst", "_StateIterator", sizeof(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator),
   __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_6fstlib_4cext_9pywrapfst__StateIterator) __PYX_ERR(2, 472, __pyx_L1_error)
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst__StateIterator = (struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator*)__Pyx_GetVtable(__pyx_ptype_6fstlib_4cext_9pywrapfst__StateIterator->tp_dict); if (unlikely(!__pyx_vtabptr_6fstlib_4cext_9pywrapfst__StateIterator)) __PYX_ERR(2, 472, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_Compiler = __Pyx_ImportType(__pyx_t_1, "fstlib.cext.pywrapfst", "Compiler", sizeof(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler),
   __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_6fstlib_4cext_9pywrapfst_Compiler) __PYX_ERR(2, 592, __pyx_L1_error)
-  __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Compiler = (struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Compiler*)__Pyx_GetVtable(__pyx_ptype_6fstlib_4cext_9pywrapfst_Compiler->tp_dict); if (unlikely(!__pyx_vtabptr_6fstlib_4cext_9pywrapfst_Compiler)) __PYX_ERR(2, 592, __pyx_L1_error)
+   if (!__pyx_ptype_6fstlib_4cext_9pywrapfst_Compiler) __PYX_ERR(2, 594, __pyx_L1_error)
+  __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Compiler = (struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Compiler*)__Pyx_GetVtable(__pyx_ptype_6fstlib_4cext_9pywrapfst_Compiler->tp_dict); if (unlikely(!__pyx_vtabptr_6fstlib_4cext_9pywrapfst_Compiler)) __PYX_ERR(2, 594, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader = __Pyx_ImportType(__pyx_t_1, "fstlib.cext.pywrapfst", "FarReader", sizeof(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader),
   __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader) __PYX_ERR(2, 613, __pyx_L1_error)
-  __pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarReader = (struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader*)__Pyx_GetVtable(__pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader->tp_dict); if (unlikely(!__pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarReader)) __PYX_ERR(2, 613, __pyx_L1_error)
+   if (!__pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader) __PYX_ERR(2, 615, __pyx_L1_error)
+  __pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarReader = (struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader*)__Pyx_GetVtable(__pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader->tp_dict); if (unlikely(!__pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarReader)) __PYX_ERR(2, 615, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter = __Pyx_ImportType(__pyx_t_1, "fstlib.cext.pywrapfst", "FarWriter", sizeof(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter),
   __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter) __PYX_ERR(2, 638, __pyx_L1_error)
-  __pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarWriter = (struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarWriter*)__Pyx_GetVtable(__pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter->tp_dict); if (unlikely(!__pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarWriter)) __PYX_ERR(2, 638, __pyx_L1_error)
+   if (!__pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter) __PYX_ERR(2, 640, __pyx_L1_error)
+  __pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarWriter = (struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarWriter*)__Pyx_GetVtable(__pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter->tp_dict); if (unlikely(!__pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarWriter)) __PYX_ERR(2, 640, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -4279,31 +5029,55 @@
   #endif
 
   /* "fstlib/cext/ops.pyx":15
  * from .pywrapfst cimport *
  * from .cops cimport *
  * import numpy as np             # <<<<<<<<<<<<<<
  * 
- * def runme():
+ * ## additional constants
  */
   __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 15, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 15, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/ops.pyx":17
- * import numpy as np
+  /* "fstlib/cext/ops.pyx":18
+ * 
+ * ## additional constants
+ * DELTA = fst.kDelta             # <<<<<<<<<<<<<<
+ * SHORTEST_DELTA = fst.kShortestDelta
+ * 
+ */
+  __pyx_t_1 = PyFloat_FromDouble(fst::kDelta); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_DELTA, __pyx_t_1) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "fstlib/cext/ops.pyx":19
+ * ## additional constants
+ * DELTA = fst.kDelta
+ * SHORTEST_DELTA = fst.kShortestDelta             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_t_1 = PyFloat_FromDouble(fst::kShortestDelta); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SHORTEST_DELTA, __pyx_t_1) < 0) __PYX_ERR(0, 19, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "fstlib/cext/ops.pyx":22
+ * 
  * 
  * def runme():             # <<<<<<<<<<<<<<
  *     print('This works')
  * 
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_3ops_1runme, NULL, __pyx_n_s_fstlib_cext_ops); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_3ops_1runme, NULL, __pyx_n_s_fstlib_cext_ops); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_runme, __pyx_t_1) < 0) __PYX_ERR(0, 17, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_runme, __pyx_t_1) < 0) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "fstlib/cext/ops.pyx":1
  * #cython: c_string_encoding=utf8, c_string_type=unicode, language_level=3, nonecheck=True             # <<<<<<<<<<<<<<
  * # distutils: language=c++
  * 
  */
```

### Comparing `medicc2-0.9.2/fstlib/cext/pywrapfst.cpp` & `medicc2-1.0.0/fstlib/cext/pywrapfst.cpp`

 * *Files 2% similar despite different names*

```diff
@@ -779,14 +779,15 @@
     #define __PYX_EXTERN_C extern
   #endif
 #endif
 
 #define __PYX_HAVE__fstlib__cext__pywrapfst
 #define __PYX_HAVE_API__fstlib__cext__pywrapfst
 /* Early includes */
+#include <stdint.h>
 #include "ios"
 #include "new"
 #include "stdexcept"
 #include "typeinfo"
 #include <memory>
 #include <string.h>
 #include <string>
@@ -800,46 +801,28 @@
     template <typename T> typename std::remove_reference<T>::type&& move(T& t) noexcept { return std::move(t); }
     template <typename T> typename std::remove_reference<T>::type&& move(T&& t) noexcept { return std::move(t); }
     }
 
     #endif
     
 #include <vector>
-#include <stdint.h>
 #include <iostream>
 #include <fstream>
 #include <sstream>
 #include <fst/util.h>
 #include <fst/fstlib.h>
 #include <fst/script/fstscript.h>
 #include <fst/script/getters.h>
 #include <fst/extensions/far/far.h>
 #include <fst/extensions/far/getters.h>
 #include <fst/extensions/far/far-class.h>
 #include <stddef.h>
 #include <time.h>
+#include <limits>
 #include <fst/compat.h>
-
-    #include <type_traits>
-    #include <utility>
-
-    namespace fst {
-
-    template <typename T>
-    inline typename std::remove_reference<T>::type &&move(T &t) {
-        return std::move(t);
-    }
-
-    template <typename T>
-    inline typename std::remove_reference<T>::type &&move(T &&t) {
-        return std::move(t);
-    }
-
-    }  // namespace fst
-    
 #ifdef _OPENMP
 #include <omp.h>
 #endif /* _OPENMP */
 
 #if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
 #define CYTHON_WITHOUT_ASSERTIONS
 #endif
@@ -1067,31 +1050,31 @@
 struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator;
 struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator;
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler;
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader;
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter;
 struct __pyx_obj_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__;
 
-/* "cpywrapfst.pxd":508
+/* "cpywrapfst.pxd":515
  * 
  * 
- * ctypedef pair[int64, const FstClass *] LabelFstClassPair             # <<<<<<<<<<<<<<
+ * ctypedef pair[int64_t, const FstClass *] LabelFstClassPair             # <<<<<<<<<<<<<<
  * 
- * ctypedef pair[int64, int64] LabelPair
+ * ctypedef pair[int64_t, int64_t] LabelPair
  */
-typedef std::pair<int64,fst::script::FstClass const *>  __pyx_t_10cpywrapfst_LabelFstClassPair;
+typedef std::pair<int64_t,fst::script::FstClass const *>  __pyx_t_10cpywrapfst_LabelFstClassPair;
 
-/* "cpywrapfst.pxd":510
- * ctypedef pair[int64, const FstClass *] LabelFstClassPair
+/* "cpywrapfst.pxd":517
+ * ctypedef pair[int64_t, const FstClass *] LabelFstClassPair
  * 
- * ctypedef pair[int64, int64] LabelPair             # <<<<<<<<<<<<<<
+ * ctypedef pair[int64_t, int64_t] LabelPair             # <<<<<<<<<<<<<<
  * 
  * 
  */
-typedef std::pair<int64,int64>  __pyx_t_10cpywrapfst_LabelPair;
+typedef std::pair<int64_t,int64_t>  __pyx_t_10cpywrapfst_LabelPair;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_draw;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_print;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__arcsort;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__closure;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs;
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states;
@@ -1141,21 +1124,21 @@
  * 
  */
 typedef fst::SymbolTable const *__pyx_t_6fstlib_4cext_9pywrapfst_const_SymbolTable_ptr;
 
 /* "fstlib/cext/pywrapfst.pxd":160
  *   cdef fst.SymbolTable *_mutable_raw_ptr_or_raise(self) except *
  * 
- *   cpdef int64 add_symbol(self, symbol, int64 key=?) except *             # <<<<<<<<<<<<<<
+ *   cpdef int64_t add_symbol(self, symbol, int64_t key=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cpdef void add_table(self, SymbolTableView syms) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol {
   int __pyx_n;
-  int64 key;
+  int64_t key;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":207
  * 
  * 
  * ctypedef fst.EncodeMapperClass * EncodeMapperClass_ptr             # <<<<<<<<<<<<<<
  * 
@@ -1215,16 +1198,16 @@
   PyObject *title;
   double width;
   double height;
   bool portrait;
   bool vertical;
   double ranksep;
   double nodesep;
-  int32 fontsize;
-  int32 precision;
+  int32_t fontsize;
+  int32_t precision;
   PyObject *float_format;
   bool show_weight_one;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":292
  *   cpdef _FstSymbolTableView output_symbols(self)
  * 
@@ -1243,47 +1226,47 @@
 };
 
 /* "fstlib/cext/pywrapfst.pxd":325
  *   cpdef void add_states(self, size_t)
  * 
  *   cdef void _arcsort(self, sort_type=?) except *             # <<<<<<<<<<<<<<
  * 
- *   cdef void _closure(self, bool closure_plus=?)
+ *   cdef void _closure(self, closure_type=?)
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__arcsort {
   int __pyx_n;
   PyObject *sort_type;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":327
  *   cdef void _arcsort(self, sort_type=?) except *
  * 
- *   cdef void _closure(self, bool closure_plus=?)             # <<<<<<<<<<<<<<
+ *   cdef void _closure(self, closure_type=?)             # <<<<<<<<<<<<<<
  * 
  *   cdef void _concat(self, Fst fst2) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__closure {
   int __pyx_n;
-  bool closure_plus;
+  PyObject *closure_type;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":335
  *   cdef void _decode(self, EncodeMapper) except *
  * 
- *   cdef void _delete_arcs(self, int64 state, size_t n=?) except *             # <<<<<<<<<<<<<<
+ *   cdef void _delete_arcs(self, int64_t state, size_t n=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cdef void _delete_states(self, states=?) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs {
   int __pyx_n;
   size_t n;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":337
- *   cdef void _delete_arcs(self, int64 state, size_t n=?) except *
+ *   cdef void _delete_arcs(self, int64_t state, size_t n=?) except *
  * 
  *   cdef void _delete_states(self, states=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cdef void _encode(self, EncodeMapper) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states {
   int __pyx_n;
@@ -1291,52 +1274,52 @@
 };
 
 /* "fstlib/cext/pywrapfst.pxd":343
  *   cdef void _invert(self)
  * 
  *   cdef void _minimize(self, float delta=?, bool allow_nondet=?) except *             # <<<<<<<<<<<<<<
  * 
- *   cpdef _MutableArcIterator mutable_arcs(self, int64 state)
+ *   cpdef _MutableArcIterator mutable_arcs(self, int64_t state)
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__minimize {
   int __pyx_n;
   float delta;
   bool allow_nondet;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":351
  *   cdef void _project(self, project_type) except *
  * 
- *   cdef void _prune(self, float delta=?, int64 nstate=?, weight=?) except *             # <<<<<<<<<<<<<<
+ *   cdef void _prune(self, float delta=?, int64_t nstate=?, weight=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cdef void _push(self,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__prune {
   int __pyx_n;
   float delta;
-  int64 nstate;
+  int64_t nstate;
   PyObject *weight;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":353
- *   cdef void _prune(self, float delta=?, int64 nstate=?, weight=?) except *
+ *   cdef void _prune(self, float delta=?, int64_t nstate=?, weight=?) except *
  * 
  *   cdef void _push(self,             # <<<<<<<<<<<<<<
  *                   float delta=?,
  *                   bool remove_total_weight=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__push {
   int __pyx_n;
   float delta;
   bool remove_total_weight;
-  bool to_final;
+  PyObject *reweight_type;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":358
- *                   bool to_final=?)
+ *                   reweight_type=?)
  * 
  *   cdef void _relabel_pairs(self, ipairs=?, opairs=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cdef void _relabel_tables(self,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_pairs {
   int __pyx_n;
@@ -1360,332 +1343,332 @@
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *old_osymbols;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *new_osymbols;
   PyObject *unknown_osymbol;
   bool attach_new_osymbols;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":374
- *   cdef void _reserve_states(self, int64 n)
+ *   cdef void _reserve_states(self, int64_t n)
  * 
- *   cdef void _reweight(self, potentials, bool to_final=?) except *             # <<<<<<<<<<<<<<
+ *   cdef void _reweight(self, potentials, reweight_type=?) except *             # <<<<<<<<<<<<<<
  * 
  *   cdef void _rmepsilon(self,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__reweight {
   int __pyx_n;
-  bool to_final;
+  PyObject *reweight_type;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":376
- *   cdef void _reweight(self, potentials, bool to_final=?) except *
+ *   cdef void _reweight(self, potentials, reweight_type=?) except *
  * 
  *   cdef void _rmepsilon(self,             # <<<<<<<<<<<<<<
  *                        queue_type=?,
  *                        bool connect=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__rmepsilon {
   int __pyx_n;
   PyObject *queue_type;
   bool connect;
   PyObject *weight;
-  int64 nstate;
+  int64_t nstate;
   float delta;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":383
  *                        float delta=?) except *
  * 
- *   cdef void _set_final(self, int64 state, weight=?) except *             # <<<<<<<<<<<<<<
+ *   cdef void _set_final(self, int64_t state, weight=?) except *             # <<<<<<<<<<<<<<
  * 
- *   cdef void _set_start(self, int64 state) except *
+ *   cdef void _set_start(self, int64_t state) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final {
   int __pyx_n;
   PyObject *weight;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":489
+/* "fstlib/cext/pywrapfst.pxd":491
  * 
  * 
  * cdef Fst _map(Fst ifst, float delta=?, map_type=?, double power=?, weight=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef Fst arcmap(Fst ifst, float delta=?, map_type=?, double power=?, weight=?)
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst__map {
   int __pyx_n;
   float delta;
   PyObject *map_type;
   double power;
   PyObject *weight;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":491
+/* "fstlib/cext/pywrapfst.pxd":493
  * cdef Fst _map(Fst ifst, float delta=?, map_type=?, double power=?, weight=?)
  * 
  * cpdef Fst arcmap(Fst ifst, float delta=?, map_type=?, double power=?, weight=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef MutableFst compose(Fst ifst1,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_arcmap {
   int __pyx_n;
   float delta;
   PyObject *map_type;
   double power;
   PyObject *weight;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":493
+/* "fstlib/cext/pywrapfst.pxd":495
  * cpdef Fst arcmap(Fst ifst, float delta=?, map_type=?, double power=?, weight=?)
  * 
  * cpdef MutableFst compose(Fst ifst1,             # <<<<<<<<<<<<<<
  *                          Fst ifst2,
  *                          compose_filter=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_compose {
   int __pyx_n;
   PyObject *compose_filter;
   bool connect;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":498
+/* "fstlib/cext/pywrapfst.pxd":500
  *                          bool connect=?)
  * 
  * cpdef Fst convert(Fst ifst, fst_type=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef MutableFst determinize(Fst ifst,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_convert {
   int __pyx_n;
   PyObject *fst_type;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":500
+/* "fstlib/cext/pywrapfst.pxd":502
  * cpdef Fst convert(Fst ifst, fst_type=?)
  * 
  * cpdef MutableFst determinize(Fst ifst,             # <<<<<<<<<<<<<<
  *                              float delta=?,
  *                              det_type=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_determinize {
   int __pyx_n;
   float delta;
   PyObject *det_type;
-  int64 nstate;
-  int64 subsequential_label;
+  int64_t nstate;
+  int64_t subsequential_label;
   PyObject *weight;
   bool increment_subsequential_label;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":508
+/* "fstlib/cext/pywrapfst.pxd":510
  *                              bool increment_subsequential_label=?)
  * 
  * cpdef MutableFst difference(Fst ifst1,             # <<<<<<<<<<<<<<
  *                             Fst ifst2,
  *                             compose_filter=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_difference {
   int __pyx_n;
   PyObject *compose_filter;
   bool connect;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":513
+/* "fstlib/cext/pywrapfst.pxd":515
  *                             bool connect=?)
  * 
  * cpdef MutableFst disambiguate(Fst ifst,             # <<<<<<<<<<<<<<
  *                               float delta=?,
- *                               int64 nstate=?,
+ *                               int64_t nstate=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_disambiguate {
   int __pyx_n;
   float delta;
-  int64 nstate;
-  int64 subsequential_label;
+  int64_t nstate;
+  int64_t subsequential_label;
   PyObject *weight;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":519
+/* "fstlib/cext/pywrapfst.pxd":521
  *                               weight=?)
  * 
- * cpdef MutableFst epsnormalize(Fst ifst, bool eps_norm_output=?)             # <<<<<<<<<<<<<<
+ * cpdef MutableFst epsnormalize(Fst ifst, eps_norm_type=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef bool equal(Fst ifst1, Fst ifst2, float delta=?)
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_epsnormalize {
   int __pyx_n;
-  bool eps_norm_output;
+  PyObject *eps_norm_type;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":521
- * cpdef MutableFst epsnormalize(Fst ifst, bool eps_norm_output=?)
+/* "fstlib/cext/pywrapfst.pxd":523
+ * cpdef MutableFst epsnormalize(Fst ifst, eps_norm_type=?)
  * 
  * cpdef bool equal(Fst ifst1, Fst ifst2, float delta=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef bool equivalent(Fst ifst1, Fst ifst2, float delta=?) except *
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_equal {
   int __pyx_n;
   float delta;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":523
+/* "fstlib/cext/pywrapfst.pxd":525
  * cpdef bool equal(Fst ifst1, Fst ifst2, float delta=?)
  * 
  * cpdef bool equivalent(Fst ifst1, Fst ifst2, float delta=?) except *             # <<<<<<<<<<<<<<
  * 
  * cpdef MutableFst intersect(Fst ifst1,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_equivalent {
   int __pyx_n;
   float delta;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":525
+/* "fstlib/cext/pywrapfst.pxd":527
  * cpdef bool equivalent(Fst ifst1, Fst ifst2, float delta=?) except *
  * 
  * cpdef MutableFst intersect(Fst ifst1,             # <<<<<<<<<<<<<<
  *                            Fst ifst2,
  *                            compose_filter=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_intersect {
   int __pyx_n;
   PyObject *compose_filter;
   bool connect;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":530
+/* "fstlib/cext/pywrapfst.pxd":532
  *                            bool connect=?)
  * 
  * cpdef bool isomorphic(Fst ifst1, Fst ifst2, float delta=?)             # <<<<<<<<<<<<<<
  * 
  * cpdef MutableFst prune(Fst ifst,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_isomorphic {
   int __pyx_n;
   float delta;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":532
+/* "fstlib/cext/pywrapfst.pxd":534
  * cpdef bool isomorphic(Fst ifst1, Fst ifst2, float delta=?)
  * 
  * cpdef MutableFst prune(Fst ifst,             # <<<<<<<<<<<<<<
  *                        float delta=?,
- *                        int64 nstate=?,
+ *                        int64_t nstate=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_prune {
   int __pyx_n;
   float delta;
-  int64 nstate;
+  int64_t nstate;
   PyObject *weight;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":537
+/* "fstlib/cext/pywrapfst.pxd":539
  *                        weight=?)
  * 
  * cpdef MutableFst push(Fst ifst,             # <<<<<<<<<<<<<<
  *                       float delta=?,
  *                       bool push_weights=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_push {
   int __pyx_n;
   float delta;
   bool push_weights;
   bool push_labels;
   bool remove_common_affix;
   bool remove_total_weight;
-  bool to_final;
+  PyObject *reweight_type;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":545
- *                       bool to_final=?)
+/* "fstlib/cext/pywrapfst.pxd":547
+ *                       reweight_type=?)
  * 
  * cpdef bool randequivalent(Fst ifst1,             # <<<<<<<<<<<<<<
  *                           Fst ifst2,
- *                           int32 npath=?,
+ *                           int32_t npath=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_randequivalent {
   int __pyx_n;
-  int32 npath;
+  int32_t npath;
   float delta;
   PyObject *select;
-  int32 max_length;
-  uint64 seed;
+  int32_t max_length;
+  uint64_t seed;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":553
- *                           uint64 seed=?) except *
+/* "fstlib/cext/pywrapfst.pxd":555
+ *                           uint64_t seed=?) except *
  * 
  * cpdef MutableFst randgen(Fst ifst,             # <<<<<<<<<<<<<<
- *                          int32 npath=?,
+ *                          int32_t npath=?,
  *                          select=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_randgen {
   int __pyx_n;
-  int32 npath;
+  int32_t npath;
   PyObject *select;
-  int32 max_length;
+  int32_t max_length;
   bool remove_total_weight;
   bool weighted;
-  uint64 seed;
+  uint64_t seed;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":561
- *                          uint64 seed=?)
+/* "fstlib/cext/pywrapfst.pxd":563
+ *                          uint64_t seed=?)
  * 
  * cpdef MutableFst replace(pairs,             # <<<<<<<<<<<<<<
  *                          call_arc_labeling=?,
  *                          return_arc_labeling=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_replace {
   int __pyx_n;
   PyObject *call_arc_labeling;
   PyObject *return_arc_labeling;
   bool epsilon_on_replace;
-  int64 return_label;
+  int64_t return_label;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":567
- *                          int64 return_label=?)
+/* "fstlib/cext/pywrapfst.pxd":569
+ *                          int64_t return_label=?)
  * 
  * cpdef MutableFst reverse(Fst ifst, bool require_superinitial=?)             # <<<<<<<<<<<<<<
  * 
  * cdef void _shortestdistance(Fst ifst,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_reverse {
   int __pyx_n;
   bool require_superinitial;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":569
+/* "fstlib/cext/pywrapfst.pxd":571
  * cpdef MutableFst reverse(Fst ifst, bool require_superinitial=?)
  * 
  * cdef void _shortestdistance(Fst ifst,             # <<<<<<<<<<<<<<
  *                             vector[fst.WeightClass] *,
  *                             float delta=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst__shortestdistance {
   int __pyx_n;
   float delta;
-  int64 nstate;
+  int64_t nstate;
   PyObject *queue_type;
   bool reverse;
 };
 
-/* "fstlib/cext/pywrapfst.pxd":576
+/* "fstlib/cext/pywrapfst.pxd":578
  *                             bool reverse=?) except *
  * 
  * cpdef MutableFst shortestpath(Fst ifst,             # <<<<<<<<<<<<<<
  *                               float delta=?,
- *                               int32 nshortest=?,
+ *                               int32_t nshortest=?,
  */
 struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_shortestpath {
   int __pyx_n;
   float delta;
-  int32 nshortest;
-  int64 nstate;
+  int32_t nshortest;
+  int64_t nstate;
   PyObject *queue_type;
   bool unique;
   PyObject *weight;
 };
 
 /* "fstlib/cext/pywrapfst.pxd":71
  * 
@@ -1903,15 +1886,15 @@
   PyObject_HEAD
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_vtab;
   std::shared_ptr<fst::script::FstClass>  _fst;
   std::unique_ptr<fst::script::StateIteratorClass>  _siter;
 };
 
 
-/* "fstlib/cext/pywrapfst.pxd":592
+/* "fstlib/cext/pywrapfst.pxd":594
  * 
  * 
  * cdef class Compiler:             # <<<<<<<<<<<<<<
  * 
  *   cdef unique_ptr[stringstream] _sstrm
  */
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler {
@@ -1927,57 +1910,57 @@
   bool _keep_isymbols;
   bool _keep_osymbols;
   bool _keep_state_numbering;
   bool _allow_negative_labels;
 };
 
 
-/* "fstlib/cext/pywrapfst.pxd":613
+/* "fstlib/cext/pywrapfst.pxd":615
  * # FarReader.
  * 
  * cdef class FarReader:             # <<<<<<<<<<<<<<
  * 
  *   cdef unique_ptr[fst.FarReaderClass] _reader
  */
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader {
   PyObject_HEAD
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *__pyx_vtab;
   std::unique_ptr<fst::script::FarReaderClass>  _reader;
 };
 
 
-/* "fstlib/cext/pywrapfst.pxd":638
+/* "fstlib/cext/pywrapfst.pxd":640
  * # FarWriter.
  * 
  * cdef class FarWriter:             # <<<<<<<<<<<<<<
  * 
  *   cdef unique_ptr[fst.FarWriterClass] _writer
  */
 struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter {
   PyObject_HEAD
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarWriter *__pyx_vtab;
   std::unique_ptr<fst::script::FarWriterClass>  _writer;
 };
 
 
-/* "fstlib/cext/pywrapfst.pyx":3275
+/* "fstlib/cext/pywrapfst.pyx":3360
  * 
  *   # Magic method used to get a Pythonic Iterator API out of the C++ API.
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     while not self.done():
  *       yield self.value()
  */
 struct __pyx_obj_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__ {
   PyObject_HEAD
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self;
 };
 
 
 
-/* "fstlib/cext/pywrapfst.pyx":405
+/* "fstlib/cext/pywrapfst.pyx":466
  * 
  * 
  * cdef class Weight:             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
@@ -1987,318 +1970,319 @@
   std::string (*to_string)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *, int __pyx_skip_dispatch);
   std::string (*type)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *, int __pyx_skip_dispatch);
   bool (*member)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_Weight;
 
 
-/* "fstlib/cext/pywrapfst.pyx":732
+/* "fstlib/cext/pywrapfst.pyx":793
  * 
  * 
  * cdef class SymbolTableView:             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView {
   fst::SymbolTable const *(*_raw)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
   void (*_raise_nonexistent)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
   fst::SymbolTable const *(*_raw_ptr_or_raise)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
-  int64 (*available_key)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
+  int64_t (*available_key)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   PyObject *(*checksum)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *(*copy)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
-  int64 (*get_nth_key)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, Py_ssize_t, int __pyx_skip_dispatch);
+  int64_t (*get_nth_key)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, Py_ssize_t, int __pyx_skip_dispatch);
   PyObject *(*labeled_checksum)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   bool (*member)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, PyObject *, int __pyx_skip_dispatch);
   std::string (*name)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   size_t (*num_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   void (*write)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, PyObject *, int __pyx_skip_dispatch);
   void (*write_text)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, PyObject *, int __pyx_skip_dispatch);
   PyObject *(*write_to_string)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_SymbolTableView;
 
 
-/* "fstlib/cext/pywrapfst.pyx":935
+/* "fstlib/cext/pywrapfst.pyx":996
  * 
  * 
  * cdef class _EncodeMapperSymbolTableView(SymbolTableView):             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView {
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView __pyx_base;
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView;
 
 
-/* "fstlib/cext/pywrapfst.pyx":959
+/* "fstlib/cext/pywrapfst.pyx":1020
  * 
  * 
  * cdef class _FstSymbolTableView(SymbolTableView):             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__FstSymbolTableView {
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView __pyx_base;
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__FstSymbolTableView *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__FstSymbolTableView;
 
 
-/* "fstlib/cext/pywrapfst.pyx":982
+/* "fstlib/cext/pywrapfst.pyx":1043
  * 
  * 
  * cdef class _MutableSymbolTable(SymbolTableView):             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable {
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView __pyx_base;
   fst::SymbolTable *(*_mutable_raw)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *);
   fst::SymbolTable *(*_mutable_raw_ptr_or_raise)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *);
-  int64 (*add_symbol)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol *__pyx_optional_args);
+  int64_t (*add_symbol)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol *__pyx_optional_args);
   void (*add_table)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch);
   void (*set_name)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, PyObject *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableSymbolTable;
 
 
-/* "fstlib/cext/pywrapfst.pyx":1054
+/* "fstlib/cext/pywrapfst.pyx":1115
  * 
  * 
  * cdef class _MutableFstSymbolTableView(_MutableSymbolTable):             # <<<<<<<<<<<<<<
  *   """
  *   (No constructor.)
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView {
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable __pyx_base;
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView;
 
 
-/* "fstlib/cext/pywrapfst.pyx":1069
+/* "fstlib/cext/pywrapfst.pyx":1130
  * 
  * 
  * cdef class SymbolTable(_MutableSymbolTable):             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTable {
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable __pyx_base;
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTable *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_SymbolTable;
 
 
-/* "fstlib/cext/pywrapfst.pyx":1297
+/* "fstlib/cext/pywrapfst.pyx":1358
  * 
  * 
  * cdef class EncodeMapper:             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_EncodeMapper {
   std::string (*arc_type)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
   std::string (*weight_type)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
-  uint8 (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
+  uint8_t (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
   void (*write)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, PyObject *, int __pyx_skip_dispatch);
   PyObject *(*write_to_string)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *(*input_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *(*output_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch);
   void (*_set_input_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
   void (*_set_output_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_EncodeMapper;
 
 
-/* "fstlib/cext/pywrapfst.pyx":1564
+/* "fstlib/cext/pywrapfst.pyx":1626
  * 
  * 
  * cdef class Fst:             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst {
   std::string (*_local_render_svg)(std::string const &);
   std::string (*arc_type)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
-  struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *(*arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch);
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *(*arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *(*copy)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   void (*draw)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_draw *__pyx_optional_args);
-  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *(*final)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch);
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *(*final)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch);
   std::string (*fst_type)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *(*input_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
-  size_t (*num_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch);
-  size_t (*num_input_epsilons)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch);
-  size_t (*num_output_epsilons)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch);
+  size_t (*num_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch);
+  size_t (*num_input_epsilons)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch);
+  size_t (*num_output_epsilons)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *(*output_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   std::string (*print)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_print *__pyx_optional_args);
-  int64 (*start)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
+  int64_t (*start)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *(*states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   bool (*verify)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   std::string (*weight_type)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
   void (*write)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, PyObject *, int __pyx_skip_dispatch);
   PyObject *(*write_to_string)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_Fst;
 
 
-/* "fstlib/cext/pywrapfst.pyx":2029
+/* "fstlib/cext/pywrapfst.pyx":2093
  * 
  * 
  * cdef class MutableFst(Fst):             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst {
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst __pyx_base;
   void (*_check_mutating_imethod)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *);
-  void (*_add_arc)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *);
-  int64 (*add_state)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch);
+  void (*_add_arc)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *);
+  int64_t (*add_state)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch);
   void (*add_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, size_t, int __pyx_skip_dispatch);
   void (*_arcsort)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__arcsort *__pyx_optional_args);
   void (*_closure)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__closure *__pyx_optional_args);
   void (*_concat)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *);
   void (*_connect)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *);
   void (*_decode)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *);
-  void (*_delete_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs *__pyx_optional_args);
+  void (*_delete_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs *__pyx_optional_args);
   void (*_delete_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states *__pyx_optional_args);
   void (*_encode)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *);
   void (*_invert)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *);
   void (*_minimize)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__minimize *__pyx_optional_args);
-  struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *(*mutable_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, int __pyx_skip_dispatch);
-  int64 (*num_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch);
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *(*mutable_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, int __pyx_skip_dispatch);
+  int64_t (*num_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch);
   void (*_project)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, PyObject *);
   void (*_prune)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__prune *__pyx_optional_args);
   void (*_push)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__push *__pyx_optional_args);
   void (*_relabel_pairs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_pairs *__pyx_optional_args);
   void (*_relabel_tables)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_tables *__pyx_optional_args);
-  void (*_reserve_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, size_t);
-  void (*_reserve_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64);
+  void (*_reserve_arcs)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, size_t);
+  void (*_reserve_states)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t);
   void (*_reweight)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, PyObject *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__reweight *__pyx_optional_args);
   void (*_rmepsilon)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__rmepsilon *__pyx_optional_args);
-  void (*_set_final)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final *__pyx_optional_args);
-  void (*_set_start)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64);
+  void (*_set_final)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final *__pyx_optional_args);
+  void (*_set_start)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t);
   void (*_set_input_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
   void (*_set_output_symbols)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *);
   void (*_topsort)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_MutableFst;
 
 
-/* "fstlib/cext/pywrapfst.pyx":2891
+/* "fstlib/cext/pywrapfst.pyx":2958
  * 
  * 
  * cdef class VectorFst(MutableFst):             # <<<<<<<<<<<<<<
  *   """
  *   VectorFst(arc_type="standard")
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_VectorFst {
   struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst __pyx_base;
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_VectorFst *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_VectorFst;
 
 
-/* "fstlib/cext/pywrapfst.pyx":3074
+/* "fstlib/cext/pywrapfst.pyx":3140
  * 
  * 
  * cdef class Arc:             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Arc {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *(*copy)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Arc *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_Arc;
 
 
-/* "fstlib/cext/pywrapfst.pyx":3144
+/* "fstlib/cext/pywrapfst.pyx":3210
  * 
  * 
  * cdef class _ArcIterator:             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__ArcIterator {
   bool (*done)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
-  uint8 (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
+  uint8_t (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
   void (*next)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
   size_t (*position)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
   void (*reset)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
   void (*seek)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, size_t, int __pyx_skip_dispatch);
-  void (*set_flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, uint8, uint8, int __pyx_skip_dispatch);
-  PyObject *(*value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch);
+  void (*set_flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, uint8_t, uint8_t, int __pyx_skip_dispatch);
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *(*_value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__ArcIterator;
 
 
-/* "fstlib/cext/pywrapfst.pyx":3255
+/* "fstlib/cext/pywrapfst.pyx":3340
  * 
  * 
  * cdef class _MutableArcIterator:             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator {
   bool (*done)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
-  uint8 (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
+  uint8_t (*flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
   void (*next)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
   size_t (*position)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
   void (*reset)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
   void (*seek)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, size_t, int __pyx_skip_dispatch);
-  void (*set_flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, uint8, uint8, int __pyx_skip_dispatch);
-  void (*set_value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *, int __pyx_skip_dispatch);
-  PyObject *(*value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch);
+  void (*set_flags)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, uint8_t, uint8_t, int __pyx_skip_dispatch);
+  void (*_set_value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *);
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *(*_value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableArcIterator;
 
 
-/* "fstlib/cext/pywrapfst.pyx":3383
+/* "fstlib/cext/pywrapfst.pyx":3504
  * 
  * 
  * cdef class _StateIterator:             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator {
   bool (*done)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch);
   void (*next)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch);
   void (*reset)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch);
-  int64 (*value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch);
+  int64_t (*_value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *);
+  int64_t (*value)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__StateIterator;
 
 
-/* "fstlib/cext/pywrapfst.pyx":4293
+/* "fstlib/cext/pywrapfst.pyx":4436
  * 
  * 
  * cdef class Compiler:             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
 struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Compiler {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *(*compile)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *, int __pyx_skip_dispatch);
   void (*write)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *, PyObject *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Compiler *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_Compiler;
 
 
-/* "fstlib/cext/pywrapfst.pyx":4430
+/* "fstlib/cext/pywrapfst.pyx":4573
  * 
  * 
  * cdef class FarReader:             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
@@ -2312,15 +2296,15 @@
   std::string (*get_key)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch);
   void (*next)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch);
   void (*reset)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarReader;
 
 
-/* "fstlib/cext/pywrapfst.pyx":4585
+/* "fstlib/cext/pywrapfst.pyx":4728
  * 
  * 
  * cdef class FarWriter:             # <<<<<<<<<<<<<<
  * 
  *   """
  */
 
@@ -3029,115 +3013,116 @@
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_copy(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_6Weight_to_string(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_6Weight_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_6Weight_member(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static __pyx_t_6fstlib_4cext_9pywrapfst_const_SymbolTable_ptr __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView__raw(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView__raise_nonexistent(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self); /* proto*/
 static __pyx_t_6fstlib_4cext_9pywrapfst_const_SymbolTable_ptr __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView__raw_ptr_or_raise(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self); /* proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_available_key(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_available_key(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static PyObject *__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_checksum(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_copy(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_get_nth_key(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, Py_ssize_t __pyx_v_pos, int __pyx_skip_dispatch); /* proto*/
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_get_nth_key(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, Py_ssize_t __pyx_v_pos, int __pyx_skip_dispatch); /* proto*/
 static PyObject *__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_labeled_checksum(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_member(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, PyObject *__pyx_v_key, int __pyx_skip_dispatch); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_name(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static size_t __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_num_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, PyObject *__pyx_v_source, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write_text(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, PyObject *__pyx_v_source, int __pyx_skip_dispatch); /* proto*/
 static PyObject *__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write_to_string(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static __pyx_t_6fstlib_4cext_9pywrapfst_const_SymbolTable_ptr __pyx_f_6fstlib_4cext_9pywrapfst_28_EncodeMapperSymbolTableView__raw(struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *__pyx_v_self); /* proto*/
 static __pyx_t_6fstlib_4cext_9pywrapfst_const_SymbolTable_ptr __pyx_f_6fstlib_4cext_9pywrapfst_19_FstSymbolTableView__raw(struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *__pyx_v_self); /* proto*/
 static __pyx_t_6fstlib_4cext_9pywrapfst_const_SymbolTable_ptr __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable__raw(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self); /* proto*/
 static __pyx_t_6fstlib_4cext_9pywrapfst_SymbolTable_ptr __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable__mutable_raw(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self); /* proto*/
 static __pyx_t_6fstlib_4cext_9pywrapfst_SymbolTable_ptr __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable__mutable_raw_ptr_or_raise(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self); /* proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, PyObject *__pyx_v_symbol, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol *__pyx_optional_args); /* proto*/
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, PyObject *__pyx_v_symbol, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol *__pyx_optional_args); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_table(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_symbols, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_set_name(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, PyObject *__pyx_v_new_name, int __pyx_skip_dispatch); /* proto*/
 static __pyx_t_6fstlib_4cext_9pywrapfst_SymbolTable_ptr __pyx_f_6fstlib_4cext_9pywrapfst_26_MutableFstSymbolTableView__mutable_raw(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView *__pyx_v_self); /* proto*/
 static __pyx_t_6fstlib_4cext_9pywrapfst_SymbolTable_ptr __pyx_f_6fstlib_4cext_9pywrapfst_11SymbolTable__mutable_raw(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *__pyx_v_self); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_arc_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_weight_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
-static uint8 __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
+static uint8_t __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_write(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, PyObject *__pyx_v_source, int __pyx_skip_dispatch); /* proto*/
 static PyObject *__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_write_to_string(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_input_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_output_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper__set_input_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_symbols); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper__set_output_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_symbols); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_3Fst__local_render_svg(std::string const &__pyx_v_dot); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arc_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
-static struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_copy(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_draw(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, PyObject *__pyx_v_source, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_draw *__pyx_optional_args); /* proto*/
-static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_fst_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_input_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
-static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
-static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_input_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
-static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_output_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
+static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
+static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_input_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
+static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_output_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_output_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_print(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_print *__pyx_optional_args); /* proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_verify(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_weight_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_write(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, PyObject *__pyx_v_source, int __pyx_skip_dispatch); /* proto*/
 static PyObject *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_write_to_string(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__check_mutating_imethod(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self); /* proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__add_arc(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc); /* proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_state(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__add_arc(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc); /* proto*/
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_state(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, size_t __pyx_v_n, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__arcsort(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__arcsort *__pyx_optional_args); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__closure(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__closure *__pyx_optional_args); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__concat(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_fst2); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__connect(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__decode(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_mapper); /* proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs *__pyx_optional_args); /* proto*/
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs *__pyx_optional_args); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states *__pyx_optional_args); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__encode(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_mapper); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__invert(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__minimize(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__minimize *__pyx_optional_args); /* proto*/
-static struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_mutable_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_num_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_mutable_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch); /* proto*/
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_num_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__project(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_project_type); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__prune(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__prune *__pyx_optional_args); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__push(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__push *__pyx_optional_args); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_pairs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_pairs *__pyx_optional_args); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_tables(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_tables *__pyx_optional_args); /* proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, size_t __pyx_v_n); /* proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_n); /* proto*/
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, size_t __pyx_v_n); /* proto*/
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_n); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reweight(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_potentials, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__reweight *__pyx_optional_args); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__rmepsilon(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__rmepsilon *__pyx_optional_args); /* proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final *__pyx_optional_args); /* proto*/
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final *__pyx_optional_args); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_input_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_symbols); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_output_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_symbols); /* proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state); /* proto*/
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__topsort(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self); /* proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_f_6fstlib_4cext_9pywrapfst_3Arc_copy(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_done(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
-static uint8 __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
+static uint8_t __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_next(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static size_t __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_position(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_reset(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_seek(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, size_t __pyx_v_a, int __pyx_skip_dispatch); /* proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, uint8 __pyx_v_flags, uint8 __pyx_v_mask, int __pyx_skip_dispatch); /* proto*/
-static PyObject *__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
+static void __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, uint8_t __pyx_v_flags, uint8_t __pyx_v_mask, int __pyx_skip_dispatch); /* proto*/
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator__value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self); /* proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_done(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
-static uint8 __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
+static uint8_t __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_next(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static size_t __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_position(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_reset(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_seek(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, size_t __pyx_v_a, int __pyx_skip_dispatch); /* proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, uint8 __pyx_v_flags, uint8 __pyx_v_mask, int __pyx_skip_dispatch); /* proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc, int __pyx_skip_dispatch); /* proto*/
-static PyObject *__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
+static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, uint8_t __pyx_v_flags, uint8_t __pyx_v_mask, int __pyx_skip_dispatch); /* proto*/
+static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator__set_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc); /* proto*/
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator__value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self); /* proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_done(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_next(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_reset(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator__value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self); /* proto*/
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_f_6fstlib_4cext_9pywrapfst_8Compiler_compile(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_8Compiler_write(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *__pyx_v_self, PyObject *__pyx_v_expression, int __pyx_skip_dispatch); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_arc_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_done(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_error(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_far_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_find(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *__pyx_v_self, PyObject *__pyx_v_key, int __pyx_skip_dispatch); /* proto*/
@@ -3147,43 +3132,41 @@
 static void __pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_reset(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_close(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *__pyx_v_self); /* proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_add(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *__pyx_v_self, PyObject *__pyx_v_key, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, int __pyx_skip_dispatch); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_arc_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_error(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_far_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
 
+/* Module declarations from 'libc.stdint' */
+
 /* Module declarations from 'libcpp' */
 
 /* Module declarations from 'libcpp.memory' */
 
 /* Module declarations from 'libc.string' */
 
 /* Module declarations from 'libcpp.string' */
 
 /* Module declarations from 'libcpp.utility' */
 
 /* Module declarations from 'libcpp.vector' */
 
-/* Module declarations from 'libc.stdint' */
-
-/* Module declarations from 'cintegral_types' */
-
 /* Module declarations from 'cios' */
 
 /* Module declarations from 'cpywrapfst' */
 
 /* Module declarations from 'libc.stddef' */
 
 /* Module declarations from 'libc.time' */
 
 /* Module declarations from 'libcpp.cast' */
 
-/* Module declarations from 'cmemory' */
+/* Module declarations from 'libcpp.limits' */
 
-/* Module declarations from 'cutility' */
+/* Module declarations from 'cmemory' */
 
 /* Module declarations from 'fstlib.cext.pywrapfst' */
 static PyTypeObject *__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight = 0;
 static PyTypeObject *__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView = 0;
 static PyTypeObject *__pyx_ptype_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView = 0;
 static PyTypeObject *__pyx_ptype_6fstlib_4cext_9pywrapfst__FstSymbolTableView = 0;
 static PyTypeObject *__pyx_ptype_6fstlib_4cext_9pywrapfst__MutableSymbolTable = 0;
@@ -3250,24 +3233,27 @@
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_replace(PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_replace *__pyx_optional_args); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_reverse(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_reverse *__pyx_optional_args); /*proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst__shortestdistance(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, std::vector<fst::script::WeightClass>  *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst__shortestdistance *__pyx_optional_args); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_shortestpath(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_shortestpath *__pyx_optional_args); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_f_6fstlib_4cext_9pywrapfst_statemap(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, PyObject *, int __pyx_skip_dispatch); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_synchronize(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch); /*proto*/
 static fst::FarType __pyx_f_6fstlib_4cext_9pywrapfst__get_far_type(std::string const &); /*proto*/
+static enum fst::ClosureType __pyx_f_6fstlib_4cext_9pywrapfst__get_closure_type(std::string const &); /*proto*/
+static enum fst::EpsNormalizeType __pyx_f_6fstlib_4cext_9pywrapfst__get_eps_norm_type(std::string const &); /*proto*/
 static fst::ProjectType __pyx_f_6fstlib_4cext_9pywrapfst__get_project_type(std::string const &); /*proto*/
+static enum fst::ReweightType __pyx_f_6fstlib_4cext_9pywrapfst__get_reweight_type(std::string const &); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *__pyx_f_6fstlib_4cext_9pywrapfst_compact_symbol_table(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *__pyx_f_6fstlib_4cext_9pywrapfst_merge_symbol_table(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch); /*proto*/
 static std::string __pyx_convert_string_from_py_std__in_string(PyObject *); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyObject_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyUnicode_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyStr_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyBytes_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyByteArray_string_to_py_std__in_string(std::string const &); /*proto*/
-static std::vector<int64>  __pyx_convert_vector_from_py_int64(PyObject *); /*proto*/
+static std::vector<int64_t>  __pyx_convert_vector_from_py_int64_t(PyObject *); /*proto*/
 static std::vector<std::string>  __pyx_convert_vector_from_py_std_3a__3a_string(PyObject *); /*proto*/
 #define __Pyx_MODULE_NAME "fstlib.cext.pywrapfst"
 extern int __pyx_module_is_main_fstlib__cext__pywrapfst;
 int __pyx_module_is_main_fstlib__cext__pywrapfst = 0;
 
 /* Implementation of 'fstlib.cext.pywrapfst' */
 static PyObject *__pyx_builtin_ValueError;
@@ -3283,31 +3269,30 @@
 static const char __pyx_k_[] = ": ";
 static const char __pyx_k_g[] = "g";
 static const char __pyx_k_n[] = "n";
 static const char __pyx_k_w[] = "w";
 static const char __pyx_k_x[] = "x";
 static const char __pyx_k__2[] = "<";
 static const char __pyx_k__3[] = ">";
+static const char __pyx_k__9[] = "";
 static const char __pyx_k_id[] = "id";
 static const char __pyx_k_os[] = "os";
 static const char __pyx_k_Arc[] = "Arc";
 static const char __pyx_k_Fst[] = "Fst";
-static const char __pyx_k__11[] = "";
 static const char __pyx_k_add[] = "add";
 static const char __pyx_k_arc[] = "arc";
 static const char __pyx_k_doc[] = "__doc__";
 static const char __pyx_k_dot[] = "dot";
 static const char __pyx_k_key[] = "key";
 static const char __pyx_k_lhs[] = "lhs";
 static const char __pyx_k_one[] = "one";
 static const char __pyx_k_rhs[] = "rhs";
 static const char __pyx_k_sys[] = "sys";
 static const char __pyx_k_Flag[] = "Flag";
 static const char __pyx_k_PIPE[] = "PIPE";
-static const char __pyx_k_Tsvg[] = "-Tsvg";
 static const char __pyx_k_arcs[] = "arcs";
 static const char __pyx_k_args[] = "args";
 static const char __pyx_k_auto[] = "auto";
 static const char __pyx_k_copy[] = "copy";
 static const char __pyx_k_done[] = "done";
 static const char __pyx_k_draw[] = "draw";
 static const char __pyx_k_enum[] = "enum";
@@ -3320,14 +3305,15 @@
 static const char __pyx_k_next[] = "next";
 static const char __pyx_k_open[] = "open";
 static const char __pyx_k_plus[] = "plus";
 static const char __pyx_k_read[] = "read";
 static const char __pyx_k_seed[] = "seed";
 static const char __pyx_k_seek[] = "seek";
 static const char __pyx_k_send[] = "send";
+static const char __pyx_k_star[] = "star";
 static const char __pyx_k_test[] = "test";
 static const char __pyx_k_type[] = "type";
 static const char __pyx_k_zero[] = "zero";
 static const char __pyx_k_ERROR[] = "ERROR";
 static const char __pyx_k_Popen[] = "Popen";
 static const char __pyx_k_at_0x[] = " at 0x";
 static const char __pyx_k_class[] = "__class__";
@@ -3435,15 +3421,14 @@
 static const char __pyx_k_position[] = "position";
 static const char __pyx_k_qualname[] = "__qualname__";
 static const char __pyx_k_read_fst[] = "read_fst";
 static const char __pyx_k_set_name[] = "set_name";
 static const char __pyx_k_setstate[] = "__setstate__";
 static const char __pyx_k_ssymbols[] = "ssymbols";
 static const char __pyx_k_standard[] = "standard";
-static const char __pyx_k_to_final[] = "to_final";
 static const char __pyx_k_tropical[] = "tropical";
 static const char __pyx_k_vertical[] = "vertical";
 static const char __pyx_k_weight_2[] = "_weight";
 static const char __pyx_k_weighted[] = "weighted";
 static const char __pyx_k_ARC_FLAGS[] = "ARC_FLAGS";
 static const char __pyx_k_Arc_at_0x[] = "<Arc at 0x";
 static const char __pyx_k_FarReader[] = "FarReader";
@@ -3460,41 +3445,43 @@
 static const char __pyx_k_no_weight[] = "no_weight";
 static const char __pyx_k_nshortest[] = "nshortest";
 static const char __pyx_k_precision[] = "precision";
 static const char __pyx_k_pywrapfst[] = "<pywrapfst>";
 static const char __pyx_k_read_text[] = "read_text";
 static const char __pyx_k_reduce_ex[] = "__reduce_ex__";
 static const char __pyx_k_set_flags[] = "set_flags";
-static const char __pyx_k_set_value[] = "set_value";
 static const char __pyx_k_sort_type[] = "sort_type";
 static const char __pyx_k_to_string[] = "to_string";
 static const char __pyx_k_ACCESSIBLE[] = "ACCESSIBLE";
 static const char __pyx_k_ArcMapType[] = "ArcMapType";
 static const char __pyx_k_FstIOError[] = "FstIOError";
 static const char __pyx_k_FstOpError[] = "FstOpError";
 static const char __pyx_k_I_EPSILONS[] = "I_EPSILONS";
 static const char __pyx_k_IndexError[] = "IndexError";
 static const char __pyx_k_MutableFst[] = "MutableFst";
 static const char __pyx_k_NOT_STRING[] = "NOT_STRING";
 static const char __pyx_k_O_EPSILONS[] = "O_EPSILONS";
 static const char __pyx_k_TOP_SORTED[] = "TOP_SORTED";
+static const char __pyx_k_Tsvg_cairo[] = "-Tsvg:cairo";
 static const char __pyx_k_UNWEIGHTED[] = "UNWEIGHTED";
 static const char __pyx_k_ValueError[] = "ValueError";
 static const char __pyx_k_WeightLike[] = "WeightLike";
 static const char __pyx_k_add_states[] = "add_states";
 static const char __pyx_k_add_symbol[] = "add_symbol";
 static const char __pyx_k_functional[] = "functional";
 static const char __pyx_k_max_length[] = "max_length";
 static const char __pyx_k_num_states[] = "num_states";
 static const char __pyx_k_potentials[] = "potentials";
 static const char __pyx_k_pyx_vtable[] = "__pyx_vtable__";
 static const char __pyx_k_queue_type[] = "queue_type";
 static const char __pyx_k_subprocess[] = "subprocess";
+static const char __pyx_k_to_initial[] = "to_initial";
 static const char __pyx_k_write_text[] = "write_text";
 static const char __pyx_k_ArcIterator[] = "_ArcIterator";
+static const char __pyx_k_ClosureType[] = "ClosureType";
 static const char __pyx_k_FstArgError[] = "FstArgError";
 static const char __pyx_k_NO_EPSILONS[] = "NO_EPSILONS";
 static const char __pyx_k_NO_STATE_ID[] = "NO_STATE_ID";
 static const char __pyx_k_Open_failed[] = "Open failed: ";
 static const char __pyx_k_ProjectType[] = "ProjectType";
 static const char __pyx_k_Read_failed[] = "Read failed: ";
 static const char __pyx_k_SymbolTable[] = "<SymbolTable ";
@@ -3507,20 +3494,21 @@
 static const char __pyx_k_unspecified[] = "<unspecified>";
 static const char __pyx_k_weight_type[] = "weight_type";
 static const char __pyx_k_ARC_NO_CACHE[] = "ARC_NO_CACHE";
 static const char __pyx_k_COACCESSIBLE[] = "COACCESSIBLE";
 static const char __pyx_k_ENCODE_FLAGS[] = "ENCODE_FLAGS";
 static const char __pyx_k_EncodeMapper[] = "EncodeMapper";
 static const char __pyx_k_NOT_ACCEPTOR[] = "NOT_ACCEPTOR";
+static const char __pyx_k_ReweightType[] = "ReweightType";
 static const char __pyx_k_RuntimeError[] = "RuntimeError";
 static const char __pyx_k_StateMapType[] = "StateMapType";
 static const char __pyx_k_Write_failed[] = "Write failed: ";
 static const char __pyx_k_allow_nondet[] = "allow_nondet";
 static const char __pyx_k_but_received[] = " but received ";
-static const char __pyx_k_closure_plus[] = "closure_plus";
+static const char __pyx_k_closure_type[] = "closure_type";
 static const char __pyx_k_float_format[] = "float_format";
 static const char __pyx_k_mutable_arcs[] = "mutable_arcs";
 static const char __pyx_k_new_isymbols[] = "new_isymbols";
 static const char __pyx_k_new_osymbols[] = "new_osymbols";
 static const char __pyx_k_old_isymbols[] = "old_isymbols";
 static const char __pyx_k_old_osymbols[] = "old_osymbols";
 static const char __pyx_k_push_weights[] = "push_weights";
@@ -3534,18 +3522,20 @@
 static const char __pyx_k_NO_I_EPSILONS[] = "NO_I_EPSILONS";
 static const char __pyx_k_NO_O_EPSILONS[] = "NO_O_EPSILONS";
 static const char __pyx_k_StateIterator[] = "_StateIterator";
 static const char __pyx_k_StopIteration[] = "StopIteration";
 static const char __pyx_k_SymbolTable_2[] = "SymbolTable";
 static const char __pyx_k_available_key[] = "available_key";
 static const char __pyx_k_encode_labels[] = "encode_labels";
+static const char __pyx_k_eps_norm_type[] = "eps_norm_type";
 static const char __pyx_k_input_symbols[] = "input_symbols";
 static const char __pyx_k_keep_isymbols[] = "keep_isymbols";
 static const char __pyx_k_keep_osymbols[] = "keep_osymbols";
 static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
+static const char __pyx_k_reweight_type[] = "reweight_type";
 static const char __pyx_k_ENCODE_WEIGHTS[] = "ENCODE_WEIGHTS";
 static const char __pyx_k_FST_PROPERTIES[] = "FST_PROPERTIES";
 static const char __pyx_k_INITIAL_CYCLIC[] = "INITIAL_CYCLIC";
 static const char __pyx_k_I_LABEL_SORTED[] = "I_LABEL_SORTED";
 static const char __pyx_k_Invalid_weight[] = "Invalid weight";
 static const char __pyx_k_NOT_ACCESSIBLE[] = "NOT_ACCESSIBLE";
 static const char __pyx_k_NOT_TOP_SORTED[] = "NOT_TOP_SORTED";
@@ -3561,22 +3551,22 @@
 static const char __pyx_k_FarWriter_at_0x[] = " FarWriter at 0x";
 static const char __pyx_k_INITIAL_ACYCLIC[] = "INITIAL_ACYCLIC";
 static const char __pyx_k_I_DETERMINISTIC[] = "I_DETERMINISTIC";
 static const char __pyx_k_NULL_PROPERTIES[] = "NULL_PROPERTIES";
 static const char __pyx_k_O_DETERMINISTIC[] = "O_DETERMINISTIC";
 static const char __pyx_k_SymbolTableView[] = "SymbolTableView";
 static const char __pyx_k_WEIGHTED_CYCLES[] = "WEIGHTED_CYCLES";
-static const char __pyx_k_eps_norm_output[] = "eps_norm_output";
 static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
 static const char __pyx_k_show_weight_one[] = "show_weight_one";
 static const char __pyx_k_unknown_isymbol[] = "unknown_isymbol";
 static const char __pyx_k_unknown_osymbol[] = "unknown_osymbol";
 static const char __pyx_k_write_to_string[] = "write_to_string";
 static const char __pyx_k_ARC_WEIGHT_VALUE[] = "ARC_WEIGHT_VALUE";
 static const char __pyx_k_Cannot_construct[] = "Cannot construct ";
+static const char __pyx_k_EpsNormalizeType[] = "EpsNormalizeType";
 static const char __pyx_k_NOT_COACCESSIBLE[] = "NOT_COACCESSIBLE";
 static const char __pyx_k_Operation_failed[] = "Operation failed";
 static const char __pyx_k_RandArcSelection[] = "RandArcSelection";
 static const char __pyx_k_ReplaceLabelType[] = "ReplaceLabelType";
 static const char __pyx_k_Unknown_FAR_type[] = "Unknown FAR type: ";
 static const char __pyx_k_Unknown_arc_type[] = "Unknown arc type: ";
 static const char __pyx_k_Unknown_map_type[] = "Unknown map type: ";
@@ -3584,14 +3574,15 @@
 static const char __pyx_k_read_from_string[] = "read_from_string";
 static const char __pyx_k_shortestdistance[] = "shortestdistance";
 static const char __pyx_k_ARC_I_LABEL_VALUE[] = "ARC_I_LABEL_VALUE";
 static const char __pyx_k_ARC_O_LABEL_VALUE[] = "ARC_O_LABEL_VALUE";
 static const char __pyx_k_ArcIterator_at_0x[] = "<_ArcIterator at 0x";
 static const char __pyx_k_BINARY_PROPERTIES[] = "BINARY_PROPERTIES";
 static const char __pyx_k_FstBadWeightError[] = "FstBadWeightError";
+static const char __pyx_k_Literal_star_plus[] = "Literal[\"star\", \"plus\"]";
 static const char __pyx_k_UNWEIGHTED_CYCLES[] = "UNWEIGHTED_CYCLES";
 static const char __pyx_k_Unknown_sort_type[] = "Unknown sort type: ";
 static const char __pyx_k_call_arc_labeling[] = "call_arc_labeling";
 static const char __pyx_k_ADD_ARC_PROPERTIES[] = "ADD_ARC_PROPERTIES";
 static const char __pyx_k_Compilation_failed[] = "Compilation failed";
 static const char __pyx_k_EncodeMapper_at_0x[] = "<EncodeMapper at 0x";
 static const char __pyx_k_FstSymbolTableView[] = "_FstSymbolTableView";
@@ -3628,14 +3619,15 @@
 static const char __pyx_k_SET_START_PROPERTIES[] = "SET_START_PROPERTIES";
 static const char __pyx_k_keep_state_numbering[] = "keep_state_numbering";
 static const char __pyx_k_read_Fst_from_string[] = "_read_Fst_from_string";
 static const char __pyx_k_require_superinitial[] = "require_superinitial";
 static const char __pyx_k_typing_Literal_e_f_g[] = "typing.Literal[\"e\", \"f\", \"g\"]";
 static const char __pyx_k_DELETE_ARC_PROPERTIES[] = "DELETE_ARC_PROPERTIES";
 static const char __pyx_k_STATE_SORT_PROPERTIES[] = "STATE_SORT_PROPERTIES";
+static const char __pyx_k_Unknown_reweight_type[] = "Unknown reweight type: ";
 static const char __pyx_k_Weight_type_not_found[] = "Weight type not found";
 static const char __pyx_k_allow_negative_labels[] = "allow_negative_labels";
 static const char __pyx_k_fstlib_cext_pywrapfst[] = "fstlib.cext.pywrapfst";
 static const char __pyx_k_Dot_rendering_failed_s[] = "Dot rendering failed: %s";
 static const char __pyx_k_NEG_TRINARY_PROPERTIES[] = "NEG_TRINARY_PROPERTIES";
 static const char __pyx_k_POS_TRINARY_PROPERTIES[] = "POS_TRINARY_PROPERTIES";
 static const char __pyx_k_Write_to_string_failed[] = "Write to string failed";
@@ -3664,36 +3656,40 @@
 static const char __pyx_k_read_SymbolTable_from_string[] = "_read_SymbolTable_from_string";
 static const char __pyx_k_typing_Literal_ilabel_olabel[] = "typing.Literal[\"ilabel\", \"olabel\"]";
 static const char __pyx_k_No_new_SymbolTables_specified[] = "No new SymbolTables specified";
 static const char __pyx_k_No_relabeling_pairs_specified[] = "No relabeling pairs specified";
 static const char __pyx_k_increment_subsequential_label[] = "increment_subsequential_label";
 static const char __pyx_k_read_EncodeMapper_from_string[] = "_read_EncodeMapper_from_string";
 static const char __pyx_k_Incompatible_or_invalid_weight[] = "Incompatible or invalid weight";
+static const char __pyx_k_Can_t_set_value_on_an_exhausted[] = "Can't set value on an exhausted iterator";
 static const char __pyx_k_const_EncodeMapper_SymbolTableV[] = "<const EncodeMapper SymbolTableView ";
 static const char __pyx_k_self__aiter_self__fst_cannot_be[] = "self._aiter,self._fst cannot be converted to a Python object for pickling";
 static const char __pyx_k_self__fst_self__siter_cannot_be[] = "self._fst,self._siter cannot be converted to a Python object for pickling";
 static const char __pyx_k_self__siter_cannot_be_converted[] = "self._siter cannot be converted to a Python object for pickling";
 static const char __pyx_k_typing_Literal_uniform_log_prob[] = "typing.Literal[\"uniform\", \"log_prob\", \"fast_log_prob\"]";
+static const char __pyx_k_Can_t_get_value_from_an_exhauste[] = "Can't get value from an exhausted iterator";
 static const char __pyx_k_Incompatible_or_invalid_arc_type[] = "Incompatible or invalid arc type";
 static const char __pyx_k_Incompatible_or_invalid_weight_t[] = "Incompatible or invalid weight type";
 static const char __pyx_k_Python_interface_to_the_FST_scri[] = "Python interface to the FST scripting API.\n\nOperations which construct new FSTs are implemented as traditional functions, as\nare two-argument boolean functions like `equal` and `equivalent`. Destructive\noperations---those that mutate an FST, in place---are instance methods, as is\n`write`. Operator overloading is not used. The following example, based on\nMohri et al. 2002, shows the construction of an ASR system given a pronunciation\nlexicon L, grammar G, a transducer from context-dependent phones to\ncontext-independent phones C, and an HMM set H:\n\n  L = fst.Fst.read(\"L.fst\")\n  G = fst.Fst.read(\"G.fst\")\n  C = fst.Fst.read(\"C.fst\")\n  H = fst.Fst.read(\"H.fst\")\n  LG = fst.determinize(fst.compose(L, G))\n  CLG = fst.determinize(fst.compose(C, LG))\n  HCLG = fst.determinize(fst.compose(H, CLG))\n  HCLG.minimize()                                      # NB: works in-place.\n\nPython variables here use snake_case and constants are in all caps, minus the\nnormal `k` prefix.\n";
+static const char __pyx_k_Unknown_epsilon_normalization_ty[] = "Unknown epsilon normalization type: ";
 static const char __pyx_k_Unknown_random_arc_selection_typ[] = "Unknown random arc selection type: ";
 static const char __pyx_k_no_default___reduce___due_to_non[] = "no default __reduce__ due to non-trivial __cinit__";
 static const char __pyx_k_self__aiter_self__mfst_cannot_be[] = "self._aiter,self._mfst cannot be converted to a Python object for pickling";
 static const char __pyx_k_self__arc_cannot_be_converted_to[] = "self._arc cannot be converted to a Python object for pickling";
 static const char __pyx_k_self__reader_cannot_be_converted[] = "self._reader cannot be converted to a Python object for pickling";
 static const char __pyx_k_self__weight_cannot_be_converted[] = "self._weight cannot be converted to a Python object for pickling";
 static const char __pyx_k_self__writer_cannot_be_converted[] = "self._writer cannot be converted to a Python object for pickling";
 static const char __pyx_k_typing_Literal_alt_sequence_auto[] = "typing.Literal[\"alt_sequence\", \"auto\", \"match\", \"no_match\",\n                           \"null\", \"sequence\", \"trivial\"]";
 static const char __pyx_k_typing_Literal_arc_sum_arc_uniqu[] = "typing.Literal[\"arc_sum\", \"arc_unique\", \"identity\"]";
 static const char __pyx_k_typing_Literal_auto_fifo_lifo_sh[] = "typing.Literal[\"auto\", \"fifo\", \"lifo\", \"shortest\", \"state\",\n                              \"top\"]";
 static const char __pyx_k_typing_Literal_fst_stlist_sttabl[] = "typing.Literal[\n  \"fst\",\n  \"stlist\",\n  \"sttable\",\n  \"default\"\n]";
 static const char __pyx_k_typing_Literal_functional_nonfun[] = "typing.Literal[\"functional\", \"nonfunctional\",\n                                    \"disambiguate\"]";
 static const char __pyx_k_typing_Literal_identity_input_ep[] = "typing.Literal[\"identity\", \"input_epsilon\", \"invert\",\n                               \"output_epsilon\", \"plus\", \"power\", \"quantize\",\n                               \"rmweight\", \"superfinal\", \"times\", \"to_log\",\n                               # NOTE: Both spellings of \"to_std\"\n                               \"to_log64\", \"to_std\", \"to_standard\"]";
 static const char __pyx_k_typing_Literal_neither_input_out[] = "typing.Literal[\"neither\", \"input\", \"output\", \"both\"]";
+static const char __pyx_k_typing_Literal_to_inital_to_fina[] = "typing.Literal[\"to_inital\", \"to_final\"]";
 static const char __pyx_k_typing_Union_Weight_typing_Union[] = "typing.Union[Weight, typing.Union[str, int, float]]";
 static PyObject *__pyx_kp_u_;
 static PyObject *__pyx_n_s_ACCEPTOR;
 static PyObject *__pyx_n_s_ACCESSIBLE;
 static PyObject *__pyx_n_s_ACYCLIC;
 static PyObject *__pyx_n_s_ADD_ARC_PROPERTIES;
 static PyObject *__pyx_n_s_ADD_STATE_PROPERTIES;
@@ -3711,16 +3707,19 @@
 static PyObject *__pyx_kp_u_ArcIterator_at_0x;
 static PyObject *__pyx_n_s_ArcMapType;
 static PyObject *__pyx_kp_u_Arc_at_0x;
 static PyObject *__pyx_n_s_BINARY_PROPERTIES;
 static PyObject *__pyx_n_s_COACCESSIBLE;
 static PyObject *__pyx_n_s_COPY_PROPERTIES;
 static PyObject *__pyx_n_s_CYCLIC;
+static PyObject *__pyx_kp_u_Can_t_get_value_from_an_exhauste;
+static PyObject *__pyx_kp_u_Can_t_set_value_on_an_exhausted;
 static PyObject *__pyx_kp_u_Cannot_construct;
 static PyObject *__pyx_kp_u_Cannot_topsort_cyclic_FST;
+static PyObject *__pyx_n_s_ClosureType;
 static PyObject *__pyx_kp_u_Compilation_failed;
 static PyObject *__pyx_n_s_Compiler;
 static PyObject *__pyx_n_s_ComposeFilter;
 static PyObject *__pyx_kp_u_Conversion_to;
 static PyObject *__pyx_n_s_DELETE_ARC_PROPERTIES;
 static PyObject *__pyx_n_s_DELETE_STATE_PROPERTIES;
 static PyObject *__pyx_n_s_DeterminizeType;
@@ -3732,14 +3731,15 @@
 static PyObject *__pyx_n_s_EPSILONS;
 static PyObject *__pyx_n_s_ERROR;
 static PyObject *__pyx_n_s_EXPANDED;
 static PyObject *__pyx_n_s_EXTRINSIC_PROPERTIES;
 static PyObject *__pyx_n_s_EncodeMapper;
 static PyObject *__pyx_n_s_EncodeMapperSymbolTableView;
 static PyObject *__pyx_kp_u_EncodeMapper_at_0x;
+static PyObject *__pyx_n_s_EpsNormalizeType;
 static PyObject *__pyx_kp_u_Expected;
 static PyObject *__pyx_n_s_FST_PROPERTIES;
 static PyObject *__pyx_n_s_FarReader;
 static PyObject *__pyx_kp_u_FarReader_at_0x;
 static PyObject *__pyx_n_s_FarType;
 static PyObject *__pyx_n_s_FarWriter;
 static PyObject *__pyx_kp_u_FarWriter_at_0x;
@@ -3765,14 +3765,15 @@
 static PyObject *__pyx_n_s_I_LABEL_SORTED;
 static PyObject *__pyx_kp_u_Incompatible_or_invalid_arc_type;
 static PyObject *__pyx_kp_u_Incompatible_or_invalid_weight;
 static PyObject *__pyx_kp_u_Incompatible_or_invalid_weight_t;
 static PyObject *__pyx_n_s_IndexError;
 static PyObject *__pyx_kp_u_Invalid_weight;
 static PyObject *__pyx_n_s_KeyError;
+static PyObject *__pyx_kp_u_Literal_star_plus;
 static PyObject *__pyx_n_s_MUTABLE;
 static PyObject *__pyx_n_s_MutableArcIterator;
 static PyObject *__pyx_n_s_MutableArcIterator___iter;
 static PyObject *__pyx_kp_u_MutableArcIterator_at_0x;
 static PyObject *__pyx_n_s_MutableFst;
 static PyObject *__pyx_n_s_MutableFstSymbolTableView;
 static PyObject *__pyx_n_s_MutableSymbolTable;
@@ -3810,14 +3811,15 @@
 static PyObject *__pyx_n_s_QueueType;
 static PyObject *__pyx_n_s_RM_SUPERFINAL_PROPERTIES;
 static PyObject *__pyx_n_s_RandArcSelection;
 static PyObject *__pyx_kp_u_Read_failed;
 static PyObject *__pyx_kp_u_Read_from_FST_failed;
 static PyObject *__pyx_kp_u_Read_from_string_failed;
 static PyObject *__pyx_n_s_ReplaceLabelType;
+static PyObject *__pyx_n_s_ReweightType;
 static PyObject *__pyx_n_s_RuntimeError;
 static PyObject *__pyx_n_s_SET_ARC_PROPERTIES;
 static PyObject *__pyx_n_s_SET_FINAL_PROPERTIES;
 static PyObject *__pyx_n_s_SET_START_PROPERTIES;
 static PyObject *__pyx_n_s_STATE_SORT_PROPERTIES;
 static PyObject *__pyx_n_s_STRING;
 static PyObject *__pyx_n_s_SortType;
@@ -3830,42 +3832,44 @@
 static PyObject *__pyx_n_s_SymbolTableIterator;
 static PyObject *__pyx_kp_u_SymbolTableIterator_at_0x;
 static PyObject *__pyx_n_s_SymbolTableView;
 static PyObject *__pyx_n_s_SymbolTable_2;
 static PyObject *__pyx_kp_u_SymbolTable_no_longer_exists;
 static PyObject *__pyx_n_s_TOP_SORTED;
 static PyObject *__pyx_n_s_TRINARY_PROPERTIES;
-static PyObject *__pyx_kp_u_Tsvg;
+static PyObject *__pyx_kp_u_Tsvg_cairo;
 static PyObject *__pyx_n_s_TypeError;
 static PyObject *__pyx_n_s_UNWEIGHTED;
 static PyObject *__pyx_n_s_UNWEIGHTED_CYCLES;
 static PyObject *__pyx_kp_u_Unknown_FAR_type;
 static PyObject *__pyx_kp_u_Unknown_arc_type;
 static PyObject *__pyx_kp_u_Unknown_compose_filter_type;
 static PyObject *__pyx_kp_u_Unknown_determinization_type;
+static PyObject *__pyx_kp_u_Unknown_epsilon_normalization_ty;
 static PyObject *__pyx_kp_u_Unknown_map_type;
 static PyObject *__pyx_kp_u_Unknown_projection_type;
 static PyObject *__pyx_kp_u_Unknown_queue_type;
 static PyObject *__pyx_kp_u_Unknown_random_arc_selection_typ;
 static PyObject *__pyx_kp_u_Unknown_replace_label_type;
+static PyObject *__pyx_kp_u_Unknown_reweight_type;
 static PyObject *__pyx_kp_u_Unknown_sort_type;
 static PyObject *__pyx_n_s_ValueError;
 static PyObject *__pyx_n_s_VectorFst;
 static PyObject *__pyx_n_s_WEIGHTED;
 static PyObject *__pyx_n_s_WEIGHTED_CYCLES;
 static PyObject *__pyx_n_s_WEIGHT_INVARIANT_PROPERTIES;
 static PyObject *__pyx_kp_u_Weight;
 static PyObject *__pyx_n_s_WeightLike;
 static PyObject *__pyx_n_s_Weight_2;
 static PyObject *__pyx_kp_u_Weight_type_not_found;
 static PyObject *__pyx_kp_u_Write_failed;
 static PyObject *__pyx_kp_u_Write_to_string_failed;
-static PyObject *__pyx_kp_u__11;
 static PyObject *__pyx_kp_u__2;
 static PyObject *__pyx_kp_u__3;
+static PyObject *__pyx_kp_u__9;
 static PyObject *__pyx_n_s_acceptor;
 static PyObject *__pyx_n_s_add;
 static PyObject *__pyx_n_s_add_state;
 static PyObject *__pyx_n_s_add_states;
 static PyObject *__pyx_n_s_add_symbol;
 static PyObject *__pyx_n_s_add_table;
 static PyObject *__pyx_n_s_allow_negative_labels;
@@ -3882,15 +3886,15 @@
 static PyObject *__pyx_kp_u_but_received;
 static PyObject *__pyx_n_s_call_arc_labeling;
 static PyObject *__pyx_n_s_checksum;
 static PyObject *__pyx_n_s_class;
 static PyObject *__pyx_n_s_class_2;
 static PyObject *__pyx_n_s_cline_in_traceback;
 static PyObject *__pyx_n_s_close;
-static PyObject *__pyx_n_s_closure_plus;
+static PyObject *__pyx_n_s_closure_type;
 static PyObject *__pyx_n_s_communicate;
 static PyObject *__pyx_n_s_compile;
 static PyObject *__pyx_n_s_compose_filter;
 static PyObject *__pyx_n_s_connect;
 static PyObject *__pyx_kp_u_const_EncodeMapper_SymbolTableV;
 static PyObject *__pyx_kp_u_const_Fst_SymbolTableView;
 static PyObject *__pyx_n_s_copy;
@@ -3903,15 +3907,15 @@
 static PyObject *__pyx_n_s_doc;
 static PyObject *__pyx_n_s_done;
 static PyObject *__pyx_n_u_dot;
 static PyObject *__pyx_n_s_draw;
 static PyObject *__pyx_n_s_encode_labels;
 static PyObject *__pyx_n_s_encode_weights;
 static PyObject *__pyx_n_s_enum;
-static PyObject *__pyx_n_s_eps_norm_output;
+static PyObject *__pyx_n_s_eps_norm_type;
 static PyObject *__pyx_n_s_epsilon_on_replace;
 static PyObject *__pyx_n_s_error;
 static PyObject *__pyx_kp_u_failed;
 static PyObject *__pyx_n_s_far_type;
 static PyObject *__pyx_n_s_final;
 static PyObject *__pyx_n_s_find;
 static PyObject *__pyx_n_s_flags;
@@ -4019,14 +4023,15 @@
 static PyObject *__pyx_n_s_remove_common_affix;
 static PyObject *__pyx_n_s_remove_total_weight;
 static PyObject *__pyx_n_s_require_superinitial;
 static PyObject *__pyx_n_s_reset;
 static PyObject *__pyx_n_s_return_arc_labeling;
 static PyObject *__pyx_n_s_return_label;
 static PyObject *__pyx_n_s_reverse;
+static PyObject *__pyx_n_s_reweight_type;
 static PyObject *__pyx_n_s_rhs;
 static PyObject *__pyx_n_s_seed;
 static PyObject *__pyx_n_s_seek;
 static PyObject *__pyx_n_s_select;
 static PyObject *__pyx_kp_s_self__aiter_self__fst_cannot_be;
 static PyObject *__pyx_kp_s_self__aiter_self__mfst_cannot_be;
 static PyObject *__pyx_kp_s_self__arc_cannot_be_converted_to;
@@ -4034,23 +4039,23 @@
 static PyObject *__pyx_kp_s_self__reader_cannot_be_converted;
 static PyObject *__pyx_kp_s_self__siter_cannot_be_converted;
 static PyObject *__pyx_kp_s_self__weight_cannot_be_converted;
 static PyObject *__pyx_kp_s_self__writer_cannot_be_converted;
 static PyObject *__pyx_n_s_send;
 static PyObject *__pyx_n_s_set_flags;
 static PyObject *__pyx_n_s_set_name;
-static PyObject *__pyx_n_s_set_value;
 static PyObject *__pyx_n_s_setstate;
 static PyObject *__pyx_n_s_setstate_cython;
 static PyObject *__pyx_n_s_shortestdistance;
 static PyObject *__pyx_n_s_show_weight_one;
 static PyObject *__pyx_n_s_sort_type;
 static PyObject *__pyx_n_s_source;
 static PyObject *__pyx_n_s_ssymbols;
 static PyObject *__pyx_n_u_standard;
+static PyObject *__pyx_n_u_star;
 static PyObject *__pyx_n_s_start;
 static PyObject *__pyx_n_s_state;
 static PyObject *__pyx_n_s_states;
 static PyObject *__pyx_n_s_staticmethod;
 static PyObject *__pyx_n_s_stdin;
 static PyObject *__pyx_n_s_stdout;
 static PyObject *__pyx_n_s_subprocess;
@@ -4059,28 +4064,29 @@
 static PyObject *__pyx_n_s_symbols;
 static PyObject *__pyx_n_s_sys;
 static PyObject *__pyx_n_s_test;
 static PyObject *__pyx_n_s_test_2;
 static PyObject *__pyx_n_s_throw;
 static PyObject *__pyx_n_s_times;
 static PyObject *__pyx_n_s_title;
-static PyObject *__pyx_n_s_to_final;
+static PyObject *__pyx_n_u_to_initial;
 static PyObject *__pyx_n_s_to_string;
 static PyObject *__pyx_n_s_type;
 static PyObject *__pyx_n_s_typing;
 static PyObject *__pyx_kp_u_typing_Literal_alt_sequence_auto;
 static PyObject *__pyx_kp_u_typing_Literal_arc_sum_arc_uniqu;
 static PyObject *__pyx_kp_u_typing_Literal_auto_fifo_lifo_sh;
 static PyObject *__pyx_kp_u_typing_Literal_e_f_g;
 static PyObject *__pyx_kp_u_typing_Literal_fst_stlist_sttabl;
 static PyObject *__pyx_kp_u_typing_Literal_functional_nonfun;
 static PyObject *__pyx_kp_u_typing_Literal_identity_input_ep;
 static PyObject *__pyx_kp_u_typing_Literal_ilabel_olabel;
 static PyObject *__pyx_kp_u_typing_Literal_input_output;
 static PyObject *__pyx_kp_u_typing_Literal_neither_input_out;
+static PyObject *__pyx_kp_u_typing_Literal_to_inital_to_fina;
 static PyObject *__pyx_kp_u_typing_Literal_uniform_log_prob;
 static PyObject *__pyx_kp_u_typing_Union_Weight_typing_Union;
 static PyObject *__pyx_n_u_uniform;
 static PyObject *__pyx_n_s_unique;
 static PyObject *__pyx_n_s_unknown_isymbol;
 static PyObject *__pyx_n_s_unknown_osymbol;
 static PyObject *__pyx_kp_u_unspecified;
@@ -4132,15 +4138,15 @@
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_15SymbolTableView_20name(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_15SymbolTableView_22num_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_15SymbolTableView_24write(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, PyObject *__pyx_v_source); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_15SymbolTableView_26write_text(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, PyObject *__pyx_v_source); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_15SymbolTableView_28write_to_string(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_28_EncodeMapperSymbolTableView___repr__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_FstSymbolTableView___repr__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, PyObject *__pyx_v_symbol, int64 __pyx_v_key); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, PyObject *__pyx_v_symbol, int64_t __pyx_v_key); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_2add_table(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_symbols); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_4set_name(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, PyObject *__pyx_v_new_name); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_26_MutableFstSymbolTableView___repr__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_11SymbolTable___repr__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *__pyx_v_self); /* proto */
 static int __pyx_pf_6fstlib_4cext_9pywrapfst_11SymbolTable_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *__pyx_v_self, PyObject *__pyx_v_name); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_11SymbolTable_4read(CYTHON_UNUSED PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_source); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_11SymbolTable_6read_text(CYTHON_UNUSED PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_source, bool __pyx_v_allow_negative_labels); /* proto */
@@ -4173,108 +4179,108 @@
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_14_read_EncodeMapper_from_string(CYTHON_UNUSED PyObject *__pyx_self, std::string __pyx_v_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst__repr_svg_(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
 static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_4__reduce__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_6__repr__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_8__str__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_10arc_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_12arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_12arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_14copy(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_16draw(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, PyObject *__pyx_v_source, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_isymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_osymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_ssymbols, bool __pyx_v_acceptor, PyObject *__pyx_v_title, double __pyx_v_width, double __pyx_v_height, bool __pyx_v_portrait, bool __pyx_v_vertical, double __pyx_v_ranksep, double __pyx_v_nodesep, int32 __pyx_v_fontsize, int32 __pyx_v_precision, PyObject *__pyx_v_float_format, bool __pyx_v_show_weight_one); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_18final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_16draw(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, PyObject *__pyx_v_source, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_isymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_osymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_ssymbols, bool __pyx_v_acceptor, PyObject *__pyx_v_title, double __pyx_v_width, double __pyx_v_height, bool __pyx_v_portrait, bool __pyx_v_vertical, double __pyx_v_ranksep, double __pyx_v_nodesep, int32_t __pyx_v_fontsize, int32_t __pyx_v_precision, PyObject *__pyx_v_float_format, bool __pyx_v_show_weight_one); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_18final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_20fst_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_22input_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_24num_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_26num_input_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_28num_output_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_24num_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_26num_input_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_28num_output_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_30output_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_32print(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_isymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_osymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_ssymbols, bool __pyx_v_acceptor, bool __pyx_v_show_weight_one, PyObject *__pyx_v_missing_sym); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_34properties(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, PyObject *__pyx_v_mask, bool __pyx_v_test); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_36read(CYTHON_UNUSED PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_source); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_38read_from_string(CYTHON_UNUSED PyTypeObject *__pyx_v_cls, PyObject *__pyx_v_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_40start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_42states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_44verify(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_46weight_type(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_48write(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, PyObject *__pyx_v_source); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_50write_to_string(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_add_arc(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_add_arc(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_2add_state(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_4add_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, size_t __pyx_v_n); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_6arcsort(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_sort_type); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_8closure(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, bool __pyx_v_closure_plus); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_8closure(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_closure_type); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_10concat(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_fst2); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_12connect(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_14decode(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_mapper); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_16delete_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, size_t __pyx_v_n); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_16delete_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, size_t __pyx_v_n); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_18delete_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_states); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_20encode(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_mapper); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_22invert(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_24minimize(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, float __pyx_v_delta, bool __pyx_v_allow_nondet); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_26mutable_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_26mutable_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_28mutable_input_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_30mutable_output_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_32num_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_34project(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_project_type); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_36prune(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, float __pyx_v_delta, int64 __pyx_v_nstate, PyObject *__pyx_v_weight); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_38push(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, float __pyx_v_delta, bool __pyx_v_remove_total_weight, bool __pyx_v_to_final); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_36prune(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, float __pyx_v_delta, int64_t __pyx_v_nstate, PyObject *__pyx_v_weight); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_38push(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, float __pyx_v_delta, bool __pyx_v_remove_total_weight, PyObject *__pyx_v_reweight_type); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_40relabel_pairs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_ipairs, PyObject *__pyx_v_opairs); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_42relabel_tables(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_old_isymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_new_isymbols, PyObject *__pyx_v_unknown_isymbol, bool __pyx_v_attach_new_isymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_old_osymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_new_osymbols, PyObject *__pyx_v_unknown_osymbol, bool __pyx_v_attach_new_osymbols); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_44reserve_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, size_t __pyx_v_n); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_46reserve_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_n); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_48reweight(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_potentials, bool __pyx_v_to_final); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_50rmepsilon(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_queue_type, bool __pyx_v_connect, PyObject *__pyx_v_weight, int64 __pyx_v_nstate, float __pyx_v_delta); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_52set_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, PyObject *__pyx_v_weight); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_44reserve_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, size_t __pyx_v_n); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_46reserve_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_n); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_48reweight(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_potentials, PyObject *__pyx_v_reweight_type); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_50rmepsilon(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_queue_type, bool __pyx_v_connect, PyObject *__pyx_v_weight, int64_t __pyx_v_nstate, float __pyx_v_delta); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_52set_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, PyObject *__pyx_v_weight); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_54set_input_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_symbols); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_56set_output_symbols(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_symbols); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_58set_properties(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_props, PyObject *__pyx_v_mask); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_60set_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_60set_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_62topsort(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_64union(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_fsts2); /* proto */
 static int __pyx_pf_6fstlib_4cext_9pywrapfst_9VectorFst___init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_VectorFst *__pyx_v_self, PyObject *__pyx_v_arc_type); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_16_read_Fst(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_source); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_18_read_Fst_from_string(CYTHON_UNUSED PyObject *__pyx_self, std::string __pyx_v_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Arc___repr__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self); /* proto */
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64 __pyx_v_ilabel, int64 __pyx_v_olabel, PyObject *__pyx_v_weight, int64 __pyx_v_nextstate); /* proto */
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64_t __pyx_v_ilabel, int64_t __pyx_v_olabel, PyObject *__pyx_v_weight, int64_t __pyx_v_nextstate); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_4copy(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6ilabel___get__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self); /* proto */
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6ilabel_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64 __pyx_v_value); /* proto */
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6ilabel_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64_t __pyx_v_value); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6olabel___get__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self); /* proto */
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6olabel_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64 __pyx_v_value); /* proto */
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6olabel_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64_t __pyx_v_value); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6weight___get__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self); /* proto */
 static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6weight_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, PyObject *__pyx_v_weight); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_9nextstate___get__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self); /* proto */
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_9nextstate_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64 __pyx_v_value); /* proto */
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_9nextstate_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64_t __pyx_v_value); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6__reduce_cython__(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_8__setstate_cython__(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator___repr__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self); /* proto */
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, int64 __pyx_v_state); /* proto */
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, int64_t __pyx_v_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_4__iter__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_6__next__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_8done(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_10flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_12next(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_14position(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_16reset(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_18seek(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, size_t __pyx_v_a); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_20set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, uint8 __pyx_v_flags, uint8 __pyx_v_mask); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_20set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, uint8_t __pyx_v_flags, uint8_t __pyx_v_mask); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_22value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_24__reduce_cython__(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_26__setstate_cython__(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator___repr__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self); /* proto */
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_ifst, int64 __pyx_v_state); /* proto */
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_ifst, int64_t __pyx_v_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_4__iter__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_7__next__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_9done(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_11flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_13next(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_15position(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_17reset(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_19seek(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, size_t __pyx_v_a); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_21set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, uint8 __pyx_v_flags, uint8 __pyx_v_mask); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_21set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, uint8_t __pyx_v_flags, uint8_t __pyx_v_mask); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_23set_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_25value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_27__reduce_cython__(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_29__setstate_cython__(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator___repr__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self); /* proto */
 static int __pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator_4__iter__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self); /* proto */
@@ -4284,30 +4290,30 @@
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator_12reset(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator_14value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator_16__reduce_cython__(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator_18__setstate_cython__(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_20arcmap(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, PyObject *__pyx_v_map_type, double __pyx_v_power, PyObject *__pyx_v_weight); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_22compose(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, PyObject *__pyx_v_compose_filter, bool __pyx_v_connect); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_24convert(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, PyObject *__pyx_v_fst_type); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_26determinize(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, PyObject *__pyx_v_det_type, int64 __pyx_v_nstate, int64 __pyx_v_subsequential_label, PyObject *__pyx_v_weight, bool __pyx_v_increment_subsequential_label); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_26determinize(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, PyObject *__pyx_v_det_type, int64_t __pyx_v_nstate, int64_t __pyx_v_subsequential_label, PyObject *__pyx_v_weight, bool __pyx_v_increment_subsequential_label); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_28difference(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, PyObject *__pyx_v_compose_filter, bool __pyx_v_connect); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_30disambiguate(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64 __pyx_v_nstate, int64 __pyx_v_subsequential_label, PyObject *__pyx_v_weight); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_32epsnormalize(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, bool __pyx_v_eps_norm_output); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_30disambiguate(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64_t __pyx_v_nstate, int64_t __pyx_v_subsequential_label, PyObject *__pyx_v_weight); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_32epsnormalize(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, PyObject *__pyx_v_eps_norm_type); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_34equal(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, float __pyx_v_delta); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_36equivalent(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, float __pyx_v_delta); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_38intersect(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, PyObject *__pyx_v_compose_filter, bool __pyx_v_connect); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_40isomorphic(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, float __pyx_v_delta); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_42prune(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64 __pyx_v_nstate, PyObject *__pyx_v_weight); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_44push(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, bool __pyx_v_push_weights, bool __pyx_v_push_labels, bool __pyx_v_remove_common_affix, bool __pyx_v_remove_total_weight, bool __pyx_v_to_final); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_46randequivalent(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, int32 __pyx_v_npath, float __pyx_v_delta, PyObject *__pyx_v_select, int32 __pyx_v_max_length, uint64 __pyx_v_seed); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_48randgen(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, int32 __pyx_v_npath, PyObject *__pyx_v_select, int32 __pyx_v_max_length, bool __pyx_v_weighted, bool __pyx_v_remove_total_weight, uint64 __pyx_v_seed); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_50replace(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_pairs, PyObject *__pyx_v_call_arc_labeling, PyObject *__pyx_v_return_arc_labeling, bool __pyx_v_epsilon_on_replace, int64 __pyx_v_return_label); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_42prune(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64_t __pyx_v_nstate, PyObject *__pyx_v_weight); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_44push(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, bool __pyx_v_push_weights, bool __pyx_v_push_labels, bool __pyx_v_remove_common_affix, bool __pyx_v_remove_total_weight, PyObject *__pyx_v_reweight_type); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_46randequivalent(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, int32_t __pyx_v_npath, float __pyx_v_delta, PyObject *__pyx_v_select, int32_t __pyx_v_max_length, uint64_t __pyx_v_seed); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_48randgen(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, int32_t __pyx_v_npath, PyObject *__pyx_v_select, int32_t __pyx_v_max_length, bool __pyx_v_weighted, bool __pyx_v_remove_total_weight, uint64_t __pyx_v_seed); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_50replace(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_pairs, PyObject *__pyx_v_call_arc_labeling, PyObject *__pyx_v_return_arc_labeling, bool __pyx_v_epsilon_on_replace, int64_t __pyx_v_return_label); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_52reverse(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, bool __pyx_v_require_superinitial); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_54shortestdistance(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64 __pyx_v_nstate, PyObject *__pyx_v_queue_type, bool __pyx_v_reverse); /* proto */
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_56shortestpath(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int32 __pyx_v_nshortest, int64 __pyx_v_nstate, PyObject *__pyx_v_queue_type, bool __pyx_v_unique, PyObject *__pyx_v_weight); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_54shortestdistance(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64_t __pyx_v_nstate, PyObject *__pyx_v_queue_type, bool __pyx_v_reverse); /* proto */
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_56shortestpath(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int32_t __pyx_v_nshortest, int64_t __pyx_v_nstate, PyObject *__pyx_v_queue_type, bool __pyx_v_unique, PyObject *__pyx_v_weight); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_58statemap(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, PyObject *__pyx_v_map_type); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_60synchronize(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst); /* proto */
 static int __pyx_pf_6fstlib_4cext_9pywrapfst_8Compiler___cinit__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *__pyx_v_self, PyObject *__pyx_v_fst_type, PyObject *__pyx_v_arc_type, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *__pyx_v_isymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *__pyx_v_osymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *__pyx_v_ssymbols, bool __pyx_v_acceptor, bool __pyx_v_keep_isymbols, bool __pyx_v_keep_osymbols, bool __pyx_v_keep_state_numbering, bool __pyx_v_allow_negative_labels); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_8Compiler_2compile(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_8Compiler_4write(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *__pyx_v_self, PyObject *__pyx_v_expression); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_8Compiler_6__reduce_cython__(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_8Compiler_8__setstate_cython__(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state); /* proto */
@@ -4354,83 +4360,81 @@
 static PyObject *__pyx_tp_new_6fstlib_4cext_9pywrapfst__ArcIterator(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_6fstlib_4cext_9pywrapfst__MutableArcIterator(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_6fstlib_4cext_9pywrapfst__StateIterator(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_6fstlib_4cext_9pywrapfst_Compiler(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_6fstlib_4cext_9pywrapfst_FarReader(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_6fstlib_4cext_9pywrapfst_FarWriter(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static int64 __pyx_k__6;
+static int64_t __pyx_k__6;
+static float __pyx_k__10;
+static float __pyx_k__11;
 static float __pyx_k__12;
-static float __pyx_k__13;
+static int64_t __pyx_k__13;
 static float __pyx_k__14;
-static int64 __pyx_k__15;
+static int64_t __pyx_k__15;
 static float __pyx_k__16;
-static int64 __pyx_k__17;
-static float __pyx_k__18;
+static float __pyx_k__17;
+static int64_t __pyx_k__18;
 static float __pyx_k__19;
-static int64 __pyx_k__20;
+static int64_t __pyx_k__20;
 static float __pyx_k__21;
-static int64 __pyx_k__22;
-static float __pyx_k__23;
+static float __pyx_k__30;
+static float __pyx_k__31;
 static float __pyx_k__32;
-static float __pyx_k__33;
+static int64_t __pyx_k__33;
 static float __pyx_k__34;
-static int64 __pyx_k__35;
+static int64_t __pyx_k__35;
 static float __pyx_k__36;
-static int64 __pyx_k__37;
+static float __pyx_k__37;
 static float __pyx_k__38;
 static float __pyx_k__39;
-static float __pyx_k__40;
+static int64_t __pyx_k__40;
 static float __pyx_k__41;
-static int64 __pyx_k__42;
-static float __pyx_k__43;
-static float __pyx_k__44;
-static int32 __pyx_k__45;
-static int32 __pyx_k__46;
+static float __pyx_k__42;
+static int32_t __pyx_k__43;
+static int32_t __pyx_k__44;
+static float __pyx_k__45;
+static int64_t __pyx_k__46;
 static float __pyx_k__47;
-static int64 __pyx_k__48;
+static int64_t __pyx_k__48;
 static float __pyx_k__49;
-static int64 __pyx_k__50;
-static float __pyx_k__51;
-static int64 __pyx_k__52;
+static int64_t __pyx_k__50;
 static PyObject *__pyx_tuple__4;
 static PyObject *__pyx_tuple__5;
 static PyObject *__pyx_tuple__7;
 static PyObject *__pyx_tuple__8;
-static PyObject *__pyx_tuple__9;
-static PyObject *__pyx_tuple__10;
+static PyObject *__pyx_tuple__22;
+static PyObject *__pyx_tuple__23;
 static PyObject *__pyx_tuple__24;
 static PyObject *__pyx_tuple__25;
 static PyObject *__pyx_tuple__26;
 static PyObject *__pyx_tuple__27;
 static PyObject *__pyx_tuple__28;
 static PyObject *__pyx_tuple__29;
-static PyObject *__pyx_tuple__30;
-static PyObject *__pyx_tuple__31;
+static PyObject *__pyx_tuple__51;
+static PyObject *__pyx_tuple__52;
 static PyObject *__pyx_tuple__53;
 static PyObject *__pyx_tuple__54;
 static PyObject *__pyx_tuple__55;
 static PyObject *__pyx_tuple__56;
 static PyObject *__pyx_tuple__57;
-static PyObject *__pyx_tuple__58;
 static PyObject *__pyx_tuple__59;
 static PyObject *__pyx_tuple__61;
 static PyObject *__pyx_tuple__63;
 static PyObject *__pyx_tuple__65;
 static PyObject *__pyx_tuple__67;
-static PyObject *__pyx_tuple__69;
+static PyObject *__pyx_codeobj__58;
 static PyObject *__pyx_codeobj__60;
 static PyObject *__pyx_codeobj__62;
 static PyObject *__pyx_codeobj__64;
 static PyObject *__pyx_codeobj__66;
 static PyObject *__pyx_codeobj__68;
-static PyObject *__pyx_codeobj__70;
 /* Late includes */
 
-/* "fstlib/cext/pywrapfst.pyx":176
+/* "fstlib/cext/pywrapfst.pyx":178
  * 
  * 
  * cdef string tostring(data) except *:             # <<<<<<<<<<<<<<
  *   """Converts strings to bytestrings.
  * 
  */
 
@@ -4446,122 +4450,122 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("tostring", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":195
+  /* "fstlib/cext/pywrapfst.pyx":197
  *   """
  *   # A Python string can be implicitly cast to a C++ string.
  *   if isinstance(data, str):             # <<<<<<<<<<<<<<
  *     return data
  *   raise TypeError(f"Expected {str.__name__} but received "
  */
   __pyx_t_1 = PyUnicode_Check(__pyx_v_data); 
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":196
+    /* "fstlib/cext/pywrapfst.pyx":198
  *   # A Python string can be implicitly cast to a C++ string.
  *   if isinstance(data, str):
  *     return data             # <<<<<<<<<<<<<<
  *   raise TypeError(f"Expected {str.__name__} but received "
  *                   f"{type(data).__name__}: {data!r}")
  */
-    __pyx_t_3 = __pyx_convert_string_from_py_std__in_string(__pyx_v_data); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 196, __pyx_L1_error)
+    __pyx_t_3 = __pyx_convert_string_from_py_std__in_string(__pyx_v_data); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 198, __pyx_L1_error)
     __pyx_r = __pyx_t_3;
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":195
+    /* "fstlib/cext/pywrapfst.pyx":197
  *   """
  *   # A Python string can be implicitly cast to a C++ string.
  *   if isinstance(data, str):             # <<<<<<<<<<<<<<
  *     return data
  *   raise TypeError(f"Expected {str.__name__} but received "
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":197
+  /* "fstlib/cext/pywrapfst.pyx":199
  *   if isinstance(data, str):
  *     return data
  *   raise TypeError(f"Expected {str.__name__} but received "             # <<<<<<<<<<<<<<
  *                   f"{type(data).__name__}: {data!r}")
  * 
  */
-  __pyx_t_4 = PyTuple_New(6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 197, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_5 = 0;
   __pyx_t_6 = 127;
   __Pyx_INCREF(__pyx_kp_u_Expected);
   __pyx_t_5 += 9;
   __Pyx_GIVEREF(__pyx_kp_u_Expected);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Expected);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)(&PyUnicode_Type)), __pyx_n_s_name); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 197, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)(&PyUnicode_Type)), __pyx_n_s_name); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_7, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 197, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_7, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_6 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_6) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_6;
   __pyx_t_5 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_8);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_8);
   __pyx_t_8 = 0;
   __Pyx_INCREF(__pyx_kp_u_but_received);
   __pyx_t_5 += 14;
   __Pyx_GIVEREF(__pyx_kp_u_but_received);
   PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u_but_received);
 
-  /* "fstlib/cext/pywrapfst.pyx":198
+  /* "fstlib/cext/pywrapfst.pyx":200
  *     return data
  *   raise TypeError(f"Expected {str.__name__} but received "
  *                   f"{type(data).__name__}: {data!r}")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(__pyx_v_data)), __pyx_n_s_name); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 198, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(__pyx_v_data)), __pyx_n_s_name); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 200, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 198, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 200, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_t_6 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_7) > __pyx_t_6) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_7) : __pyx_t_6;
   __pyx_t_5 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_4, 3, __pyx_t_7);
   __pyx_t_7 = 0;
   __Pyx_INCREF(__pyx_kp_u_);
   __pyx_t_5 += 2;
   __Pyx_GIVEREF(__pyx_kp_u_);
   PyTuple_SET_ITEM(__pyx_t_4, 4, __pyx_kp_u_);
-  __pyx_t_7 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_data), __pyx_empty_unicode); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 198, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_data), __pyx_empty_unicode); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 200, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_6 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_7) > __pyx_t_6) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_7) : __pyx_t_6;
   __pyx_t_5 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_4, 5, __pyx_t_7);
   __pyx_t_7 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":197
+  /* "fstlib/cext/pywrapfst.pyx":199
  *   if isinstance(data, str):
  *     return data
  *   raise TypeError(f"Expected {str.__name__} but received "             # <<<<<<<<<<<<<<
  *                   f"{type(data).__name__}: {data!r}")
  * 
  */
-  __pyx_t_7 = __Pyx_PyUnicode_Join(__pyx_t_4, 6, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 197, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyUnicode_Join(__pyx_t_4, 6, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 197, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_Raise(__pyx_t_4, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __PYX_ERR(0, 197, __pyx_L1_error)
+  __PYX_ERR(0, 199, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":176
+  /* "fstlib/cext/pywrapfst.pyx":178
  * 
  * 
  * cdef string tostring(data) except *:             # <<<<<<<<<<<<<<
  *   """Converts strings to bytestrings.
  * 
  */
 
@@ -4573,15 +4577,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.tostring", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_pretend_to_initialize(&__pyx_r);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":201
+/* "fstlib/cext/pywrapfst.pyx":203
  * 
  * 
  * cdef string weight_tostring(data) except *:             # <<<<<<<<<<<<<<
  *   """Converts strings or numerics to bytestrings.
  * 
  */
 
@@ -4597,162 +4601,162 @@
   Py_UCS4 __pyx_t_7;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("weight_tostring", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":223
+  /* "fstlib/cext/pywrapfst.pyx":225
  *   """
  *   # A Python string can be implicitly cast to a C++ string.
  *   if isinstance(data, str):             # <<<<<<<<<<<<<<
  *     return data
  *   elif isinstance(data, numbers.Number):
  */
   __pyx_t_1 = PyUnicode_Check(__pyx_v_data); 
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":224
+    /* "fstlib/cext/pywrapfst.pyx":226
  *   # A Python string can be implicitly cast to a C++ string.
  *   if isinstance(data, str):
  *     return data             # <<<<<<<<<<<<<<
  *   elif isinstance(data, numbers.Number):
  *     return str(data)
  */
-    __pyx_t_3 = __pyx_convert_string_from_py_std__in_string(__pyx_v_data); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L1_error)
+    __pyx_t_3 = __pyx_convert_string_from_py_std__in_string(__pyx_v_data); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 226, __pyx_L1_error)
     __pyx_r = __pyx_t_3;
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":223
+    /* "fstlib/cext/pywrapfst.pyx":225
  *   """
  *   # A Python string can be implicitly cast to a C++ string.
  *   if isinstance(data, str):             # <<<<<<<<<<<<<<
  *     return data
  *   elif isinstance(data, numbers.Number):
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":225
+  /* "fstlib/cext/pywrapfst.pyx":227
  *   if isinstance(data, str):
  *     return data
  *   elif isinstance(data, numbers.Number):             # <<<<<<<<<<<<<<
  *     return str(data)
  *   raise TypeError(f"Expected {str.__name__} but received "
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_numbers); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 225, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_numbers); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 227, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_Number); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 225, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_Number); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 227, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_2 = PyObject_IsInstance(__pyx_v_data, __pyx_t_5); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 225, __pyx_L1_error)
+  __pyx_t_2 = PyObject_IsInstance(__pyx_v_data, __pyx_t_5); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 227, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_1 = (__pyx_t_2 != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":226
+    /* "fstlib/cext/pywrapfst.pyx":228
  *     return data
  *   elif isinstance(data, numbers.Number):
  *     return str(data)             # <<<<<<<<<<<<<<
  *   raise TypeError(f"Expected {str.__name__} but received "
  *                   f"{type(data).__name__}: {data!r}")
  */
-    __pyx_t_5 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_data); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 226, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_data); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 228, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_3 = __pyx_convert_string_from_py_std__in_string(__pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 226, __pyx_L1_error)
+    __pyx_t_3 = __pyx_convert_string_from_py_std__in_string(__pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_r = __pyx_t_3;
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":225
+    /* "fstlib/cext/pywrapfst.pyx":227
  *   if isinstance(data, str):
  *     return data
  *   elif isinstance(data, numbers.Number):             # <<<<<<<<<<<<<<
  *     return str(data)
  *   raise TypeError(f"Expected {str.__name__} but received "
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":227
+  /* "fstlib/cext/pywrapfst.pyx":229
  *   elif isinstance(data, numbers.Number):
  *     return str(data)
  *   raise TypeError(f"Expected {str.__name__} but received "             # <<<<<<<<<<<<<<
  *                   f"{type(data).__name__}: {data!r}")
  * 
  */
-  __pyx_t_5 = PyTuple_New(6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 227, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 229, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_6 = 0;
   __pyx_t_7 = 127;
   __Pyx_INCREF(__pyx_kp_u_Expected);
   __pyx_t_6 += 9;
   __Pyx_GIVEREF(__pyx_kp_u_Expected);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_Expected);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)(&PyUnicode_Type)), __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 227, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)(&PyUnicode_Type)), __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 229, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 227, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 229, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
   __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_8);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_8);
   __pyx_t_8 = 0;
   __Pyx_INCREF(__pyx_kp_u_but_received);
   __pyx_t_6 += 14;
   __Pyx_GIVEREF(__pyx_kp_u_but_received);
   PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_kp_u_but_received);
 
-  /* "fstlib/cext/pywrapfst.pyx":228
+  /* "fstlib/cext/pywrapfst.pyx":230
  *     return str(data)
  *   raise TypeError(f"Expected {str.__name__} but received "
  *                   f"{type(data).__name__}: {data!r}")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(__pyx_v_data)), __pyx_n_s_name); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(__pyx_v_data)), __pyx_n_s_name); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 230, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 230, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
   __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_t_4);
   __pyx_t_4 = 0;
   __Pyx_INCREF(__pyx_kp_u_);
   __pyx_t_6 += 2;
   __Pyx_GIVEREF(__pyx_kp_u_);
   PyTuple_SET_ITEM(__pyx_t_5, 4, __pyx_kp_u_);
-  __pyx_t_4 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_data), __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_data), __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 230, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
   __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_5, 5, __pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":227
+  /* "fstlib/cext/pywrapfst.pyx":229
  *   elif isinstance(data, numbers.Number):
  *     return str(data)
  *   raise TypeError(f"Expected {str.__name__} but received "             # <<<<<<<<<<<<<<
  *                   f"{type(data).__name__}: {data!r}")
  * 
  */
-  __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_5, 6, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 227, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_5, 6, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 229, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 227, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 229, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_Raise(__pyx_t_5, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __PYX_ERR(0, 227, __pyx_L1_error)
+  __PYX_ERR(0, 229, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":201
+  /* "fstlib/cext/pywrapfst.pyx":203
  * 
  * 
  * cdef string weight_tostring(data) except *:             # <<<<<<<<<<<<<<
  *   """Converts strings or numerics to bytestrings.
  * 
  */
 
@@ -4764,15 +4768,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.weight_tostring", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_pretend_to_initialize(&__pyx_r);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":231
+/* "fstlib/cext/pywrapfst.pyx":233
  * 
  * 
  * cdef string path_tostring(data) except *:             # <<<<<<<<<<<<<<
  *   return tostring(os.fspath(data))
  * 
  */
 
@@ -4784,47 +4788,47 @@
   PyObject *__pyx_t_3 = NULL;
   std::string __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("path_tostring", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":232
+  /* "fstlib/cext/pywrapfst.pyx":234
  * 
  * cdef string path_tostring(data) except *:
  *   return tostring(os.fspath(data))             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_os); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_os); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_fspath); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_fspath); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_data) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_data);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_4 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_4 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 234, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_4;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":231
+  /* "fstlib/cext/pywrapfst.pyx":233
  * 
  * 
  * cdef string path_tostring(data) except *:             # <<<<<<<<<<<<<<
  *   return tostring(os.fspath(data))
  * 
  */
 
@@ -4836,15 +4840,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.path_tostring", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_pretend_to_initialize(&__pyx_r);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":235
+/* "fstlib/cext/pywrapfst.pyx":237
  * 
  * 
  * cdef fst.FarType _get_far_type(const string &far_type) except *:             # <<<<<<<<<<<<<<
  *   """Matches string with the appropriate FarType enum value.
  * 
  */
 
@@ -4858,39 +4862,39 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_get_far_type", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":251
+  /* "fstlib/cext/pywrapfst.pyx":253
  *   """
  *   cdef fst.FarType _far_type
  *   if not fst.GetFarType(far_type, addr(_far_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown FAR type: {far_type!r}")
  *   return _far_type
  */
   __pyx_t_1 = ((!(fst::script::GetFarType(__pyx_v_far_type, (&__pyx_v__far_type)) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":252
+    /* "fstlib/cext/pywrapfst.pyx":254
  *   cdef fst.FarType _far_type
  *   if not fst.GetFarType(far_type, addr(_far_type)):
  *     raise FstArgError(f"Unknown FAR type: {far_type!r}")             # <<<<<<<<<<<<<<
  *   return _far_type
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 252, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 254, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_far_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 252, __pyx_L1_error)
+    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_far_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 254, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 252, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 254, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_FAR_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 252, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_FAR_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 254, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -4898,41 +4902,41 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 252, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 254, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 252, __pyx_L1_error)
+    __PYX_ERR(0, 254, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":251
+    /* "fstlib/cext/pywrapfst.pyx":253
  *   """
  *   cdef fst.FarType _far_type
  *   if not fst.GetFarType(far_type, addr(_far_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown FAR type: {far_type!r}")
  *   return _far_type
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":253
+  /* "fstlib/cext/pywrapfst.pyx":255
  *   if not fst.GetFarType(far_type, addr(_far_type)):
  *     raise FstArgError(f"Unknown FAR type: {far_type!r}")
  *   return _far_type             # <<<<<<<<<<<<<<
  * 
- * 
+ * cdef fst.ClosureType _get_closure_type(const string &closure_type) except *:
  */
   __pyx_r = __pyx_v__far_type;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":235
+  /* "fstlib/cext/pywrapfst.pyx":237
  * 
  * 
  * cdef fst.FarType _get_far_type(const string &far_type) except *:             # <<<<<<<<<<<<<<
  *   """Matches string with the appropriate FarType enum value.
  * 
  */
 
@@ -4945,16 +4949,125 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_far_type", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = (fst::FarType) 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":256
+/* "fstlib/cext/pywrapfst.pyx":257
+ *   return _far_type
+ * 
+ * cdef fst.ClosureType _get_closure_type(const string &closure_type) except *:             # <<<<<<<<<<<<<<
+ *   """Matches string with the appropriate ClosureType enum value.
+ * 
+ */
+
+static enum fst::ClosureType __pyx_f_6fstlib_4cext_9pywrapfst__get_closure_type(std::string const &__pyx_v_closure_type) {
+  enum fst::ClosureType __pyx_v__closure_type;
+  enum fst::ClosureType __pyx_r;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("_get_closure_type", 0);
+
+  /* "fstlib/cext/pywrapfst.pyx":273
+ *   """
+ *   cdef fst.ClosureType _closure_type
+ *   if not fst.GetClosureType(closure_type, addr(_closure_type)):             # <<<<<<<<<<<<<<
+ *     raise FstArgError(f"Unknown projection type: {closure_type!r}")
+ *   return _closure_type
+ */
+  __pyx_t_1 = ((!(fst::script::GetClosureType(__pyx_v_closure_type, (&__pyx_v__closure_type)) != 0)) != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "fstlib/cext/pywrapfst.pyx":274
+ *   cdef fst.ClosureType _closure_type
+ *   if not fst.GetClosureType(closure_type, addr(_closure_type)):
+ *     raise FstArgError(f"Unknown projection type: {closure_type!r}")             # <<<<<<<<<<<<<<
+ *   return _closure_type
+ * 
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 274, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_closure_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 274, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 274, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_projection_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 274, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_t_5 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
+      if (likely(__pyx_t_5)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+        __Pyx_INCREF(__pyx_t_5);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_3, function);
+      }
+    }
+    __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 274, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 274, __pyx_L1_error)
+
+    /* "fstlib/cext/pywrapfst.pyx":273
+ *   """
+ *   cdef fst.ClosureType _closure_type
+ *   if not fst.GetClosureType(closure_type, addr(_closure_type)):             # <<<<<<<<<<<<<<
+ *     raise FstArgError(f"Unknown projection type: {closure_type!r}")
+ *   return _closure_type
+ */
+  }
+
+  /* "fstlib/cext/pywrapfst.pyx":275
+ *   if not fst.GetClosureType(closure_type, addr(_closure_type)):
+ *     raise FstArgError(f"Unknown projection type: {closure_type!r}")
+ *   return _closure_type             # <<<<<<<<<<<<<<
  * 
+ * cdef fst.ComposeFilter _get_compose_filter(
+ */
+  __pyx_r = __pyx_v__closure_type;
+  goto __pyx_L0;
+
+  /* "fstlib/cext/pywrapfst.pyx":257
+ *   return _far_type
+ * 
+ * cdef fst.ClosureType _get_closure_type(const string &closure_type) except *:             # <<<<<<<<<<<<<<
+ *   """Matches string with the appropriate ClosureType enum value.
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_closure_type", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = (enum fst::ClosureType) 0;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "fstlib/cext/pywrapfst.pyx":277
+ *   return _closure_type
  * 
  * cdef fst.ComposeFilter _get_compose_filter(             # <<<<<<<<<<<<<<
  *     const string &compose_filter) except *:
  *   """Matches string with the appropriate ComposeFilter enum value.
  */
 
 static enum fst::ComposeFilter __pyx_f_6fstlib_4cext_9pywrapfst__get_compose_filter(std::string const &__pyx_v_compose_filter) {
@@ -4967,39 +5080,39 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_get_compose_filter", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":278
+  /* "fstlib/cext/pywrapfst.pyx":299
  *   """
  *   cdef fst.ComposeFilter _compose_filter
  *   if not fst.GetComposeFilter(compose_filter, addr(_compose_filter)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown compose filter type: {compose_filter!r}")
  *   return _compose_filter
  */
   __pyx_t_1 = ((!(fst::script::GetComposeFilter(__pyx_v_compose_filter, (&__pyx_v__compose_filter)) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":279
+    /* "fstlib/cext/pywrapfst.pyx":300
  *   cdef fst.ComposeFilter _compose_filter
  *   if not fst.GetComposeFilter(compose_filter, addr(_compose_filter)):
  *     raise FstArgError(f"Unknown compose filter type: {compose_filter!r}")             # <<<<<<<<<<<<<<
  *   return _compose_filter
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 279, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 300, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_compose_filter); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 279, __pyx_L1_error)
+    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_compose_filter); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 300, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 279, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 300, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_compose_filter_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 279, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_compose_filter_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 300, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -5007,42 +5120,42 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 279, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 300, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 279, __pyx_L1_error)
+    __PYX_ERR(0, 300, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":278
+    /* "fstlib/cext/pywrapfst.pyx":299
  *   """
  *   cdef fst.ComposeFilter _compose_filter
  *   if not fst.GetComposeFilter(compose_filter, addr(_compose_filter)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown compose filter type: {compose_filter!r}")
  *   return _compose_filter
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":280
+  /* "fstlib/cext/pywrapfst.pyx":301
  *   if not fst.GetComposeFilter(compose_filter, addr(_compose_filter)):
  *     raise FstArgError(f"Unknown compose filter type: {compose_filter!r}")
  *   return _compose_filter             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v__compose_filter;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":256
- * 
+  /* "fstlib/cext/pywrapfst.pyx":277
+ *   return _closure_type
  * 
  * cdef fst.ComposeFilter _get_compose_filter(             # <<<<<<<<<<<<<<
  *     const string &compose_filter) except *:
  *   """Matches string with the appropriate ComposeFilter enum value.
  */
 
   /* function exit code */
@@ -5054,15 +5167,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_compose_filter", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = (enum fst::ComposeFilter) 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":283
+/* "fstlib/cext/pywrapfst.pyx":304
  * 
  * 
  * cdef fst.DeterminizeType _get_determinize_type(const string &det_type) except *:             # <<<<<<<<<<<<<<
  *   """Matches string with the appropriate DeterminizeType enum value.
  * 
  */
 
@@ -5076,39 +5189,39 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_get_determinize_type", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":299
+  /* "fstlib/cext/pywrapfst.pyx":320
  *   """
  *   cdef fst.DeterminizeType _det_type
  *   if not fst.GetDeterminizeType(det_type, addr(_det_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown determinization type: {det_type!r}")
  *   return _det_type
  */
   __pyx_t_1 = ((!(fst::script::GetDeterminizeType(__pyx_v_det_type, (&__pyx_v__det_type)) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":300
+    /* "fstlib/cext/pywrapfst.pyx":321
  *   cdef fst.DeterminizeType _det_type
  *   if not fst.GetDeterminizeType(det_type, addr(_det_type)):
  *     raise FstArgError(f"Unknown determinization type: {det_type!r}")             # <<<<<<<<<<<<<<
  *   return _det_type
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 300, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 321, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_det_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 300, __pyx_L1_error)
+    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_det_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 321, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 300, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 321, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_determinization_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 300, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_determinization_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 321, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -5116,41 +5229,41 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 300, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 321, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 300, __pyx_L1_error)
+    __PYX_ERR(0, 321, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":299
+    /* "fstlib/cext/pywrapfst.pyx":320
  *   """
  *   cdef fst.DeterminizeType _det_type
  *   if not fst.GetDeterminizeType(det_type, addr(_det_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown determinization type: {det_type!r}")
  *   return _det_type
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":301
+  /* "fstlib/cext/pywrapfst.pyx":322
  *   if not fst.GetDeterminizeType(det_type, addr(_det_type)):
  *     raise FstArgError(f"Unknown determinization type: {det_type!r}")
  *   return _det_type             # <<<<<<<<<<<<<<
  * 
- * 
+ * cdef fst.EpsNormalizeType _get_eps_norm_type(const string &eps_norm_type) except *:
  */
   __pyx_r = __pyx_v__det_type;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":283
+  /* "fstlib/cext/pywrapfst.pyx":304
  * 
  * 
  * cdef fst.DeterminizeType _get_determinize_type(const string &det_type) except *:             # <<<<<<<<<<<<<<
  *   """Matches string with the appropriate DeterminizeType enum value.
  * 
  */
 
@@ -5163,15 +5276,124 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_determinize_type", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = (enum fst::DeterminizeType) 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":304
+/* "fstlib/cext/pywrapfst.pyx":324
+ *   return _det_type
+ * 
+ * cdef fst.EpsNormalizeType _get_eps_norm_type(const string &eps_norm_type) except *:             # <<<<<<<<<<<<<<
+ *   """Matches string with the appropriate EpsNormalizeType enum value.
+ * 
+ */
+
+static enum fst::EpsNormalizeType __pyx_f_6fstlib_4cext_9pywrapfst__get_eps_norm_type(std::string const &__pyx_v_eps_norm_type) {
+  enum fst::EpsNormalizeType __pyx_v__eps_norm_type;
+  enum fst::EpsNormalizeType __pyx_r;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("_get_eps_norm_type", 0);
+
+  /* "fstlib/cext/pywrapfst.pyx":340
+ *   """
+ *   cdef fst.EpsNormalizeType _eps_norm_type
+ *   if not fst.GetEpsNormalizeType(eps_norm_type, addr(_eps_norm_type)):             # <<<<<<<<<<<<<<
+ *     raise FstArgError(f"Unknown epsilon normalization type: {eps_norm_type!r}")
+ *   return _eps_norm_type
+ */
+  __pyx_t_1 = ((!(fst::script::GetEpsNormalizeType(__pyx_v_eps_norm_type, (&__pyx_v__eps_norm_type)) != 0)) != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "fstlib/cext/pywrapfst.pyx":341
+ *   cdef fst.EpsNormalizeType _eps_norm_type
+ *   if not fst.GetEpsNormalizeType(eps_norm_type, addr(_eps_norm_type)):
+ *     raise FstArgError(f"Unknown epsilon normalization type: {eps_norm_type!r}")             # <<<<<<<<<<<<<<
+ *   return _eps_norm_type
+ * 
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 341, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_eps_norm_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 341, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 341, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_epsilon_normalization_ty, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 341, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_t_5 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
+      if (likely(__pyx_t_5)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+        __Pyx_INCREF(__pyx_t_5);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_3, function);
+      }
+    }
+    __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 341, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 341, __pyx_L1_error)
+
+    /* "fstlib/cext/pywrapfst.pyx":340
+ *   """
+ *   cdef fst.EpsNormalizeType _eps_norm_type
+ *   if not fst.GetEpsNormalizeType(eps_norm_type, addr(_eps_norm_type)):             # <<<<<<<<<<<<<<
+ *     raise FstArgError(f"Unknown epsilon normalization type: {eps_norm_type!r}")
+ *   return _eps_norm_type
+ */
+  }
+
+  /* "fstlib/cext/pywrapfst.pyx":342
+ *   if not fst.GetEpsNormalizeType(eps_norm_type, addr(_eps_norm_type)):
+ *     raise FstArgError(f"Unknown epsilon normalization type: {eps_norm_type!r}")
+ *   return _eps_norm_type             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = __pyx_v__eps_norm_type;
+  goto __pyx_L0;
+
+  /* "fstlib/cext/pywrapfst.pyx":324
+ *   return _det_type
+ * 
+ * cdef fst.EpsNormalizeType _get_eps_norm_type(const string &eps_norm_type) except *:             # <<<<<<<<<<<<<<
+ *   """Matches string with the appropriate EpsNormalizeType enum value.
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_eps_norm_type", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = (enum fst::EpsNormalizeType) 0;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "fstlib/cext/pywrapfst.pyx":345
  * 
  * 
  * cdef fst.ProjectType _get_project_type(const string &project_type) except *:             # <<<<<<<<<<<<<<
  *   """Matches string with the appropriate ProjectType enum value.
  * 
  */
 
@@ -5185,39 +5407,39 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_get_project_type", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":320
+  /* "fstlib/cext/pywrapfst.pyx":361
  *   """
  *   cdef fst.ProjectType _project_type
  *   if not fst.GetProjectType(project_type, addr(_project_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown projection type: {project_type!r}")
  *   return _project_type
  */
   __pyx_t_1 = ((!(fst::script::GetProjectType(__pyx_v_project_type, (&__pyx_v__project_type)) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":321
+    /* "fstlib/cext/pywrapfst.pyx":362
  *   cdef fst.ProjectType _project_type
  *   if not fst.GetProjectType(project_type, addr(_project_type)):
  *     raise FstArgError(f"Unknown projection type: {project_type!r}")             # <<<<<<<<<<<<<<
  *   return _project_type
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 321, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 362, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_project_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 321, __pyx_L1_error)
+    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_project_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 362, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 321, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 362, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_projection_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 321, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_projection_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 362, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -5225,41 +5447,41 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 321, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 362, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 321, __pyx_L1_error)
+    __PYX_ERR(0, 362, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":320
+    /* "fstlib/cext/pywrapfst.pyx":361
  *   """
  *   cdef fst.ProjectType _project_type
  *   if not fst.GetProjectType(project_type, addr(_project_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown projection type: {project_type!r}")
  *   return _project_type
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":322
+  /* "fstlib/cext/pywrapfst.pyx":363
  *   if not fst.GetProjectType(project_type, addr(_project_type)):
  *     raise FstArgError(f"Unknown projection type: {project_type!r}")
  *   return _project_type             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v__project_type;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":304
+  /* "fstlib/cext/pywrapfst.pyx":345
  * 
  * 
  * cdef fst.ProjectType _get_project_type(const string &project_type) except *:             # <<<<<<<<<<<<<<
  *   """Matches string with the appropriate ProjectType enum value.
  * 
  */
 
@@ -5272,15 +5494,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_project_type", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = (fst::ProjectType) 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":325
+/* "fstlib/cext/pywrapfst.pyx":366
  * 
  * 
  * cdef fst.QueueType _get_queue_type(const string &queue_type) except *:             # <<<<<<<<<<<<<<
  *   """Matches string with the appropriate QueueType enum value.
  * 
  */
 
@@ -5294,39 +5516,39 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_get_queue_type", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":344
+  /* "fstlib/cext/pywrapfst.pyx":385
  *   """
  *   cdef fst.QueueType _queue_type
  *   if not fst.GetQueueType(queue_type, addr(_queue_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown queue type: {queue_type!r}")
  *   return _queue_type
  */
   __pyx_t_1 = ((!(fst::script::GetQueueType(__pyx_v_queue_type, (&__pyx_v__queue_type)) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":345
+    /* "fstlib/cext/pywrapfst.pyx":386
  *   cdef fst.QueueType _queue_type
  *   if not fst.GetQueueType(queue_type, addr(_queue_type)):
  *     raise FstArgError(f"Unknown queue type: {queue_type!r}")             # <<<<<<<<<<<<<<
  *   return _queue_type
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 345, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 386, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_queue_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 345, __pyx_L1_error)
+    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_queue_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 386, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 345, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 386, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_queue_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 345, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_queue_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 386, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -5334,41 +5556,41 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 345, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 386, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 345, __pyx_L1_error)
+    __PYX_ERR(0, 386, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":344
+    /* "fstlib/cext/pywrapfst.pyx":385
  *   """
  *   cdef fst.QueueType _queue_type
  *   if not fst.GetQueueType(queue_type, addr(_queue_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown queue type: {queue_type!r}")
  *   return _queue_type
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":346
+  /* "fstlib/cext/pywrapfst.pyx":387
  *   if not fst.GetQueueType(queue_type, addr(_queue_type)):
  *     raise FstArgError(f"Unknown queue type: {queue_type!r}")
  *   return _queue_type             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v__queue_type;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":325
+  /* "fstlib/cext/pywrapfst.pyx":366
  * 
  * 
  * cdef fst.QueueType _get_queue_type(const string &queue_type) except *:             # <<<<<<<<<<<<<<
  *   """Matches string with the appropriate QueueType enum value.
  * 
  */
 
@@ -5381,15 +5603,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_queue_type", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = (enum fst::QueueType) 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":349
+/* "fstlib/cext/pywrapfst.pyx":390
  * 
  * 
  * cdef fst.RandArcSelection _get_rand_arc_selection(             # <<<<<<<<<<<<<<
  *     const string &select) except *:
  *   """Matches string with the appropriate RandArcSelection enum value.
  */
 
@@ -5403,39 +5625,39 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_get_rand_arc_selection", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":369
+  /* "fstlib/cext/pywrapfst.pyx":410
  *   """
  *   cdef fst.RandArcSelection _select
  *   if not fst.GetRandArcSelection(select, addr(_select)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown random arc selection type: {select!r}")
  *   return _select
  */
   __pyx_t_1 = ((!(fst::script::GetRandArcSelection(__pyx_v_select, (&__pyx_v__select)) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":370
+    /* "fstlib/cext/pywrapfst.pyx":411
  *   cdef fst.RandArcSelection _select
  *   if not fst.GetRandArcSelection(select, addr(_select)):
  *     raise FstArgError(f"Unknown random arc selection type: {select!r}")             # <<<<<<<<<<<<<<
  *   return _select
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 370, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 411, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_select); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 370, __pyx_L1_error)
+    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_select); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 411, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 370, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 411, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_random_arc_selection_typ, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 370, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_random_arc_selection_typ, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 411, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -5443,41 +5665,41 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 370, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 411, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 370, __pyx_L1_error)
+    __PYX_ERR(0, 411, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":369
+    /* "fstlib/cext/pywrapfst.pyx":410
  *   """
  *   cdef fst.RandArcSelection _select
  *   if not fst.GetRandArcSelection(select, addr(_select)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown random arc selection type: {select!r}")
  *   return _select
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":371
+  /* "fstlib/cext/pywrapfst.pyx":412
  *   if not fst.GetRandArcSelection(select, addr(_select)):
  *     raise FstArgError(f"Unknown random arc selection type: {select!r}")
  *   return _select             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v__select;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":349
+  /* "fstlib/cext/pywrapfst.pyx":390
  * 
  * 
  * cdef fst.RandArcSelection _get_rand_arc_selection(             # <<<<<<<<<<<<<<
  *     const string &select) except *:
  *   """Matches string with the appropriate RandArcSelection enum value.
  */
 
@@ -5490,15 +5712,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_rand_arc_selection", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = (fst::script::RandArcSelection) 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":374
+/* "fstlib/cext/pywrapfst.pyx":415
  * 
  * 
  * cdef fst.ReplaceLabelType _get_replace_label_type(             # <<<<<<<<<<<<<<
  *     const string &replace_label_type, bool epsilon_on_replace) except *:
  *   """Matches string with the appropriate ReplaceLabelType enum value.
  */
 
@@ -5512,39 +5734,39 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_get_replace_label_type", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":395
+  /* "fstlib/cext/pywrapfst.pyx":436
  *   """
  *   cdef fst.ReplaceLabelType _replace_label_type
  *   if not fst.GetReplaceLabelType(replace_label_type,             # <<<<<<<<<<<<<<
  *                                  epsilon_on_replace,
  *                                  addr(_replace_label_type)):
  */
   __pyx_t_1 = ((!(fst::script::GetReplaceLabelType(__pyx_v_replace_label_type, __pyx_v_epsilon_on_replace, (&__pyx_v__replace_label_type)) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":398
+    /* "fstlib/cext/pywrapfst.pyx":439
  *                                  epsilon_on_replace,
  *                                  addr(_replace_label_type)):
  *     raise FstArgError(f"Unknown replace label type: {replace_label_type!r}")             # <<<<<<<<<<<<<<
  *   return _replace_label_type
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 398, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_replace_label_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 398, __pyx_L1_error)
+    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_replace_label_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 398, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_replace_label_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 398, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_replace_label_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -5552,41 +5774,41 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 398, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 398, __pyx_L1_error)
+    __PYX_ERR(0, 439, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":395
+    /* "fstlib/cext/pywrapfst.pyx":436
  *   """
  *   cdef fst.ReplaceLabelType _replace_label_type
  *   if not fst.GetReplaceLabelType(replace_label_type,             # <<<<<<<<<<<<<<
  *                                  epsilon_on_replace,
  *                                  addr(_replace_label_type)):
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":399
+  /* "fstlib/cext/pywrapfst.pyx":440
  *                                  addr(_replace_label_type)):
  *     raise FstArgError(f"Unknown replace label type: {replace_label_type!r}")
  *   return _replace_label_type             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v__replace_label_type;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":374
+  /* "fstlib/cext/pywrapfst.pyx":415
  * 
  * 
  * cdef fst.ReplaceLabelType _get_replace_label_type(             # <<<<<<<<<<<<<<
  *     const string &replace_label_type, bool epsilon_on_replace) except *:
  *   """Matches string with the appropriate ReplaceLabelType enum value.
  */
 
@@ -5599,15 +5821,124 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_replace_label_type", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = (enum fst::ReplaceLabelType) 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":425
+/* "fstlib/cext/pywrapfst.pyx":443
+ * 
+ * 
+ * cdef fst.ReweightType _get_reweight_type(const string &reweight_type) except *:             # <<<<<<<<<<<<<<
+ *   """Matches string with the appropriate ReweightType enum value.
+ * 
+ */
+
+static enum fst::ReweightType __pyx_f_6fstlib_4cext_9pywrapfst__get_reweight_type(std::string const &__pyx_v_reweight_type) {
+  enum fst::ReweightType __pyx_v__reweight_type;
+  enum fst::ReweightType __pyx_r;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("_get_reweight_type", 0);
+
+  /* "fstlib/cext/pywrapfst.pyx":459
+ *   """
+ *   cdef fst.ReweightType _reweight_type
+ *   if not fst.GetReweightType(reweight_type, addr(_reweight_type)):             # <<<<<<<<<<<<<<
+ *     raise FstArgError(f"Unknown reweight type: {reweight_type!r}")
+ *   return _reweight_type
+ */
+  __pyx_t_1 = ((!(fst::script::GetReweightType(__pyx_v_reweight_type, (&__pyx_v__reweight_type)) != 0)) != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "fstlib/cext/pywrapfst.pyx":460
+ *   cdef fst.ReweightType _reweight_type
+ *   if not fst.GetReweightType(reweight_type, addr(_reweight_type)):
+ *     raise FstArgError(f"Unknown reweight type: {reweight_type!r}")             # <<<<<<<<<<<<<<
+ *   return _reweight_type
+ * 
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 460, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_reweight_type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 460, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 460, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_reweight_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 460, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_t_5 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
+      if (likely(__pyx_t_5)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+        __Pyx_INCREF(__pyx_t_5);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_3, function);
+      }
+    }
+    __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 460, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 460, __pyx_L1_error)
+
+    /* "fstlib/cext/pywrapfst.pyx":459
+ *   """
+ *   cdef fst.ReweightType _reweight_type
+ *   if not fst.GetReweightType(reweight_type, addr(_reweight_type)):             # <<<<<<<<<<<<<<
+ *     raise FstArgError(f"Unknown reweight type: {reweight_type!r}")
+ *   return _reweight_type
+ */
+  }
+
+  /* "fstlib/cext/pywrapfst.pyx":461
+ *   if not fst.GetReweightType(reweight_type, addr(_reweight_type)):
+ *     raise FstArgError(f"Unknown reweight type: {reweight_type!r}")
+ *   return _reweight_type             # <<<<<<<<<<<<<<
+ * 
+ * ## Weight and helpers.
+ */
+  __pyx_r = __pyx_v__reweight_type;
+  goto __pyx_L0;
+
+  /* "fstlib/cext/pywrapfst.pyx":443
+ * 
+ * 
+ * cdef fst.ReweightType _get_reweight_type(const string &reweight_type) except *:             # <<<<<<<<<<<<<<
+ *   """Matches string with the appropriate ReweightType enum value.
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_reweight_type", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = (enum fst::ReweightType) 0;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "fstlib/cext/pywrapfst.pyx":486
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<{self.type()} Weight {self.to_string()} at 0x{id(self):x}>"
  * 
  */
 
@@ -5633,82 +5964,82 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":426
+  /* "fstlib/cext/pywrapfst.pyx":487
  * 
  *   def __repr__(self):
  *     return f"<{self.type()} Weight {self.to_string()} at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
  *   def __str__(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 426, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 487, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u__2);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__2);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u__2);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "type");
-    __PYX_ERR(0, 426, __pyx_L1_error)
+    __PYX_ERR(0, 487, __pyx_L1_error)
   }
-  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->type(__pyx_v_self, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 426, __pyx_L1_error)
+  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->type(__pyx_v_self, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 487, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
   __pyx_t_4 = 0;
   __Pyx_INCREF(__pyx_kp_u_Weight);
   __pyx_t_2 += 8;
   __Pyx_GIVEREF(__pyx_kp_u_Weight);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_Weight);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "to_string");
-    __PYX_ERR(0, 426, __pyx_L1_error)
+    __PYX_ERR(0, 487, __pyx_L1_error)
   }
-  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->to_string(__pyx_v_self, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 426, __pyx_L1_error)
+  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->to_string(__pyx_v_self, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 487, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_4);
   __pyx_t_4 = 0;
   __Pyx_INCREF(__pyx_kp_u_at_0x);
   __pyx_t_2 += 6;
   __Pyx_GIVEREF(__pyx_kp_u_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u_at_0x);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 426, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 487, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 426, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 487, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 5, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 6, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 7, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 426, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 7, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 487, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":425
+  /* "fstlib/cext/pywrapfst.pyx":486
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<{self.type()} Weight {self.to_string()} at 0x{id(self):x}>"
  * 
  */
 
@@ -5721,15 +6052,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":428
+/* "fstlib/cext/pywrapfst.pyx":489
  *     return f"<{self.type()} Weight {self.to_string()} at 0x{id(self):x}>"
  * 
  *   def __str__(self):             # <<<<<<<<<<<<<<
  *     return self.to_string()
  * 
  */
 
@@ -5751,33 +6082,33 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__str__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":429
+  /* "fstlib/cext/pywrapfst.pyx":490
  * 
  *   def __str__(self):
  *     return self.to_string()             # <<<<<<<<<<<<<<
  * 
  *   # This attempts to convert the string form into a float, raising
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "to_string");
-    __PYX_ERR(0, 429, __pyx_L1_error)
+    __PYX_ERR(0, 490, __pyx_L1_error)
   }
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->to_string(__pyx_v_self, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 429, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->to_string(__pyx_v_self, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 490, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":428
+  /* "fstlib/cext/pywrapfst.pyx":489
  *     return f"<{self.type()} Weight {self.to_string()} at 0x{id(self):x}>"
  * 
  *   def __str__(self):             # <<<<<<<<<<<<<<
  *     return self.to_string()
  * 
  */
 
@@ -5788,15 +6119,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":434
+/* "fstlib/cext/pywrapfst.pyx":495
  *   # ValueError when that is not appropriate.
  * 
  *   def __float__(self):             # <<<<<<<<<<<<<<
  *     return float(self.to_string())
  * 
  */
 
@@ -5819,36 +6150,36 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__float__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":435
+  /* "fstlib/cext/pywrapfst.pyx":496
  * 
  *   def __float__(self):
  *     return float(self.to_string())             # <<<<<<<<<<<<<<
  * 
  *   def __init__(self, weight_type, weight):
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "to_string");
-    __PYX_ERR(0, 435, __pyx_L1_error)
+    __PYX_ERR(0, 496, __pyx_L1_error)
   }
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->to_string(__pyx_v_self, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 435, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->to_string(__pyx_v_self, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 496, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyNumber_Float(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 435, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyNumber_Float(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 496, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":434
+  /* "fstlib/cext/pywrapfst.pyx":495
  *   # ValueError when that is not appropriate.
  * 
  *   def __float__(self):             # <<<<<<<<<<<<<<
  *     return float(self.to_string())
  * 
  */
 
@@ -5860,15 +6191,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":437
+/* "fstlib/cext/pywrapfst.pyx":498
  *     return float(self.to_string())
  * 
  *   def __init__(self, weight_type, weight):             # <<<<<<<<<<<<<<
  *     self._weight.reset(new fst.WeightClass(tostring(weight_type),
  *                                            weight_tostring(weight)))
  */
 
@@ -5902,32 +6233,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weight_type)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weight)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, 1); __PYX_ERR(0, 437, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, 1); __PYX_ERR(0, 498, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 437, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 498, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_weight_type = values[0];
     __pyx_v_weight = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 437, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 498, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Weight.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_6Weight_6__init__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self), __pyx_v_weight_type, __pyx_v_weight);
 
@@ -5942,59 +6273,59 @@
   std::string __pyx_t_1;
   std::string __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":438
+  /* "fstlib/cext/pywrapfst.pyx":499
  * 
  *   def __init__(self, weight_type, weight):
  *     self._weight.reset(new fst.WeightClass(tostring(weight_type),             # <<<<<<<<<<<<<<
  *                                            weight_tostring(weight)))
  *     self._check_weight()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 438, __pyx_L1_error)
+    __PYX_ERR(0, 499, __pyx_L1_error)
   }
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_weight_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 438, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_weight_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 499, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":439
+  /* "fstlib/cext/pywrapfst.pyx":500
  *   def __init__(self, weight_type, weight):
  *     self._weight.reset(new fst.WeightClass(tostring(weight_type),
  *                                            weight_tostring(weight)))             # <<<<<<<<<<<<<<
  *     self._check_weight()
  * 
  */
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_weight_tostring(__pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 439, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_weight_tostring(__pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 500, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":438
+  /* "fstlib/cext/pywrapfst.pyx":499
  * 
  *   def __init__(self, weight_type, weight):
  *     self._weight.reset(new fst.WeightClass(tostring(weight_type),             # <<<<<<<<<<<<<<
  *                                            weight_tostring(weight)))
  *     self._check_weight()
  */
   __pyx_v_self->_weight.reset(new fst::script::WeightClass(__pyx_t_1, __pyx_t_2));
 
-  /* "fstlib/cext/pywrapfst.pyx":440
+  /* "fstlib/cext/pywrapfst.pyx":501
  *     self._weight.reset(new fst.WeightClass(tostring(weight_type),
  *                                            weight_tostring(weight)))
  *     self._check_weight()             # <<<<<<<<<<<<<<
  * 
  *   cdef void _check_weight(self) except *:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_weight");
-    __PYX_ERR(0, 440, __pyx_L1_error)
+    __PYX_ERR(0, 501, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->_check_weight(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 440, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->_check_weight(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 501, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":437
+  /* "fstlib/cext/pywrapfst.pyx":498
  *     return float(self.to_string())
  * 
  *   def __init__(self, weight_type, weight):             # <<<<<<<<<<<<<<
  *     self._weight.reset(new fst.WeightClass(tostring(weight_type),
  *                                            weight_tostring(weight)))
  */
 
@@ -6005,15 +6336,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Weight.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":442
+/* "fstlib/cext/pywrapfst.pyx":503
  *     self._check_weight()
  * 
  *   cdef void _check_weight(self) except *:             # <<<<<<<<<<<<<<
  *     if self.type() == b"none":
  *       raise FstArgError("Weight type not found")
  */
 
@@ -6024,117 +6355,117 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_check_weight", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":443
+  /* "fstlib/cext/pywrapfst.pyx":504
  * 
  *   cdef void _check_weight(self) except *:
  *     if self.type() == b"none":             # <<<<<<<<<<<<<<
  *       raise FstArgError("Weight type not found")
  *     if not self.member():
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "type");
-    __PYX_ERR(0, 443, __pyx_L1_error)
+    __PYX_ERR(0, 504, __pyx_L1_error)
   }
   __pyx_t_1 = ((((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->type(__pyx_v_self, 0) == ((char const *)"none")) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":444
+    /* "fstlib/cext/pywrapfst.pyx":505
  *   cdef void _check_weight(self) except *:
  *     if self.type() == b"none":
  *       raise FstArgError("Weight type not found")             # <<<<<<<<<<<<<<
  *     if not self.member():
  *       raise FstBadWeightError("Invalid weight")
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 444, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 505, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Weight_type_not_found) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Weight_type_not_found);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 444, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 505, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 444, __pyx_L1_error)
+    __PYX_ERR(0, 505, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":443
+    /* "fstlib/cext/pywrapfst.pyx":504
  * 
  *   cdef void _check_weight(self) except *:
  *     if self.type() == b"none":             # <<<<<<<<<<<<<<
  *       raise FstArgError("Weight type not found")
  *     if not self.member():
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":445
+  /* "fstlib/cext/pywrapfst.pyx":506
  *     if self.type() == b"none":
  *       raise FstArgError("Weight type not found")
  *     if not self.member():             # <<<<<<<<<<<<<<
  *       raise FstBadWeightError("Invalid weight")
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "member");
-    __PYX_ERR(0, 445, __pyx_L1_error)
+    __PYX_ERR(0, 506, __pyx_L1_error)
   }
   __pyx_t_1 = ((!(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_self->__pyx_vtab)->member(__pyx_v_self, 0) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":446
+    /* "fstlib/cext/pywrapfst.pyx":507
  *       raise FstArgError("Weight type not found")
  *     if not self.member():
  *       raise FstBadWeightError("Invalid weight")             # <<<<<<<<<<<<<<
  * 
  *   cpdef Weight copy(self):
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstBadWeightError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 446, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstBadWeightError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 507, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Invalid_weight) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Invalid_weight);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 446, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 507, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 446, __pyx_L1_error)
+    __PYX_ERR(0, 507, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":445
+    /* "fstlib/cext/pywrapfst.pyx":506
  *     if self.type() == b"none":
  *       raise FstArgError("Weight type not found")
  *     if not self.member():             # <<<<<<<<<<<<<<
  *       raise FstBadWeightError("Invalid weight")
  * 
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":442
+  /* "fstlib/cext/pywrapfst.pyx":503
  *     self._check_weight()
  * 
  *   cdef void _check_weight(self) except *:             # <<<<<<<<<<<<<<
  *     if self.type() == b"none":
  *       raise FstArgError("Weight type not found")
  */
 
@@ -6145,15 +6476,15 @@
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Weight._check_weight", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":448
+/* "fstlib/cext/pywrapfst.pyx":509
  *       raise FstBadWeightError("Invalid weight")
  * 
  *   cpdef Weight copy(self):             # <<<<<<<<<<<<<<
  *     """
  *     copy(self)
  */
 
@@ -6175,15 +6506,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 448, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 509, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_6Weight_9copy)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -6192,18 +6523,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 448, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 509, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight))))) __PYX_ERR(0, 448, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight))))) __PYX_ERR(0, 509, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -6214,56 +6545,56 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":454
+  /* "fstlib/cext/pywrapfst.pyx":515
  *     Returns a copy of the Weight.
  *     """
  *     cdef Weight _weight = Weight.__new__(Weight)             # <<<<<<<<<<<<<<
  *     _weight._weight.reset(new fst.WeightClass(deref(self._weight)))
  *     return _weight
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 454, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 515, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":455
+  /* "fstlib/cext/pywrapfst.pyx":516
  *     """
  *     cdef Weight _weight = Weight.__new__(Weight)
  *     _weight._weight.reset(new fst.WeightClass(deref(self._weight)))             # <<<<<<<<<<<<<<
  *     return _weight
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 455, __pyx_L1_error)
+    __PYX_ERR(0, 516, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 455, __pyx_L1_error)
+    __PYX_ERR(0, 516, __pyx_L1_error)
   }
   __pyx_v__weight->_weight.reset(new fst::script::WeightClass((*__pyx_v_self->_weight)));
 
-  /* "fstlib/cext/pywrapfst.pyx":456
+  /* "fstlib/cext/pywrapfst.pyx":517
  *     cdef Weight _weight = Weight.__new__(Weight)
  *     _weight._weight.reset(new fst.WeightClass(deref(self._weight)))
  *     return _weight             # <<<<<<<<<<<<<<
  * 
  *   # To get around the inability to declare cdef class methods, we define the
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = __pyx_v__weight;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":448
+  /* "fstlib/cext/pywrapfst.pyx":509
  *       raise FstBadWeightError("Invalid weight")
  * 
  *   cpdef Weight copy(self):             # <<<<<<<<<<<<<<
  *     """
  *     copy(self)
  */
 
@@ -6301,15 +6632,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("copy", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_copy(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 448, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_copy(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 509, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6318,15 +6649,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":462
+/* "fstlib/cext/pywrapfst.pyx":523
  * 
  *   @classmethod
  *   def zero(cls, weight_type):             # <<<<<<<<<<<<<<
  *     """
  *     Weight.zero(weight_type)
  */
 
@@ -6349,29 +6680,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("zero", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":468
+  /* "fstlib/cext/pywrapfst.pyx":529
  *     Constructs semiring zero.
  *     """
  *     return _zero(weight_type)             # <<<<<<<<<<<<<<
  * 
  *   @classmethod
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__zero(__pyx_v_weight_type)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 468, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__zero(__pyx_v_weight_type)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 529, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":462
+  /* "fstlib/cext/pywrapfst.pyx":523
  * 
  *   @classmethod
  *   def zero(cls, weight_type):             # <<<<<<<<<<<<<<
  *     """
  *     Weight.zero(weight_type)
  */
 
@@ -6382,15 +6713,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":471
+/* "fstlib/cext/pywrapfst.pyx":532
  * 
  *   @classmethod
  *   def one(cls, weight_type):             # <<<<<<<<<<<<<<
  *     """
  *     Weight.one(weight_type)
  */
 
@@ -6413,29 +6744,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("one", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":477
+  /* "fstlib/cext/pywrapfst.pyx":538
  *     Constructs semiring One.
  *     """
  *     return _one(weight_type)             # <<<<<<<<<<<<<<
  * 
  *   @classmethod
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__one(__pyx_v_weight_type)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 477, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__one(__pyx_v_weight_type)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":471
+  /* "fstlib/cext/pywrapfst.pyx":532
  * 
  *   @classmethod
  *   def one(cls, weight_type):             # <<<<<<<<<<<<<<
  *     """
  *     Weight.one(weight_type)
  */
 
@@ -6446,15 +6777,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":480
+/* "fstlib/cext/pywrapfst.pyx":541
  * 
  *   @classmethod
  *   def no_weight(cls, weight_type):             # <<<<<<<<<<<<<<
  *     """
  *     Weight.no_weight(weight_type)
  */
 
@@ -6477,29 +6808,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("no_weight", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":486
+  /* "fstlib/cext/pywrapfst.pyx":547
  *     Constructs a non-member weight in the semiring.
  *     """
  *     return _no_weight(weight_type)             # <<<<<<<<<<<<<<
  * 
  *   def __eq__(Weight w1, Weight w2):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__no_weight(__pyx_v_weight_type)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 486, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__no_weight(__pyx_v_weight_type)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":480
+  /* "fstlib/cext/pywrapfst.pyx":541
  * 
  *   @classmethod
  *   def no_weight(cls, weight_type):             # <<<<<<<<<<<<<<
  *     """
  *     Weight.no_weight(weight_type)
  */
 
@@ -6510,15 +6841,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":488
+/* "fstlib/cext/pywrapfst.pyx":549
  *     return _no_weight(weight_type)
  * 
  *   def __eq__(Weight w1, Weight w2):             # <<<<<<<<<<<<<<
  *     return fst.Eq(deref(w1._weight), deref(w2._weight))
  * 
  */
 
@@ -6527,15 +6858,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_6Weight_17__eq__(PyObject *__pyx_v_w1, PyObject *__pyx_v_w2) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__eq__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_w2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "w2", 0))) __PYX_ERR(0, 488, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_w2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "w2", 0))) __PYX_ERR(0, 549, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_6Weight_16__eq__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_w1), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_w2));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -6548,37 +6879,37 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__eq__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":489
+  /* "fstlib/cext/pywrapfst.pyx":550
  * 
  *   def __eq__(Weight w1, Weight w2):
  *     return fst.Eq(deref(w1._weight), deref(w2._weight))             # <<<<<<<<<<<<<<
  * 
  *   def __ne__(Weight w1, Weight w2):
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_w1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 489, __pyx_L1_error)
+    __PYX_ERR(0, 550, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_w2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 489, __pyx_L1_error)
+    __PYX_ERR(0, 550, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyBool_FromLong(operator==((*__pyx_v_w1->_weight), (*__pyx_v_w2->_weight))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(operator==((*__pyx_v_w1->_weight), (*__pyx_v_w2->_weight))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 550, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":488
+  /* "fstlib/cext/pywrapfst.pyx":549
  *     return _no_weight(weight_type)
  * 
  *   def __eq__(Weight w1, Weight w2):             # <<<<<<<<<<<<<<
  *     return fst.Eq(deref(w1._weight), deref(w2._weight))
  * 
  */
 
@@ -6589,15 +6920,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":491
+/* "fstlib/cext/pywrapfst.pyx":552
  *     return fst.Eq(deref(w1._weight), deref(w2._weight))
  * 
  *   def __ne__(Weight w1, Weight w2):             # <<<<<<<<<<<<<<
  *     return not w1 == w2
  * 
  */
 
@@ -6606,15 +6937,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_6Weight_19__ne__(PyObject *__pyx_v_w1, PyObject *__pyx_v_w2) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__ne__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_w2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "w2", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_w2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "w2", 0))) __PYX_ERR(0, 552, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_6Weight_18__ne__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_w1), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_w2));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -6628,32 +6959,32 @@
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__ne__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":492
+  /* "fstlib/cext/pywrapfst.pyx":553
  * 
  *   def __ne__(Weight w1, Weight w2):
  *     return not w1 == w2             # <<<<<<<<<<<<<<
  * 
  *   cpdef string to_string(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyObject_RichCompare(((PyObject *)__pyx_v_w1), ((PyObject *)__pyx_v_w2), Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 492, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 492, __pyx_L1_error)
+  __pyx_t_1 = PyObject_RichCompare(((PyObject *)__pyx_v_w1), ((PyObject *)__pyx_v_w2), Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 553, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 553, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyBool_FromLong((!__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 492, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong((!__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 553, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":491
+  /* "fstlib/cext/pywrapfst.pyx":552
  *     return fst.Eq(deref(w1._weight), deref(w2._weight))
  * 
  *   def __ne__(Weight w1, Weight w2):             # <<<<<<<<<<<<<<
  *     return not w1 == w2
  * 
  */
 
@@ -6664,15 +6995,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":494
+/* "fstlib/cext/pywrapfst.pyx":555
  *     return not w1 == w2
  * 
  *   cpdef string to_string(self):             # <<<<<<<<<<<<<<
  *     return self._weight.get().ToString()
  * 
  */
 
@@ -6694,15 +7025,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 494, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_to_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 555, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_6Weight_21to_string)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -6710,18 +7041,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 494, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 555, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 494, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 555, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -6732,29 +7063,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":495
+  /* "fstlib/cext/pywrapfst.pyx":556
  * 
  *   cpdef string to_string(self):
  *     return self._weight.get().ToString()             # <<<<<<<<<<<<<<
  * 
  *   cpdef string type(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 495, __pyx_L1_error)
+    __PYX_ERR(0, 556, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_weight.get()->ToString();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":494
+  /* "fstlib/cext/pywrapfst.pyx":555
  *     return not w1 == w2
  * 
  *   cpdef string to_string(self):             # <<<<<<<<<<<<<<
  *     return self._weight.get().ToString()
  * 
  */
 
@@ -6789,15 +7120,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("to_string", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_to_string(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 494, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_to_string(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 555, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6806,15 +7137,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":497
+/* "fstlib/cext/pywrapfst.pyx":558
  *     return self._weight.get().ToString()
  * 
  *   cpdef string type(self):             # <<<<<<<<<<<<<<
  *     """type(self)
  * 
  */
 
@@ -6836,15 +7167,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 497, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 558, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_6Weight_23type)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -6852,18 +7183,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 497, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 558, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 497, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 558, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -6874,29 +7205,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":502
+  /* "fstlib/cext/pywrapfst.pyx":563
  *     Returns a string indicating the weight type.
  *     """
  *     return self._weight.get().Type()             # <<<<<<<<<<<<<<
  * 
  *   cpdef bool member(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 502, __pyx_L1_error)
+    __PYX_ERR(0, 563, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_weight.get()->Type();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":497
+  /* "fstlib/cext/pywrapfst.pyx":558
  *     return self._weight.get().ToString()
  * 
  *   cpdef string type(self):             # <<<<<<<<<<<<<<
  *     """type(self)
  * 
  */
 
@@ -6932,15 +7263,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 497, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 558, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6949,15 +7280,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":504
+/* "fstlib/cext/pywrapfst.pyx":565
  *     return self._weight.get().Type()
  * 
  *   cpdef bool member(self):             # <<<<<<<<<<<<<<
  *     return self._weight.get().Member()
  * 
  */
 
@@ -6979,15 +7310,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_member); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 504, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_member); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 565, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_6Weight_25member)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -6995,18 +7326,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 504, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 565, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 565, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -7017,29 +7348,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":505
+  /* "fstlib/cext/pywrapfst.pyx":566
  * 
  *   cpdef bool member(self):
  *     return self._weight.get().Member()             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 505, __pyx_L1_error)
+    __PYX_ERR(0, 566, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_weight.get()->Member();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":504
+  /* "fstlib/cext/pywrapfst.pyx":565
  *     return self._weight.get().Type()
  * 
  *   cpdef bool member(self):             # <<<<<<<<<<<<<<
  *     return self._weight.get().Member()
  * 
  */
 
@@ -7074,15 +7405,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("member", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_member(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 504, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_member(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 565, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -7204,15 +7535,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Weight.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":508
+/* "fstlib/cext/pywrapfst.pyx":569
  * 
  * 
  * cdef Weight _plus(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Plus(deref(lhs._weight),
  */
 
@@ -7222,76 +7553,76 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_plus", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":509
+  /* "fstlib/cext/pywrapfst.pyx":570
  * 
  * cdef Weight _plus(Weight lhs, Weight rhs):
  *   cdef Weight _weight = Weight.__new__(Weight)             # <<<<<<<<<<<<<<
  *   _weight._weight.reset(new fst.WeightClass(fst.Plus(deref(lhs._weight),
  *                                                      deref(rhs._weight))))
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 509, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 570, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":510
+  /* "fstlib/cext/pywrapfst.pyx":571
  * cdef Weight _plus(Weight lhs, Weight rhs):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Plus(deref(lhs._weight),             # <<<<<<<<<<<<<<
  *                                                      deref(rhs._weight))))
  *   return _weight
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 510, __pyx_L1_error)
+    __PYX_ERR(0, 571, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_lhs) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 510, __pyx_L1_error)
+    __PYX_ERR(0, 571, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":511
+  /* "fstlib/cext/pywrapfst.pyx":572
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Plus(deref(lhs._weight),
  *                                                      deref(rhs._weight))))             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_rhs) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 511, __pyx_L1_error)
+    __PYX_ERR(0, 572, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":510
+  /* "fstlib/cext/pywrapfst.pyx":571
  * cdef Weight _plus(Weight lhs, Weight rhs):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Plus(deref(lhs._weight),             # <<<<<<<<<<<<<<
  *                                                      deref(rhs._weight))))
  *   return _weight
  */
   __pyx_v__weight->_weight.reset(new fst::script::WeightClass(fst::script::Plus((*__pyx_v_lhs->_weight), (*__pyx_v_rhs->_weight))));
 
-  /* "fstlib/cext/pywrapfst.pyx":512
+  /* "fstlib/cext/pywrapfst.pyx":573
  *   _weight._weight.reset(new fst.WeightClass(fst.Plus(deref(lhs._weight),
  *                                                      deref(rhs._weight))))
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = __pyx_v__weight;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":508
+  /* "fstlib/cext/pywrapfst.pyx":569
  * 
  * 
  * cdef Weight _plus(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Plus(deref(lhs._weight),
  */
 
@@ -7303,15 +7634,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":515
+/* "fstlib/cext/pywrapfst.pyx":576
  * 
  * 
  * def plus(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   plus(lhs, rhs)
  */
 
@@ -7347,39 +7678,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lhs)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rhs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("plus", 1, 2, 2, 1); __PYX_ERR(0, 515, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("plus", 1, 2, 2, 1); __PYX_ERR(0, 576, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "plus") < 0)) __PYX_ERR(0, 515, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "plus") < 0)) __PYX_ERR(0, 576, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_lhs = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)values[0]);
     __pyx_v_rhs = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("plus", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 515, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("plus", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 576, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.plus", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_lhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "lhs", 0))) __PYX_ERR(0, 515, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_rhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "rhs", 0))) __PYX_ERR(0, 515, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_lhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "lhs", 0))) __PYX_ERR(0, 576, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_rhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "rhs", 0))) __PYX_ERR(0, 576, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_plus(__pyx_self, __pyx_v_lhs, __pyx_v_rhs);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -7393,52 +7724,52 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("plus", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":535
+  /* "fstlib/cext/pywrapfst.pyx":596
  *     FstBadWeightError: invalid weight.
  *   """
  *   cdef Weight _weight = _plus(lhs, rhs)             # <<<<<<<<<<<<<<
  *   _weight._check_weight()
  *   return _weight
  */
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__plus(__pyx_v_lhs, __pyx_v_rhs)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 535, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__plus(__pyx_v_lhs, __pyx_v_rhs)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 596, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":536
+  /* "fstlib/cext/pywrapfst.pyx":597
  *   """
  *   cdef Weight _weight = _plus(lhs, rhs)
  *   _weight._check_weight()             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_weight");
-    __PYX_ERR(0, 536, __pyx_L1_error)
+    __PYX_ERR(0, 597, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v__weight->__pyx_vtab)->_check_weight(__pyx_v__weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 536, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v__weight->__pyx_vtab)->_check_weight(__pyx_v__weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 597, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":537
+  /* "fstlib/cext/pywrapfst.pyx":598
  *   cdef Weight _weight = _plus(lhs, rhs)
  *   _weight._check_weight()
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = ((PyObject *)__pyx_v__weight);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":515
+  /* "fstlib/cext/pywrapfst.pyx":576
  * 
  * 
  * def plus(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   plus(lhs, rhs)
  */
 
@@ -7450,15 +7781,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":540
+/* "fstlib/cext/pywrapfst.pyx":601
  * 
  * 
  * cdef Weight _times(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Times(deref(lhs._weight),
  */
 
@@ -7468,76 +7799,76 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_times", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":541
+  /* "fstlib/cext/pywrapfst.pyx":602
  * 
  * cdef Weight _times(Weight lhs, Weight rhs):
  *   cdef Weight _weight = Weight.__new__(Weight)             # <<<<<<<<<<<<<<
  *   _weight._weight.reset(new fst.WeightClass(fst.Times(deref(lhs._weight),
  *                                                       deref(rhs._weight))))
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 541, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 602, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":542
+  /* "fstlib/cext/pywrapfst.pyx":603
  * cdef Weight _times(Weight lhs, Weight rhs):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Times(deref(lhs._weight),             # <<<<<<<<<<<<<<
  *                                                       deref(rhs._weight))))
  *   return _weight
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 542, __pyx_L1_error)
+    __PYX_ERR(0, 603, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_lhs) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 542, __pyx_L1_error)
+    __PYX_ERR(0, 603, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":543
+  /* "fstlib/cext/pywrapfst.pyx":604
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Times(deref(lhs._weight),
  *                                                       deref(rhs._weight))))             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_rhs) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 543, __pyx_L1_error)
+    __PYX_ERR(0, 604, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":542
+  /* "fstlib/cext/pywrapfst.pyx":603
  * cdef Weight _times(Weight lhs, Weight rhs):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Times(deref(lhs._weight),             # <<<<<<<<<<<<<<
  *                                                       deref(rhs._weight))))
  *   return _weight
  */
   __pyx_v__weight->_weight.reset(new fst::script::WeightClass(fst::script::Times((*__pyx_v_lhs->_weight), (*__pyx_v_rhs->_weight))));
 
-  /* "fstlib/cext/pywrapfst.pyx":544
+  /* "fstlib/cext/pywrapfst.pyx":605
  *   _weight._weight.reset(new fst.WeightClass(fst.Times(deref(lhs._weight),
  *                                                       deref(rhs._weight))))
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = __pyx_v__weight;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":540
+  /* "fstlib/cext/pywrapfst.pyx":601
  * 
  * 
  * cdef Weight _times(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Times(deref(lhs._weight),
  */
 
@@ -7549,15 +7880,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":547
+/* "fstlib/cext/pywrapfst.pyx":608
  * 
  * 
  * def times(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   times(lhs, rhs)
  */
 
@@ -7593,39 +7924,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lhs)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rhs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("times", 1, 2, 2, 1); __PYX_ERR(0, 547, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("times", 1, 2, 2, 1); __PYX_ERR(0, 608, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "times") < 0)) __PYX_ERR(0, 547, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "times") < 0)) __PYX_ERR(0, 608, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_lhs = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)values[0]);
     __pyx_v_rhs = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("times", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 547, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("times", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 608, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.times", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_lhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "lhs", 0))) __PYX_ERR(0, 547, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_rhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "rhs", 0))) __PYX_ERR(0, 547, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_lhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "lhs", 0))) __PYX_ERR(0, 608, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_rhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "rhs", 0))) __PYX_ERR(0, 608, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_2times(__pyx_self, __pyx_v_lhs, __pyx_v_rhs);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -7639,52 +7970,52 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("times", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":567
+  /* "fstlib/cext/pywrapfst.pyx":628
  *     FstBadWeightError: Invalid weight.
  *   """
  *   cdef Weight _weight = _times(lhs, rhs)             # <<<<<<<<<<<<<<
  *   _weight._check_weight()
  *   return _weight
  */
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__times(__pyx_v_lhs, __pyx_v_rhs)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 567, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__times(__pyx_v_lhs, __pyx_v_rhs)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 628, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":568
+  /* "fstlib/cext/pywrapfst.pyx":629
  *   """
  *   cdef Weight _weight = _times(lhs, rhs)
  *   _weight._check_weight()             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_weight");
-    __PYX_ERR(0, 568, __pyx_L1_error)
+    __PYX_ERR(0, 629, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v__weight->__pyx_vtab)->_check_weight(__pyx_v__weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 568, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v__weight->__pyx_vtab)->_check_weight(__pyx_v__weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 629, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":569
+  /* "fstlib/cext/pywrapfst.pyx":630
  *   cdef Weight _weight = _times(lhs, rhs)
  *   _weight._check_weight()
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = ((PyObject *)__pyx_v__weight);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":547
+  /* "fstlib/cext/pywrapfst.pyx":608
  * 
  * 
  * def times(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   times(lhs, rhs)
  */
 
@@ -7696,15 +8027,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":572
+/* "fstlib/cext/pywrapfst.pyx":633
  * 
  * 
  * cdef Weight _divide(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Divide(deref(lhs._weight),
  */
 
@@ -7714,76 +8045,76 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_divide", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":573
+  /* "fstlib/cext/pywrapfst.pyx":634
  * 
  * cdef Weight _divide(Weight lhs, Weight rhs):
  *   cdef Weight _weight = Weight.__new__(Weight)             # <<<<<<<<<<<<<<
  *   _weight._weight.reset(new fst.WeightClass(fst.Divide(deref(lhs._weight),
  *                                                        deref(rhs._weight))))
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 573, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 634, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":574
+  /* "fstlib/cext/pywrapfst.pyx":635
  * cdef Weight _divide(Weight lhs, Weight rhs):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Divide(deref(lhs._weight),             # <<<<<<<<<<<<<<
  *                                                        deref(rhs._weight))))
  *   return _weight
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 574, __pyx_L1_error)
+    __PYX_ERR(0, 635, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_lhs) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 574, __pyx_L1_error)
+    __PYX_ERR(0, 635, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":575
+  /* "fstlib/cext/pywrapfst.pyx":636
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Divide(deref(lhs._weight),
  *                                                        deref(rhs._weight))))             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_rhs) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 575, __pyx_L1_error)
+    __PYX_ERR(0, 636, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":574
+  /* "fstlib/cext/pywrapfst.pyx":635
  * cdef Weight _divide(Weight lhs, Weight rhs):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Divide(deref(lhs._weight),             # <<<<<<<<<<<<<<
  *                                                        deref(rhs._weight))))
  *   return _weight
  */
   __pyx_v__weight->_weight.reset(new fst::script::WeightClass(fst::script::Divide((*__pyx_v_lhs->_weight), (*__pyx_v_rhs->_weight))));
 
-  /* "fstlib/cext/pywrapfst.pyx":576
+  /* "fstlib/cext/pywrapfst.pyx":637
  *   _weight._weight.reset(new fst.WeightClass(fst.Divide(deref(lhs._weight),
  *                                                        deref(rhs._weight))))
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = __pyx_v__weight;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":572
+  /* "fstlib/cext/pywrapfst.pyx":633
  * 
  * 
  * cdef Weight _divide(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Divide(deref(lhs._weight),
  */
 
@@ -7795,15 +8126,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":579
+/* "fstlib/cext/pywrapfst.pyx":640
  * 
  * 
  * def divide(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   divide(lhs, rhs)
  */
 
@@ -7839,39 +8170,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lhs)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rhs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("divide", 1, 2, 2, 1); __PYX_ERR(0, 579, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("divide", 1, 2, 2, 1); __PYX_ERR(0, 640, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "divide") < 0)) __PYX_ERR(0, 579, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "divide") < 0)) __PYX_ERR(0, 640, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_lhs = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)values[0]);
     __pyx_v_rhs = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("divide", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 579, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("divide", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 640, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.divide", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_lhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "lhs", 0))) __PYX_ERR(0, 579, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_rhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "rhs", 0))) __PYX_ERR(0, 579, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_lhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "lhs", 0))) __PYX_ERR(0, 640, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_rhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "rhs", 0))) __PYX_ERR(0, 640, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_4divide(__pyx_self, __pyx_v_lhs, __pyx_v_rhs);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -7885,52 +8216,52 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("divide", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":601
+  /* "fstlib/cext/pywrapfst.pyx":662
  *     FstBadWeightError: Invalid weight.
  *   """
  *   cdef Weight _weight = _divide(lhs, rhs)             # <<<<<<<<<<<<<<
  *   _weight._check_weight()
  *   return _weight
  */
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__divide(__pyx_v_lhs, __pyx_v_rhs)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 601, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__divide(__pyx_v_lhs, __pyx_v_rhs)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 662, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":602
+  /* "fstlib/cext/pywrapfst.pyx":663
  *   """
  *   cdef Weight _weight = _divide(lhs, rhs)
  *   _weight._check_weight()             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_weight");
-    __PYX_ERR(0, 602, __pyx_L1_error)
+    __PYX_ERR(0, 663, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v__weight->__pyx_vtab)->_check_weight(__pyx_v__weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 602, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v__weight->__pyx_vtab)->_check_weight(__pyx_v__weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 663, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":603
+  /* "fstlib/cext/pywrapfst.pyx":664
  *   cdef Weight _weight = _divide(lhs, rhs)
  *   _weight._check_weight()
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = ((PyObject *)__pyx_v__weight);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":579
+  /* "fstlib/cext/pywrapfst.pyx":640
  * 
  * 
  * def divide(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   divide(lhs, rhs)
  */
 
@@ -7942,15 +8273,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":606
+/* "fstlib/cext/pywrapfst.pyx":667
  * 
  * 
  * cdef Weight _power(Weight w, size_t n):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Power(deref(w._weight), n)))
  */
 
@@ -7960,56 +8291,56 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_power", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":607
+  /* "fstlib/cext/pywrapfst.pyx":668
  * 
  * cdef Weight _power(Weight w, size_t n):
  *   cdef Weight _weight = Weight.__new__(Weight)             # <<<<<<<<<<<<<<
  *   _weight._weight.reset(new fst.WeightClass(fst.Power(deref(w._weight), n)))
  *   return _weight
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 607, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 668, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":608
+  /* "fstlib/cext/pywrapfst.pyx":669
  * cdef Weight _power(Weight w, size_t n):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Power(deref(w._weight), n)))             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 608, __pyx_L1_error)
+    __PYX_ERR(0, 669, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_w) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 608, __pyx_L1_error)
+    __PYX_ERR(0, 669, __pyx_L1_error)
   }
   __pyx_v__weight->_weight.reset(new fst::script::WeightClass(fst::script::Power((*__pyx_v_w->_weight), __pyx_v_n)));
 
-  /* "fstlib/cext/pywrapfst.pyx":609
+  /* "fstlib/cext/pywrapfst.pyx":670
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Power(deref(w._weight), n)))
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = __pyx_v__weight;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":606
+  /* "fstlib/cext/pywrapfst.pyx":667
  * 
  * 
  * cdef Weight _power(Weight w, size_t n):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(fst.Power(deref(w._weight), n)))
  */
 
@@ -8021,15 +8352,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":612
+/* "fstlib/cext/pywrapfst.pyx":673
  * 
  * 
  * def power(Weight w, size_t n):             # <<<<<<<<<<<<<<
  *   """
  *   power(lhs, rhs)
  */
 
@@ -8065,38 +8396,38 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_w)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("power", 1, 2, 2, 1); __PYX_ERR(0, 612, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("power", 1, 2, 2, 1); __PYX_ERR(0, 673, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "power") < 0)) __PYX_ERR(0, 612, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "power") < 0)) __PYX_ERR(0, 673, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_w = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)values[0]);
-    __pyx_v_n = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_n == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 612, __pyx_L3_error)
+    __pyx_v_n = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_n == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 673, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("power", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 612, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("power", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 673, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.power", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_w), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "w", 0))) __PYX_ERR(0, 612, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_w), __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, 1, "w", 0))) __PYX_ERR(0, 673, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_6power(__pyx_self, __pyx_v_w, __pyx_v_n);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -8110,52 +8441,52 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("power", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":629
+  /* "fstlib/cext/pywrapfst.pyx":690
  *     FstBadWeightError: Invalid weight.
  *   """
  *   cdef Weight _weight = _power(w, n)             # <<<<<<<<<<<<<<
  *   _weight._check_weight()
  *   return _weight
  */
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__power(__pyx_v_w, __pyx_v_n)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 629, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__power(__pyx_v_w, __pyx_v_n)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 690, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":630
+  /* "fstlib/cext/pywrapfst.pyx":691
  *   """
  *   cdef Weight _weight = _power(w, n)
  *   _weight._check_weight()             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_weight");
-    __PYX_ERR(0, 630, __pyx_L1_error)
+    __PYX_ERR(0, 691, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v__weight->__pyx_vtab)->_check_weight(__pyx_v__weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 630, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v__weight->__pyx_vtab)->_check_weight(__pyx_v__weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 691, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":631
+  /* "fstlib/cext/pywrapfst.pyx":692
  *   cdef Weight _weight = _power(w, n)
  *   _weight._check_weight()
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = ((PyObject *)__pyx_v__weight);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":612
+  /* "fstlib/cext/pywrapfst.pyx":673
  * 
  * 
  * def power(Weight w, size_t n):             # <<<<<<<<<<<<<<
  *   """
  *   power(lhs, rhs)
  */
 
@@ -8167,15 +8498,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":634
+/* "fstlib/cext/pywrapfst.pyx":695
  * 
  * 
  * cdef fst.WeightClass _get_WeightClass_or_zero(const string &weight_type,             # <<<<<<<<<<<<<<
  *                                               weight) except *:
  *   """Converts weight string to a WeightClass.
  */
 
@@ -8191,153 +8522,153 @@
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_get_WeightClass_or_zero", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":652
+  /* "fstlib/cext/pywrapfst.pyx":713
  *   """
  *   cdef fst.WeightClass _weight
  *   if weight is None:             # <<<<<<<<<<<<<<
  *     _weight = fst.WeightClass.Zero(weight_type)
  *   elif isinstance(weight, Weight):
  */
   __pyx_t_1 = (__pyx_v_weight == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":653
+    /* "fstlib/cext/pywrapfst.pyx":714
  *   cdef fst.WeightClass _weight
  *   if weight is None:
  *     _weight = fst.WeightClass.Zero(weight_type)             # <<<<<<<<<<<<<<
  *   elif isinstance(weight, Weight):
  *     _weight = deref(<fst.WeightClass *> (<Weight> weight)._weight.get())
  */
     __pyx_v__weight = fst::script::WeightClass::Zero(__pyx_v_weight_type);
 
-    /* "fstlib/cext/pywrapfst.pyx":652
+    /* "fstlib/cext/pywrapfst.pyx":713
  *   """
  *   cdef fst.WeightClass _weight
  *   if weight is None:             # <<<<<<<<<<<<<<
  *     _weight = fst.WeightClass.Zero(weight_type)
  *   elif isinstance(weight, Weight):
  */
     goto __pyx_L3;
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":654
+  /* "fstlib/cext/pywrapfst.pyx":715
  *   if weight is None:
  *     _weight = fst.WeightClass.Zero(weight_type)
  *   elif isinstance(weight, Weight):             # <<<<<<<<<<<<<<
  *     _weight = deref(<fst.WeightClass *> (<Weight> weight)._weight.get())
  *   else:
  */
   __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_weight, __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight); 
   __pyx_t_1 = (__pyx_t_2 != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":655
+    /* "fstlib/cext/pywrapfst.pyx":716
  *     _weight = fst.WeightClass.Zero(weight_type)
  *   elif isinstance(weight, Weight):
  *     _weight = deref(<fst.WeightClass *> (<Weight> weight)._weight.get())             # <<<<<<<<<<<<<<
  *   else:
  *     _weight = fst.WeightClass(weight_type, weight_tostring(weight))
  */
     if (unlikely(__pyx_v_weight == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-      __PYX_ERR(0, 655, __pyx_L1_error)
+      __PYX_ERR(0, 716, __pyx_L1_error)
     }
     __pyx_v__weight = (*((fst::script::WeightClass *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_weight)->_weight.get()));
 
-    /* "fstlib/cext/pywrapfst.pyx":654
+    /* "fstlib/cext/pywrapfst.pyx":715
  *   if weight is None:
  *     _weight = fst.WeightClass.Zero(weight_type)
  *   elif isinstance(weight, Weight):             # <<<<<<<<<<<<<<
  *     _weight = deref(<fst.WeightClass *> (<Weight> weight)._weight.get())
  *   else:
  */
     goto __pyx_L3;
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":657
+  /* "fstlib/cext/pywrapfst.pyx":718
  *     _weight = deref(<fst.WeightClass *> (<Weight> weight)._weight.get())
  *   else:
  *     _weight = fst.WeightClass(weight_type, weight_tostring(weight))             # <<<<<<<<<<<<<<
  *     if not _weight.Member():
  *       raise FstBadWeightError(weight_tostring(weight))
  */
   /*else*/ {
-    __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst_weight_tostring(__pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 657, __pyx_L1_error)
+    __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst_weight_tostring(__pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 718, __pyx_L1_error)
     __pyx_v__weight = fst::script::WeightClass(__pyx_v_weight_type, __pyx_t_3);
 
-    /* "fstlib/cext/pywrapfst.pyx":658
+    /* "fstlib/cext/pywrapfst.pyx":719
  *   else:
  *     _weight = fst.WeightClass(weight_type, weight_tostring(weight))
  *     if not _weight.Member():             # <<<<<<<<<<<<<<
  *       raise FstBadWeightError(weight_tostring(weight))
  *   return _weight
  */
     __pyx_t_1 = ((!(__pyx_v__weight.Member() != 0)) != 0);
     if (unlikely(__pyx_t_1)) {
 
-      /* "fstlib/cext/pywrapfst.pyx":659
+      /* "fstlib/cext/pywrapfst.pyx":720
  *     _weight = fst.WeightClass(weight_type, weight_tostring(weight))
  *     if not _weight.Member():
  *       raise FstBadWeightError(weight_tostring(weight))             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_FstBadWeightError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 659, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_FstBadWeightError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 720, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst_weight_tostring(__pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 659, __pyx_L1_error)
-      __pyx_t_6 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 659, __pyx_L1_error)
+      __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst_weight_tostring(__pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 720, __pyx_L1_error)
+      __pyx_t_6 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 720, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __pyx_t_7 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
         __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
         if (likely(__pyx_t_7)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
           __Pyx_INCREF(__pyx_t_7);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_5, function);
         }
       }
       __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6);
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 659, __pyx_L1_error)
+      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 720, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_Raise(__pyx_t_4, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __PYX_ERR(0, 659, __pyx_L1_error)
+      __PYX_ERR(0, 720, __pyx_L1_error)
 
-      /* "fstlib/cext/pywrapfst.pyx":658
+      /* "fstlib/cext/pywrapfst.pyx":719
  *   else:
  *     _weight = fst.WeightClass(weight_type, weight_tostring(weight))
  *     if not _weight.Member():             # <<<<<<<<<<<<<<
  *       raise FstBadWeightError(weight_tostring(weight))
  *   return _weight
  */
     }
   }
   __pyx_L3:;
 
-  /* "fstlib/cext/pywrapfst.pyx":660
+  /* "fstlib/cext/pywrapfst.pyx":721
  *     if not _weight.Member():
  *       raise FstBadWeightError(weight_tostring(weight))
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v__weight;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":634
+  /* "fstlib/cext/pywrapfst.pyx":695
  * 
  * 
  * cdef fst.WeightClass _get_WeightClass_or_zero(const string &weight_type,             # <<<<<<<<<<<<<<
  *                                               weight) except *:
  *   """Converts weight string to a WeightClass.
  */
 
@@ -8350,15 +8681,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_WeightClass_or_zero", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_pretend_to_initialize(&__pyx_r);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":663
+/* "fstlib/cext/pywrapfst.pyx":724
  * 
  * 
  * cdef fst.WeightClass _get_WeightClass_or_one(const string &weight_type,             # <<<<<<<<<<<<<<
  *                                              weight) except *:
  *   """Converts weight string to a WeightClass.
  */
 
@@ -8374,153 +8705,153 @@
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_get_WeightClass_or_one", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":681
+  /* "fstlib/cext/pywrapfst.pyx":742
  *   """
  *   cdef fst.WeightClass _weight
  *   if weight is None:             # <<<<<<<<<<<<<<
  *     _weight = fst.WeightClass.One(weight_type)
  *   elif isinstance(weight, Weight):
  */
   __pyx_t_1 = (__pyx_v_weight == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":682
+    /* "fstlib/cext/pywrapfst.pyx":743
  *   cdef fst.WeightClass _weight
  *   if weight is None:
  *     _weight = fst.WeightClass.One(weight_type)             # <<<<<<<<<<<<<<
  *   elif isinstance(weight, Weight):
  *     _weight = deref(<fst.WeightClass *> (<Weight> weight)._weight.get())
  */
     __pyx_v__weight = fst::script::WeightClass::One(__pyx_v_weight_type);
 
-    /* "fstlib/cext/pywrapfst.pyx":681
+    /* "fstlib/cext/pywrapfst.pyx":742
  *   """
  *   cdef fst.WeightClass _weight
  *   if weight is None:             # <<<<<<<<<<<<<<
  *     _weight = fst.WeightClass.One(weight_type)
  *   elif isinstance(weight, Weight):
  */
     goto __pyx_L3;
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":683
+  /* "fstlib/cext/pywrapfst.pyx":744
  *   if weight is None:
  *     _weight = fst.WeightClass.One(weight_type)
  *   elif isinstance(weight, Weight):             # <<<<<<<<<<<<<<
  *     _weight = deref(<fst.WeightClass *> (<Weight> weight)._weight.get())
  *   else:
  */
   __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_weight, __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight); 
   __pyx_t_1 = (__pyx_t_2 != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":684
+    /* "fstlib/cext/pywrapfst.pyx":745
  *     _weight = fst.WeightClass.One(weight_type)
  *   elif isinstance(weight, Weight):
  *     _weight = deref(<fst.WeightClass *> (<Weight> weight)._weight.get())             # <<<<<<<<<<<<<<
  *   else:
  *     _weight = fst.WeightClass(weight_type, weight_tostring(weight))
  */
     if (unlikely(__pyx_v_weight == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-      __PYX_ERR(0, 684, __pyx_L1_error)
+      __PYX_ERR(0, 745, __pyx_L1_error)
     }
     __pyx_v__weight = (*((fst::script::WeightClass *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v_weight)->_weight.get()));
 
-    /* "fstlib/cext/pywrapfst.pyx":683
+    /* "fstlib/cext/pywrapfst.pyx":744
  *   if weight is None:
  *     _weight = fst.WeightClass.One(weight_type)
  *   elif isinstance(weight, Weight):             # <<<<<<<<<<<<<<
  *     _weight = deref(<fst.WeightClass *> (<Weight> weight)._weight.get())
  *   else:
  */
     goto __pyx_L3;
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":686
+  /* "fstlib/cext/pywrapfst.pyx":747
  *     _weight = deref(<fst.WeightClass *> (<Weight> weight)._weight.get())
  *   else:
  *     _weight = fst.WeightClass(weight_type, weight_tostring(weight))             # <<<<<<<<<<<<<<
  *     if not _weight.Member():
  *       raise FstBadWeightError(weight_tostring(weight))
  */
   /*else*/ {
-    __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst_weight_tostring(__pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 686, __pyx_L1_error)
+    __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst_weight_tostring(__pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 747, __pyx_L1_error)
     __pyx_v__weight = fst::script::WeightClass(__pyx_v_weight_type, __pyx_t_3);
 
-    /* "fstlib/cext/pywrapfst.pyx":687
+    /* "fstlib/cext/pywrapfst.pyx":748
  *   else:
  *     _weight = fst.WeightClass(weight_type, weight_tostring(weight))
  *     if not _weight.Member():             # <<<<<<<<<<<<<<
  *       raise FstBadWeightError(weight_tostring(weight))
  *   return _weight
  */
     __pyx_t_1 = ((!(__pyx_v__weight.Member() != 0)) != 0);
     if (unlikely(__pyx_t_1)) {
 
-      /* "fstlib/cext/pywrapfst.pyx":688
+      /* "fstlib/cext/pywrapfst.pyx":749
  *     _weight = fst.WeightClass(weight_type, weight_tostring(weight))
  *     if not _weight.Member():
  *       raise FstBadWeightError(weight_tostring(weight))             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_FstBadWeightError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 688, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_FstBadWeightError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 749, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst_weight_tostring(__pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 688, __pyx_L1_error)
-      __pyx_t_6 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 688, __pyx_L1_error)
+      __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst_weight_tostring(__pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 749, __pyx_L1_error)
+      __pyx_t_6 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 749, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __pyx_t_7 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
         __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
         if (likely(__pyx_t_7)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
           __Pyx_INCREF(__pyx_t_7);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_5, function);
         }
       }
       __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6);
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 688, __pyx_L1_error)
+      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 749, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_Raise(__pyx_t_4, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __PYX_ERR(0, 688, __pyx_L1_error)
+      __PYX_ERR(0, 749, __pyx_L1_error)
 
-      /* "fstlib/cext/pywrapfst.pyx":687
+      /* "fstlib/cext/pywrapfst.pyx":748
  *   else:
  *     _weight = fst.WeightClass(weight_type, weight_tostring(weight))
  *     if not _weight.Member():             # <<<<<<<<<<<<<<
  *       raise FstBadWeightError(weight_tostring(weight))
  *   return _weight
  */
     }
   }
   __pyx_L3:;
 
-  /* "fstlib/cext/pywrapfst.pyx":689
+  /* "fstlib/cext/pywrapfst.pyx":750
  *     if not _weight.Member():
  *       raise FstBadWeightError(weight_tostring(weight))
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v__weight;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":663
+  /* "fstlib/cext/pywrapfst.pyx":724
  * 
  * 
  * cdef fst.WeightClass _get_WeightClass_or_one(const string &weight_type,             # <<<<<<<<<<<<<<
  *                                              weight) except *:
  *   """Converts weight string to a WeightClass.
  */
 
@@ -8533,15 +8864,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._get_WeightClass_or_one", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_pretend_to_initialize(&__pyx_r);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":692
+/* "fstlib/cext/pywrapfst.pyx":753
  * 
  * 
  * cdef Weight _zero(weight_type):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(
  */
 
@@ -8555,120 +8886,120 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_zero", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":693
+  /* "fstlib/cext/pywrapfst.pyx":754
  * 
  * cdef Weight _zero(weight_type):
  *   cdef Weight _weight = Weight.__new__(Weight)             # <<<<<<<<<<<<<<
  *   _weight._weight.reset(
  *     new fst.WeightClass(fst.WeightClass.Zero(tostring(weight_type))))
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 693, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 754, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":694
+  /* "fstlib/cext/pywrapfst.pyx":755
  * cdef Weight _zero(weight_type):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(             # <<<<<<<<<<<<<<
  *     new fst.WeightClass(fst.WeightClass.Zero(tostring(weight_type))))
  *   if _weight._weight.get().Type() == b"none":
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 694, __pyx_L1_error)
+    __PYX_ERR(0, 755, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":695
+  /* "fstlib/cext/pywrapfst.pyx":756
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(
  *     new fst.WeightClass(fst.WeightClass.Zero(tostring(weight_type))))             # <<<<<<<<<<<<<<
  *   if _weight._weight.get().Type() == b"none":
  *     raise FstArgError("Weight type not found")
  */
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_weight_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 695, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_weight_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 756, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":694
+  /* "fstlib/cext/pywrapfst.pyx":755
  * cdef Weight _zero(weight_type):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(             # <<<<<<<<<<<<<<
  *     new fst.WeightClass(fst.WeightClass.Zero(tostring(weight_type))))
  *   if _weight._weight.get().Type() == b"none":
  */
   __pyx_v__weight->_weight.reset(new fst::script::WeightClass(fst::script::WeightClass::Zero(__pyx_t_2)));
 
-  /* "fstlib/cext/pywrapfst.pyx":696
+  /* "fstlib/cext/pywrapfst.pyx":757
  *   _weight._weight.reset(
  *     new fst.WeightClass(fst.WeightClass.Zero(tostring(weight_type))))
  *   if _weight._weight.get().Type() == b"none":             # <<<<<<<<<<<<<<
  *     raise FstArgError("Weight type not found")
  *   return _weight
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 696, __pyx_L1_error)
+    __PYX_ERR(0, 757, __pyx_L1_error)
   }
   __pyx_t_3 = ((__pyx_v__weight->_weight.get()->Type() == ((char const *)"none")) != 0);
   if (unlikely(__pyx_t_3)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":697
+    /* "fstlib/cext/pywrapfst.pyx":758
  *     new fst.WeightClass(fst.WeightClass.Zero(tostring(weight_type))))
  *   if _weight._weight.get().Type() == b"none":
  *     raise FstArgError("Weight type not found")             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 697, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 758, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_kp_u_Weight_type_not_found) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_kp_u_Weight_type_not_found);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 697, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 758, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 697, __pyx_L1_error)
+    __PYX_ERR(0, 758, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":696
+    /* "fstlib/cext/pywrapfst.pyx":757
  *   _weight._weight.reset(
  *     new fst.WeightClass(fst.WeightClass.Zero(tostring(weight_type))))
  *   if _weight._weight.get().Type() == b"none":             # <<<<<<<<<<<<<<
  *     raise FstArgError("Weight type not found")
  *   return _weight
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":698
+  /* "fstlib/cext/pywrapfst.pyx":759
  *   if _weight._weight.get().Type() == b"none":
  *     raise FstArgError("Weight type not found")
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = __pyx_v__weight;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":692
+  /* "fstlib/cext/pywrapfst.pyx":753
  * 
  * 
  * cdef Weight _zero(weight_type):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(
  */
 
@@ -8682,15 +9013,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":701
+/* "fstlib/cext/pywrapfst.pyx":762
  * 
  * 
  * cdef Weight _one(weight_type):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(
  */
 
@@ -8704,120 +9035,120 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_one", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":702
+  /* "fstlib/cext/pywrapfst.pyx":763
  * 
  * cdef Weight _one(weight_type):
  *   cdef Weight _weight = Weight.__new__(Weight)             # <<<<<<<<<<<<<<
  *   _weight._weight.reset(
  *     new fst.WeightClass(fst.WeightClass.One(tostring(weight_type))))
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 702, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 763, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":703
+  /* "fstlib/cext/pywrapfst.pyx":764
  * cdef Weight _one(weight_type):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(             # <<<<<<<<<<<<<<
  *     new fst.WeightClass(fst.WeightClass.One(tostring(weight_type))))
  *   if _weight._weight.get().Type() == b"none":
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 703, __pyx_L1_error)
+    __PYX_ERR(0, 764, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":704
+  /* "fstlib/cext/pywrapfst.pyx":765
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(
  *     new fst.WeightClass(fst.WeightClass.One(tostring(weight_type))))             # <<<<<<<<<<<<<<
  *   if _weight._weight.get().Type() == b"none":
  *     raise FstArgError("Weight type not found")
  */
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_weight_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 704, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_weight_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 765, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":703
+  /* "fstlib/cext/pywrapfst.pyx":764
  * cdef Weight _one(weight_type):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(             # <<<<<<<<<<<<<<
  *     new fst.WeightClass(fst.WeightClass.One(tostring(weight_type))))
  *   if _weight._weight.get().Type() == b"none":
  */
   __pyx_v__weight->_weight.reset(new fst::script::WeightClass(fst::script::WeightClass::One(__pyx_t_2)));
 
-  /* "fstlib/cext/pywrapfst.pyx":705
+  /* "fstlib/cext/pywrapfst.pyx":766
  *   _weight._weight.reset(
  *     new fst.WeightClass(fst.WeightClass.One(tostring(weight_type))))
  *   if _weight._weight.get().Type() == b"none":             # <<<<<<<<<<<<<<
  *     raise FstArgError("Weight type not found")
  *   return _weight
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 705, __pyx_L1_error)
+    __PYX_ERR(0, 766, __pyx_L1_error)
   }
   __pyx_t_3 = ((__pyx_v__weight->_weight.get()->Type() == ((char const *)"none")) != 0);
   if (unlikely(__pyx_t_3)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":706
+    /* "fstlib/cext/pywrapfst.pyx":767
  *     new fst.WeightClass(fst.WeightClass.One(tostring(weight_type))))
  *   if _weight._weight.get().Type() == b"none":
  *     raise FstArgError("Weight type not found")             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 706, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 767, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_kp_u_Weight_type_not_found) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_kp_u_Weight_type_not_found);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 706, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 767, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 706, __pyx_L1_error)
+    __PYX_ERR(0, 767, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":705
+    /* "fstlib/cext/pywrapfst.pyx":766
  *   _weight._weight.reset(
  *     new fst.WeightClass(fst.WeightClass.One(tostring(weight_type))))
  *   if _weight._weight.get().Type() == b"none":             # <<<<<<<<<<<<<<
  *     raise FstArgError("Weight type not found")
  *   return _weight
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":707
+  /* "fstlib/cext/pywrapfst.pyx":768
  *   if _weight._weight.get().Type() == b"none":
  *     raise FstArgError("Weight type not found")
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = __pyx_v__weight;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":701
+  /* "fstlib/cext/pywrapfst.pyx":762
  * 
  * 
  * cdef Weight _one(weight_type):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(
  */
 
@@ -8831,15 +9162,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":710
+/* "fstlib/cext/pywrapfst.pyx":771
  * 
  * 
  * cdef Weight _no_weight(weight_type):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(
  */
 
@@ -8850,69 +9181,69 @@
   PyObject *__pyx_t_1 = NULL;
   std::string __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_no_weight", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":711
+  /* "fstlib/cext/pywrapfst.pyx":772
  * 
  * cdef Weight _no_weight(weight_type):
  *   cdef Weight _weight = Weight.__new__(Weight)             # <<<<<<<<<<<<<<
  *   _weight._weight.reset(
  *     new fst.WeightClass(fst.WeightClass.NoWeight(tostring(weight_type))))
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 711, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 772, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":712
+  /* "fstlib/cext/pywrapfst.pyx":773
  * cdef Weight _no_weight(weight_type):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(             # <<<<<<<<<<<<<<
  *     new fst.WeightClass(fst.WeightClass.NoWeight(tostring(weight_type))))
  *   return _weight
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 712, __pyx_L1_error)
+    __PYX_ERR(0, 773, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":713
+  /* "fstlib/cext/pywrapfst.pyx":774
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(
  *     new fst.WeightClass(fst.WeightClass.NoWeight(tostring(weight_type))))             # <<<<<<<<<<<<<<
  *   return _weight
  * 
  */
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_weight_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 713, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_weight_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 774, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":712
+  /* "fstlib/cext/pywrapfst.pyx":773
  * cdef Weight _no_weight(weight_type):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(             # <<<<<<<<<<<<<<
  *     new fst.WeightClass(fst.WeightClass.NoWeight(tostring(weight_type))))
  *   return _weight
  */
   __pyx_v__weight->_weight.reset(new fst::script::WeightClass(fst::script::WeightClass::NoWeight(__pyx_t_2)));
 
-  /* "fstlib/cext/pywrapfst.pyx":714
+  /* "fstlib/cext/pywrapfst.pyx":775
  *   _weight._weight.reset(
  *     new fst.WeightClass(fst.WeightClass.NoWeight(tostring(weight_type))))
  *   return _weight             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = __pyx_v__weight;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":710
+  /* "fstlib/cext/pywrapfst.pyx":771
  * 
  * 
  * cdef Weight _no_weight(weight_type):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(
  */
 
@@ -8924,15 +9255,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":746
+/* "fstlib/cext/pywrapfst.pyx":807
  *   # Doing so will allow undefined behavior.
  * 
  *   def __init__(self):             # <<<<<<<<<<<<<<
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  */
 
@@ -8958,40 +9289,40 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":747
+  /* "fstlib/cext/pywrapfst.pyx":808
  * 
  *   def __init__(self):
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")             # <<<<<<<<<<<<<<
  * 
  *   def __iter__(self):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 747, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 808, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 747, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 808, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_2, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 747, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_2, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 808, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Cannot_construct, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 747, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Cannot_construct, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 808, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_NotImplementedError, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 747, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_NotImplementedError, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 808, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(0, 747, __pyx_L1_error)
+  __PYX_ERR(0, 808, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":746
+  /* "fstlib/cext/pywrapfst.pyx":807
  *   # Doing so will allow undefined behavior.
  * 
  *   def __init__(self):             # <<<<<<<<<<<<<<
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  */
 
@@ -9001,15 +9332,15 @@
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.SymbolTableView.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":749
+/* "fstlib/cext/pywrapfst.pyx":810
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     return _SymbolTableIterator(self)
  * 
  */
 
@@ -9031,29 +9362,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__iter__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":750
+  /* "fstlib/cext/pywrapfst.pyx":811
  * 
  *   def __iter__(self):
  *     return _SymbolTableIterator(self)             # <<<<<<<<<<<<<<
  * 
  *   # Registers the class for pickling.
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__SymbolTableIterator), ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 750, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__SymbolTableIterator), ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 811, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":749
+  /* "fstlib/cext/pywrapfst.pyx":810
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     return _SymbolTableIterator(self)
  * 
  */
 
@@ -9064,15 +9395,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":754
+/* "fstlib/cext/pywrapfst.pyx":815
  *   # Registers the class for pickling.
  * 
  *   def __reduce__(self):             # <<<<<<<<<<<<<<
  *     return (_read_SymbolTable_from_string, (self.write_to_string(),))
  * 
  */
 
@@ -9096,48 +9427,48 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__reduce__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":755
+  /* "fstlib/cext/pywrapfst.pyx":816
  * 
  *   def __reduce__(self):
  *     return (_read_SymbolTable_from_string, (self.write_to_string(),))             # <<<<<<<<<<<<<<
  * 
  *   # Returns a raw const pointer to SymbolTable.
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_read_SymbolTable_from_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 755, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_read_SymbolTable_from_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 816, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "write_to_string");
-    __PYX_ERR(0, 755, __pyx_L1_error)
+    __PYX_ERR(0, 816, __pyx_L1_error)
   }
-  __pyx_t_2 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->write_to_string(__pyx_v_self, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 755, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->write_to_string(__pyx_v_self, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 816, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 755, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 816, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 755, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 816, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_3 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":754
+  /* "fstlib/cext/pywrapfst.pyx":815
  *   # Registers the class for pickling.
  * 
  *   def __reduce__(self):             # <<<<<<<<<<<<<<
  *     return (_read_SymbolTable_from_string, (self.write_to_string(),))
  * 
  */
 
@@ -9150,52 +9481,52 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":761
+/* "fstlib/cext/pywrapfst.pyx":822
  *   # Should not be directly accessed except by `_raw_ptr_or_raise()`.
  *   # All other methods should use the safer _raw_ptr_or_raise() instead.
  *   cdef const_SymbolTable_ptr _raw(self):             # <<<<<<<<<<<<<<
  *     return NULL
  * 
  */
 
 static __pyx_t_6fstlib_4cext_9pywrapfst_const_SymbolTable_ptr __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView__raw(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self) {
   __pyx_t_6fstlib_4cext_9pywrapfst_const_SymbolTable_ptr __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_raw", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":762
+  /* "fstlib/cext/pywrapfst.pyx":823
  *   # All other methods should use the safer _raw_ptr_or_raise() instead.
  *   cdef const_SymbolTable_ptr _raw(self):
  *     return NULL             # <<<<<<<<<<<<<<
  * 
  *   # Raises an FstOpError for a nonexistent SymbolTable.
  */
   __pyx_r = NULL;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":761
+  /* "fstlib/cext/pywrapfst.pyx":822
  *   # Should not be directly accessed except by `_raw_ptr_or_raise()`.
  *   # All other methods should use the safer _raw_ptr_or_raise() instead.
  *   cdef const_SymbolTable_ptr _raw(self):             # <<<<<<<<<<<<<<
  *     return NULL
  * 
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":765
+/* "fstlib/cext/pywrapfst.pyx":826
  * 
  *   # Raises an FstOpError for a nonexistent SymbolTable.
  *   cdef void _raise_nonexistent(self) except *:             # <<<<<<<<<<<<<<
  *     raise FstOpError("SymbolTable no longer exists")
  * 
  */
 
@@ -9205,43 +9536,43 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_raise_nonexistent", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":766
+  /* "fstlib/cext/pywrapfst.pyx":827
  *   # Raises an FstOpError for a nonexistent SymbolTable.
  *   cdef void _raise_nonexistent(self) except *:
  *     raise FstOpError("SymbolTable no longer exists")             # <<<<<<<<<<<<<<
  * 
  *   # Internal API method that should be used when a const pointer to an
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 766, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 827, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_kp_u_SymbolTable_no_longer_exists) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_SymbolTable_no_longer_exists);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 766, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 827, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(0, 766, __pyx_L1_error)
+  __PYX_ERR(0, 827, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":765
+  /* "fstlib/cext/pywrapfst.pyx":826
  * 
  *   # Raises an FstOpError for a nonexistent SymbolTable.
  *   cdef void _raise_nonexistent(self) except *:             # <<<<<<<<<<<<<<
  *     raise FstOpError("SymbolTable no longer exists")
  * 
  */
 
@@ -9250,15 +9581,15 @@
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.SymbolTableView._raise_nonexistent", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":770
+/* "fstlib/cext/pywrapfst.pyx":831
  *   # Internal API method that should be used when a const pointer to an
  *   # fst.SymbolTable is required.
  *   cdef const_SymbolTable_ptr _raw_ptr_or_raise(self) except *:             # <<<<<<<<<<<<<<
  *     cdef const_SymbolTable_ptr _raw = self._raw()
  *     if _raw == NULL:
  */
 
@@ -9268,70 +9599,70 @@
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_raw_ptr_or_raise", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":771
+  /* "fstlib/cext/pywrapfst.pyx":832
  *   # fst.SymbolTable is required.
  *   cdef const_SymbolTable_ptr _raw_ptr_or_raise(self) except *:
  *     cdef const_SymbolTable_ptr _raw = self._raw()             # <<<<<<<<<<<<<<
  *     if _raw == NULL:
  *       self._raise_nonexistent()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw");
-    __PYX_ERR(0, 771, __pyx_L1_error)
+    __PYX_ERR(0, 832, __pyx_L1_error)
   }
   __pyx_v__raw = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw(__pyx_v_self);
 
-  /* "fstlib/cext/pywrapfst.pyx":772
+  /* "fstlib/cext/pywrapfst.pyx":833
  *   cdef const_SymbolTable_ptr _raw_ptr_or_raise(self) except *:
  *     cdef const_SymbolTable_ptr _raw = self._raw()
  *     if _raw == NULL:             # <<<<<<<<<<<<<<
  *       self._raise_nonexistent()
  *     return _raw
  */
   __pyx_t_1 = ((__pyx_v__raw == NULL) != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":773
+    /* "fstlib/cext/pywrapfst.pyx":834
  *     cdef const_SymbolTable_ptr _raw = self._raw()
  *     if _raw == NULL:
  *       self._raise_nonexistent()             # <<<<<<<<<<<<<<
  *     return _raw
  * 
  */
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raise_nonexistent");
-      __PYX_ERR(0, 773, __pyx_L1_error)
+      __PYX_ERR(0, 834, __pyx_L1_error)
     }
-    ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raise_nonexistent(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 773, __pyx_L1_error)
+    ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raise_nonexistent(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 834, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":772
+    /* "fstlib/cext/pywrapfst.pyx":833
  *   cdef const_SymbolTable_ptr _raw_ptr_or_raise(self) except *:
  *     cdef const_SymbolTable_ptr _raw = self._raw()
  *     if _raw == NULL:             # <<<<<<<<<<<<<<
  *       self._raise_nonexistent()
  *     return _raw
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":774
+  /* "fstlib/cext/pywrapfst.pyx":835
  *     if _raw == NULL:
  *       self._raise_nonexistent()
  *     return _raw             # <<<<<<<<<<<<<<
  * 
- *   cpdef int64 available_key(self) except *:
+ *   cpdef int64_t available_key(self) except *:
  */
   __pyx_r = __pyx_v__raw;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":770
+  /* "fstlib/cext/pywrapfst.pyx":831
  *   # Internal API method that should be used when a const pointer to an
  *   # fst.SymbolTable is required.
  *   cdef const_SymbolTable_ptr _raw_ptr_or_raise(self) except *:             # <<<<<<<<<<<<<<
  *     cdef const_SymbolTable_ptr _raw = self._raw()
  *     if _raw == NULL:
  */
 
@@ -9340,46 +9671,46 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.SymbolTableView._raw_ptr_or_raise", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":776
+/* "fstlib/cext/pywrapfst.pyx":837
  *     return _raw
  * 
- *   cpdef int64 available_key(self) except *:             # <<<<<<<<<<<<<<
+ *   cpdef int64_t available_key(self) except *:             # <<<<<<<<<<<<<<
  *     """
  *     available_key(self)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_7available_key(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_available_key(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, int __pyx_skip_dispatch) {
-  int64 __pyx_r;
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_available_key(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, int __pyx_skip_dispatch) {
+  int64_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  int64 __pyx_t_5;
+  int64_t __pyx_t_5;
   fst::SymbolTable const *__pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("available_key", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_available_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 776, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_available_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 837, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_7available_key)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -9387,18 +9718,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 776, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 837, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 776, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 837, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -9409,33 +9740,33 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":782
+  /* "fstlib/cext/pywrapfst.pyx":843
  *     Returns an integer indicating the next available key index in the table.
  *     """
  *     return self._raw_ptr_or_raise().AvailableKey()             # <<<<<<<<<<<<<<
  * 
  *   cpdef bytes checksum(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 782, __pyx_L1_error)
+    __PYX_ERR(0, 843, __pyx_L1_error)
   }
-  __pyx_t_6 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 782, __pyx_L1_error)
+  __pyx_t_6 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 843, __pyx_L1_error)
   __pyx_r = __pyx_t_6->AvailableKey();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":776
+  /* "fstlib/cext/pywrapfst.pyx":837
  *     return _raw
  * 
- *   cpdef int64 available_key(self) except *:             # <<<<<<<<<<<<<<
+ *   cpdef int64_t available_key(self) except *:             # <<<<<<<<<<<<<<
  *     """
  *     available_key(self)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -9462,23 +9793,23 @@
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_15SymbolTableView_6available_key(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  int64 __pyx_t_1;
+  int64_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("available_key", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_available_key(__pyx_v_self, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 776, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 776, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_available_key(__pyx_v_self, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 837, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 837, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -9487,15 +9818,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":784
+/* "fstlib/cext/pywrapfst.pyx":845
  *     return self._raw_ptr_or_raise().AvailableKey()
  * 
  *   cpdef bytes checksum(self):             # <<<<<<<<<<<<<<
  *     """
  *     checksum(self)
  */
 
@@ -9517,15 +9848,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 784, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 845, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_9checksum)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -9534,18 +9865,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 784, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 845, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 784, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 845, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -9556,34 +9887,34 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":790
+  /* "fstlib/cext/pywrapfst.pyx":851
  *     Returns a bytestring indicating the label-independent MD5 checksum.
  *     """
  *     return self._raw_ptr_or_raise().CheckSum()             # <<<<<<<<<<<<<<
  * 
  *   cpdef SymbolTable copy(self):
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 790, __pyx_L1_error)
+    __PYX_ERR(0, 851, __pyx_L1_error)
   }
-  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 790, __pyx_L1_error)
-  __pyx_t_1 = __pyx_convert_PyBytes_string_to_py_std__in_string(__pyx_t_5->CheckSum()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 790, __pyx_L1_error)
+  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 851, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyBytes_string_to_py_std__in_string(__pyx_t_5->CheckSum()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 851, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":784
+  /* "fstlib/cext/pywrapfst.pyx":845
  *     return self._raw_ptr_or_raise().AvailableKey()
  * 
  *   cpdef bytes checksum(self):             # <<<<<<<<<<<<<<
  *     """
  *     checksum(self)
  */
 
@@ -9620,15 +9951,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("checksum", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_checksum(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 784, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_checksum(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 845, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -9637,15 +9968,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":792
+/* "fstlib/cext/pywrapfst.pyx":853
  *     return self._raw_ptr_or_raise().CheckSum()
  * 
  *   cpdef SymbolTable copy(self):             # <<<<<<<<<<<<<<
  *     """
  *     copy(self)
  */
 
@@ -9667,15 +9998,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 792, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 853, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_11copy)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -9684,18 +10015,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 792, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 853, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable))))) __PYX_ERR(0, 792, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable))))) __PYX_ERR(0, 853, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -9706,34 +10037,34 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":798
+  /* "fstlib/cext/pywrapfst.pyx":859
  *     Returns a mutable copy of the SymbolTable.
  *     """
  *     return _init_SymbolTable(WrapUnique(self._raw_ptr_or_raise().Copy()))             # <<<<<<<<<<<<<<
  * 
  *   def find(self, key):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 798, __pyx_L1_error)
+    __PYX_ERR(0, 859, __pyx_L1_error)
   }
-  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 798, __pyx_L1_error)
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(fst::WrapUnique<fst::SymbolTable>(__pyx_t_5->Copy()))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 798, __pyx_L1_error)
+  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 859, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(fst::WrapUnique<fst::SymbolTable>(__pyx_t_5->Copy()))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 859, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":792
+  /* "fstlib/cext/pywrapfst.pyx":853
  *     return self._raw_ptr_or_raise().CheckSum()
  * 
  *   cpdef SymbolTable copy(self):             # <<<<<<<<<<<<<<
  *     """
  *     copy(self)
  */
 
@@ -9770,15 +10101,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("copy", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_copy(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 792, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_copy(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 853, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -9787,15 +10118,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":800
+/* "fstlib/cext/pywrapfst.pyx":861
  *     return _init_SymbolTable(WrapUnique(self._raw_ptr_or_raise().Copy()))
  * 
  *   def find(self, key):             # <<<<<<<<<<<<<<
  *     """
  *     find(self, key)
  */
 
@@ -9822,36 +10153,36 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   std::string __pyx_t_5;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_t_7;
   PyObject *__pyx_t_8 = NULL;
   PyObject *__pyx_t_9 = NULL;
-  int64 __pyx_t_10;
+  int64_t __pyx_t_10;
   PyObject *__pyx_t_11 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("find", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":817
+  /* "fstlib/cext/pywrapfst.pyx":878
  *           not found.
  *     """
  *     cdef const_SymbolTable_ptr _raw = self._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     try:
  *       return _raw.FindIndex(tostring(key))
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 817, __pyx_L1_error)
+    __PYX_ERR(0, 878, __pyx_L1_error)
   }
-  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 817, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 878, __pyx_L1_error)
   __pyx_v__raw = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":818
+  /* "fstlib/cext/pywrapfst.pyx":879
  *     """
  *     cdef const_SymbolTable_ptr _raw = self._raw_ptr_or_raise()
  *     try:             # <<<<<<<<<<<<<<
  *       return _raw.FindIndex(tostring(key))
  *     except TypeError:
  */
   {
@@ -9859,77 +10190,77 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_2, &__pyx_t_3, &__pyx_t_4);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_4);
     /*try:*/ {
 
-      /* "fstlib/cext/pywrapfst.pyx":819
+      /* "fstlib/cext/pywrapfst.pyx":880
  *     cdef const_SymbolTable_ptr _raw = self._raw_ptr_or_raise()
  *     try:
  *       return _raw.FindIndex(tostring(key))             # <<<<<<<<<<<<<<
  *     except TypeError:
  *       return _raw.FindSymbol(key)
  */
       __Pyx_XDECREF(__pyx_r);
-      __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_key); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 819, __pyx_L3_error)
-      __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v__raw->Find(__pyx_t_5)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 819, __pyx_L3_error)
+      __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_key); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 880, __pyx_L3_error)
+      __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v__raw->Find(__pyx_t_5)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 880, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_6);
       __pyx_r = __pyx_t_6;
       __pyx_t_6 = 0;
       goto __pyx_L7_try_return;
 
-      /* "fstlib/cext/pywrapfst.pyx":818
+      /* "fstlib/cext/pywrapfst.pyx":879
  *     """
  *     cdef const_SymbolTable_ptr _raw = self._raw_ptr_or_raise()
  *     try:             # <<<<<<<<<<<<<<
  *       return _raw.FindIndex(tostring(key))
  *     except TypeError:
  */
     }
     __pyx_L3_error:;
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-    /* "fstlib/cext/pywrapfst.pyx":820
+    /* "fstlib/cext/pywrapfst.pyx":881
  *     try:
  *       return _raw.FindIndex(tostring(key))
  *     except TypeError:             # <<<<<<<<<<<<<<
  *       return _raw.FindSymbol(key)
  * 
  */
     __pyx_t_7 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_TypeError);
     if (__pyx_t_7) {
       __Pyx_AddTraceback("fstlib.cext.pywrapfst.SymbolTableView.find", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_8, &__pyx_t_9) < 0) __PYX_ERR(0, 820, __pyx_L5_except_error)
+      if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_8, &__pyx_t_9) < 0) __PYX_ERR(0, 881, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_GOTREF(__pyx_t_9);
 
-      /* "fstlib/cext/pywrapfst.pyx":821
+      /* "fstlib/cext/pywrapfst.pyx":882
  *       return _raw.FindIndex(tostring(key))
  *     except TypeError:
  *       return _raw.FindSymbol(key)             # <<<<<<<<<<<<<<
  * 
- *   cpdef int64 get_nth_key(self, ssize_t pos) except *:
+ *   cpdef int64_t get_nth_key(self, ssize_t pos) except *:
  */
       __Pyx_XDECREF(__pyx_r);
-      __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_key); if (unlikely((__pyx_t_10 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 821, __pyx_L5_except_error)
-      __pyx_t_11 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v__raw->Find(__pyx_t_10)); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 821, __pyx_L5_except_error)
+      __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_key); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 882, __pyx_L5_except_error)
+      __pyx_t_11 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v__raw->Find(__pyx_t_10)); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 882, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_11);
       __pyx_r = __pyx_t_11;
       __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       goto __pyx_L6_except_return;
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "fstlib/cext/pywrapfst.pyx":818
+    /* "fstlib/cext/pywrapfst.pyx":879
  *     """
  *     cdef const_SymbolTable_ptr _raw = self._raw_ptr_or_raise()
  *     try:             # <<<<<<<<<<<<<<
  *       return _raw.FindIndex(tostring(key))
  *     except TypeError:
  */
     __Pyx_XGIVEREF(__pyx_t_2);
@@ -9947,15 +10278,15 @@
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_XGIVEREF(__pyx_t_4);
     __Pyx_ExceptionReset(__pyx_t_2, __pyx_t_3, __pyx_t_4);
     goto __pyx_L0;
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":800
+  /* "fstlib/cext/pywrapfst.pyx":861
  *     return _init_SymbolTable(WrapUnique(self._raw_ptr_or_raise().Copy()))
  * 
  *   def find(self, key):             # <<<<<<<<<<<<<<
  *     """
  *     find(self, key)
  */
 
@@ -9969,50 +10300,50 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":823
+/* "fstlib/cext/pywrapfst.pyx":884
  *       return _raw.FindSymbol(key)
  * 
- *   cpdef int64 get_nth_key(self, ssize_t pos) except *:             # <<<<<<<<<<<<<<
+ *   cpdef int64_t get_nth_key(self, ssize_t pos) except *:             # <<<<<<<<<<<<<<
  *     """
  *     get_nth_key(self, pos)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_15get_nth_key(PyObject *__pyx_v_self, PyObject *__pyx_arg_pos); /*proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_get_nth_key(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, Py_ssize_t __pyx_v_pos, int __pyx_skip_dispatch) {
-  int64 __pyx_r;
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_get_nth_key(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, Py_ssize_t __pyx_v_pos, int __pyx_skip_dispatch) {
+  int64_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
-  int64 __pyx_t_6;
+  int64_t __pyx_t_6;
   fst::SymbolTable const *__pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_nth_key", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_nth_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 823, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_nth_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 884, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_15get_nth_key)) {
-        __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_pos); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 823, __pyx_L1_error)
+        __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_pos); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 884, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -10020,18 +10351,18 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 823, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 884, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_6 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_6 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 823, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_6 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 884, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_6;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -10042,33 +10373,33 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":835
+  /* "fstlib/cext/pywrapfst.pyx":896
  *       The integer index of the n-th key, or NO_LABEL if not found.
  *     """
  *     return self._raw_ptr_or_raise().GetNthKey(pos)             # <<<<<<<<<<<<<<
  * 
  *   cpdef bytes labeled_checksum(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 835, __pyx_L1_error)
+    __PYX_ERR(0, 896, __pyx_L1_error)
   }
-  __pyx_t_7 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 835, __pyx_L1_error)
+  __pyx_t_7 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 896, __pyx_L1_error)
   __pyx_r = __pyx_t_7->GetNthKey(__pyx_v_pos);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":823
+  /* "fstlib/cext/pywrapfst.pyx":884
  *       return _raw.FindSymbol(key)
  * 
- *   cpdef int64 get_nth_key(self, ssize_t pos) except *:             # <<<<<<<<<<<<<<
+ *   cpdef int64_t get_nth_key(self, ssize_t pos) except *:             # <<<<<<<<<<<<<<
  *     """
  *     get_nth_key(self, pos)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -10091,15 +10422,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("get_nth_key (wrapper)", 0);
   assert(__pyx_arg_pos); {
-    __pyx_v_pos = PyInt_AsSsize_t(__pyx_arg_pos); if (unlikely((__pyx_v_pos == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 823, __pyx_L3_error)
+    __pyx_v_pos = PyInt_AsSsize_t(__pyx_arg_pos); if (unlikely((__pyx_v_pos == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 884, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.SymbolTableView.get_nth_key", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
@@ -10109,23 +10440,23 @@
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_15SymbolTableView_14get_nth_key(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_self, Py_ssize_t __pyx_v_pos) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  int64 __pyx_t_1;
+  int64_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_nth_key", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_get_nth_key(__pyx_v_self, __pyx_v_pos, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 823, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 823, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_get_nth_key(__pyx_v_self, __pyx_v_pos, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 884, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 884, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -10134,15 +10465,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":837
+/* "fstlib/cext/pywrapfst.pyx":898
  *     return self._raw_ptr_or_raise().GetNthKey(pos)
  * 
  *   cpdef bytes labeled_checksum(self):             # <<<<<<<<<<<<<<
  *     """
  *     labeled_checksum(self)
  */
 
@@ -10164,15 +10495,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_labeled_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 837, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_labeled_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 898, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_17labeled_checksum)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -10181,18 +10512,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 837, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 898, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 837, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 898, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -10203,34 +10534,34 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":843
+  /* "fstlib/cext/pywrapfst.pyx":904
  *     Returns a bytestring indicating the label-dependent MD5 checksum.
  *     """
  *     return self._raw_ptr_or_raise().LabeledCheckSum()             # <<<<<<<<<<<<<<
  * 
  *   cpdef bool member(self, key) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 843, __pyx_L1_error)
+    __PYX_ERR(0, 904, __pyx_L1_error)
   }
-  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 843, __pyx_L1_error)
-  __pyx_t_1 = __pyx_convert_PyBytes_string_to_py_std__in_string(__pyx_t_5->LabeledCheckSum()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 843, __pyx_L1_error)
+  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 904, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyBytes_string_to_py_std__in_string(__pyx_t_5->LabeledCheckSum()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 904, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":837
+  /* "fstlib/cext/pywrapfst.pyx":898
  *     return self._raw_ptr_or_raise().GetNthKey(pos)
  * 
  *   cpdef bytes labeled_checksum(self):             # <<<<<<<<<<<<<<
  *     """
  *     labeled_checksum(self)
  */
 
@@ -10267,15 +10598,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("labeled_checksum", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_labeled_checksum(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 837, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_labeled_checksum(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 898, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -10284,15 +10615,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":845
+/* "fstlib/cext/pywrapfst.pyx":906
  *     return self._raw_ptr_or_raise().LabeledCheckSum()
  * 
  *   cpdef bool member(self, key) except *:             # <<<<<<<<<<<<<<
  *     """
  *     member(self, key)
  */
 
@@ -10308,29 +10639,29 @@
   bool __pyx_t_5;
   fst::SymbolTable const *__pyx_t_6;
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   PyObject *__pyx_t_9 = NULL;
   std::string __pyx_t_10;
   int __pyx_t_11;
-  int64 __pyx_t_12;
+  int64_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("member", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_member); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 845, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_member); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 906, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_19member)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -10338,18 +10669,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_key) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_key);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 845, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 906, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 845, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 906, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -10360,29 +10691,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":861
+  /* "fstlib/cext/pywrapfst.pyx":922
  *       Whether or not the key is present (as a string or a index) in the table.
  *     """
  *     cdef const_SymbolTable_ptr _raw = self._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     try:
  *       return _raw.MemberSymbol(tostring(key))
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 861, __pyx_L1_error)
+    __PYX_ERR(0, 922, __pyx_L1_error)
   }
-  __pyx_t_6 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 861, __pyx_L1_error)
+  __pyx_t_6 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 922, __pyx_L1_error)
   __pyx_v__raw = __pyx_t_6;
 
-  /* "fstlib/cext/pywrapfst.pyx":862
+  /* "fstlib/cext/pywrapfst.pyx":923
  *     """
  *     cdef const_SymbolTable_ptr _raw = self._raw_ptr_or_raise()
  *     try:             # <<<<<<<<<<<<<<
  *       return _raw.MemberSymbol(tostring(key))
  *     except TypeError:
  */
   {
@@ -10390,72 +10721,72 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
     __Pyx_XGOTREF(__pyx_t_7);
     __Pyx_XGOTREF(__pyx_t_8);
     __Pyx_XGOTREF(__pyx_t_9);
     /*try:*/ {
 
-      /* "fstlib/cext/pywrapfst.pyx":863
+      /* "fstlib/cext/pywrapfst.pyx":924
  *     cdef const_SymbolTable_ptr _raw = self._raw_ptr_or_raise()
  *     try:
  *       return _raw.MemberSymbol(tostring(key))             # <<<<<<<<<<<<<<
  *     except TypeError:
  *       return _raw.MemberIndex(key)
  */
-      __pyx_t_10 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_key); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 863, __pyx_L3_error)
+      __pyx_t_10 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_key); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 924, __pyx_L3_error)
       __pyx_r = __pyx_v__raw->Member(__pyx_t_10);
       goto __pyx_L7_try_return;
 
-      /* "fstlib/cext/pywrapfst.pyx":862
+      /* "fstlib/cext/pywrapfst.pyx":923
  *     """
  *     cdef const_SymbolTable_ptr _raw = self._raw_ptr_or_raise()
  *     try:             # <<<<<<<<<<<<<<
  *       return _raw.MemberSymbol(tostring(key))
  *     except TypeError:
  */
     }
     __pyx_L3_error:;
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "fstlib/cext/pywrapfst.pyx":864
+    /* "fstlib/cext/pywrapfst.pyx":925
  *     try:
  *       return _raw.MemberSymbol(tostring(key))
  *     except TypeError:             # <<<<<<<<<<<<<<
  *       return _raw.MemberIndex(key)
  * 
  */
     __pyx_t_11 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_TypeError);
     if (__pyx_t_11) {
       __Pyx_AddTraceback("fstlib.cext.pywrapfst.SymbolTableView.member", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3) < 0) __PYX_ERR(0, 864, __pyx_L5_except_error)
+      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3) < 0) __PYX_ERR(0, 925, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_GOTREF(__pyx_t_3);
 
-      /* "fstlib/cext/pywrapfst.pyx":865
+      /* "fstlib/cext/pywrapfst.pyx":926
  *       return _raw.MemberSymbol(tostring(key))
  *     except TypeError:
  *       return _raw.MemberIndex(key)             # <<<<<<<<<<<<<<
  * 
  *   cpdef string name(self) except *:
  */
-      __pyx_t_12 = __Pyx_PyInt_As_int64_t(__pyx_v_key); if (unlikely((__pyx_t_12 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 865, __pyx_L5_except_error)
+      __pyx_t_12 = __Pyx_PyInt_As_int64_t(__pyx_v_key); if (unlikely((__pyx_t_12 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 926, __pyx_L5_except_error)
       __pyx_r = __pyx_v__raw->Member(__pyx_t_12);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       goto __pyx_L6_except_return;
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "fstlib/cext/pywrapfst.pyx":862
+    /* "fstlib/cext/pywrapfst.pyx":923
  *     """
  *     cdef const_SymbolTable_ptr _raw = self._raw_ptr_or_raise()
  *     try:             # <<<<<<<<<<<<<<
  *       return _raw.MemberSymbol(tostring(key))
  *     except TypeError:
  */
     __Pyx_XGIVEREF(__pyx_t_7);
@@ -10473,15 +10804,15 @@
     __Pyx_XGIVEREF(__pyx_t_7);
     __Pyx_XGIVEREF(__pyx_t_8);
     __Pyx_XGIVEREF(__pyx_t_9);
     __Pyx_ExceptionReset(__pyx_t_7, __pyx_t_8, __pyx_t_9);
     goto __pyx_L0;
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":845
+  /* "fstlib/cext/pywrapfst.pyx":906
  *     return self._raw_ptr_or_raise().LabeledCheckSum()
  * 
  *   cpdef bool member(self, key) except *:             # <<<<<<<<<<<<<<
  *     """
  *     member(self, key)
  */
 
@@ -10518,16 +10849,16 @@
   bool __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("member", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_member(__pyx_v_self, __pyx_v_key, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 845, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 845, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_member(__pyx_v_self, __pyx_v_key, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 906, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 906, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -10536,15 +10867,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":867
+/* "fstlib/cext/pywrapfst.pyx":928
  *       return _raw.MemberIndex(key)
  * 
  *   cpdef string name(self) except *:             # <<<<<<<<<<<<<<
  *     """
  *     name(self)
  */
 
@@ -10567,15 +10898,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_name_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 867, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_name_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 928, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_21name)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -10583,18 +10914,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 867, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 928, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 867, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 928, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -10605,30 +10936,30 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":873
+  /* "fstlib/cext/pywrapfst.pyx":934
  *     Returns the symbol table's name.
  *     """
  *     return self._raw_ptr_or_raise().Name()             # <<<<<<<<<<<<<<
  * 
  *   cpdef size_t num_symbols(self) except *:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 873, __pyx_L1_error)
+    __PYX_ERR(0, 934, __pyx_L1_error)
   }
-  __pyx_t_6 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
+  __pyx_t_6 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 934, __pyx_L1_error)
   __pyx_r = __pyx_t_6->Name();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":867
+  /* "fstlib/cext/pywrapfst.pyx":928
  *       return _raw.MemberIndex(key)
  * 
  *   cpdef string name(self) except *:             # <<<<<<<<<<<<<<
  *     """
  *     name(self)
  */
 
@@ -10665,16 +10996,16 @@
   std::string __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("name", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_name(__pyx_v_self, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 867, __pyx_L1_error)
-  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 867, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_name(__pyx_v_self, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 928, __pyx_L1_error)
+  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 928, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -10683,15 +11014,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":875
+/* "fstlib/cext/pywrapfst.pyx":936
  *     return self._raw_ptr_or_raise().Name()
  * 
  *   cpdef size_t num_symbols(self) except *:             # <<<<<<<<<<<<<<
  *     """
  *     num_symbols(self)
  */
 
@@ -10714,15 +11045,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_symbols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 875, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_symbols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 936, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_23num_symbols)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -10730,18 +11061,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 875, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 936, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_5 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_5 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 936, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -10752,30 +11083,30 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":881
+  /* "fstlib/cext/pywrapfst.pyx":942
  *     Returns the number of symbols in the symbol table.
  *     """
  *     return self._raw_ptr_or_raise().NumSymbols()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void write(self, source) except *:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 881, __pyx_L1_error)
+    __PYX_ERR(0, 942, __pyx_L1_error)
   }
-  __pyx_t_6 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 881, __pyx_L1_error)
+  __pyx_t_6 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 942, __pyx_L1_error)
   __pyx_r = __pyx_t_6->NumSymbols();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":875
+  /* "fstlib/cext/pywrapfst.pyx":936
  *     return self._raw_ptr_or_raise().Name()
  * 
  *   cpdef size_t num_symbols(self) except *:             # <<<<<<<<<<<<<<
  *     """
  *     num_symbols(self)
  */
 
@@ -10812,16 +11143,16 @@
   size_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("num_symbols", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_num_symbols(__pyx_v_self, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyInt_FromSize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 875, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_num_symbols(__pyx_v_self, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 936, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_FromSize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 936, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -10830,15 +11161,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":883
+/* "fstlib/cext/pywrapfst.pyx":944
  *     return self._raw_ptr_or_raise().NumSymbols()
  * 
  *   cpdef void write(self, source) except *:             # <<<<<<<<<<<<<<
  *     """
  *     write(self, source)
  */
 
@@ -10861,15 +11192,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 883, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 944, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_25write)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -10877,15 +11208,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_source) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_source);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 883, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 944, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -10897,42 +11228,42 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":897
+  /* "fstlib/cext/pywrapfst.pyx":958
  *       FstIOError: Write failed.
  *     """
  *     if not self._raw_ptr_or_raise().Write(path_tostring(source)):             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 897, __pyx_L1_error)
+    __PYX_ERR(0, 958, __pyx_L1_error)
   }
-  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 897, __pyx_L1_error)
-  __pyx_t_6 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 897, __pyx_L1_error)
+  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 958, __pyx_L1_error)
+  __pyx_t_6 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 958, __pyx_L1_error)
   __pyx_t_7 = ((!(__pyx_t_5->Write(__pyx_t_6) != 0)) != 0);
   if (unlikely(__pyx_t_7)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":898
+    /* "fstlib/cext/pywrapfst.pyx":959
  *     """
  *     if not self._raw_ptr_or_raise().Write(path_tostring(source)):
  *       raise FstIOError(f"Write failed: {source!r}")             # <<<<<<<<<<<<<<
  * 
  *   cpdef void write_text(self, source) except *:
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 898, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 898, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Write_failed, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 898, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Write_failed, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -10940,31 +11271,31 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 898, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 898, __pyx_L1_error)
+    __PYX_ERR(0, 959, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":897
+    /* "fstlib/cext/pywrapfst.pyx":958
  *       FstIOError: Write failed.
  *     """
  *     if not self._raw_ptr_or_raise().Write(path_tostring(source)):             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":883
+  /* "fstlib/cext/pywrapfst.pyx":944
  *     return self._raw_ptr_or_raise().NumSymbols()
  * 
  *   cpdef void write(self, source) except *:             # <<<<<<<<<<<<<<
  *     """
  *     write(self, source)
  */
 
@@ -10999,16 +11330,16 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("write", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write(__pyx_v_self, __pyx_v_source, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 883, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 883, __pyx_L1_error)
+  __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write(__pyx_v_self, __pyx_v_source, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 944, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 944, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -11017,15 +11348,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":900
+/* "fstlib/cext/pywrapfst.pyx":961
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  *   cpdef void write_text(self, source) except *:             # <<<<<<<<<<<<<<
  *     """
  *     write_text(self, source)
  */
 
@@ -11048,15 +11379,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_text); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 900, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_text); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 961, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_27write_text)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -11064,15 +11395,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_source) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_source);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 900, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 961, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -11084,42 +11415,42 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":914
+  /* "fstlib/cext/pywrapfst.pyx":975
  *       FstIOError: Write failed.
  *     """
  *     if not self._raw_ptr_or_raise().WriteText(path_tostring(source)):             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 914, __pyx_L1_error)
+    __PYX_ERR(0, 975, __pyx_L1_error)
   }
-  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 914, __pyx_L1_error)
-  __pyx_t_6 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 914, __pyx_L1_error)
+  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 975, __pyx_L1_error)
+  __pyx_t_6 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 975, __pyx_L1_error)
   __pyx_t_7 = ((!(__pyx_t_5->WriteText(__pyx_t_6) != 0)) != 0);
   if (unlikely(__pyx_t_7)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":915
+    /* "fstlib/cext/pywrapfst.pyx":976
  *     """
  *     if not self._raw_ptr_or_raise().WriteText(path_tostring(source)):
  *       raise FstIOError(f"Write failed: {source!r}")             # <<<<<<<<<<<<<<
  * 
  *   cpdef bytes write_to_string(self):
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 976, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 976, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Write_failed, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Write_failed, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 976, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -11127,31 +11458,31 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 915, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 976, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 976, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":914
+    /* "fstlib/cext/pywrapfst.pyx":975
  *       FstIOError: Write failed.
  *     """
  *     if not self._raw_ptr_or_raise().WriteText(path_tostring(source)):             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":900
+  /* "fstlib/cext/pywrapfst.pyx":961
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  *   cpdef void write_text(self, source) except *:             # <<<<<<<<<<<<<<
  *     """
  *     write_text(self, source)
  */
 
@@ -11186,16 +11517,16 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("write_text", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write_text(__pyx_v_self, __pyx_v_source, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 900, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 900, __pyx_L1_error)
+  __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write_text(__pyx_v_self, __pyx_v_source, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 961, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -11204,15 +11535,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":917
+/* "fstlib/cext/pywrapfst.pyx":978
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  *   cpdef bytes write_to_string(self):             # <<<<<<<<<<<<<<
  *     """
  *     write_to_string(self)
  */
 
@@ -11236,15 +11567,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_to_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 917, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_to_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 978, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_15SymbolTableView_29write_to_string)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -11253,18 +11584,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 917, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 978, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 917, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 978, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -11275,81 +11606,81 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":930
+  /* "fstlib/cext/pywrapfst.pyx":991
  *     """
  *     cdef stringstream _sstrm
  *     if not self._raw_ptr_or_raise().Write(_sstrm):             # <<<<<<<<<<<<<<
  *       raise FstIOError("Write to string failed")
  *     return _sstrm.str()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 930, __pyx_L1_error)
+    __PYX_ERR(0, 991, __pyx_L1_error)
   }
-  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 930, __pyx_L1_error)
+  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 991, __pyx_L1_error)
   __pyx_t_6 = ((!(__pyx_t_5->Write(__pyx_v__sstrm) != 0)) != 0);
   if (unlikely(__pyx_t_6)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":931
+    /* "fstlib/cext/pywrapfst.pyx":992
  *     cdef stringstream _sstrm
  *     if not self._raw_ptr_or_raise().Write(_sstrm):
  *       raise FstIOError("Write to string failed")             # <<<<<<<<<<<<<<
  *     return _sstrm.str()
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 931, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 992, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_kp_u_Write_to_string_failed) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_Write_to_string_failed);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 931, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 992, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 931, __pyx_L1_error)
+    __PYX_ERR(0, 992, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":930
+    /* "fstlib/cext/pywrapfst.pyx":991
  *     """
  *     cdef stringstream _sstrm
  *     if not self._raw_ptr_or_raise().Write(_sstrm):             # <<<<<<<<<<<<<<
  *       raise FstIOError("Write to string failed")
  *     return _sstrm.str()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":932
+  /* "fstlib/cext/pywrapfst.pyx":993
  *     if not self._raw_ptr_or_raise().Write(_sstrm):
  *       raise FstIOError("Write to string failed")
  *     return _sstrm.str()             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyBytes_string_to_py_std__in_string(__pyx_v__sstrm.str()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 932, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyBytes_string_to_py_std__in_string(__pyx_v__sstrm.str()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 993, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":917
+  /* "fstlib/cext/pywrapfst.pyx":978
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  *   cpdef bytes write_to_string(self):             # <<<<<<<<<<<<<<
  *     """
  *     write_to_string(self)
  */
 
@@ -11386,15 +11717,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("write_to_string", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write_to_string(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write_to_string(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 978, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -11403,15 +11734,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":950
+/* "fstlib/cext/pywrapfst.pyx":1011
  *   # Doing so will allow undefined behavior.
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return (f"<const EncodeMapper SymbolTableView {self.name()!r} "
  *             f"at 0x{id(self):x}>")
  */
 
@@ -11438,87 +11769,87 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":951
+  /* "fstlib/cext/pywrapfst.pyx":1012
  * 
  *   def __repr__(self):
  *     return (f"<const EncodeMapper SymbolTableView {self.name()!r} "             # <<<<<<<<<<<<<<
  *             f"at 0x{id(self):x}>")
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 951, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1012, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_const_EncodeMapper_SymbolTableV);
   __pyx_t_2 += 36;
   __Pyx_GIVEREF(__pyx_kp_u_const_EncodeMapper_SymbolTableV);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_const_EncodeMapper_SymbolTableV);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "name");
-    __PYX_ERR(0, 951, __pyx_L1_error)
+    __PYX_ERR(0, 1012, __pyx_L1_error)
   }
-  __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.name(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self), 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 951, __pyx_L1_error)
-  __pyx_t_5 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 951, __pyx_L1_error)
+  __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.name(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self), 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1012, __pyx_L1_error)
+  __pyx_t_5 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1012, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_5), __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 951, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_5), __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1012, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_6);
   __pyx_t_6 = 0;
   __Pyx_INCREF(__pyx_kp_u_at_0x);
   __pyx_t_2 += 6;
   __Pyx_GIVEREF(__pyx_kp_u_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_at_0x);
 
-  /* "fstlib/cext/pywrapfst.pyx":952
+  /* "fstlib/cext/pywrapfst.pyx":1013
  *   def __repr__(self):
  *     return (f"<const EncodeMapper SymbolTableView {self.name()!r} "
  *             f"at 0x{id(self):x}>")             # <<<<<<<<<<<<<<
  * 
  *   cdef const_SymbolTable_ptr _raw(self):
  */
-  __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1013, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_6, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_6, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1013, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u__3);
 
-  /* "fstlib/cext/pywrapfst.pyx":951
+  /* "fstlib/cext/pywrapfst.pyx":1012
  * 
  *   def __repr__(self):
  *     return (f"<const EncodeMapper SymbolTableView {self.name()!r} "             # <<<<<<<<<<<<<<
  *             f"at 0x{id(self):x}>")
  * 
  */
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 951, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1012, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":950
+  /* "fstlib/cext/pywrapfst.pyx":1011
  *   # Doing so will allow undefined behavior.
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return (f"<const EncodeMapper SymbolTableView {self.name()!r} "
  *             f"at 0x{id(self):x}>")
  */
 
@@ -11531,15 +11862,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":954
+/* "fstlib/cext/pywrapfst.pyx":1015
  *             f"at 0x{id(self):x}>")
  * 
  *   cdef const_SymbolTable_ptr _raw(self):             # <<<<<<<<<<<<<<
  *     return (self._mapper.get().InputSymbols() if self._input_side
  *             else self._mapper.get().OutputSymbols())
  */
 
@@ -11548,50 +11879,50 @@
   __Pyx_RefNannyDeclarations
   fst::SymbolTable const *__pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_raw", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":955
+  /* "fstlib/cext/pywrapfst.pyx":1016
  * 
  *   cdef const_SymbolTable_ptr _raw(self):
  *     return (self._mapper.get().InputSymbols() if self._input_side             # <<<<<<<<<<<<<<
  *             else self._mapper.get().OutputSymbols())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_input_side");
-    __PYX_ERR(0, 955, __pyx_L1_error)
+    __PYX_ERR(0, 1016, __pyx_L1_error)
   }
   if ((__pyx_v_self->_input_side != 0)) {
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-      __PYX_ERR(0, 955, __pyx_L1_error)
+      __PYX_ERR(0, 1016, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_self->_mapper.get()->InputSymbols();
   } else {
 
-    /* "fstlib/cext/pywrapfst.pyx":956
+    /* "fstlib/cext/pywrapfst.pyx":1017
  *   cdef const_SymbolTable_ptr _raw(self):
  *     return (self._mapper.get().InputSymbols() if self._input_side
  *             else self._mapper.get().OutputSymbols())             # <<<<<<<<<<<<<<
  * 
  * 
  */
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-      __PYX_ERR(0, 956, __pyx_L1_error)
+      __PYX_ERR(0, 1017, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_self->_mapper.get()->OutputSymbols();
   }
   __pyx_r = __pyx_t_1;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":954
+  /* "fstlib/cext/pywrapfst.pyx":1015
  *             f"at 0x{id(self):x}>")
  * 
  *   cdef const_SymbolTable_ptr _raw(self):             # <<<<<<<<<<<<<<
  *     return (self._mapper.get().InputSymbols() if self._input_side
  *             else self._mapper.get().OutputSymbols())
  */
 
@@ -11600,15 +11931,15 @@
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst._EncodeMapperSymbolTableView._raw", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":973
+/* "fstlib/cext/pywrapfst.pyx":1034
  *   # Doing so will allow undefined behavior.
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return (f"<const Fst SymbolTableView {self.name()!r} "
  *             f"at 0x{id(self):x}>")
  */
 
@@ -11635,87 +11966,87 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":974
+  /* "fstlib/cext/pywrapfst.pyx":1035
  * 
  *   def __repr__(self):
  *     return (f"<const Fst SymbolTableView {self.name()!r} "             # <<<<<<<<<<<<<<
  *             f"at 0x{id(self):x}>")
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 974, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1035, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_const_Fst_SymbolTableView);
   __pyx_t_2 += 27;
   __Pyx_GIVEREF(__pyx_kp_u_const_Fst_SymbolTableView);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_const_Fst_SymbolTableView);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "name");
-    __PYX_ERR(0, 974, __pyx_L1_error)
+    __PYX_ERR(0, 1035, __pyx_L1_error)
   }
-  __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__FstSymbolTableView *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.name(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self), 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 974, __pyx_L1_error)
-  __pyx_t_5 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 974, __pyx_L1_error)
+  __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__FstSymbolTableView *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.name(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self), 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1035, __pyx_L1_error)
+  __pyx_t_5 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1035, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_5), __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 974, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_5), __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1035, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_6);
   __pyx_t_6 = 0;
   __Pyx_INCREF(__pyx_kp_u_at_0x);
   __pyx_t_2 += 6;
   __Pyx_GIVEREF(__pyx_kp_u_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_at_0x);
 
-  /* "fstlib/cext/pywrapfst.pyx":975
+  /* "fstlib/cext/pywrapfst.pyx":1036
  *   def __repr__(self):
  *     return (f"<const Fst SymbolTableView {self.name()!r} "
  *             f"at 0x{id(self):x}>")             # <<<<<<<<<<<<<<
  * 
  *   cdef const_SymbolTable_ptr _raw(self):
  */
-  __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 975, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1036, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_6, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 975, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_6, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1036, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u__3);
 
-  /* "fstlib/cext/pywrapfst.pyx":974
+  /* "fstlib/cext/pywrapfst.pyx":1035
  * 
  *   def __repr__(self):
  *     return (f"<const Fst SymbolTableView {self.name()!r} "             # <<<<<<<<<<<<<<
  *             f"at 0x{id(self):x}>")
  * 
  */
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 974, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1035, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":973
+  /* "fstlib/cext/pywrapfst.pyx":1034
  *   # Doing so will allow undefined behavior.
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return (f"<const Fst SymbolTableView {self.name()!r} "
  *             f"at 0x{id(self):x}>")
  */
 
@@ -11728,15 +12059,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":977
+/* "fstlib/cext/pywrapfst.pyx":1038
  *             f"at 0x{id(self):x}>")
  * 
  *   cdef const_SymbolTable_ptr _raw(self):             # <<<<<<<<<<<<<<
  *     return (self._fst.get().InputSymbols() if self._input_side
  *             else self._fst.get().OutputSymbols())
  */
 
@@ -11745,50 +12076,50 @@
   __Pyx_RefNannyDeclarations
   fst::SymbolTable const *__pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_raw", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":978
+  /* "fstlib/cext/pywrapfst.pyx":1039
  * 
  *   cdef const_SymbolTable_ptr _raw(self):
  *     return (self._fst.get().InputSymbols() if self._input_side             # <<<<<<<<<<<<<<
  *             else self._fst.get().OutputSymbols())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_input_side");
-    __PYX_ERR(0, 978, __pyx_L1_error)
+    __PYX_ERR(0, 1039, __pyx_L1_error)
   }
   if ((__pyx_v_self->_input_side != 0)) {
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-      __PYX_ERR(0, 978, __pyx_L1_error)
+      __PYX_ERR(0, 1039, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_self->_fst.get()->InputSymbols();
   } else {
 
-    /* "fstlib/cext/pywrapfst.pyx":979
+    /* "fstlib/cext/pywrapfst.pyx":1040
  *   cdef const_SymbolTable_ptr _raw(self):
  *     return (self._fst.get().InputSymbols() if self._input_side
  *             else self._fst.get().OutputSymbols())             # <<<<<<<<<<<<<<
  * 
  * 
  */
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-      __PYX_ERR(0, 979, __pyx_L1_error)
+      __PYX_ERR(0, 1040, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_self->_fst.get()->OutputSymbols();
   }
   __pyx_r = __pyx_t_1;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":977
+  /* "fstlib/cext/pywrapfst.pyx":1038
  *             f"at 0x{id(self):x}>")
  * 
  *   cdef const_SymbolTable_ptr _raw(self):             # <<<<<<<<<<<<<<
  *     return (self._fst.get().InputSymbols() if self._input_side
  *             else self._fst.get().OutputSymbols())
  */
 
@@ -11797,15 +12128,15 @@
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst._FstSymbolTableView._raw", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":993
+/* "fstlib/cext/pywrapfst.pyx":1054
  *   """
  * 
  *   cdef const_SymbolTable_ptr _raw(self):             # <<<<<<<<<<<<<<
  *     return self._mutable_raw()
  * 
  */
 
@@ -11813,29 +12144,29 @@
   __pyx_t_6fstlib_4cext_9pywrapfst_const_SymbolTable_ptr __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_raw", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":994
+  /* "fstlib/cext/pywrapfst.pyx":1055
  * 
  *   cdef const_SymbolTable_ptr _raw(self):
  *     return self._mutable_raw()             # <<<<<<<<<<<<<<
  * 
  *   # Returns a mutable raw pointer to SymbolTable.
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mutable_raw");
-    __PYX_ERR(0, 994, __pyx_L1_error)
+    __PYX_ERR(0, 1055, __pyx_L1_error)
   }
   __pyx_r = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self->__pyx_base.__pyx_vtab)->_mutable_raw(__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":993
+  /* "fstlib/cext/pywrapfst.pyx":1054
  *   """
  * 
  *   cdef const_SymbolTable_ptr _raw(self):             # <<<<<<<<<<<<<<
  *     return self._mutable_raw()
  * 
  */
 
@@ -11844,52 +12175,52 @@
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst._MutableSymbolTable._raw", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1000
+/* "fstlib/cext/pywrapfst.pyx":1061
  *   # Should not be directly accessed except by `_mutable__raw_ptr_or_raise()`.
  *   # All other methods should use the safer _mutable__raw_ptr_or_raise() instead.
  *   cdef SymbolTable_ptr _mutable_raw(self):             # <<<<<<<<<<<<<<
  *     return NULL
  * 
  */
 
 static __pyx_t_6fstlib_4cext_9pywrapfst_SymbolTable_ptr __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable__mutable_raw(CYTHON_UNUSED struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self) {
   __pyx_t_6fstlib_4cext_9pywrapfst_SymbolTable_ptr __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_mutable_raw", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1001
+  /* "fstlib/cext/pywrapfst.pyx":1062
  *   # All other methods should use the safer _mutable__raw_ptr_or_raise() instead.
  *   cdef SymbolTable_ptr _mutable_raw(self):
  *     return NULL             # <<<<<<<<<<<<<<
  * 
  *   # Internal API method that should be used when a mutable pointer to an
  */
   __pyx_r = NULL;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1000
+  /* "fstlib/cext/pywrapfst.pyx":1061
  *   # Should not be directly accessed except by `_mutable__raw_ptr_or_raise()`.
  *   # All other methods should use the safer _mutable__raw_ptr_or_raise() instead.
  *   cdef SymbolTable_ptr _mutable_raw(self):             # <<<<<<<<<<<<<<
  *     return NULL
  * 
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1005
+/* "fstlib/cext/pywrapfst.pyx":1066
  *   # Internal API method that should be used when a mutable pointer to an
  *   # fst.SymbolTable is required.
  *   cdef SymbolTable_ptr _mutable_raw_ptr_or_raise(self) except *:             # <<<<<<<<<<<<<<
  *     cdef SymbolTable_ptr mutable_raw = self._mutable_raw()
  *     if mutable_raw == NULL:
  */
 
@@ -11899,70 +12230,70 @@
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_mutable_raw_ptr_or_raise", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1006
+  /* "fstlib/cext/pywrapfst.pyx":1067
  *   # fst.SymbolTable is required.
  *   cdef SymbolTable_ptr _mutable_raw_ptr_or_raise(self) except *:
  *     cdef SymbolTable_ptr mutable_raw = self._mutable_raw()             # <<<<<<<<<<<<<<
  *     if mutable_raw == NULL:
  *       self._raise_nonexistent()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mutable_raw");
-    __PYX_ERR(0, 1006, __pyx_L1_error)
+    __PYX_ERR(0, 1067, __pyx_L1_error)
   }
   __pyx_v_mutable_raw = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self->__pyx_base.__pyx_vtab)->_mutable_raw(__pyx_v_self);
 
-  /* "fstlib/cext/pywrapfst.pyx":1007
+  /* "fstlib/cext/pywrapfst.pyx":1068
  *   cdef SymbolTable_ptr _mutable_raw_ptr_or_raise(self) except *:
  *     cdef SymbolTable_ptr mutable_raw = self._mutable_raw()
  *     if mutable_raw == NULL:             # <<<<<<<<<<<<<<
  *       self._raise_nonexistent()
  *     return mutable_raw
  */
   __pyx_t_1 = ((__pyx_v_mutable_raw == NULL) != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1008
+    /* "fstlib/cext/pywrapfst.pyx":1069
  *     cdef SymbolTable_ptr mutable_raw = self._mutable_raw()
  *     if mutable_raw == NULL:
  *       self._raise_nonexistent()             # <<<<<<<<<<<<<<
  *     return mutable_raw
  * 
  */
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raise_nonexistent");
-      __PYX_ERR(0, 1008, __pyx_L1_error)
+      __PYX_ERR(0, 1069, __pyx_L1_error)
     }
-    ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base._raise_nonexistent(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self)); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1008, __pyx_L1_error)
+    ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base._raise_nonexistent(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self)); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1069, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1007
+    /* "fstlib/cext/pywrapfst.pyx":1068
  *   cdef SymbolTable_ptr _mutable_raw_ptr_or_raise(self) except *:
  *     cdef SymbolTable_ptr mutable_raw = self._mutable_raw()
  *     if mutable_raw == NULL:             # <<<<<<<<<<<<<<
  *       self._raise_nonexistent()
  *     return mutable_raw
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1009
+  /* "fstlib/cext/pywrapfst.pyx":1070
  *     if mutable_raw == NULL:
  *       self._raise_nonexistent()
  *     return mutable_raw             # <<<<<<<<<<<<<<
  * 
- *   cpdef int64 add_symbol(self, symbol, int64 key=fst.kNoSymbol) except *:
+ *   cpdef int64_t add_symbol(self, symbol, int64_t key=fst.kNoSymbol) except *:
  */
   __pyx_r = __pyx_v_mutable_raw;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1005
+  /* "fstlib/cext/pywrapfst.pyx":1066
  *   # Internal API method that should be used when a mutable pointer to an
  *   # fst.SymbolTable is required.
  *   cdef SymbolTable_ptr _mutable_raw_ptr_or_raise(self) except *:             # <<<<<<<<<<<<<<
  *     cdef SymbolTable_ptr mutable_raw = self._mutable_raw()
  *     if mutable_raw == NULL:
  */
 
@@ -11971,37 +12302,37 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._MutableSymbolTable._mutable_raw_ptr_or_raise", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1011
+/* "fstlib/cext/pywrapfst.pyx":1072
  *     return mutable_raw
  * 
- *   cpdef int64 add_symbol(self, symbol, int64 key=fst.kNoSymbol) except *:             # <<<<<<<<<<<<<<
+ *   cpdef int64_t add_symbol(self, symbol, int64_t key=fst.kNoSymbol) except *:             # <<<<<<<<<<<<<<
  *     """
  *     add_symbol(self, symbol, key=NO_SYMBOL)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_1add_symbol(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, PyObject *__pyx_v_symbol, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol *__pyx_optional_args) {
-  int64 __pyx_v_key = __pyx_k__6;
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, PyObject *__pyx_v_symbol, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol *__pyx_optional_args) {
+  int64_t __pyx_v_key = __pyx_k__6;
   __pyx_t_6fstlib_4cext_9pywrapfst_SymbolTable_ptr __pyx_v__mutable_raw;
   std::string __pyx_v__symbol;
-  int64 __pyx_r;
+  int64_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_t_6;
   PyObject *__pyx_t_7 = NULL;
-  int64 __pyx_t_8;
+  int64_t __pyx_t_8;
   fst::SymbolTable *__pyx_t_9;
   std::string __pyx_t_10;
   int __pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add_symbol", 0);
@@ -12015,18 +12346,18 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_symbol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1011, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_symbol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1072, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_1add_symbol)) {
-        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_key); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1011, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_key); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1072, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         __pyx_t_6 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
@@ -12036,47 +12367,47 @@
             __Pyx_DECREF_SET(__pyx_t_4, function);
             __pyx_t_6 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_symbol, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1011, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1072, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_symbol, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1011, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1072, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         {
-          __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1011, __pyx_L1_error)
+          __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1072, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           if (__pyx_t_5) {
             __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
           }
           __Pyx_INCREF(__pyx_v_symbol);
           __Pyx_GIVEREF(__pyx_v_symbol);
           PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_symbol);
           __Pyx_GIVEREF(__pyx_t_3);
           PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
           __pyx_t_3 = 0;
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1011, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1072, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         }
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_8 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_8 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1011, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_8 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1072, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_8;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -12087,83 +12418,83 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1028
+  /* "fstlib/cext/pywrapfst.pyx":1089
  *       The integer key of the new symbol.
  *     """
  *     cdef SymbolTable_ptr _mutable_raw = self._mutable_raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     cdef string _symbol = tostring(symbol)
  *     if key != fst.kNoSymbol:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mutable_raw_ptr_or_raise");
-    __PYX_ERR(0, 1028, __pyx_L1_error)
+    __PYX_ERR(0, 1089, __pyx_L1_error)
   }
-  __pyx_t_9 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self->__pyx_base.__pyx_vtab)->_mutable_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1028, __pyx_L1_error)
+  __pyx_t_9 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self->__pyx_base.__pyx_vtab)->_mutable_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1089, __pyx_L1_error)
   __pyx_v__mutable_raw = __pyx_t_9;
 
-  /* "fstlib/cext/pywrapfst.pyx":1029
+  /* "fstlib/cext/pywrapfst.pyx":1090
  *     """
  *     cdef SymbolTable_ptr _mutable_raw = self._mutable_raw_ptr_or_raise()
  *     cdef string _symbol = tostring(symbol)             # <<<<<<<<<<<<<<
  *     if key != fst.kNoSymbol:
  *       return _mutable_raw.AddSymbol(_symbol, key)
  */
-  __pyx_t_10 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_symbol); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1029, __pyx_L1_error)
+  __pyx_t_10 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_symbol); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1090, __pyx_L1_error)
   __pyx_v__symbol = __pyx_t_10;
 
-  /* "fstlib/cext/pywrapfst.pyx":1030
+  /* "fstlib/cext/pywrapfst.pyx":1091
  *     cdef SymbolTable_ptr _mutable_raw = self._mutable_raw_ptr_or_raise()
  *     cdef string _symbol = tostring(symbol)
  *     if key != fst.kNoSymbol:             # <<<<<<<<<<<<<<
  *       return _mutable_raw.AddSymbol(_symbol, key)
  *     else:
  */
   __pyx_t_11 = ((__pyx_v_key != fst::kNoSymbol) != 0);
   if (__pyx_t_11) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1031
+    /* "fstlib/cext/pywrapfst.pyx":1092
  *     cdef string _symbol = tostring(symbol)
  *     if key != fst.kNoSymbol:
  *       return _mutable_raw.AddSymbol(_symbol, key)             # <<<<<<<<<<<<<<
  *     else:
  *       return _mutable_raw.AddSymbol(_symbol)
  */
     __pyx_r = __pyx_v__mutable_raw->AddSymbol(__pyx_v__symbol, __pyx_v_key);
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":1030
+    /* "fstlib/cext/pywrapfst.pyx":1091
  *     cdef SymbolTable_ptr _mutable_raw = self._mutable_raw_ptr_or_raise()
  *     cdef string _symbol = tostring(symbol)
  *     if key != fst.kNoSymbol:             # <<<<<<<<<<<<<<
  *       return _mutable_raw.AddSymbol(_symbol, key)
  *     else:
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1033
+  /* "fstlib/cext/pywrapfst.pyx":1094
  *       return _mutable_raw.AddSymbol(_symbol, key)
  *     else:
  *       return _mutable_raw.AddSymbol(_symbol)             # <<<<<<<<<<<<<<
  * 
  *   cpdef void add_table(self, SymbolTableView symbols) except *:
  */
   /*else*/ {
     __pyx_r = __pyx_v__mutable_raw->AddSymbol(__pyx_v__symbol);
     goto __pyx_L0;
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1011
+  /* "fstlib/cext/pywrapfst.pyx":1072
  *     return mutable_raw
  * 
- *   cpdef int64 add_symbol(self, symbol, int64 key=fst.kNoSymbol) except *:             # <<<<<<<<<<<<<<
+ *   cpdef int64_t add_symbol(self, symbol, int64_t key=fst.kNoSymbol) except *:             # <<<<<<<<<<<<<<
  *     """
  *     add_symbol(self, symbol, key=NO_SYMBOL)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -12180,15 +12511,15 @@
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_1add_symbol(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol[] = "\n    add_symbol(self, symbol, key=NO_SYMBOL)\n\n    Adds a symbol to the table and returns the index.\n\n    This method adds a symbol to the table. The caller can optionally\n    specify a non-negative integer index for the key.\n\n    Args:\n      symbol: A symbol string.\n      key: An index for the symbol; if not specified, the next index will be\n          used.\n\n    Returns:\n      The integer key of the new symbol.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_1add_symbol(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_symbol = 0;
-  int64 __pyx_v_key;
+  int64_t __pyx_v_key;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("add_symbol (wrapper)", 0);
   {
@@ -12214,62 +12545,62 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_key);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_symbol") < 0)) __PYX_ERR(0, 1011, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_symbol") < 0)) __PYX_ERR(0, 1072, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_symbol = values[0];
     if (values[1]) {
-      __pyx_v_key = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_key == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1011, __pyx_L3_error)
+      __pyx_v_key = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_key == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1072, __pyx_L3_error)
     } else {
       __pyx_v_key = __pyx_k__6;
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("add_symbol", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1011, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("add_symbol", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1072, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._MutableSymbolTable.add_symbol", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self), __pyx_v_symbol, __pyx_v_key);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, PyObject *__pyx_v_symbol, int64 __pyx_v_key) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *__pyx_v_self, PyObject *__pyx_v_symbol, int64_t __pyx_v_key) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  int64 __pyx_t_1;
+  int64_t __pyx_t_1;
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add_symbol", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.key = __pyx_v_key;
-  __pyx_t_1 = __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableSymbolTable->add_symbol(__pyx_v_self, __pyx_v_symbol, 1, &__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1011, __pyx_L1_error)
-  __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1011, __pyx_L1_error)
+  __pyx_t_1 = __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableSymbolTable->add_symbol(__pyx_v_self, __pyx_v_symbol, 1, &__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1072, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1072, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -12278,15 +12609,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1035
+/* "fstlib/cext/pywrapfst.pyx":1096
  *       return _mutable_raw.AddSymbol(_symbol)
  * 
  *   cpdef void add_table(self, SymbolTableView symbols) except *:             # <<<<<<<<<<<<<<
  *     """
  *     add_table(self, symbols)
  */
 
@@ -12308,15 +12639,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_table); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1035, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_table); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1096, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_3add_table)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -12324,15 +12655,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_symbols)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_symbols));
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1035, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1096, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -12344,50 +12675,50 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1047
+  /* "fstlib/cext/pywrapfst.pyx":1108
  *       symbols: A SymbolTable to be merged with the current table.
  *     """
  *     self._mutable_raw_ptr_or_raise().AddTable(             # <<<<<<<<<<<<<<
  *         deref(symbols._raw_ptr_or_raise()))
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mutable_raw_ptr_or_raise");
-    __PYX_ERR(0, 1047, __pyx_L1_error)
+    __PYX_ERR(0, 1108, __pyx_L1_error)
   }
-  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self->__pyx_base.__pyx_vtab)->_mutable_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1047, __pyx_L1_error)
+  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self->__pyx_base.__pyx_vtab)->_mutable_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1108, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1048
+  /* "fstlib/cext/pywrapfst.pyx":1109
  *     """
  *     self._mutable_raw_ptr_or_raise().AddTable(
  *         deref(symbols._raw_ptr_or_raise()))             # <<<<<<<<<<<<<<
  * 
  *   cpdef void set_name(self, new_name) except *:
  */
   if (unlikely(((PyObject *)__pyx_v_symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 1048, __pyx_L1_error)
+    __PYX_ERR(0, 1109, __pyx_L1_error)
   }
-  __pyx_t_6 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1048, __pyx_L1_error)
+  __pyx_t_6 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1109, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1047
+  /* "fstlib/cext/pywrapfst.pyx":1108
  *       symbols: A SymbolTable to be merged with the current table.
  *     """
  *     self._mutable_raw_ptr_or_raise().AddTable(             # <<<<<<<<<<<<<<
  *         deref(symbols._raw_ptr_or_raise()))
  * 
  */
   __pyx_t_5->AddTable((*__pyx_t_6));
 
-  /* "fstlib/cext/pywrapfst.pyx":1035
+  /* "fstlib/cext/pywrapfst.pyx":1096
  *       return _mutable_raw.AddSymbol(_symbol)
  * 
  *   cpdef void add_table(self, SymbolTableView symbols) except *:             # <<<<<<<<<<<<<<
  *     """
  *     add_table(self, symbols)
  */
 
@@ -12409,15 +12740,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_3add_table(PyObject *__pyx_v_self, PyObject *__pyx_v_symbols) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("add_table (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 1035, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 1096, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_2add_table(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -12430,16 +12761,16 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add_table", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_table(__pyx_v_self, __pyx_v_symbols, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1035, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1035, __pyx_L1_error)
+  __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_table(__pyx_v_self, __pyx_v_symbols, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1096, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1096, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -12448,15 +12779,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1050
+/* "fstlib/cext/pywrapfst.pyx":1111
  *         deref(symbols._raw_ptr_or_raise()))
  * 
  *   cpdef void set_name(self, new_name) except *:             # <<<<<<<<<<<<<<
  *     self._mutable_raw_ptr_or_raise().SetName(tostring(new_name))
  * 
  */
 
@@ -12478,15 +12809,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1050, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1111, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_5set_name)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -12494,15 +12825,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_new_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_new_name);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1050, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1111, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -12514,30 +12845,30 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1051
+  /* "fstlib/cext/pywrapfst.pyx":1112
  * 
  *   cpdef void set_name(self, new_name) except *:
  *     self._mutable_raw_ptr_or_raise().SetName(tostring(new_name))             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mutable_raw_ptr_or_raise");
-    __PYX_ERR(0, 1051, __pyx_L1_error)
+    __PYX_ERR(0, 1112, __pyx_L1_error)
   }
-  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self->__pyx_base.__pyx_vtab)->_mutable_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1051, __pyx_L1_error)
-  __pyx_t_6 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_new_name); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1051, __pyx_L1_error)
+  __pyx_t_5 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableSymbolTable *)__pyx_v_self->__pyx_base.__pyx_vtab)->_mutable_raw_ptr_or_raise(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1112, __pyx_L1_error)
+  __pyx_t_6 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_new_name); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1112, __pyx_L1_error)
   __pyx_t_5->SetName(__pyx_t_6);
 
-  /* "fstlib/cext/pywrapfst.pyx":1050
+  /* "fstlib/cext/pywrapfst.pyx":1111
  *         deref(symbols._raw_ptr_or_raise()))
  * 
  *   cpdef void set_name(self, new_name) except *:             # <<<<<<<<<<<<<<
  *     self._mutable_raw_ptr_or_raise().SetName(tostring(new_name))
  * 
  */
 
@@ -12571,16 +12902,16 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_name", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_set_name(__pyx_v_self, __pyx_v_new_name, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1050, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1050, __pyx_L1_error)
+  __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_set_name(__pyx_v_self, __pyx_v_new_name, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1111, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1111, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -12589,15 +12920,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1061
+/* "fstlib/cext/pywrapfst.pyx":1122
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<Fst SymbolTableView {self.name()!r} at 0x{id(self):x}>"
  * 
  */
 
@@ -12624,71 +12955,71 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1062
+  /* "fstlib/cext/pywrapfst.pyx":1123
  * 
  *   def __repr__(self):
  *     return f"<Fst SymbolTableView {self.name()!r} at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
  *   cdef SymbolTable_ptr _mutable_raw(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1062, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1123, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_Fst_SymbolTableView);
   __pyx_t_2 += 21;
   __Pyx_GIVEREF(__pyx_kp_u_Fst_SymbolTableView);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Fst_SymbolTableView);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "name");
-    __PYX_ERR(0, 1062, __pyx_L1_error)
+    __PYX_ERR(0, 1123, __pyx_L1_error)
   }
-  __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.__pyx_base.name(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self), 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1062, __pyx_L1_error)
-  __pyx_t_5 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1062, __pyx_L1_error)
+  __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.__pyx_base.name(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self), 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1123, __pyx_L1_error)
+  __pyx_t_5 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1123, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_5), __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1062, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_5), __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1123, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_6);
   __pyx_t_6 = 0;
   __Pyx_INCREF(__pyx_kp_u_at_0x);
   __pyx_t_2 += 6;
   __Pyx_GIVEREF(__pyx_kp_u_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_at_0x);
-  __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1062, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1123, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_6, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1062, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_6, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1123, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1062, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1123, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1061
+  /* "fstlib/cext/pywrapfst.pyx":1122
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<Fst SymbolTableView {self.name()!r} at 0x{id(self):x}>"
  * 
  */
 
@@ -12701,15 +13032,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1064
+/* "fstlib/cext/pywrapfst.pyx":1125
  *     return f"<Fst SymbolTableView {self.name()!r} at 0x{id(self):x}>"
  * 
  *   cdef SymbolTable_ptr _mutable_raw(self):             # <<<<<<<<<<<<<<
  *     return (self._mfst.get().MutableInputSymbols() if self._input_side else
  *             self._mfst.get().MutableOutputSymbols())
  */
 
@@ -12718,50 +13049,50 @@
   __Pyx_RefNannyDeclarations
   fst::SymbolTable *__pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_mutable_raw", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1065
+  /* "fstlib/cext/pywrapfst.pyx":1126
  * 
  *   cdef SymbolTable_ptr _mutable_raw(self):
  *     return (self._mfst.get().MutableInputSymbols() if self._input_side else             # <<<<<<<<<<<<<<
  *             self._mfst.get().MutableOutputSymbols())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_input_side");
-    __PYX_ERR(0, 1065, __pyx_L1_error)
+    __PYX_ERR(0, 1126, __pyx_L1_error)
   }
   if ((__pyx_v_self->_input_side != 0)) {
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-      __PYX_ERR(0, 1065, __pyx_L1_error)
+      __PYX_ERR(0, 1126, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_self->_mfst.get()->MutableInputSymbols();
   } else {
 
-    /* "fstlib/cext/pywrapfst.pyx":1066
+    /* "fstlib/cext/pywrapfst.pyx":1127
  *   cdef SymbolTable_ptr _mutable_raw(self):
  *     return (self._mfst.get().MutableInputSymbols() if self._input_side else
  *             self._mfst.get().MutableOutputSymbols())             # <<<<<<<<<<<<<<
  * 
  * 
  */
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-      __PYX_ERR(0, 1066, __pyx_L1_error)
+      __PYX_ERR(0, 1127, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_self->_mfst.get()->MutableOutputSymbols();
   }
   __pyx_r = __pyx_t_1;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1064
+  /* "fstlib/cext/pywrapfst.pyx":1125
  *     return f"<Fst SymbolTableView {self.name()!r} at 0x{id(self):x}>"
  * 
  *   cdef SymbolTable_ptr _mutable_raw(self):             # <<<<<<<<<<<<<<
  *     return (self._mfst.get().MutableInputSymbols() if self._input_side else
  *             self._mfst.get().MutableOutputSymbols())
  */
 
@@ -12770,15 +13101,15 @@
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst._MutableFstSymbolTableView._mutable_raw", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1086
+/* "fstlib/cext/pywrapfst.pyx":1147
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<SymbolTable {self.name()!r} at 0x{id(self):x}>"
  * 
  */
 
@@ -12805,71 +13136,71 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1087
+  /* "fstlib/cext/pywrapfst.pyx":1148
  * 
  *   def __repr__(self):
  *     return f"<SymbolTable {self.name()!r} at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
  *   def __init__(self, name="<unspecified>"):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1087, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_SymbolTable);
   __pyx_t_2 += 13;
   __Pyx_GIVEREF(__pyx_kp_u_SymbolTable);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_SymbolTable);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "name");
-    __PYX_ERR(0, 1087, __pyx_L1_error)
+    __PYX_ERR(0, 1148, __pyx_L1_error)
   }
-  __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.__pyx_base.name(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self), 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1087, __pyx_L1_error)
-  __pyx_t_5 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1087, __pyx_L1_error)
+  __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_v_self->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.__pyx_base.name(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self), 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1148, __pyx_L1_error)
+  __pyx_t_5 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_5), __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1087, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_5), __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_6);
   __pyx_t_6 = 0;
   __Pyx_INCREF(__pyx_kp_u_at_0x);
   __pyx_t_2 += 6;
   __Pyx_GIVEREF(__pyx_kp_u_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_at_0x);
-  __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1087, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_6, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1087, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_6, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1087, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1086
+  /* "fstlib/cext/pywrapfst.pyx":1147
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<SymbolTable {self.name()!r} at 0x{id(self):x}>"
  * 
  */
 
@@ -12882,15 +13213,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1089
+/* "fstlib/cext/pywrapfst.pyx":1150
  *     return f"<SymbolTable {self.name()!r} at 0x{id(self):x}>"
  * 
  *   def __init__(self, name="<unspecified>"):             # <<<<<<<<<<<<<<
  *     self._smart_table.reset(new fst.SymbolTable(tostring(name)))
  * 
  */
 
@@ -12922,29 +13253,29 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name_2);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1089, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1150, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_name = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1089, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1150, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.SymbolTable.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_11SymbolTable_2__init__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_v_self), __pyx_v_name);
 
@@ -12958,29 +13289,29 @@
   __Pyx_RefNannyDeclarations
   std::string __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1090
+  /* "fstlib/cext/pywrapfst.pyx":1151
  * 
  *   def __init__(self, name="<unspecified>"):
  *     self._smart_table.reset(new fst.SymbolTable(tostring(name)))             # <<<<<<<<<<<<<<
  * 
  *   cdef SymbolTable_ptr _mutable_raw(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_smart_table");
-    __PYX_ERR(0, 1090, __pyx_L1_error)
+    __PYX_ERR(0, 1151, __pyx_L1_error)
   }
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_name); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1090, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_name); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1151, __pyx_L1_error)
   __pyx_v_self->_smart_table.reset(new fst::SymbolTable(__pyx_t_1));
 
-  /* "fstlib/cext/pywrapfst.pyx":1089
+  /* "fstlib/cext/pywrapfst.pyx":1150
  *     return f"<SymbolTable {self.name()!r} at 0x{id(self):x}>"
  * 
  *   def __init__(self, name="<unspecified>"):             # <<<<<<<<<<<<<<
  *     self._smart_table.reset(new fst.SymbolTable(tostring(name)))
  * 
  */
 
@@ -12991,15 +13322,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.SymbolTable.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1092
+/* "fstlib/cext/pywrapfst.pyx":1153
  *     self._smart_table.reset(new fst.SymbolTable(tostring(name)))
  * 
  *   cdef SymbolTable_ptr _mutable_raw(self):             # <<<<<<<<<<<<<<
  *     return self._smart_table.get()
  * 
  */
 
@@ -13007,29 +13338,29 @@
   __pyx_t_6fstlib_4cext_9pywrapfst_SymbolTable_ptr __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_mutable_raw", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1093
+  /* "fstlib/cext/pywrapfst.pyx":1154
  * 
  *   cdef SymbolTable_ptr _mutable_raw(self):
  *     return self._smart_table.get()             # <<<<<<<<<<<<<<
  * 
  *   @classmethod
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_smart_table");
-    __PYX_ERR(0, 1093, __pyx_L1_error)
+    __PYX_ERR(0, 1154, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_smart_table.get();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1092
+  /* "fstlib/cext/pywrapfst.pyx":1153
  *     self._smart_table.reset(new fst.SymbolTable(tostring(name)))
  * 
  *   cdef SymbolTable_ptr _mutable_raw(self):             # <<<<<<<<<<<<<<
  *     return self._smart_table.get()
  * 
  */
 
@@ -13038,15 +13369,15 @@
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst.SymbolTable._mutable_raw", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1096
+/* "fstlib/cext/pywrapfst.pyx":1157
  * 
  *   @classmethod
  *   def read(cls, source):             # <<<<<<<<<<<<<<
  *     """
  *     SymbolTable.read(source)
  */
 
@@ -13075,46 +13406,46 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1111
+  /* "fstlib/cext/pywrapfst.pyx":1172
  *     """
  *     cdef unique_ptr[fst.SymbolTable] _symbols
  *     _symbols.reset(fst.SymbolTable.Read(path_tostring(source)))             # <<<<<<<<<<<<<<
  *     if _symbols.get() == NULL:
  *       raise FstIOError(f"Read failed: {source!r}")
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1111, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1172, __pyx_L1_error)
   __pyx_v__symbols.reset(fst::SymbolTable::Read(__pyx_t_1));
 
-  /* "fstlib/cext/pywrapfst.pyx":1112
+  /* "fstlib/cext/pywrapfst.pyx":1173
  *     cdef unique_ptr[fst.SymbolTable] _symbols
  *     _symbols.reset(fst.SymbolTable.Read(path_tostring(source)))
  *     if _symbols.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Read failed: {source!r}")
  *     return _init_SymbolTable(move(_symbols))
  */
   __pyx_t_2 = ((__pyx_v__symbols.get() == NULL) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1113
+    /* "fstlib/cext/pywrapfst.pyx":1174
  *     _symbols.reset(fst.SymbolTable.Read(path_tostring(source)))
  *     if _symbols.get() == NULL:
  *       raise FstIOError(f"Read failed: {source!r}")             # <<<<<<<<<<<<<<
  *     return _init_SymbolTable(move(_symbols))
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1113, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1174, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1113, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1174, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_failed, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1113, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_failed, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1174, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -13122,45 +13453,45 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1113, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1174, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 1113, __pyx_L1_error)
+    __PYX_ERR(0, 1174, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1112
+    /* "fstlib/cext/pywrapfst.pyx":1173
  *     cdef unique_ptr[fst.SymbolTable] _symbols
  *     _symbols.reset(fst.SymbolTable.Read(path_tostring(source)))
  *     if _symbols.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Read failed: {source!r}")
  *     return _init_SymbolTable(move(_symbols))
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1114
+  /* "fstlib/cext/pywrapfst.pyx":1175
  *     if _symbols.get() == NULL:
  *       raise FstIOError(f"Read failed: {source!r}")
  *     return _init_SymbolTable(move(_symbols))             # <<<<<<<<<<<<<<
  * 
  *   @classmethod
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(fst::move<std::unique_ptr<fst::SymbolTable> >(__pyx_v__symbols))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1114, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(cython_std::move<std::unique_ptr<fst::SymbolTable> >(__pyx_v__symbols))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1175, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1096
+  /* "fstlib/cext/pywrapfst.pyx":1157
  * 
  *   @classmethod
  *   def read(cls, source):             # <<<<<<<<<<<<<<
  *     """
  *     SymbolTable.read(source)
  */
 
@@ -13174,15 +13505,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1117
+/* "fstlib/cext/pywrapfst.pyx":1178
  * 
  *   @classmethod
  *   def read_text(cls, source, bool allow_negative_labels=False):             # <<<<<<<<<<<<<<
  *     """
  *     SymbolTable.read_text(source)
  */
 
@@ -13221,35 +13552,35 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_allow_negative_labels);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_text") < 0)) __PYX_ERR(0, 1117, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_text") < 0)) __PYX_ERR(0, 1178, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_source = values[0];
     if (values[1]) {
-      __pyx_v_allow_negative_labels = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_allow_negative_labels == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1117, __pyx_L3_error)
+      __pyx_v_allow_negative_labels = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_allow_negative_labels == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1178, __pyx_L3_error)
     } else {
       __pyx_v_allow_negative_labels = ((bool)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("read_text", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1117, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("read_text", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1178, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.SymbolTable.read_text", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_11SymbolTable_6read_text(((PyTypeObject*)__pyx_v_cls), __pyx_v_source, __pyx_v_allow_negative_labels);
 
@@ -13270,63 +13601,63 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read_text", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1134
+  /* "fstlib/cext/pywrapfst.pyx":1195
  *     """
  *     cdef unique_ptr[fst.SymbolTableTextOptions] _opts
  *     _opts.reset(new fst.SymbolTableTextOptions(allow_negative_labels))             # <<<<<<<<<<<<<<
  *     cdef unique_ptr[fst.SymbolTable] _symbols
  *     _symbols.reset(fst.SymbolTable.ReadText(path_tostring(source),
  */
   __pyx_v__opts.reset(new fst::SymbolTableTextOptions(__pyx_v_allow_negative_labels));
 
-  /* "fstlib/cext/pywrapfst.pyx":1136
+  /* "fstlib/cext/pywrapfst.pyx":1197
  *     _opts.reset(new fst.SymbolTableTextOptions(allow_negative_labels))
  *     cdef unique_ptr[fst.SymbolTable] _symbols
  *     _symbols.reset(fst.SymbolTable.ReadText(path_tostring(source),             # <<<<<<<<<<<<<<
  *                                             deref(_opts)))
  *     if _symbols.get() == NULL:
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1136, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1197, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1137
+  /* "fstlib/cext/pywrapfst.pyx":1198
  *     cdef unique_ptr[fst.SymbolTable] _symbols
  *     _symbols.reset(fst.SymbolTable.ReadText(path_tostring(source),
  *                                             deref(_opts)))             # <<<<<<<<<<<<<<
  *     if _symbols.get() == NULL:
  *       raise FstIOError(f"Read failed: {source!r}")
  */
   __pyx_v__symbols.reset(fst::SymbolTable::ReadText(__pyx_t_1, (*__pyx_v__opts)));
 
-  /* "fstlib/cext/pywrapfst.pyx":1138
+  /* "fstlib/cext/pywrapfst.pyx":1199
  *     _symbols.reset(fst.SymbolTable.ReadText(path_tostring(source),
  *                                             deref(_opts)))
  *     if _symbols.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Read failed: {source!r}")
  *     return _init_SymbolTable(move(_symbols))
  */
   __pyx_t_2 = ((__pyx_v__symbols.get() == NULL) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1139
+    /* "fstlib/cext/pywrapfst.pyx":1200
  *                                             deref(_opts)))
  *     if _symbols.get() == NULL:
  *       raise FstIOError(f"Read failed: {source!r}")             # <<<<<<<<<<<<<<
  *     return _init_SymbolTable(move(_symbols))
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1139, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1200, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1139, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1200, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_failed, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1139, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_failed, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1200, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -13334,45 +13665,45 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1139, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1200, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 1139, __pyx_L1_error)
+    __PYX_ERR(0, 1200, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1138
+    /* "fstlib/cext/pywrapfst.pyx":1199
  *     _symbols.reset(fst.SymbolTable.ReadText(path_tostring(source),
  *                                             deref(_opts)))
  *     if _symbols.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Read failed: {source!r}")
  *     return _init_SymbolTable(move(_symbols))
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1140
+  /* "fstlib/cext/pywrapfst.pyx":1201
  *     if _symbols.get() == NULL:
  *       raise FstIOError(f"Read failed: {source!r}")
  *     return _init_SymbolTable(move(_symbols))             # <<<<<<<<<<<<<<
  * 
  *   @classmethod
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(fst::move<std::unique_ptr<fst::SymbolTable> >(__pyx_v__symbols))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1140, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(cython_std::move<std::unique_ptr<fst::SymbolTable> >(__pyx_v__symbols))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1201, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1117
+  /* "fstlib/cext/pywrapfst.pyx":1178
  * 
  *   @classmethod
  *   def read_text(cls, source, bool allow_negative_labels=False):             # <<<<<<<<<<<<<<
  *     """
  *     SymbolTable.read_text(source)
  */
 
@@ -13386,15 +13717,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1143
+/* "fstlib/cext/pywrapfst.pyx":1204
  * 
  *   @classmethod
  *   def read_fst(cls, source, bool input_table):             # <<<<<<<<<<<<<<
  *     """
  *     SymbolTable.read_fst(source, input_table)
  */
 
@@ -13429,32 +13760,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_source)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_input_table)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("read_fst", 1, 2, 2, 1); __PYX_ERR(0, 1143, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("read_fst", 1, 2, 2, 1); __PYX_ERR(0, 1204, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_fst") < 0)) __PYX_ERR(0, 1143, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_fst") < 0)) __PYX_ERR(0, 1204, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_source = values[0];
-    __pyx_v_input_table = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_input_table == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1143, __pyx_L3_error)
+    __pyx_v_input_table = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_input_table == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1204, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("read_fst", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1143, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("read_fst", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1204, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.SymbolTable.read_fst", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_11SymbolTable_8read_fst(((PyTypeObject*)__pyx_v_cls), __pyx_v_source, __pyx_v_input_table);
 
@@ -13474,46 +13805,46 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read_fst", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1164
+  /* "fstlib/cext/pywrapfst.pyx":1225
  *     """
  *     cdef unique_ptr[fst.SymbolTable] _symbols
  *     _symbols.reset(fst.FstReadSymbols(path_tostring(source), input_table))             # <<<<<<<<<<<<<<
  *     if _symbols.get() == NULL:
  *       raise FstIOError(f"Read from FST failed: {source!r}")
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1164, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1225, __pyx_L1_error)
   __pyx_v__symbols.reset(fst::FstReadSymbols(__pyx_t_1, __pyx_v_input_table));
 
-  /* "fstlib/cext/pywrapfst.pyx":1165
+  /* "fstlib/cext/pywrapfst.pyx":1226
  *     cdef unique_ptr[fst.SymbolTable] _symbols
  *     _symbols.reset(fst.FstReadSymbols(path_tostring(source), input_table))
  *     if _symbols.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Read from FST failed: {source!r}")
  *     return _init_SymbolTable(move(_symbols))
  */
   __pyx_t_2 = ((__pyx_v__symbols.get() == NULL) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1166
+    /* "fstlib/cext/pywrapfst.pyx":1227
  *     _symbols.reset(fst.FstReadSymbols(path_tostring(source), input_table))
  *     if _symbols.get() == NULL:
  *       raise FstIOError(f"Read from FST failed: {source!r}")             # <<<<<<<<<<<<<<
  *     return _init_SymbolTable(move(_symbols))
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1166, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1227, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1166, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1227, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_from_FST_failed, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1166, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_from_FST_failed, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1227, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -13521,45 +13852,45 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1166, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1227, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 1166, __pyx_L1_error)
+    __PYX_ERR(0, 1227, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1165
+    /* "fstlib/cext/pywrapfst.pyx":1226
  *     cdef unique_ptr[fst.SymbolTable] _symbols
  *     _symbols.reset(fst.FstReadSymbols(path_tostring(source), input_table))
  *     if _symbols.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Read from FST failed: {source!r}")
  *     return _init_SymbolTable(move(_symbols))
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1167
+  /* "fstlib/cext/pywrapfst.pyx":1228
  *     if _symbols.get() == NULL:
  *       raise FstIOError(f"Read from FST failed: {source!r}")
  *     return _init_SymbolTable(move(_symbols))             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(fst::move<std::unique_ptr<fst::SymbolTable> >(__pyx_v__symbols))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1167, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(cython_std::move<std::unique_ptr<fst::SymbolTable> >(__pyx_v__symbols))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1228, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1143
+  /* "fstlib/cext/pywrapfst.pyx":1204
  * 
  *   @classmethod
  *   def read_fst(cls, source, bool input_table):             # <<<<<<<<<<<<<<
  *     """
  *     SymbolTable.read_fst(source, input_table)
  */
 
@@ -13573,15 +13904,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1170
+/* "fstlib/cext/pywrapfst.pyx":1231
  * 
  * 
  * cdef _EncodeMapperSymbolTableView _init_EncodeMapperSymbolTableView(             # <<<<<<<<<<<<<<
  *     shared_ptr[fst.EncodeMapperClass] mapper, bool input_side):
  *   cdef _EncodeMapperSymbolTableView _symbols = (
  */
 
@@ -13591,65 +13922,65 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_init_EncodeMapperSymbolTableView", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1173
+  /* "fstlib/cext/pywrapfst.pyx":1234
  *     shared_ptr[fst.EncodeMapperClass] mapper, bool input_side):
  *   cdef _EncodeMapperSymbolTableView _symbols = (
  *       _EncodeMapperSymbolTableView.__new__(_EncodeMapperSymbolTableView))             # <<<<<<<<<<<<<<
  *   _symbols._mapper = move(mapper)
  *   _symbols._input_side = input_side
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1173, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1234, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__symbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1174
+  /* "fstlib/cext/pywrapfst.pyx":1235
  *   cdef _EncodeMapperSymbolTableView _symbols = (
  *       _EncodeMapperSymbolTableView.__new__(_EncodeMapperSymbolTableView))
  *   _symbols._mapper = move(mapper)             # <<<<<<<<<<<<<<
  *   _symbols._input_side = input_side
  *   return _symbols
  */
   if (unlikely(((PyObject *)__pyx_v__symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1174, __pyx_L1_error)
+    __PYX_ERR(0, 1235, __pyx_L1_error)
   }
-  __pyx_v__symbols->_mapper = fst::move<std::shared_ptr<fst::script::EncodeMapperClass> >(__pyx_v_mapper);
+  __pyx_v__symbols->_mapper = cython_std::move<std::shared_ptr<fst::script::EncodeMapperClass> >(__pyx_v_mapper);
 
-  /* "fstlib/cext/pywrapfst.pyx":1175
+  /* "fstlib/cext/pywrapfst.pyx":1236
  *       _EncodeMapperSymbolTableView.__new__(_EncodeMapperSymbolTableView))
  *   _symbols._mapper = move(mapper)
  *   _symbols._input_side = input_side             # <<<<<<<<<<<<<<
  *   return _symbols
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_input_side");
-    __PYX_ERR(0, 1175, __pyx_L1_error)
+    __PYX_ERR(0, 1236, __pyx_L1_error)
   }
   __pyx_v__symbols->_input_side = __pyx_v_input_side;
 
-  /* "fstlib/cext/pywrapfst.pyx":1176
+  /* "fstlib/cext/pywrapfst.pyx":1237
  *   _symbols._mapper = move(mapper)
  *   _symbols._input_side = input_side
  *   return _symbols             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__symbols));
   __pyx_r = __pyx_v__symbols;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1170
+  /* "fstlib/cext/pywrapfst.pyx":1231
  * 
  * 
  * cdef _EncodeMapperSymbolTableView _init_EncodeMapperSymbolTableView(             # <<<<<<<<<<<<<<
  *     shared_ptr[fst.EncodeMapperClass] mapper, bool input_side):
  *   cdef _EncodeMapperSymbolTableView _symbols = (
  */
 
@@ -13661,15 +13992,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__symbols);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1179
+/* "fstlib/cext/pywrapfst.pyx":1240
  * 
  * 
  * cdef _FstSymbolTableView _init_FstSymbolTableView(shared_ptr[fst.FstClass] ifst,             # <<<<<<<<<<<<<<
  *                                                   bool input_side):
  *   cdef _FstSymbolTableView _symbols = (
  */
 
@@ -13679,65 +14010,65 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_init_FstSymbolTableView", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1182
+  /* "fstlib/cext/pywrapfst.pyx":1243
  *                                                   bool input_side):
  *   cdef _FstSymbolTableView _symbols = (
  *       _FstSymbolTableView.__new__(_FstSymbolTableView))             # <<<<<<<<<<<<<<
  *   _symbols._fst = move(ifst)
  *   _symbols._input_side = input_side
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst__FstSymbolTableView(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__FstSymbolTableView), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1182, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst__FstSymbolTableView(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__FstSymbolTableView), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1243, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__symbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1183
+  /* "fstlib/cext/pywrapfst.pyx":1244
  *   cdef _FstSymbolTableView _symbols = (
  *       _FstSymbolTableView.__new__(_FstSymbolTableView))
  *   _symbols._fst = move(ifst)             # <<<<<<<<<<<<<<
  *   _symbols._input_side = input_side
  *   return _symbols
  */
   if (unlikely(((PyObject *)__pyx_v__symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1183, __pyx_L1_error)
+    __PYX_ERR(0, 1244, __pyx_L1_error)
   }
-  __pyx_v__symbols->_fst = fst::move<std::shared_ptr<fst::script::FstClass> >(__pyx_v_ifst);
+  __pyx_v__symbols->_fst = cython_std::move<std::shared_ptr<fst::script::FstClass> >(__pyx_v_ifst);
 
-  /* "fstlib/cext/pywrapfst.pyx":1184
+  /* "fstlib/cext/pywrapfst.pyx":1245
  *       _FstSymbolTableView.__new__(_FstSymbolTableView))
  *   _symbols._fst = move(ifst)
  *   _symbols._input_side = input_side             # <<<<<<<<<<<<<<
  *   return _symbols
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_input_side");
-    __PYX_ERR(0, 1184, __pyx_L1_error)
+    __PYX_ERR(0, 1245, __pyx_L1_error)
   }
   __pyx_v__symbols->_input_side = __pyx_v_input_side;
 
-  /* "fstlib/cext/pywrapfst.pyx":1185
+  /* "fstlib/cext/pywrapfst.pyx":1246
  *   _symbols._fst = move(ifst)
  *   _symbols._input_side = input_side
  *   return _symbols             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__symbols));
   __pyx_r = __pyx_v__symbols;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1179
+  /* "fstlib/cext/pywrapfst.pyx":1240
  * 
  * 
  * cdef _FstSymbolTableView _init_FstSymbolTableView(shared_ptr[fst.FstClass] ifst,             # <<<<<<<<<<<<<<
  *                                                   bool input_side):
  *   cdef _FstSymbolTableView _symbols = (
  */
 
@@ -13749,15 +14080,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__symbols);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1188
+/* "fstlib/cext/pywrapfst.pyx":1249
  * 
  * 
  * cdef _MutableFstSymbolTableView _init_MutableFstSymbolTableView(             # <<<<<<<<<<<<<<
  *                                     shared_ptr[fst.MutableFstClass] ifst,
  *                                     bool input_side):
  */
 
@@ -13767,65 +14098,65 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_init_MutableFstSymbolTableView", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1192
+  /* "fstlib/cext/pywrapfst.pyx":1253
  *                                     bool input_side):
  *   cdef _MutableFstSymbolTableView _symbols = (
  *       _MutableFstSymbolTableView.__new__(_MutableFstSymbolTableView))             # <<<<<<<<<<<<<<
  *   _symbols._mfst = move(ifst)
  *   _symbols._input_side = input_side
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1192, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1253, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__symbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1193
+  /* "fstlib/cext/pywrapfst.pyx":1254
  *   cdef _MutableFstSymbolTableView _symbols = (
  *       _MutableFstSymbolTableView.__new__(_MutableFstSymbolTableView))
  *   _symbols._mfst = move(ifst)             # <<<<<<<<<<<<<<
  *   _symbols._input_side = input_side
  *   return _symbols
  */
   if (unlikely(((PyObject *)__pyx_v__symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 1193, __pyx_L1_error)
+    __PYX_ERR(0, 1254, __pyx_L1_error)
   }
-  __pyx_v__symbols->_mfst = fst::move<std::shared_ptr<fst::script::MutableFstClass> >(__pyx_v_ifst);
+  __pyx_v__symbols->_mfst = cython_std::move<std::shared_ptr<fst::script::MutableFstClass> >(__pyx_v_ifst);
 
-  /* "fstlib/cext/pywrapfst.pyx":1194
+  /* "fstlib/cext/pywrapfst.pyx":1255
  *       _MutableFstSymbolTableView.__new__(_MutableFstSymbolTableView))
  *   _symbols._mfst = move(ifst)
  *   _symbols._input_side = input_side             # <<<<<<<<<<<<<<
  *   return _symbols
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_input_side");
-    __PYX_ERR(0, 1194, __pyx_L1_error)
+    __PYX_ERR(0, 1255, __pyx_L1_error)
   }
   __pyx_v__symbols->_input_side = __pyx_v_input_side;
 
-  /* "fstlib/cext/pywrapfst.pyx":1195
+  /* "fstlib/cext/pywrapfst.pyx":1256
  *   _symbols._mfst = move(ifst)
  *   _symbols._input_side = input_side
  *   return _symbols             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__symbols));
   __pyx_r = __pyx_v__symbols;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1188
+  /* "fstlib/cext/pywrapfst.pyx":1249
  * 
  * 
  * cdef _MutableFstSymbolTableView _init_MutableFstSymbolTableView(             # <<<<<<<<<<<<<<
  *                                     shared_ptr[fst.MutableFstClass] ifst,
  *                                     bool input_side):
  */
 
@@ -13837,15 +14168,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__symbols);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1198
+/* "fstlib/cext/pywrapfst.pyx":1259
  * 
  * 
  * cdef SymbolTable _init_SymbolTable(unique_ptr[fst.SymbolTable] symbols):             # <<<<<<<<<<<<<<
  *   cdef SymbolTable _symbols = SymbolTable.__new__(SymbolTable)
  *   _symbols._smart_table = move(symbols)
  */
 
@@ -13855,52 +14186,52 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_init_SymbolTable", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1199
+  /* "fstlib/cext/pywrapfst.pyx":1260
  * 
  * cdef SymbolTable _init_SymbolTable(unique_ptr[fst.SymbolTable] symbols):
  *   cdef SymbolTable _symbols = SymbolTable.__new__(SymbolTable)             # <<<<<<<<<<<<<<
  *   _symbols._smart_table = move(symbols)
  *   return _symbols
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_SymbolTable(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1199, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_SymbolTable(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1260, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__symbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1200
+  /* "fstlib/cext/pywrapfst.pyx":1261
  * cdef SymbolTable _init_SymbolTable(unique_ptr[fst.SymbolTable] symbols):
  *   cdef SymbolTable _symbols = SymbolTable.__new__(SymbolTable)
  *   _symbols._smart_table = move(symbols)             # <<<<<<<<<<<<<<
  *   return _symbols
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_smart_table");
-    __PYX_ERR(0, 1200, __pyx_L1_error)
+    __PYX_ERR(0, 1261, __pyx_L1_error)
   }
-  __pyx_v__symbols->_smart_table = fst::move<std::unique_ptr<fst::SymbolTable> >(__pyx_v_symbols);
+  __pyx_v__symbols->_smart_table = cython_std::move<std::unique_ptr<fst::SymbolTable> >(__pyx_v_symbols);
 
-  /* "fstlib/cext/pywrapfst.pyx":1201
+  /* "fstlib/cext/pywrapfst.pyx":1262
  *   cdef SymbolTable _symbols = SymbolTable.__new__(SymbolTable)
  *   _symbols._smart_table = move(symbols)
  *   return _symbols             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__symbols));
   __pyx_r = __pyx_v__symbols;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1198
+  /* "fstlib/cext/pywrapfst.pyx":1259
  * 
  * 
  * cdef SymbolTable _init_SymbolTable(unique_ptr[fst.SymbolTable] symbols):             # <<<<<<<<<<<<<<
  *   cdef SymbolTable _symbols = SymbolTable.__new__(SymbolTable)
  *   _symbols._smart_table = move(symbols)
  */
 
@@ -13912,15 +14243,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__symbols);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1204
+/* "fstlib/cext/pywrapfst.pyx":1265
  * 
  * 
  * cpdef SymbolTable _read_SymbolTable_from_string(string state):             # <<<<<<<<<<<<<<
  *   cdef stringstream _sstrm
  *   _sstrm << state
  */
 
@@ -13935,94 +14266,94 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_read_SymbolTable_from_string", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1206
+  /* "fstlib/cext/pywrapfst.pyx":1267
  * cpdef SymbolTable _read_SymbolTable_from_string(string state):
  *   cdef stringstream _sstrm
  *   _sstrm << state             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.SymbolTable] _symbols
  *   _symbols.reset(fst.SymbolTable.ReadStream(_sstrm, b"<pywrapfst>"))
  */
   (void)((__pyx_v__sstrm << __pyx_v_state));
 
-  /* "fstlib/cext/pywrapfst.pyx":1208
+  /* "fstlib/cext/pywrapfst.pyx":1269
  *   _sstrm << state
  *   cdef unique_ptr[fst.SymbolTable] _symbols
  *   _symbols.reset(fst.SymbolTable.ReadStream(_sstrm, b"<pywrapfst>"))             # <<<<<<<<<<<<<<
  *   if _symbols.get() == NULL:
  *     raise FstIOError("Read from string failed")
  */
   __pyx_v__symbols.reset(fst::SymbolTable::Read(__pyx_v__sstrm, __pyx_k_pywrapfst));
 
-  /* "fstlib/cext/pywrapfst.pyx":1209
+  /* "fstlib/cext/pywrapfst.pyx":1270
  *   cdef unique_ptr[fst.SymbolTable] _symbols
  *   _symbols.reset(fst.SymbolTable.ReadStream(_sstrm, b"<pywrapfst>"))
  *   if _symbols.get() == NULL:             # <<<<<<<<<<<<<<
  *     raise FstIOError("Read from string failed")
  *   return _init_SymbolTable(move(_symbols))
  */
   __pyx_t_1 = ((__pyx_v__symbols.get() == NULL) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1210
+    /* "fstlib/cext/pywrapfst.pyx":1271
  *   _symbols.reset(fst.SymbolTable.ReadStream(_sstrm, b"<pywrapfst>"))
  *   if _symbols.get() == NULL:
  *     raise FstIOError("Read from string failed")             # <<<<<<<<<<<<<<
  *   return _init_SymbolTable(move(_symbols))
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1210, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1271, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Read_from_string_failed) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Read_from_string_failed);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1210, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1271, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 1210, __pyx_L1_error)
+    __PYX_ERR(0, 1271, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1209
+    /* "fstlib/cext/pywrapfst.pyx":1270
  *   cdef unique_ptr[fst.SymbolTable] _symbols
  *   _symbols.reset(fst.SymbolTable.ReadStream(_sstrm, b"<pywrapfst>"))
  *   if _symbols.get() == NULL:             # <<<<<<<<<<<<<<
  *     raise FstIOError("Read from string failed")
  *   return _init_SymbolTable(move(_symbols))
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1211
+  /* "fstlib/cext/pywrapfst.pyx":1272
  *   if _symbols.get() == NULL:
  *     raise FstIOError("Read from string failed")
  *   return _init_SymbolTable(move(_symbols))             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(fst::move<std::unique_ptr<fst::SymbolTable> >(__pyx_v__symbols))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1211, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(cython_std::move<std::unique_ptr<fst::SymbolTable> >(__pyx_v__symbols))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1272, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_t_2);
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1204
+  /* "fstlib/cext/pywrapfst.pyx":1265
  * 
  * 
  * cpdef SymbolTable _read_SymbolTable_from_string(string state):             # <<<<<<<<<<<<<<
  *   cdef stringstream _sstrm
  *   _sstrm << state
  */
 
@@ -14046,15 +14377,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_read_SymbolTable_from_string (wrapper)", 0);
   assert(__pyx_arg_state); {
-    __pyx_v_state = __pyx_convert_string_from_py_std__in_string(__pyx_arg_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1204, __pyx_L3_error)
+    __pyx_v_state = __pyx_convert_string_from_py_std__in_string(__pyx_arg_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1265, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._read_SymbolTable_from_string", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
@@ -14070,15 +14401,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_read_SymbolTable_from_string", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_SymbolTable_from_string(__pyx_v_state, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1204, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_SymbolTable_from_string(__pyx_v_state, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1265, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -14087,15 +14418,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1217
+/* "fstlib/cext/pywrapfst.pyx":1278
  * 
  * 
  * cpdef SymbolTable compact_symbol_table(SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *   """
  *   compact_symbol_table(symbols)
  */
 
@@ -14106,50 +14437,50 @@
   fst::SymbolTable const *__pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("compact_symbol_table", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1229
+  /* "fstlib/cext/pywrapfst.pyx":1290
  *     A new compacted SymbolTable.
  *   """
  *   return _init_SymbolTable(WrapUnique(fst.CompactSymbolTable(             # <<<<<<<<<<<<<<
  *                                           deref(symbols._raw_ptr_or_raise()))))
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
 
-  /* "fstlib/cext/pywrapfst.pyx":1230
+  /* "fstlib/cext/pywrapfst.pyx":1291
  *   """
  *   return _init_SymbolTable(WrapUnique(fst.CompactSymbolTable(
  *                                           deref(symbols._raw_ptr_or_raise()))))             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 1230, __pyx_L1_error)
+    __PYX_ERR(0, 1291, __pyx_L1_error)
   }
-  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1230, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1291, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1229
+  /* "fstlib/cext/pywrapfst.pyx":1290
  *     A new compacted SymbolTable.
  *   """
  *   return _init_SymbolTable(WrapUnique(fst.CompactSymbolTable(             # <<<<<<<<<<<<<<
  *                                           deref(symbols._raw_ptr_or_raise()))))
  * 
  */
-  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(fst::WrapUnique<fst::SymbolTable>(fst::CompactSymbolTable((*__pyx_t_1))))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1229, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(fst::WrapUnique<fst::SymbolTable>(fst::CompactSymbolTable((*__pyx_t_1))))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1290, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_t_2);
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1217
+  /* "fstlib/cext/pywrapfst.pyx":1278
  * 
  * 
  * cpdef SymbolTable compact_symbol_table(SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *   """
  *   compact_symbol_table(symbols)
  */
 
@@ -14170,15 +14501,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_11compact_symbol_table(PyObject *__pyx_self, PyObject *__pyx_v_symbols) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("compact_symbol_table (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 1217, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 1278, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10compact_symbol_table(__pyx_self, ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -14191,15 +14522,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("compact_symbol_table", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_compact_symbol_table(__pyx_v_symbols, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1217, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_compact_symbol_table(__pyx_v_symbols, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1278, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -14208,15 +14539,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1233
+/* "fstlib/cext/pywrapfst.pyx":1294
  * 
  * 
  * cpdef SymbolTable merge_symbol_table(SymbolTableView lhs,             # <<<<<<<<<<<<<<
  *                                      SymbolTableView rhs):
  *   """
  */
 
@@ -14228,63 +14559,63 @@
   fst::SymbolTable const *__pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("merge_symbol_table", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1256
+  /* "fstlib/cext/pywrapfst.pyx":1317
  *     A new merged SymbolTable.
  *   """
  *   return _init_SymbolTable(WrapUnique(fst.MergeSymbolTable(             # <<<<<<<<<<<<<<
  *                                           deref(lhs._raw_ptr_or_raise()),
  *                                           deref(rhs._raw_ptr_or_raise()),
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
 
-  /* "fstlib/cext/pywrapfst.pyx":1257
+  /* "fstlib/cext/pywrapfst.pyx":1318
  *   """
  *   return _init_SymbolTable(WrapUnique(fst.MergeSymbolTable(
  *                                           deref(lhs._raw_ptr_or_raise()),             # <<<<<<<<<<<<<<
  *                                           deref(rhs._raw_ptr_or_raise()),
  *                                           NULL)))
  */
   if (unlikely(((PyObject *)__pyx_v_lhs) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 1257, __pyx_L1_error)
+    __PYX_ERR(0, 1318, __pyx_L1_error)
   }
-  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_lhs->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_lhs); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1257, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_lhs->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_lhs); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1318, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1258
+  /* "fstlib/cext/pywrapfst.pyx":1319
  *   return _init_SymbolTable(WrapUnique(fst.MergeSymbolTable(
  *                                           deref(lhs._raw_ptr_or_raise()),
  *                                           deref(rhs._raw_ptr_or_raise()),             # <<<<<<<<<<<<<<
  *                                           NULL)))
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_rhs) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 1258, __pyx_L1_error)
+    __PYX_ERR(0, 1319, __pyx_L1_error)
   }
-  __pyx_t_2 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_rhs->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_rhs); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1258, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_rhs->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_rhs); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1319, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1256
+  /* "fstlib/cext/pywrapfst.pyx":1317
  *     A new merged SymbolTable.
  *   """
  *   return _init_SymbolTable(WrapUnique(fst.MergeSymbolTable(             # <<<<<<<<<<<<<<
  *                                           deref(lhs._raw_ptr_or_raise()),
  *                                           deref(rhs._raw_ptr_or_raise()),
  */
-  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(fst::WrapUnique<fst::SymbolTable>(fst::MergeSymbolTable((*__pyx_t_1), (*__pyx_t_2), NULL)))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1256, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_SymbolTable(fst::WrapUnique<fst::SymbolTable>(fst::MergeSymbolTable((*__pyx_t_1), (*__pyx_t_2), NULL)))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1317, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1233
+  /* "fstlib/cext/pywrapfst.pyx":1294
  * 
  * 
  * cpdef SymbolTable merge_symbol_table(SymbolTableView lhs,             # <<<<<<<<<<<<<<
  *                                      SymbolTableView rhs):
  *   """
  */
 
@@ -14330,39 +14661,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lhs)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rhs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("merge_symbol_table", 1, 2, 2, 1); __PYX_ERR(0, 1233, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("merge_symbol_table", 1, 2, 2, 1); __PYX_ERR(0, 1294, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "merge_symbol_table") < 0)) __PYX_ERR(0, 1233, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "merge_symbol_table") < 0)) __PYX_ERR(0, 1294, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_lhs = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[0]);
     __pyx_v_rhs = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("merge_symbol_table", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1233, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("merge_symbol_table", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1294, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.merge_symbol_table", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_lhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "lhs", 0))) __PYX_ERR(0, 1233, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_rhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "rhs", 0))) __PYX_ERR(0, 1234, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_lhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "lhs", 0))) __PYX_ERR(0, 1294, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_rhs), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "rhs", 0))) __PYX_ERR(0, 1295, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_12merge_symbol_table(__pyx_self, __pyx_v_lhs, __pyx_v_rhs);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -14375,15 +14706,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("merge_symbol_table", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_merge_symbol_table(__pyx_v_lhs, __pyx_v_rhs, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1233, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_merge_symbol_table(__pyx_v_lhs, __pyx_v_rhs, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1294, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -14392,15 +14723,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1272
+/* "fstlib/cext/pywrapfst.pyx":1333
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<_SymbolTableIterator at 0x{id(self):x}>"
  * 
  */
 
@@ -14426,52 +14757,52 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1273
+  /* "fstlib/cext/pywrapfst.pyx":1334
  * 
  *   def __repr__(self):
  *     return f"<_SymbolTableIterator at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
  *   def __init__(self, SymbolTableView symbols):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1273, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1334, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_SymbolTableIterator_at_0x);
   __pyx_t_2 += 27;
   __Pyx_GIVEREF(__pyx_kp_u_SymbolTableIterator_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_SymbolTableIterator_at_0x);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1273, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1334, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1273, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1334, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1273, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1334, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1272
+  /* "fstlib/cext/pywrapfst.pyx":1333
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<_SymbolTableIterator at 0x{id(self):x}>"
  * 
  */
 
@@ -14484,15 +14815,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1275
+/* "fstlib/cext/pywrapfst.pyx":1336
  *     return f"<_SymbolTableIterator at 0x{id(self):x}>"
  * 
  *   def __init__(self, SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *     self._table = symbols
  *     self._siter.reset(
  */
 
@@ -14521,32 +14852,32 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_symbols)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1275, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1336, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_symbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[0]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1275, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1336, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._SymbolTableIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 1275, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 1336, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_20_SymbolTableIterator_2__init__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__SymbolTableIterator *)__pyx_v_self), __pyx_v_symbols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -14559,70 +14890,70 @@
   __Pyx_RefNannyDeclarations
   fst::SymbolTable const *__pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1276
+  /* "fstlib/cext/pywrapfst.pyx":1337
  * 
  *   def __init__(self, SymbolTableView symbols):
  *     self._table = symbols             # <<<<<<<<<<<<<<
  *     self._siter.reset(
  *         new fst.SymbolTableIterator(self._table._raw_ptr_or_raise().begin()))
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_table");
-    __PYX_ERR(0, 1276, __pyx_L1_error)
+    __PYX_ERR(0, 1337, __pyx_L1_error)
   }
   __Pyx_INCREF(((PyObject *)__pyx_v_symbols));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_symbols));
   __Pyx_GOTREF(__pyx_v_self->_table);
   __Pyx_DECREF(((PyObject *)__pyx_v_self->_table));
   __pyx_v_self->_table = __pyx_v_symbols;
 
-  /* "fstlib/cext/pywrapfst.pyx":1277
+  /* "fstlib/cext/pywrapfst.pyx":1338
  *   def __init__(self, SymbolTableView symbols):
  *     self._table = symbols
  *     self._siter.reset(             # <<<<<<<<<<<<<<
  *         new fst.SymbolTableIterator(self._table._raw_ptr_or_raise().begin()))
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
-    __PYX_ERR(0, 1277, __pyx_L1_error)
+    __PYX_ERR(0, 1338, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1278
+  /* "fstlib/cext/pywrapfst.pyx":1339
  *     self._table = symbols
  *     self._siter.reset(
  *         new fst.SymbolTableIterator(self._table._raw_ptr_or_raise().begin()))             # <<<<<<<<<<<<<<
  * 
  *   # This just registers this class as a possible iterator.
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_table");
-    __PYX_ERR(0, 1278, __pyx_L1_error)
+    __PYX_ERR(0, 1339, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_self->_table) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 1278, __pyx_L1_error)
+    __PYX_ERR(0, 1339, __pyx_L1_error)
   }
-  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->_table->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self->_table); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1278, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->_table->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self->_table); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1339, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1277
+  /* "fstlib/cext/pywrapfst.pyx":1338
  *   def __init__(self, SymbolTableView symbols):
  *     self._table = symbols
  *     self._siter.reset(             # <<<<<<<<<<<<<<
  *         new fst.SymbolTableIterator(self._table._raw_ptr_or_raise().begin()))
  * 
  */
   __pyx_v_self->_siter.reset(new fst::SymbolTable::iterator(__pyx_t_1->begin()));
 
-  /* "fstlib/cext/pywrapfst.pyx":1275
+  /* "fstlib/cext/pywrapfst.pyx":1336
  *     return f"<_SymbolTableIterator at 0x{id(self):x}>"
  * 
  *   def __init__(self, SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *     self._table = symbols
  *     self._siter.reset(
  */
 
@@ -14633,15 +14964,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._SymbolTableIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1281
+/* "fstlib/cext/pywrapfst.pyx":1342
  * 
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
 
@@ -14659,42 +14990,42 @@
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_20_SymbolTableIterator_4__iter__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__SymbolTableIterator *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__iter__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1282
+  /* "fstlib/cext/pywrapfst.pyx":1343
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1281
+  /* "fstlib/cext/pywrapfst.pyx":1342
  * 
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1285
+/* "fstlib/cext/pywrapfst.pyx":1346
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):             # <<<<<<<<<<<<<<
  *     if self._table._raw_ptr_or_raise().end() == deref(self._siter):
  *       raise StopIteration
  */
 
@@ -14708,134 +15039,134 @@
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_20_SymbolTableIterator_6__next__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__SymbolTableIterator *__pyx_v_self) {
-  int64 __pyx_v__label;
+  int64_t __pyx_v__label;
   std::string __pyx_v__symbol;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   fst::SymbolTable const *__pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__next__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1286
+  /* "fstlib/cext/pywrapfst.pyx":1347
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):
  *     if self._table._raw_ptr_or_raise().end() == deref(self._siter):             # <<<<<<<<<<<<<<
  *       raise StopIteration
- *     cdef int64 _label = self._siter.get().Pair().Label()
+ *     cdef int64_t _label = self._siter.get().Pair().Label()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_table");
-    __PYX_ERR(0, 1286, __pyx_L1_error)
+    __PYX_ERR(0, 1347, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_self->_table) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 1286, __pyx_L1_error)
+    __PYX_ERR(0, 1347, __pyx_L1_error)
   }
-  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->_table->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self->_table); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1286, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_self->_table->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_self->_table); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1347, __pyx_L1_error)
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
-    __PYX_ERR(0, 1286, __pyx_L1_error)
+    __PYX_ERR(0, 1347, __pyx_L1_error)
   }
   __pyx_t_2 = ((__pyx_t_1->end() == (*__pyx_v_self->_siter)) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1287
+    /* "fstlib/cext/pywrapfst.pyx":1348
  *   def __next__(self):
  *     if self._table._raw_ptr_or_raise().end() == deref(self._siter):
  *       raise StopIteration             # <<<<<<<<<<<<<<
- *     cdef int64 _label = self._siter.get().Pair().Label()
+ *     cdef int64_t _label = self._siter.get().Pair().Label()
  *     cdef string _symbol = self._siter.get().Pair().Symbol()
  */
     __Pyx_Raise(__pyx_builtin_StopIteration, 0, 0, 0);
-    __PYX_ERR(0, 1287, __pyx_L1_error)
+    __PYX_ERR(0, 1348, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1286
+    /* "fstlib/cext/pywrapfst.pyx":1347
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):
  *     if self._table._raw_ptr_or_raise().end() == deref(self._siter):             # <<<<<<<<<<<<<<
  *       raise StopIteration
- *     cdef int64 _label = self._siter.get().Pair().Label()
+ *     cdef int64_t _label = self._siter.get().Pair().Label()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1288
+  /* "fstlib/cext/pywrapfst.pyx":1349
  *     if self._table._raw_ptr_or_raise().end() == deref(self._siter):
  *       raise StopIteration
- *     cdef int64 _label = self._siter.get().Pair().Label()             # <<<<<<<<<<<<<<
+ *     cdef int64_t _label = self._siter.get().Pair().Label()             # <<<<<<<<<<<<<<
  *     cdef string _symbol = self._siter.get().Pair().Symbol()
  *     inc(deref(self._siter))
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
-    __PYX_ERR(0, 1288, __pyx_L1_error)
+    __PYX_ERR(0, 1349, __pyx_L1_error)
   }
   __pyx_v__label = __pyx_v_self->_siter.get()->operator*().Label();
 
-  /* "fstlib/cext/pywrapfst.pyx":1289
+  /* "fstlib/cext/pywrapfst.pyx":1350
  *       raise StopIteration
- *     cdef int64 _label = self._siter.get().Pair().Label()
+ *     cdef int64_t _label = self._siter.get().Pair().Label()
  *     cdef string _symbol = self._siter.get().Pair().Symbol()             # <<<<<<<<<<<<<<
  *     inc(deref(self._siter))
  *     return (_label, _symbol)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
-    __PYX_ERR(0, 1289, __pyx_L1_error)
+    __PYX_ERR(0, 1350, __pyx_L1_error)
   }
   __pyx_v__symbol = __pyx_v_self->_siter.get()->operator*().Symbol();
 
-  /* "fstlib/cext/pywrapfst.pyx":1290
- *     cdef int64 _label = self._siter.get().Pair().Label()
+  /* "fstlib/cext/pywrapfst.pyx":1351
+ *     cdef int64_t _label = self._siter.get().Pair().Label()
  *     cdef string _symbol = self._siter.get().Pair().Symbol()
  *     inc(deref(self._siter))             # <<<<<<<<<<<<<<
  *     return (_label, _symbol)
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
-    __PYX_ERR(0, 1290, __pyx_L1_error)
+    __PYX_ERR(0, 1351, __pyx_L1_error)
   }
   (void)((++(*__pyx_v_self->_siter)));
 
-  /* "fstlib/cext/pywrapfst.pyx":1291
+  /* "fstlib/cext/pywrapfst.pyx":1352
  *     cdef string _symbol = self._siter.get().Pair().Symbol()
  *     inc(deref(self._siter))
  *     return (_label, _symbol)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v__label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v__label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1352, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v__symbol); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v__symbol); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1352, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1352, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
   __pyx_t_3 = 0;
   __pyx_t_4 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1285
+  /* "fstlib/cext/pywrapfst.pyx":1346
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):             # <<<<<<<<<<<<<<
  *     if self._table._raw_ptr_or_raise().end() == deref(self._siter):
  *       raise StopIteration
  */
 
@@ -14961,15 +15292,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._SymbolTableIterator.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1320
+/* "fstlib/cext/pywrapfst.pyx":1381
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<EncodeMapper at 0x{id(self):x}>"
  * 
  */
 
@@ -14995,52 +15326,52 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1321
+  /* "fstlib/cext/pywrapfst.pyx":1382
  * 
  *   def __repr__(self):
  *     return f"<EncodeMapper at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
  *   def __init__(self,
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1321, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1382, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_EncodeMapper_at_0x);
   __pyx_t_2 += 19;
   __Pyx_GIVEREF(__pyx_kp_u_EncodeMapper_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_EncodeMapper_at_0x);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1321, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1382, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1321, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1382, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1321, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1382, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1320
+  /* "fstlib/cext/pywrapfst.pyx":1381
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<EncodeMapper at 0x{id(self):x}>"
  * 
  */
 
@@ -15053,15 +15384,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1323
+/* "fstlib/cext/pywrapfst.pyx":1384
  *     return f"<EncodeMapper at 0x{id(self):x}>"
  * 
  *   def __init__(self,             # <<<<<<<<<<<<<<
  *                arc_type="standard",
  *                bool encode_labels=False,
  */
 
@@ -15111,15 +15442,15 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_encode_weights);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1323, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1384, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -15127,143 +15458,143 @@
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_arc_type = values[0];
     if (values[1]) {
-      __pyx_v_encode_labels = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_encode_labels == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1325, __pyx_L3_error)
+      __pyx_v_encode_labels = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_encode_labels == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1386, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":1325
+      /* "fstlib/cext/pywrapfst.pyx":1386
  *   def __init__(self,
  *                arc_type="standard",
  *                bool encode_labels=False,             # <<<<<<<<<<<<<<
  *                bool encode_weights=False):
- *     cdef uint8 _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
+ *     cdef uint8_t _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
  */
       __pyx_v_encode_labels = ((bool)0);
     }
     if (values[2]) {
-      __pyx_v_encode_weights = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_encode_weights == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1326, __pyx_L3_error)
+      __pyx_v_encode_weights = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_encode_weights == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1387, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":1326
+      /* "fstlib/cext/pywrapfst.pyx":1387
  *                arc_type="standard",
  *                bool encode_labels=False,
  *                bool encode_weights=False):             # <<<<<<<<<<<<<<
- *     cdef uint8 _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
+ *     cdef uint8_t _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
  *     self._mapper.reset(
  */
       __pyx_v_encode_weights = ((bool)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1323, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1384, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.EncodeMapper.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_12EncodeMapper_2__init__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_self), __pyx_v_arc_type, __pyx_v_encode_labels, __pyx_v_encode_weights);
 
-  /* "fstlib/cext/pywrapfst.pyx":1323
+  /* "fstlib/cext/pywrapfst.pyx":1384
  *     return f"<EncodeMapper at 0x{id(self):x}>"
  * 
  *   def __init__(self,             # <<<<<<<<<<<<<<
  *                arc_type="standard",
  *                bool encode_labels=False,
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static int __pyx_pf_6fstlib_4cext_9pywrapfst_12EncodeMapper_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, PyObject *__pyx_v_arc_type, bool __pyx_v_encode_labels, bool __pyx_v_encode_weights) {
-  uint8 __pyx_v__flags;
+  uint8_t __pyx_v__flags;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   std::string __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1327
+  /* "fstlib/cext/pywrapfst.pyx":1388
  *                bool encode_labels=False,
  *                bool encode_weights=False):
- *     cdef uint8 _flags = fst.GetEncodeFlags(encode_labels, encode_weights)             # <<<<<<<<<<<<<<
+ *     cdef uint8_t _flags = fst.GetEncodeFlags(encode_labels, encode_weights)             # <<<<<<<<<<<<<<
  *     self._mapper.reset(
  *         new fst.EncodeMapperClass(tostring(arc_type), _flags, fst.ENCODE))
  */
   __pyx_v__flags = fst::script::GetEncodeFlags(__pyx_v_encode_labels, __pyx_v_encode_weights);
 
-  /* "fstlib/cext/pywrapfst.pyx":1328
+  /* "fstlib/cext/pywrapfst.pyx":1389
  *                bool encode_weights=False):
- *     cdef uint8 _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
+ *     cdef uint8_t _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
  *     self._mapper.reset(             # <<<<<<<<<<<<<<
  *         new fst.EncodeMapperClass(tostring(arc_type), _flags, fst.ENCODE))
  *     if self._mapper.get() == NULL:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1328, __pyx_L1_error)
+    __PYX_ERR(0, 1389, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1329
- *     cdef uint8 _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
+  /* "fstlib/cext/pywrapfst.pyx":1390
+ *     cdef uint8_t _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
  *     self._mapper.reset(
  *         new fst.EncodeMapperClass(tostring(arc_type), _flags, fst.ENCODE))             # <<<<<<<<<<<<<<
  *     if self._mapper.get() == NULL:
  *       raise FstOpError(f"Unknown arc type: {arc_type!r}")
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_arc_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1329, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_arc_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1390, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1328
+  /* "fstlib/cext/pywrapfst.pyx":1389
  *                bool encode_weights=False):
- *     cdef uint8 _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
+ *     cdef uint8_t _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
  *     self._mapper.reset(             # <<<<<<<<<<<<<<
  *         new fst.EncodeMapperClass(tostring(arc_type), _flags, fst.ENCODE))
  *     if self._mapper.get() == NULL:
  */
   __pyx_v_self->_mapper.reset(new fst::script::EncodeMapperClass(__pyx_t_1, __pyx_v__flags, fst::ENCODE));
 
-  /* "fstlib/cext/pywrapfst.pyx":1330
+  /* "fstlib/cext/pywrapfst.pyx":1391
  *     self._mapper.reset(
  *         new fst.EncodeMapperClass(tostring(arc_type), _flags, fst.ENCODE))
  *     if self._mapper.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstOpError(f"Unknown arc type: {arc_type!r}")
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1330, __pyx_L1_error)
+    __PYX_ERR(0, 1391, __pyx_L1_error)
   }
   __pyx_t_2 = ((__pyx_v_self->_mapper.get() == NULL) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1331
+    /* "fstlib/cext/pywrapfst.pyx":1392
  *         new fst.EncodeMapperClass(tostring(arc_type), _flags, fst.ENCODE))
  *     if self._mapper.get() == NULL:
  *       raise FstOpError(f"Unknown arc type: {arc_type!r}")             # <<<<<<<<<<<<<<
  * 
  *   # Python's equivalent to operator().
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1331, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1392, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_arc_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1331, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_arc_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1392, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_arc_type, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1331, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_arc_type, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1392, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -15271,31 +15602,31 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1331, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1392, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 1331, __pyx_L1_error)
+    __PYX_ERR(0, 1392, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1330
+    /* "fstlib/cext/pywrapfst.pyx":1391
  *     self._mapper.reset(
  *         new fst.EncodeMapperClass(tostring(arc_type), _flags, fst.ENCODE))
  *     if self._mapper.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstOpError(f"Unknown arc type: {arc_type!r}")
  * 
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1323
+  /* "fstlib/cext/pywrapfst.pyx":1384
  *     return f"<EncodeMapper at 0x{id(self):x}>"
  * 
  *   def __init__(self,             # <<<<<<<<<<<<<<
  *                arc_type="standard",
  *                bool encode_labels=False,
  */
 
@@ -15310,15 +15641,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.EncodeMapper.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1335
+/* "fstlib/cext/pywrapfst.pyx":1396
  *   # Python's equivalent to operator().
  * 
  *   def __call__(self, Arc arc):             # <<<<<<<<<<<<<<
  *     """
  *     self(state, ilabel, olabel, weight, nextstate)
  */
 
@@ -15351,32 +15682,32 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_arc)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") < 0)) __PYX_ERR(0, 1335, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") < 0)) __PYX_ERR(0, 1396, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_arc = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)values[0]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__call__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1335, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__call__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1396, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.EncodeMapper.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arc), __pyx_ptype_6fstlib_4cext_9pywrapfst_Arc, 1, "arc", 0))) __PYX_ERR(0, 1335, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arc), __pyx_ptype_6fstlib_4cext_9pywrapfst_Arc, 1, "arc", 0))) __PYX_ERR(0, 1396, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_12EncodeMapper_4__call__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_self), __pyx_v_arc);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -15389,37 +15720,37 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__call__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1351
+  /* "fstlib/cext/pywrapfst.pyx":1412
  *       FstOpError: Incompatible or invalid weight.
  *     """
  *     return _init_Arc(self._mapper.get().__call__(deref(arc._arc)))             # <<<<<<<<<<<<<<
  * 
  *   # Registers the class for pickling.
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1351, __pyx_L1_error)
+    __PYX_ERR(0, 1412, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_arc) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 1351, __pyx_L1_error)
+    __PYX_ERR(0, 1412, __pyx_L1_error)
   }
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_Arc(__pyx_v_self->_mapper.get()->operator()((*__pyx_v_arc->_arc)))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1351, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_Arc(__pyx_v_self->_mapper.get()->operator()((*__pyx_v_arc->_arc)))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1412, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1335
+  /* "fstlib/cext/pywrapfst.pyx":1396
  *   # Python's equivalent to operator().
  * 
  *   def __call__(self, Arc arc):             # <<<<<<<<<<<<<<
  *     """
  *     self(state, ilabel, olabel, weight, nextstate)
  */
 
@@ -15430,15 +15761,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1355
+/* "fstlib/cext/pywrapfst.pyx":1416
  *   # Registers the class for pickling.
  * 
  *   def __reduce__(self):             # <<<<<<<<<<<<<<
  *       return (_read_EncodeMapper_from_string, (self.write_to_string(),))
  * 
  */
 
@@ -15462,48 +15793,48 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__reduce__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1356
+  /* "fstlib/cext/pywrapfst.pyx":1417
  * 
  *   def __reduce__(self):
  *       return (_read_EncodeMapper_from_string, (self.write_to_string(),))             # <<<<<<<<<<<<<<
  * 
  *   cpdef string arc_type(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_read_EncodeMapper_from_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1356, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_read_EncodeMapper_from_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1417, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "write_to_string");
-    __PYX_ERR(0, 1356, __pyx_L1_error)
+    __PYX_ERR(0, 1417, __pyx_L1_error)
   }
-  __pyx_t_2 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_self->__pyx_vtab)->write_to_string(__pyx_v_self, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1356, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_self->__pyx_vtab)->write_to_string(__pyx_v_self, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1417, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1356, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1417, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1356, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1417, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_3 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1355
+  /* "fstlib/cext/pywrapfst.pyx":1416
  *   # Registers the class for pickling.
  * 
  *   def __reduce__(self):             # <<<<<<<<<<<<<<
  *       return (_read_EncodeMapper_from_string, (self.write_to_string(),))
  * 
  */
 
@@ -15516,15 +15847,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1358
+/* "fstlib/cext/pywrapfst.pyx":1419
  *       return (_read_EncodeMapper_from_string, (self.write_to_string(),))
  * 
  *   cpdef string arc_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     arc_type(self)
  */
 
@@ -15546,15 +15877,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_arc_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1358, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_arc_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1419, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12EncodeMapper_9arc_type)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -15562,18 +15893,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1358, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1419, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1358, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1419, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -15584,29 +15915,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1364
+  /* "fstlib/cext/pywrapfst.pyx":1425
  *     Returns a string indicating the arc type.
  *     """
  *     return self._mapper.get().ArcType()             # <<<<<<<<<<<<<<
  * 
  *   cpdef string weight_type(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1364, __pyx_L1_error)
+    __PYX_ERR(0, 1425, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_mapper.get()->ArcType();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1358
+  /* "fstlib/cext/pywrapfst.pyx":1419
  *       return (_read_EncodeMapper_from_string, (self.write_to_string(),))
  * 
  *   cpdef string arc_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     arc_type(self)
  */
 
@@ -15642,15 +15973,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("arc_type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_arc_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1358, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_arc_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1419, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -15659,15 +15990,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1366
+/* "fstlib/cext/pywrapfst.pyx":1427
  *     return self._mapper.get().ArcType()
  * 
  *   cpdef string weight_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     weight_type(self)
  */
 
@@ -15689,15 +16020,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_weight_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1366, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_weight_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1427, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12EncodeMapper_11weight_type)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -15705,18 +16036,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1366, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1427, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1366, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1427, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -15727,29 +16058,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1372
+  /* "fstlib/cext/pywrapfst.pyx":1433
  *     Returns a string indicating the weight type.
  *     """
  *     return self._mapper.get().WeightType()             # <<<<<<<<<<<<<<
  * 
- *   cpdef uint8 flags(self):
+ *   cpdef uint8_t flags(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1372, __pyx_L1_error)
+    __PYX_ERR(0, 1433, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_mapper.get()->WeightType();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1366
+  /* "fstlib/cext/pywrapfst.pyx":1427
  *     return self._mapper.get().ArcType()
  * 
  *   cpdef string weight_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     weight_type(self)
  */
 
@@ -15785,15 +16116,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("weight_type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_weight_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1366, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_weight_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1427, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -15802,45 +16133,45 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1374
+/* "fstlib/cext/pywrapfst.pyx":1435
  *     return self._mapper.get().WeightType()
  * 
- *   cpdef uint8 flags(self):             # <<<<<<<<<<<<<<
+ *   cpdef uint8_t flags(self):             # <<<<<<<<<<<<<<
  *     """
  *     flags(self)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_12EncodeMapper_13flags(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static uint8 __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, int __pyx_skip_dispatch) {
-  uint8 __pyx_r;
+static uint8_t __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, int __pyx_skip_dispatch) {
+  uint8_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  uint8 __pyx_t_5;
+  uint8_t __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("flags", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1374, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1435, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12EncodeMapper_13flags)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -15848,18 +16179,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1374, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1435, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyInt_As_uint8_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((uint8)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1374, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_As_uint8_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((uint8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1435, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -15870,32 +16201,32 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1380
+  /* "fstlib/cext/pywrapfst.pyx":1441
  *     Returns the mapper's flags.
  *     """
  *     return self._mapper.get().Flags()             # <<<<<<<<<<<<<<
  * 
  *   def properties(self, mask):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1380, __pyx_L1_error)
+    __PYX_ERR(0, 1441, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_mapper.get()->Flags();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1374
+  /* "fstlib/cext/pywrapfst.pyx":1435
  *     return self._mapper.get().WeightType()
  * 
- *   cpdef uint8 flags(self):             # <<<<<<<<<<<<<<
+ *   cpdef uint8_t flags(self):             # <<<<<<<<<<<<<<
  *     """
  *     flags(self)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -15928,15 +16259,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("flags", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_uint8_t(__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_flags(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1374, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_uint8_t(__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_flags(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1435, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -15945,15 +16276,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1382
+/* "fstlib/cext/pywrapfst.pyx":1443
  *     return self._mapper.get().Flags()
  * 
  *   def properties(self, mask):             # <<<<<<<<<<<<<<
  *     """
  *     properties(self, mask)
  */
 
@@ -15973,62 +16304,62 @@
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12EncodeMapper_14properties(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_self, PyObject *__pyx_v_mask) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
-  uint64 __pyx_t_4;
+  uint64_t __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("properties", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1397
+  /* "fstlib/cext/pywrapfst.pyx":1458
  *     """
  * 
  *     return FstProperties(self._mapper.get().Properties(mask.value))             # <<<<<<<<<<<<<<
  * 
  *   @classmethod
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstProperties); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1397, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstProperties); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1458, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1397, __pyx_L1_error)
+    __PYX_ERR(0, 1458, __pyx_L1_error)
   }
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1397, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1458, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyInt_As_uint64_t(__pyx_t_3); if (unlikely((__pyx_t_4 == ((uint64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1397, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_As_uint64_t(__pyx_t_3); if (unlikely((__pyx_t_4 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1458, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_self->_mapper.get()->Properties(__pyx_t_4)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1397, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_self->_mapper.get()->Properties(__pyx_t_4)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1458, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1397, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1458, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1382
+  /* "fstlib/cext/pywrapfst.pyx":1443
  *     return self._mapper.get().Flags()
  * 
  *   def properties(self, mask):             # <<<<<<<<<<<<<<
  *     """
  *     properties(self, mask)
  */
 
@@ -16042,15 +16373,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1400
+/* "fstlib/cext/pywrapfst.pyx":1461
  * 
  *   @classmethod
  *   def read(cls, source):             # <<<<<<<<<<<<<<
  *     """
  *     EncodeMapper.read(source)
  */
 
@@ -16079,46 +16410,54 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1416
+  /* "fstlib/cext/pywrapfst.pyx":1477
  *     """
- *     cdef unique_ptr[fst.EncodeMapperClass] _mapper
- *     _mapper.reset(fst.EncodeMapperClass.Read(path_tostring(source)))             # <<<<<<<<<<<<<<
+ *     cdef unique_ptr[fst.EncodeMapperClass] _mapper = fst.EncodeMapperClass.Read(
+ *         path_tostring(source))             # <<<<<<<<<<<<<<
  *     if _mapper.get() == NULL:
  *       raise FstIOError(f"Read failed: {source!r}")
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1416, __pyx_L1_error)
-  __pyx_v__mapper.reset(fst::script::EncodeMapperClass::Read(__pyx_t_1));
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1477, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1417
- *     cdef unique_ptr[fst.EncodeMapperClass] _mapper
- *     _mapper.reset(fst.EncodeMapperClass.Read(path_tostring(source)))
+  /* "fstlib/cext/pywrapfst.pyx":1476
+ *       A new EncodeMapper instance.
+ *     """
+ *     cdef unique_ptr[fst.EncodeMapperClass] _mapper = fst.EncodeMapperClass.Read(             # <<<<<<<<<<<<<<
+ *         path_tostring(source))
+ *     if _mapper.get() == NULL:
+ */
+  __pyx_v__mapper = fst::script::EncodeMapperClass::Read(__pyx_t_1);
+
+  /* "fstlib/cext/pywrapfst.pyx":1478
+ *     cdef unique_ptr[fst.EncodeMapperClass] _mapper = fst.EncodeMapperClass.Read(
+ *         path_tostring(source))
  *     if _mapper.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Read failed: {source!r}")
  *     return _init_EncodeMapper(_mapper.release())
  */
   __pyx_t_2 = ((__pyx_v__mapper.get() == NULL) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1418
- *     _mapper.reset(fst.EncodeMapperClass.Read(path_tostring(source)))
+    /* "fstlib/cext/pywrapfst.pyx":1479
+ *         path_tostring(source))
  *     if _mapper.get() == NULL:
  *       raise FstIOError(f"Read failed: {source!r}")             # <<<<<<<<<<<<<<
  *     return _init_EncodeMapper(_mapper.release())
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1418, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1479, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1418, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1479, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_failed, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1418, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_failed, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1479, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -16126,45 +16465,45 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1418, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1479, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 1418, __pyx_L1_error)
+    __PYX_ERR(0, 1479, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1417
- *     cdef unique_ptr[fst.EncodeMapperClass] _mapper
- *     _mapper.reset(fst.EncodeMapperClass.Read(path_tostring(source)))
+    /* "fstlib/cext/pywrapfst.pyx":1478
+ *     cdef unique_ptr[fst.EncodeMapperClass] _mapper = fst.EncodeMapperClass.Read(
+ *         path_tostring(source))
  *     if _mapper.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Read failed: {source!r}")
  *     return _init_EncodeMapper(_mapper.release())
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1419
+  /* "fstlib/cext/pywrapfst.pyx":1480
  *     if _mapper.get() == NULL:
  *       raise FstIOError(f"Read failed: {source!r}")
  *     return _init_EncodeMapper(_mapper.release())             # <<<<<<<<<<<<<<
  * 
  *   @staticmethod
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_EncodeMapper(__pyx_v__mapper.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1419, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_EncodeMapper(__pyx_v__mapper.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1480, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1400
+  /* "fstlib/cext/pywrapfst.pyx":1461
  * 
  *   @classmethod
  *   def read(cls, source):             # <<<<<<<<<<<<<<
  *     """
  *     EncodeMapper.read(source)
  */
 
@@ -16178,15 +16517,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1422
+/* "fstlib/cext/pywrapfst.pyx":1483
  * 
  *   @staticmethod
  *   def read_from_string(state):             # <<<<<<<<<<<<<<
  *     """
  *     read_from_string(state)
  */
 
@@ -16217,26 +16556,26 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_state)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_from_string") < 0)) __PYX_ERR(0, 1422, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_from_string") < 0)) __PYX_ERR(0, 1483, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_state = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("read_from_string", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1422, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("read_from_string", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1483, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.EncodeMapper.read_from_string", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_12EncodeMapper_18read_from_string(__pyx_v_state);
 
@@ -16251,30 +16590,30 @@
   std::string __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read_from_string", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1437
+  /* "fstlib/cext/pywrapfst.pyx":1498
  *       FstIOError: Read failed.
  *     """
  *     return _read_EncodeMapper_from_string(state)             # <<<<<<<<<<<<<<
  * 
  *   cpdef void write(self, source) except *:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_string_from_py_std__in_string(__pyx_v_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1437, __pyx_L1_error)
-  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_EncodeMapper_from_string(__pyx_t_1, 0)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1437, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_string_from_py_std__in_string(__pyx_v_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1498, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_EncodeMapper_from_string(__pyx_t_1, 0)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1498, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1422
+  /* "fstlib/cext/pywrapfst.pyx":1483
  * 
  *   @staticmethod
  *   def read_from_string(state):             # <<<<<<<<<<<<<<
  *     """
  *     read_from_string(state)
  */
 
@@ -16285,15 +16624,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1439
+/* "fstlib/cext/pywrapfst.pyx":1500
  *     return _read_EncodeMapper_from_string(state)
  * 
  *   cpdef void write(self, source) except *:             # <<<<<<<<<<<<<<
  *       """
  *       write(self, source)
  */
 
@@ -16315,15 +16654,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1439, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1500, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12EncodeMapper_21write)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -16331,15 +16670,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_source) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_source);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1439, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1500, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -16351,41 +16690,41 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1452
+  /* "fstlib/cext/pywrapfst.pyx":1513
  *         FstIOError: Write failed.
  *       """
  *       if not self._mapper.get().Write(path_tostring(source)):             # <<<<<<<<<<<<<<
  *         raise FstIOError(f"Write failed: {source!r}")
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1452, __pyx_L1_error)
+    __PYX_ERR(0, 1513, __pyx_L1_error)
   }
-  __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1452, __pyx_L1_error)
+  __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1513, __pyx_L1_error)
   __pyx_t_6 = ((!(__pyx_v_self->_mapper.get()->Write(__pyx_t_5) != 0)) != 0);
   if (unlikely(__pyx_t_6)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1453
+    /* "fstlib/cext/pywrapfst.pyx":1514
  *       """
  *       if not self._mapper.get().Write(path_tostring(source)):
  *         raise FstIOError(f"Write failed: {source!r}")             # <<<<<<<<<<<<<<
  * 
  *   cpdef bytes write_to_string(self):
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1453, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1514, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1453, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1514, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Write_failed, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1453, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Write_failed, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1514, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -16393,31 +16732,31 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1453, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1514, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1453, __pyx_L1_error)
+    __PYX_ERR(0, 1514, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1452
+    /* "fstlib/cext/pywrapfst.pyx":1513
  *         FstIOError: Write failed.
  *       """
  *       if not self._mapper.get().Write(path_tostring(source)):             # <<<<<<<<<<<<<<
  *         raise FstIOError(f"Write failed: {source!r}")
  * 
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1439
+  /* "fstlib/cext/pywrapfst.pyx":1500
  *     return _read_EncodeMapper_from_string(state)
  * 
  *   cpdef void write(self, source) except *:             # <<<<<<<<<<<<<<
  *       """
  *       write(self, source)
  */
 
@@ -16452,16 +16791,16 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("write", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_write(__pyx_v_self, __pyx_v_source, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1439, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1439, __pyx_L1_error)
+  __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_write(__pyx_v_self, __pyx_v_source, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1500, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1500, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -16470,15 +16809,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1455
+/* "fstlib/cext/pywrapfst.pyx":1516
  *         raise FstIOError(f"Write failed: {source!r}")
  * 
  *   cpdef bytes write_to_string(self):             # <<<<<<<<<<<<<<
  *       """
  *       write_to_string(self)
  */
 
@@ -16501,15 +16840,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_to_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1455, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_to_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1516, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12EncodeMapper_23write_to_string)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -16518,18 +16857,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1455, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1516, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 1455, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 1516, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -16540,80 +16879,80 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1468
+  /* "fstlib/cext/pywrapfst.pyx":1529
  *       """
  *       cdef stringstream _sstrm
  *       if not self._mapper.get().WriteStream(_sstrm, b"<pywrapfst>"):             # <<<<<<<<<<<<<<
  *         raise FstIOError("Write to string failed")
  *       return _sstrm.str()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1468, __pyx_L1_error)
+    __PYX_ERR(0, 1529, __pyx_L1_error)
   }
   __pyx_t_5 = ((!(__pyx_v_self->_mapper.get()->Write(__pyx_v__sstrm, __pyx_k_pywrapfst) != 0)) != 0);
   if (unlikely(__pyx_t_5)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1469
+    /* "fstlib/cext/pywrapfst.pyx":1530
  *       cdef stringstream _sstrm
  *       if not self._mapper.get().WriteStream(_sstrm, b"<pywrapfst>"):
  *         raise FstIOError("Write to string failed")             # <<<<<<<<<<<<<<
  *       return _sstrm.str()
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1469, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1530, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_kp_u_Write_to_string_failed) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_Write_to_string_failed);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1469, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1530, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1469, __pyx_L1_error)
+    __PYX_ERR(0, 1530, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1468
+    /* "fstlib/cext/pywrapfst.pyx":1529
  *       """
  *       cdef stringstream _sstrm
  *       if not self._mapper.get().WriteStream(_sstrm, b"<pywrapfst>"):             # <<<<<<<<<<<<<<
  *         raise FstIOError("Write to string failed")
  *       return _sstrm.str()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1470
+  /* "fstlib/cext/pywrapfst.pyx":1531
  *       if not self._mapper.get().WriteStream(_sstrm, b"<pywrapfst>"):
  *         raise FstIOError("Write to string failed")
  *       return _sstrm.str()             # <<<<<<<<<<<<<<
  * 
  *   cpdef _EncodeMapperSymbolTableView input_symbols(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyBytes_string_to_py_std__in_string(__pyx_v__sstrm.str()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1470, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyBytes_string_to_py_std__in_string(__pyx_v__sstrm.str()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1531, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1455
+  /* "fstlib/cext/pywrapfst.pyx":1516
  *         raise FstIOError(f"Write failed: {source!r}")
  * 
  *   cpdef bytes write_to_string(self):             # <<<<<<<<<<<<<<
  *       """
  *       write_to_string(self)
  */
 
@@ -16650,15 +16989,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("write_to_string", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_write_to_string(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1455, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_write_to_string(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1516, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -16667,15 +17006,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1472
+/* "fstlib/cext/pywrapfst.pyx":1533
  *       return _sstrm.str()
  * 
  *   cpdef _EncodeMapperSymbolTableView input_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     input_symbols(self)
  */
 
@@ -16697,15 +17036,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_input_symbols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1472, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_input_symbols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1533, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12EncodeMapper_25input_symbols)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -16714,18 +17053,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1472, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1533, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView))))) __PYX_ERR(0, 1472, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView))))) __PYX_ERR(0, 1533, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -16736,67 +17075,67 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1478
+  /* "fstlib/cext/pywrapfst.pyx":1539
  *     Returns the mapper's input symbol table, or None if none is present.
  *     """
  *     if self._mapper.get().InputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=True)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1478, __pyx_L1_error)
+    __PYX_ERR(0, 1539, __pyx_L1_error)
   }
   __pyx_t_5 = ((__pyx_v_self->_mapper.get()->InputSymbols() == NULL) != 0);
   if (__pyx_t_5) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1479
+    /* "fstlib/cext/pywrapfst.pyx":1540
  *     """
  *     if self._mapper.get().InputSymbols() == NULL:
  *       return             # <<<<<<<<<<<<<<
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=True)
  * 
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *)Py_None); __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":1478
+    /* "fstlib/cext/pywrapfst.pyx":1539
  *     Returns the mapper's input symbol table, or None if none is present.
  *     """
  *     if self._mapper.get().InputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=True)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1480
+  /* "fstlib/cext/pywrapfst.pyx":1541
  *     if self._mapper.get().InputSymbols() == NULL:
  *       return
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=True)             # <<<<<<<<<<<<<<
  * 
  *   cpdef _EncodeMapperSymbolTableView output_symbols(self):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1480, __pyx_L1_error)
+    __PYX_ERR(0, 1541, __pyx_L1_error)
   }
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_EncodeMapperSymbolTableView(__pyx_v_self->_mapper, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1480, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_EncodeMapperSymbolTableView(__pyx_v_self->_mapper, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1541, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1472
+  /* "fstlib/cext/pywrapfst.pyx":1533
  *       return _sstrm.str()
  * 
  *   cpdef _EncodeMapperSymbolTableView input_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     input_symbols(self)
  */
 
@@ -16833,15 +17172,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("input_symbols", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_input_symbols(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1472, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_input_symbols(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1533, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -16850,15 +17189,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1482
+/* "fstlib/cext/pywrapfst.pyx":1543
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=True)
  * 
  *   cpdef _EncodeMapperSymbolTableView output_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     output_symbols(self)
  */
 
@@ -16880,15 +17219,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_output_symbols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1482, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_output_symbols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1543, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12EncodeMapper_27output_symbols)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -16897,18 +17236,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1482, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1543, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView))))) __PYX_ERR(0, 1482, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView))))) __PYX_ERR(0, 1543, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -16919,67 +17258,67 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1488
+  /* "fstlib/cext/pywrapfst.pyx":1549
  *     Returns the mapper's output symbol table, or None if none is present.
  *     """
  *     if self._mapper.get().OutputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=False)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1488, __pyx_L1_error)
+    __PYX_ERR(0, 1549, __pyx_L1_error)
   }
   __pyx_t_5 = ((__pyx_v_self->_mapper.get()->OutputSymbols() == NULL) != 0);
   if (__pyx_t_5) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1489
+    /* "fstlib/cext/pywrapfst.pyx":1550
  *     """
  *     if self._mapper.get().OutputSymbols() == NULL:
  *       return             # <<<<<<<<<<<<<<
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=False)
  * 
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *)Py_None); __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":1488
+    /* "fstlib/cext/pywrapfst.pyx":1549
  *     Returns the mapper's output symbol table, or None if none is present.
  *     """
  *     if self._mapper.get().OutputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=False)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1490
+  /* "fstlib/cext/pywrapfst.pyx":1551
  *     if self._mapper.get().OutputSymbols() == NULL:
  *       return
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=False)             # <<<<<<<<<<<<<<
  * 
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1490, __pyx_L1_error)
+    __PYX_ERR(0, 1551, __pyx_L1_error)
   }
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_EncodeMapperSymbolTableView(__pyx_v_self->_mapper, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1490, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_EncodeMapperSymbolTableView(__pyx_v_self->_mapper, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1551, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1482
+  /* "fstlib/cext/pywrapfst.pyx":1543
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=True)
  * 
  *   cpdef _EncodeMapperSymbolTableView output_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     output_symbols(self)
  */
 
@@ -17016,15 +17355,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("output_symbols", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_output_symbols(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1482, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_output_symbols(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1543, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -17033,15 +17372,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1492
+/* "fstlib/cext/pywrapfst.pyx":1553
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=False)
  * 
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:             # <<<<<<<<<<<<<<
  *     if symbols is None:
  *       self._mapper.get().SetInputSymbols(NULL)
  */
 
@@ -17051,75 +17390,75 @@
   int __pyx_t_2;
   fst::SymbolTable const *__pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_set_input_symbols", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1493
+  /* "fstlib/cext/pywrapfst.pyx":1554
  * 
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:             # <<<<<<<<<<<<<<
  *       self._mapper.get().SetInputSymbols(NULL)
  *       return
  */
   __pyx_t_1 = (((PyObject *)__pyx_v_symbols) == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1494
+    /* "fstlib/cext/pywrapfst.pyx":1555
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:
  *       self._mapper.get().SetInputSymbols(NULL)             # <<<<<<<<<<<<<<
  *       return
  *     self._mapper.get().SetInputSymbols(symbols._raw_ptr_or_raise())
  */
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-      __PYX_ERR(0, 1494, __pyx_L1_error)
+      __PYX_ERR(0, 1555, __pyx_L1_error)
     }
     __pyx_v_self->_mapper.get()->SetInputSymbols(NULL);
 
-    /* "fstlib/cext/pywrapfst.pyx":1495
+    /* "fstlib/cext/pywrapfst.pyx":1556
  *     if symbols is None:
  *       self._mapper.get().SetInputSymbols(NULL)
  *       return             # <<<<<<<<<<<<<<
  *     self._mapper.get().SetInputSymbols(symbols._raw_ptr_or_raise())
  * 
  */
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":1493
+    /* "fstlib/cext/pywrapfst.pyx":1554
  * 
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:             # <<<<<<<<<<<<<<
  *       self._mapper.get().SetInputSymbols(NULL)
  *       return
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1496
+  /* "fstlib/cext/pywrapfst.pyx":1557
  *       self._mapper.get().SetInputSymbols(NULL)
  *       return
  *     self._mapper.get().SetInputSymbols(symbols._raw_ptr_or_raise())             # <<<<<<<<<<<<<<
  * 
  *   def set_input_symbols(self, SymbolTableView symbols):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1496, __pyx_L1_error)
+    __PYX_ERR(0, 1557, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 1496, __pyx_L1_error)
+    __PYX_ERR(0, 1557, __pyx_L1_error)
   }
-  __pyx_t_3 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1496, __pyx_L1_error)
+  __pyx_t_3 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1557, __pyx_L1_error)
   __pyx_v_self->_mapper.get()->SetInputSymbols(__pyx_t_3);
 
-  /* "fstlib/cext/pywrapfst.pyx":1492
+  /* "fstlib/cext/pywrapfst.pyx":1553
  *     return _init_EncodeMapperSymbolTableView(self._mapper, input_side=False)
  * 
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:             # <<<<<<<<<<<<<<
  *     if symbols is None:
  *       self._mapper.get().SetInputSymbols(NULL)
  */
 
@@ -17127,15 +17466,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.EncodeMapper._set_input_symbols", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1498
+/* "fstlib/cext/pywrapfst.pyx":1559
  *     self._mapper.get().SetInputSymbols(symbols._raw_ptr_or_raise())
  * 
  *   def set_input_symbols(self, SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *     """
  *     set_input_symbols(self, symbols)
  */
 
@@ -17145,15 +17484,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_12EncodeMapper_29set_input_symbols(PyObject *__pyx_v_self, PyObject *__pyx_v_symbols) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_input_symbols (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 1498, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 1559, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_12EncodeMapper_28set_input_symbols(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_self), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -17165,40 +17504,40 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_input_symbols", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1512
+  /* "fstlib/cext/pywrapfst.pyx":1573
  *       self.
  *     """
  *     self._set_input_symbols(symbols)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_set_input_symbols");
-    __PYX_ERR(0, 1512, __pyx_L1_error)
+    __PYX_ERR(0, 1573, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_self->__pyx_vtab)->_set_input_symbols(__pyx_v_self, __pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1512, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_self->__pyx_vtab)->_set_input_symbols(__pyx_v_self, __pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1573, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1513
+  /* "fstlib/cext/pywrapfst.pyx":1574
  *     """
  *     self._set_input_symbols(symbols)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1498
+  /* "fstlib/cext/pywrapfst.pyx":1559
  *     self._mapper.get().SetInputSymbols(symbols._raw_ptr_or_raise())
  * 
  *   def set_input_symbols(self, SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *     """
  *     set_input_symbols(self, symbols)
  */
 
@@ -17208,15 +17547,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1515
+/* "fstlib/cext/pywrapfst.pyx":1576
  *     return self
  * 
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:             # <<<<<<<<<<<<<<
  *     if symbols is None:
  *       self._mapper.get().SetOutputSymbols(NULL)
  */
 
@@ -17226,75 +17565,75 @@
   int __pyx_t_2;
   fst::SymbolTable const *__pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_set_output_symbols", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1516
+  /* "fstlib/cext/pywrapfst.pyx":1577
  * 
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:             # <<<<<<<<<<<<<<
  *       self._mapper.get().SetOutputSymbols(NULL)
  *       return
  */
   __pyx_t_1 = (((PyObject *)__pyx_v_symbols) == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1517
+    /* "fstlib/cext/pywrapfst.pyx":1578
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:
  *       self._mapper.get().SetOutputSymbols(NULL)             # <<<<<<<<<<<<<<
  *       return
  *     self._mapper.get().SetOutputSymbols(symbols._raw_ptr_or_raise())
  */
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-      __PYX_ERR(0, 1517, __pyx_L1_error)
+      __PYX_ERR(0, 1578, __pyx_L1_error)
     }
     __pyx_v_self->_mapper.get()->SetOutputSymbols(NULL);
 
-    /* "fstlib/cext/pywrapfst.pyx":1518
+    /* "fstlib/cext/pywrapfst.pyx":1579
  *     if symbols is None:
  *       self._mapper.get().SetOutputSymbols(NULL)
  *       return             # <<<<<<<<<<<<<<
  *     self._mapper.get().SetOutputSymbols(symbols._raw_ptr_or_raise())
  * 
  */
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":1516
+    /* "fstlib/cext/pywrapfst.pyx":1577
  * 
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:             # <<<<<<<<<<<<<<
  *       self._mapper.get().SetOutputSymbols(NULL)
  *       return
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1519
+  /* "fstlib/cext/pywrapfst.pyx":1580
  *       self._mapper.get().SetOutputSymbols(NULL)
  *       return
  *     self._mapper.get().SetOutputSymbols(symbols._raw_ptr_or_raise())             # <<<<<<<<<<<<<<
  * 
  *   def set_output_symbols(self, SymbolTableView symbols):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1519, __pyx_L1_error)
+    __PYX_ERR(0, 1580, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 1519, __pyx_L1_error)
+    __PYX_ERR(0, 1580, __pyx_L1_error)
   }
-  __pyx_t_3 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1519, __pyx_L1_error)
+  __pyx_t_3 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1580, __pyx_L1_error)
   __pyx_v_self->_mapper.get()->SetOutputSymbols(__pyx_t_3);
 
-  /* "fstlib/cext/pywrapfst.pyx":1515
+  /* "fstlib/cext/pywrapfst.pyx":1576
  *     return self
  * 
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:             # <<<<<<<<<<<<<<
  *     if symbols is None:
  *       self._mapper.get().SetOutputSymbols(NULL)
  */
 
@@ -17302,15 +17641,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.EncodeMapper._set_output_symbols", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1521
+/* "fstlib/cext/pywrapfst.pyx":1582
  *     self._mapper.get().SetOutputSymbols(symbols._raw_ptr_or_raise())
  * 
  *   def set_output_symbols(self, SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *     """
  *     set_output_symbols(self, symbols)
  */
 
@@ -17320,15 +17659,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_12EncodeMapper_31set_output_symbols(PyObject *__pyx_v_self, PyObject *__pyx_v_symbols) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_output_symbols (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 1521, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 1582, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_12EncodeMapper_30set_output_symbols(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_self), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -17340,40 +17679,40 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_output_symbols", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1535
+  /* "fstlib/cext/pywrapfst.pyx":1596
  *       self.
  *     """
  *     self._set_output_symbols(symbols)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_set_output_symbols");
-    __PYX_ERR(0, 1535, __pyx_L1_error)
+    __PYX_ERR(0, 1596, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_self->__pyx_vtab)->_set_output_symbols(__pyx_v_self, __pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1535, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_self->__pyx_vtab)->_set_output_symbols(__pyx_v_self, __pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1596, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1536
+  /* "fstlib/cext/pywrapfst.pyx":1597
  *     """
  *     self._set_output_symbols(symbols)
  *     return self             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1521
+  /* "fstlib/cext/pywrapfst.pyx":1582
  *     self._mapper.get().SetOutputSymbols(symbols._raw_ptr_or_raise())
  * 
  *   def set_output_symbols(self, SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *     """
  *     set_output_symbols(self, symbols)
  */
 
@@ -17383,15 +17722,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1539
+/* "fstlib/cext/pywrapfst.pyx":1600
  * 
  * 
  * cdef EncodeMapper _init_EncodeMapper(EncodeMapperClass_ptr mapper):             # <<<<<<<<<<<<<<
  *   cdef EncodeMapper result = EncodeMapper.__new__(EncodeMapper)
  *   result._mapper.reset(mapper)
  */
 
@@ -17401,52 +17740,52 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_init_EncodeMapper", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1540
+  /* "fstlib/cext/pywrapfst.pyx":1601
  * 
  * cdef EncodeMapper _init_EncodeMapper(EncodeMapperClass_ptr mapper):
  *   cdef EncodeMapper result = EncodeMapper.__new__(EncodeMapper)             # <<<<<<<<<<<<<<
  *   result._mapper.reset(mapper)
  *   return result
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_EncodeMapper(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1540, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_EncodeMapper(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1601, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v_result = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1541
+  /* "fstlib/cext/pywrapfst.pyx":1602
  * cdef EncodeMapper _init_EncodeMapper(EncodeMapperClass_ptr mapper):
  *   cdef EncodeMapper result = EncodeMapper.__new__(EncodeMapper)
  *   result._mapper.reset(mapper)             # <<<<<<<<<<<<<<
  *   return result
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 1541, __pyx_L1_error)
+    __PYX_ERR(0, 1602, __pyx_L1_error)
   }
   __pyx_v_result->_mapper.reset(__pyx_v_mapper);
 
-  /* "fstlib/cext/pywrapfst.pyx":1542
+  /* "fstlib/cext/pywrapfst.pyx":1603
  *   cdef EncodeMapper result = EncodeMapper.__new__(EncodeMapper)
  *   result._mapper.reset(mapper)
  *   return result             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_result));
   __pyx_r = __pyx_v_result;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1539
+  /* "fstlib/cext/pywrapfst.pyx":1600
  * 
  * 
  * cdef EncodeMapper _init_EncodeMapper(EncodeMapperClass_ptr mapper):             # <<<<<<<<<<<<<<
  *   cdef EncodeMapper result = EncodeMapper.__new__(EncodeMapper)
  *   result._mapper.reset(mapper)
  */
 
@@ -17458,15 +17797,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v_result);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1545
+/* "fstlib/cext/pywrapfst.pyx":1606
  * 
  * 
  * cpdef EncodeMapper _read_EncodeMapper_from_string(string state):             # <<<<<<<<<<<<<<
  *   cdef stringstream _sstrm
  *   _sstrm << state
  */
 
@@ -17481,94 +17820,94 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_read_EncodeMapper_from_string", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1547
+  /* "fstlib/cext/pywrapfst.pyx":1608
  * cpdef EncodeMapper _read_EncodeMapper_from_string(string state):
  *   cdef stringstream _sstrm
  *   _sstrm << state             # <<<<<<<<<<<<<<
- *   cdef unique_ptr[fst.EncodeMapperClass] _mapper
- *   _mapper.reset(fst.EncodeMapperClass.ReadStream(_sstrm, b"<pywrapfst>"))
+ *   cdef unique_ptr[
+ *       fst.EncodeMapperClass] _mapper = fst.EncodeMapperClass.ReadStream(
  */
   (void)((__pyx_v__sstrm << __pyx_v_state));
 
-  /* "fstlib/cext/pywrapfst.pyx":1549
+  /* "fstlib/cext/pywrapfst.pyx":1610
  *   _sstrm << state
- *   cdef unique_ptr[fst.EncodeMapperClass] _mapper
- *   _mapper.reset(fst.EncodeMapperClass.ReadStream(_sstrm, b"<pywrapfst>"))             # <<<<<<<<<<<<<<
+ *   cdef unique_ptr[
+ *       fst.EncodeMapperClass] _mapper = fst.EncodeMapperClass.ReadStream(             # <<<<<<<<<<<<<<
+ *           _sstrm, b"<pywrapfst>")
  *   if _mapper.get() == NULL:
- *     raise FstIOError("Read from string failed")
  */
-  __pyx_v__mapper.reset(fst::script::EncodeMapperClass::Read(__pyx_v__sstrm, __pyx_k_pywrapfst));
+  __pyx_v__mapper = fst::script::EncodeMapperClass::Read(__pyx_v__sstrm, __pyx_k_pywrapfst);
 
-  /* "fstlib/cext/pywrapfst.pyx":1550
- *   cdef unique_ptr[fst.EncodeMapperClass] _mapper
- *   _mapper.reset(fst.EncodeMapperClass.ReadStream(_sstrm, b"<pywrapfst>"))
+  /* "fstlib/cext/pywrapfst.pyx":1612
+ *       fst.EncodeMapperClass] _mapper = fst.EncodeMapperClass.ReadStream(
+ *           _sstrm, b"<pywrapfst>")
  *   if _mapper.get() == NULL:             # <<<<<<<<<<<<<<
  *     raise FstIOError("Read from string failed")
  *   return _init_EncodeMapper(_mapper.release())
  */
   __pyx_t_1 = ((__pyx_v__mapper.get() == NULL) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1551
- *   _mapper.reset(fst.EncodeMapperClass.ReadStream(_sstrm, b"<pywrapfst>"))
+    /* "fstlib/cext/pywrapfst.pyx":1613
+ *           _sstrm, b"<pywrapfst>")
  *   if _mapper.get() == NULL:
  *     raise FstIOError("Read from string failed")             # <<<<<<<<<<<<<<
  *   return _init_EncodeMapper(_mapper.release())
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1551, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1613, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Read_from_string_failed) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Read_from_string_failed);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1551, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1613, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 1551, __pyx_L1_error)
+    __PYX_ERR(0, 1613, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1550
- *   cdef unique_ptr[fst.EncodeMapperClass] _mapper
- *   _mapper.reset(fst.EncodeMapperClass.ReadStream(_sstrm, b"<pywrapfst>"))
+    /* "fstlib/cext/pywrapfst.pyx":1612
+ *       fst.EncodeMapperClass] _mapper = fst.EncodeMapperClass.ReadStream(
+ *           _sstrm, b"<pywrapfst>")
  *   if _mapper.get() == NULL:             # <<<<<<<<<<<<<<
  *     raise FstIOError("Read from string failed")
  *   return _init_EncodeMapper(_mapper.release())
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1552
+  /* "fstlib/cext/pywrapfst.pyx":1614
  *   if _mapper.get() == NULL:
  *     raise FstIOError("Read from string failed")
  *   return _init_EncodeMapper(_mapper.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_EncodeMapper(__pyx_v__mapper.release())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1552, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_EncodeMapper(__pyx_v__mapper.release())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1614, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_t_2);
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1545
+  /* "fstlib/cext/pywrapfst.pyx":1606
  * 
  * 
  * cpdef EncodeMapper _read_EncodeMapper_from_string(string state):             # <<<<<<<<<<<<<<
  *   cdef stringstream _sstrm
  *   _sstrm << state
  */
 
@@ -17592,15 +17931,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_read_EncodeMapper_from_string (wrapper)", 0);
   assert(__pyx_arg_state); {
-    __pyx_v_state = __pyx_convert_string_from_py_std__in_string(__pyx_arg_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1545, __pyx_L3_error)
+    __pyx_v_state = __pyx_convert_string_from_py_std__in_string(__pyx_arg_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1606, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._read_EncodeMapper_from_string", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
@@ -17616,15 +17955,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_read_EncodeMapper_from_string", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_EncodeMapper_from_string(__pyx_v_state, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1545, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_EncodeMapper_from_string(__pyx_v_state, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1606, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -17633,160 +17972,176 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1578
+/* "fstlib/cext/pywrapfst.pyx":1640
  * 
  *   @staticmethod
  *   cdef string _local_render_svg(const string &dot):             # <<<<<<<<<<<<<<
- *     proc = subprocess.Popen(("dot", "-Tsvg"),
- *                             stdin=subprocess.PIPE,
+ *     # As suggested in the following, we now use the Cairo renderer:
+ *     # https://github.com/kylebgorman/pynini/issues/35
  */
 
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_3Fst__local_render_svg(std::string const &__pyx_v_dot) {
   PyObject *__pyx_v_proc = NULL;
   std::string __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  std::string __pyx_t_5;
+  PyObject *__pyx_t_5 = NULL;
+  std::string __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_local_render_svg", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1579
- *   @staticmethod
- *   cdef string _local_render_svg(const string &dot):
- *     proc = subprocess.Popen(("dot", "-Tsvg"),             # <<<<<<<<<<<<<<
+  /* "fstlib/cext/pywrapfst.pyx":1643
+ *     # As suggested in the following, we now use the Cairo renderer:
+ *     # https://github.com/kylebgorman/pynini/issues/35
+ *     proc = subprocess.Popen(["dot", "-Tsvg:cairo"],             # <<<<<<<<<<<<<<
  *                             stdin=subprocess.PIPE,
  *                             stdout=subprocess.PIPE)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_subprocess); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1579, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_subprocess); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1643, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_Popen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1579, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_Popen); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1643, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1643, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_INCREF(__pyx_n_u_dot);
+  __Pyx_GIVEREF(__pyx_n_u_dot);
+  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_u_dot);
+  __Pyx_INCREF(__pyx_kp_u_Tsvg_cairo);
+  __Pyx_GIVEREF(__pyx_kp_u_Tsvg_cairo);
+  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_kp_u_Tsvg_cairo);
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1643, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
+  __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1580
- *   cdef string _local_render_svg(const string &dot):
- *     proc = subprocess.Popen(("dot", "-Tsvg"),
+  /* "fstlib/cext/pywrapfst.pyx":1644
+ *     # https://github.com/kylebgorman/pynini/issues/35
+ *     proc = subprocess.Popen(["dot", "-Tsvg:cairo"],
  *                             stdin=subprocess.PIPE,             # <<<<<<<<<<<<<<
  *                             stdout=subprocess.PIPE)
  *     return proc.communicate(dot.encode("utf8"))[0]
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1580, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1644, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_subprocess); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1580, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1580, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_subprocess); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1644, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_stdin, __pyx_t_4) < 0) __PYX_ERR(0, 1580, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1644, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_stdin, __pyx_t_5) < 0) __PYX_ERR(0, 1644, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1581
- *     proc = subprocess.Popen(("dot", "-Tsvg"),
+  /* "fstlib/cext/pywrapfst.pyx":1645
+ *     proc = subprocess.Popen(["dot", "-Tsvg:cairo"],
  *                             stdin=subprocess.PIPE,
  *                             stdout=subprocess.PIPE)             # <<<<<<<<<<<<<<
  *     return proc.communicate(dot.encode("utf8"))[0]
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_subprocess); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1581, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_subprocess); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1645, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1645, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_PIPE); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1581, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_stdout, __pyx_t_4) < 0) __PYX_ERR(0, 1644, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_stdout, __pyx_t_3) < 0) __PYX_ERR(0, 1580, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1579
- *   @staticmethod
- *   cdef string _local_render_svg(const string &dot):
- *     proc = subprocess.Popen(("dot", "-Tsvg"),             # <<<<<<<<<<<<<<
+  /* "fstlib/cext/pywrapfst.pyx":1643
+ *     # As suggested in the following, we now use the Cairo renderer:
+ *     # https://github.com/kylebgorman/pynini/issues/35
+ *     proc = subprocess.Popen(["dot", "-Tsvg:cairo"],             # <<<<<<<<<<<<<<
  *                             stdin=subprocess.PIPE,
  *                             stdout=subprocess.PIPE)
  */
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_tuple__10, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1579, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1643, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_v_proc = __pyx_t_3;
-  __pyx_t_3 = 0;
+  __pyx_v_proc = __pyx_t_4;
+  __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1582
+  /* "fstlib/cext/pywrapfst.pyx":1646
  *                             stdin=subprocess.PIPE,
  *                             stdout=subprocess.PIPE)
  *     return proc.communicate(dot.encode("utf8"))[0]             # <<<<<<<<<<<<<<
  * 
  *   def _repr_svg_(self):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_proc, __pyx_n_s_communicate); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1582, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_proc, __pyx_n_s_communicate); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1646, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_dot); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1582, __pyx_L1_error)
+  __pyx_t_3 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_dot); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1646, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_2 = PyUnicode_AsUTF8String(((PyObject*)__pyx_t_3)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1646, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyUnicode_AsUTF8String(((PyObject*)__pyx_t_2)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1582, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = NULL;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
-    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
-    if (likely(__pyx_t_2)) {
+    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
+    if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
-      __Pyx_INCREF(__pyx_t_2);
+      __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
-  __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1582, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1646, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (unlikely(__pyx_t_3 == Py_None)) {
+  if (unlikely(__pyx_t_4 == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(0, 1582, __pyx_L1_error)
+    __PYX_ERR(0, 1646, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1582, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1646, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1582, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_6 = __pyx_convert_string_from_py_std__in_string(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1646, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_r = __pyx_t_5;
+  __pyx_r = __pyx_t_6;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1578
+  /* "fstlib/cext/pywrapfst.pyx":1640
  * 
  *   @staticmethod
  *   cdef string _local_render_svg(const string &dot):             # <<<<<<<<<<<<<<
- *     proc = subprocess.Popen(("dot", "-Tsvg"),
- *                             stdin=subprocess.PIPE,
+ *     # As suggested in the following, we now use the Cairo renderer:
+ *     # https://github.com/kylebgorman/pynini/issues/35
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst.Fst._local_render_svg", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __Pyx_pretend_to_initialize(&__pyx_r);
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_proc);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1584
+/* "fstlib/cext/pywrapfst.pyx":1648
  *     return proc.communicate(dot.encode("utf8"))[0]
  * 
  *   def _repr_svg_(self):             # <<<<<<<<<<<<<<
  *     """IPython notebook magic to produce an SVG of the FST using GraphViz.
  * 
  */
 
@@ -17830,81 +18185,81 @@
   PyObject *__pyx_t_18 = NULL;
   PyObject *__pyx_t_19 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_repr_svg_", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1592
+  /* "fstlib/cext/pywrapfst.pyx":1656
  *     """
  *     cdef stringstream _sstrm
  *     cdef bool acceptor = (self._fst.get().Properties(fst.kAcceptor, True) ==             # <<<<<<<<<<<<<<
  *                           fst.kAcceptor)
  *     fst.Draw(deref(self._fst),
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1592, __pyx_L1_error)
+    __PYX_ERR(0, 1656, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1593
+  /* "fstlib/cext/pywrapfst.pyx":1657
  *     cdef stringstream _sstrm
  *     cdef bool acceptor = (self._fst.get().Properties(fst.kAcceptor, True) ==
  *                           fst.kAcceptor)             # <<<<<<<<<<<<<<
  *     fst.Draw(deref(self._fst),
  *              self._fst.get().InputSymbols(),
  */
   __pyx_v_acceptor = (__pyx_v_self->_fst.get()->Properties(fst::kAcceptor, 1) == fst::kAcceptor);
 
-  /* "fstlib/cext/pywrapfst.pyx":1594
+  /* "fstlib/cext/pywrapfst.pyx":1658
  *     cdef bool acceptor = (self._fst.get().Properties(fst.kAcceptor, True) ==
  *                           fst.kAcceptor)
  *     fst.Draw(deref(self._fst),             # <<<<<<<<<<<<<<
  *              self._fst.get().InputSymbols(),
  *              self._fst.get().OutputSymbols(),
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1594, __pyx_L1_error)
+    __PYX_ERR(0, 1658, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1595
+  /* "fstlib/cext/pywrapfst.pyx":1659
  *                           fst.kAcceptor)
  *     fst.Draw(deref(self._fst),
  *              self._fst.get().InputSymbols(),             # <<<<<<<<<<<<<<
  *              self._fst.get().OutputSymbols(),
  *              NULL,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1595, __pyx_L1_error)
+    __PYX_ERR(0, 1659, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1596
+  /* "fstlib/cext/pywrapfst.pyx":1660
  *     fst.Draw(deref(self._fst),
  *              self._fst.get().InputSymbols(),
  *              self._fst.get().OutputSymbols(),             # <<<<<<<<<<<<<<
  *              NULL,
  *              acceptor,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1596, __pyx_L1_error)
+    __PYX_ERR(0, 1660, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1594
+  /* "fstlib/cext/pywrapfst.pyx":1658
  *     cdef bool acceptor = (self._fst.get().Properties(fst.kAcceptor, True) ==
  *                           fst.kAcceptor)
  *     fst.Draw(deref(self._fst),             # <<<<<<<<<<<<<<
  *              self._fst.get().InputSymbols(),
  *              self._fst.get().OutputSymbols(),
  */
-  fst::script::Draw((*__pyx_v_self->_fst), __pyx_v_self->_fst.get()->InputSymbols(), __pyx_v_self->_fst.get()->OutputSymbols(), NULL, __pyx_v_acceptor, __pyx_k__11, 8.5, 11.0, 1, 0, 0.4, 0.25, 14, 5, __pyx_k_g, 0, __pyx_v__sstrm, __pyx_k_pywrapfst);
+  fst::script::Draw((*__pyx_v_self->_fst), __pyx_v_self->_fst.get()->InputSymbols(), __pyx_v_self->_fst.get()->OutputSymbols(), NULL, __pyx_v_acceptor, __pyx_k__9, 8.5, 11.0, 1, 0, 0.4, 0.25, 14, 5, __pyx_k_g, 0, __pyx_v__sstrm, __pyx_k_pywrapfst);
 
-  /* "fstlib/cext/pywrapfst.pyx":1612
+  /* "fstlib/cext/pywrapfst.pyx":1676
  *              _sstrm,
  *              b"<pywrapfst>")
  *     try:             # <<<<<<<<<<<<<<
  *       return Fst._local_render_svg(_sstrm.str())
  *     except Exception as e:
  */
   {
@@ -17912,67 +18267,67 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "fstlib/cext/pywrapfst.pyx":1613
+      /* "fstlib/cext/pywrapfst.pyx":1677
  *              b"<pywrapfst>")
  *     try:
  *       return Fst._local_render_svg(_sstrm.str())             # <<<<<<<<<<<<<<
  *     except Exception as e:
  *       logging.error("Dot rendering failed: %s", e)
  */
       __Pyx_XDECREF(__pyx_r);
-      __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst__local_render_svg(__pyx_v__sstrm.str())); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1613, __pyx_L3_error)
+      __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst__local_render_svg(__pyx_v__sstrm.str())); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1677, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_4);
       __pyx_r = __pyx_t_4;
       __pyx_t_4 = 0;
       goto __pyx_L7_try_return;
 
-      /* "fstlib/cext/pywrapfst.pyx":1612
+      /* "fstlib/cext/pywrapfst.pyx":1676
  *              _sstrm,
  *              b"<pywrapfst>")
  *     try:             # <<<<<<<<<<<<<<
  *       return Fst._local_render_svg(_sstrm.str())
  *     except Exception as e:
  */
     }
     __pyx_L3_error:;
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "fstlib/cext/pywrapfst.pyx":1614
+    /* "fstlib/cext/pywrapfst.pyx":1678
  *     try:
  *       return Fst._local_render_svg(_sstrm.str())
  *     except Exception as e:             # <<<<<<<<<<<<<<
  *       logging.error("Dot rendering failed: %s", e)
  * 
  */
     __pyx_t_5 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_5) {
       __Pyx_AddTraceback("fstlib.cext.pywrapfst.Fst._repr_svg_", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(0, 1614, __pyx_L5_except_error)
+      if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(0, 1678, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_6);
       __pyx_v_e = __pyx_t_6;
       /*try:*/ {
 
-        /* "fstlib/cext/pywrapfst.pyx":1615
+        /* "fstlib/cext/pywrapfst.pyx":1679
  *       return Fst._local_render_svg(_sstrm.str())
  *     except Exception as e:
  *       logging.error("Dot rendering failed: %s", e)             # <<<<<<<<<<<<<<
  * 
  *   def __init__(self):
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_logging); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1615, __pyx_L14_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_logging); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1679, __pyx_L14_error)
         __Pyx_GOTREF(__pyx_t_9);
-        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_error); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1615, __pyx_L14_error)
+        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_error); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1679, __pyx_L14_error)
         __Pyx_GOTREF(__pyx_t_10);
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         __pyx_t_9 = NULL;
         __pyx_t_5 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
           __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_10);
           if (likely(__pyx_t_9)) {
@@ -17982,48 +18337,48 @@
             __Pyx_DECREF_SET(__pyx_t_10, function);
             __pyx_t_5 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_10)) {
           PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_kp_u_Dot_rendering_failed_s, __pyx_v_e};
-          __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1615, __pyx_L14_error)
+          __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1679, __pyx_L14_error)
           __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
           __Pyx_GOTREF(__pyx_t_8);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
           PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_kp_u_Dot_rendering_failed_s, __pyx_v_e};
-          __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1615, __pyx_L14_error)
+          __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1679, __pyx_L14_error)
           __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
           __Pyx_GOTREF(__pyx_t_8);
         } else
         #endif
         {
-          __pyx_t_11 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1615, __pyx_L14_error)
+          __pyx_t_11 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1679, __pyx_L14_error)
           __Pyx_GOTREF(__pyx_t_11);
           if (__pyx_t_9) {
             __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_9); __pyx_t_9 = NULL;
           }
           __Pyx_INCREF(__pyx_kp_u_Dot_rendering_failed_s);
           __Pyx_GIVEREF(__pyx_kp_u_Dot_rendering_failed_s);
           PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_5, __pyx_kp_u_Dot_rendering_failed_s);
           __Pyx_INCREF(__pyx_v_e);
           __Pyx_GIVEREF(__pyx_v_e);
           PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_5, __pyx_v_e);
-          __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_11, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1615, __pyx_L14_error)
+          __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_11, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1679, __pyx_L14_error)
           __Pyx_GOTREF(__pyx_t_8);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         }
         __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       }
 
-      /* "fstlib/cext/pywrapfst.pyx":1614
+      /* "fstlib/cext/pywrapfst.pyx":1678
  *     try:
  *       return Fst._local_render_svg(_sstrm.str())
  *     except Exception as e:             # <<<<<<<<<<<<<<
  *       logging.error("Dot rendering failed: %s", e)
  * 
  */
       /*finally:*/ {
@@ -18074,15 +18429,15 @@
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       goto __pyx_L4_exception_handled;
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "fstlib/cext/pywrapfst.pyx":1612
+    /* "fstlib/cext/pywrapfst.pyx":1676
  *              _sstrm,
  *              b"<pywrapfst>")
  *     try:             # <<<<<<<<<<<<<<
  *       return Fst._local_render_svg(_sstrm.str())
  *     except Exception as e:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
@@ -18099,15 +18454,15 @@
     __pyx_L4_exception_handled:;
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1584
+  /* "fstlib/cext/pywrapfst.pyx":1648
  *     return proc.communicate(dot.encode("utf8"))[0]
  * 
  *   def _repr_svg_(self):             # <<<<<<<<<<<<<<
  *     """IPython notebook magic to produce an SVG of the FST using GraphViz.
  * 
  */
 
@@ -18127,15 +18482,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_e);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1617
+/* "fstlib/cext/pywrapfst.pyx":1681
  *       logging.error("Dot rendering failed: %s", e)
  * 
  *   def __init__(self):             # <<<<<<<<<<<<<<
  *     raise NotImplementedError(f"Cannot construct {self._class__.__name__}")
  * 
  */
 
@@ -18161,40 +18516,40 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1618
+  /* "fstlib/cext/pywrapfst.pyx":1682
  * 
  *   def __init__(self):
  *     raise NotImplementedError(f"Cannot construct {self._class__.__name__}")             # <<<<<<<<<<<<<<
  * 
  *   # Registers the class for pickling; must be repeated in any subclass which
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1618, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1682, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1618, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1682, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_2, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1618, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_2, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1682, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Cannot_construct, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1618, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Cannot_construct, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1682, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_NotImplementedError, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1618, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_NotImplementedError, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1682, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(0, 1618, __pyx_L1_error)
+  __PYX_ERR(0, 1682, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1617
+  /* "fstlib/cext/pywrapfst.pyx":1681
  *       logging.error("Dot rendering failed: %s", e)
  * 
  *   def __init__(self):             # <<<<<<<<<<<<<<
  *     raise NotImplementedError(f"Cannot construct {self._class__.__name__}")
  * 
  */
 
@@ -18204,15 +18559,15 @@
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Fst.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1623
+/* "fstlib/cext/pywrapfst.pyx":1687
  *   # can't be derived by _init_XFst.
  * 
  *   def __reduce__(self):             # <<<<<<<<<<<<<<
  *     return (_read_Fst_from_string, (self.write_to_string(),))
  * 
  */
 
@@ -18236,48 +18591,48 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__reduce__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1624
+  /* "fstlib/cext/pywrapfst.pyx":1688
  * 
  *   def __reduce__(self):
  *     return (_read_Fst_from_string, (self.write_to_string(),))             # <<<<<<<<<<<<<<
  * 
  *   def __repr__(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_read_Fst_from_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1624, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_read_Fst_from_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1688, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "write_to_string");
-    __PYX_ERR(0, 1624, __pyx_L1_error)
+    __PYX_ERR(0, 1688, __pyx_L1_error)
   }
-  __pyx_t_2 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self->__pyx_vtab)->write_to_string(__pyx_v_self, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1624, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self->__pyx_vtab)->write_to_string(__pyx_v_self, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1688, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1624, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1688, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1624, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1688, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_3 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1623
+  /* "fstlib/cext/pywrapfst.pyx":1687
  *   # can't be derived by _init_XFst.
  * 
  *   def __reduce__(self):             # <<<<<<<<<<<<<<
  *     return (_read_Fst_from_string, (self.write_to_string(),))
  * 
  */
 
@@ -18290,15 +18645,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1626
+/* "fstlib/cext/pywrapfst.pyx":1690
  *     return (_read_Fst_from_string, (self.write_to_string(),))
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<{self.fst_type()} Fst at 0x{id(self):x}>"
  * 
  */
 
@@ -18324,67 +18679,67 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1627
+  /* "fstlib/cext/pywrapfst.pyx":1691
  * 
  *   def __repr__(self):
  *     return f"<{self.fst_type()} Fst at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
  *   def __str__(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1627, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1691, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u__2);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__2);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u__2);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "fst_type");
-    __PYX_ERR(0, 1627, __pyx_L1_error)
+    __PYX_ERR(0, 1691, __pyx_L1_error)
   }
-  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self->__pyx_vtab)->fst_type(__pyx_v_self, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1627, __pyx_L1_error)
+  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self->__pyx_vtab)->fst_type(__pyx_v_self, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1691, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
   __pyx_t_4 = 0;
   __Pyx_INCREF(__pyx_kp_u_Fst_at_0x);
   __pyx_t_2 += 10;
   __Pyx_GIVEREF(__pyx_kp_u_Fst_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_Fst_at_0x);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1627, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1691, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1627, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1691, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1627, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1691, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1626
+  /* "fstlib/cext/pywrapfst.pyx":1690
  *     return (_read_Fst_from_string, (self.write_to_string(),))
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<{self.fst_type()} Fst at 0x{id(self):x}>"
  * 
  */
 
@@ -18397,15 +18752,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1629
+/* "fstlib/cext/pywrapfst.pyx":1693
  *     return f"<{self.fst_type()} Fst at 0x{id(self):x}>"
  * 
  *   def __str__(self):             # <<<<<<<<<<<<<<
  *     return self.print()
  * 
  */
 
@@ -18428,34 +18783,34 @@
   std::string __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__str__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1630
+  /* "fstlib/cext/pywrapfst.pyx":1694
  * 
  *   def __str__(self):
  *     return self.print()             # <<<<<<<<<<<<<<
  * 
  *   cpdef string arc_type(self):
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "print");
-    __PYX_ERR(0, 1630, __pyx_L1_error)
+    __PYX_ERR(0, 1694, __pyx_L1_error)
   }
-  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self->__pyx_vtab)->print(__pyx_v_self, 0, NULL); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1630, __pyx_L1_error)
-  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1630, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self->__pyx_vtab)->print(__pyx_v_self, 0, NULL); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1694, __pyx_L1_error)
+  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1694, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1629
+  /* "fstlib/cext/pywrapfst.pyx":1693
  *     return f"<{self.fst_type()} Fst at 0x{id(self):x}>"
  * 
  *   def __str__(self):             # <<<<<<<<<<<<<<
  *     return self.print()
  * 
  */
 
@@ -18466,15 +18821,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1632
+/* "fstlib/cext/pywrapfst.pyx":1696
  *     return self.print()
  * 
  *   cpdef string arc_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     arc_type(self)
  */
 
@@ -18496,15 +18851,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_arc_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1632, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_arc_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1696, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_11arc_type)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -18512,18 +18867,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1632, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1696, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1632, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1696, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -18534,29 +18889,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1638
+  /* "fstlib/cext/pywrapfst.pyx":1702
  *     Returns a string indicating the arc type.
  *     """
  *     return self._fst.get().ArcType()             # <<<<<<<<<<<<<<
  * 
- *   cpdef _ArcIterator arcs(self, int64 state):
+ *   cpdef _ArcIterator arcs(self, int64_t state):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1638, __pyx_L1_error)
+    __PYX_ERR(0, 1702, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_fst.get()->ArcType();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1632
+  /* "fstlib/cext/pywrapfst.pyx":1696
  *     return self.print()
  * 
  *   cpdef string arc_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     arc_type(self)
  */
 
@@ -18592,15 +18947,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("arc_type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arc_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1632, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arc_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1696, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -18609,24 +18964,24 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1640
+/* "fstlib/cext/pywrapfst.pyx":1704
  *     return self._fst.get().ArcType()
  * 
- *   cpdef _ArcIterator arcs(self, int64 state):             # <<<<<<<<<<<<<<
+ *   cpdef _ArcIterator arcs(self, int64_t state):             # <<<<<<<<<<<<<<
  *     """
  *     arcs(self, state)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_13arcs(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
-static struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch) {
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -18639,19 +18994,19 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_arcs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1640, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_arcs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1704, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_13arcs)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
-        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1640, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1704, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -18659,18 +19014,18 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1640, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1704, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__ArcIterator))))) __PYX_ERR(0, 1640, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__ArcIterator))))) __PYX_ERR(0, 1704, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -18681,43 +19036,43 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1652
+  /* "fstlib/cext/pywrapfst.pyx":1716
  *       An _ArcIterator.
  *     """
  *     return _ArcIterator(self, state)             # <<<<<<<<<<<<<<
  * 
  *   cpdef Fst copy(self):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1652, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1716, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1652, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1716, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
   PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__ArcIterator), __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1652, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__ArcIterator), __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1716, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1640
+  /* "fstlib/cext/pywrapfst.pyx":1704
  *     return self._fst.get().ArcType()
  * 
- *   cpdef _ArcIterator arcs(self, int64 state):             # <<<<<<<<<<<<<<
+ *   cpdef _ArcIterator arcs(self, int64_t state):             # <<<<<<<<<<<<<<
  *     """
  *     arcs(self, state)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -18733,47 +19088,47 @@
   return __pyx_r;
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_13arcs(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_3Fst_12arcs[] = "\n    arcs(self, state)\n\n    Returns an iterator over arcs leaving the specified state.\n\n    Args:\n      state: The source state ID.\n\n    Returns:\n      An _ArcIterator.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_13arcs(PyObject *__pyx_v_self, PyObject *__pyx_arg_state) {
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("arcs (wrapper)", 0);
   assert(__pyx_arg_state); {
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1640, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1704, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Fst.arcs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_12arcs(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), ((int64)__pyx_v_state));
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_12arcs(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), ((int64_t)__pyx_v_state));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_12arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_12arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("arcs", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arcs(__pyx_v_self, __pyx_v_state, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1640, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arcs(__pyx_v_self, __pyx_v_state, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1704, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -18782,15 +19137,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1654
+/* "fstlib/cext/pywrapfst.pyx":1718
  *     return _ArcIterator(self, state)
  * 
  *   cpdef Fst copy(self):             # <<<<<<<<<<<<<<
  *     """
  *     copy(self)
  */
 
@@ -18811,15 +19166,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1654, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1718, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_15copy)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -18828,18 +19183,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1654, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1718, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst))))) __PYX_ERR(0, 1654, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst))))) __PYX_ERR(0, 1718, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -18850,33 +19205,33 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1660
+  /* "fstlib/cext/pywrapfst.pyx":1724
  *     Makes a copy of the FST.
  *     """
  *     return _init_XFst(new fst.FstClass(deref(self._fst)))             # <<<<<<<<<<<<<<
  * 
  *   cpdef void draw(self,
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1660, __pyx_L1_error)
+    __PYX_ERR(0, 1724, __pyx_L1_error)
   }
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(new fst::script::FstClass((*__pyx_v_self->_fst)))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1660, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(new fst::script::FstClass((*__pyx_v_self->_fst)))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1724, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1654
+  /* "fstlib/cext/pywrapfst.pyx":1718
  *     return _ArcIterator(self, state)
  * 
  *   cpdef Fst copy(self):             # <<<<<<<<<<<<<<
  *     """
  *     copy(self)
  */
 
@@ -18913,15 +19268,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("copy", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_copy(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1654, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_copy(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1718, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -18930,89 +19285,89 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1662
+/* "fstlib/cext/pywrapfst.pyx":1726
  *     return _init_XFst(new fst.FstClass(deref(self._fst)))
  * 
  *   cpdef void draw(self,             # <<<<<<<<<<<<<<
  *                   source,
  *                   SymbolTableView isymbols=None,
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_17draw(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static void __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_draw(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, PyObject *__pyx_v_source, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_draw *__pyx_optional_args) {
 
-  /* "fstlib/cext/pywrapfst.pyx":1664
+  /* "fstlib/cext/pywrapfst.pyx":1728
  *   cpdef void draw(self,
  *                   source,
  *                   SymbolTableView isymbols=None,             # <<<<<<<<<<<<<<
  *                   SymbolTableView osymbols=None,
  *                   SymbolTableView ssymbols=None,
  */
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_isymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-  /* "fstlib/cext/pywrapfst.pyx":1665
+  /* "fstlib/cext/pywrapfst.pyx":1729
  *                   source,
  *                   SymbolTableView isymbols=None,
  *                   SymbolTableView osymbols=None,             # <<<<<<<<<<<<<<
  *                   SymbolTableView ssymbols=None,
  *                   bool acceptor=False,
  */
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_osymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-  /* "fstlib/cext/pywrapfst.pyx":1666
+  /* "fstlib/cext/pywrapfst.pyx":1730
  *                   SymbolTableView isymbols=None,
  *                   SymbolTableView osymbols=None,
  *                   SymbolTableView ssymbols=None,             # <<<<<<<<<<<<<<
  *                   bool acceptor=False,
  *                   title="",
  */
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_ssymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-  /* "fstlib/cext/pywrapfst.pyx":1667
+  /* "fstlib/cext/pywrapfst.pyx":1731
  *                   SymbolTableView osymbols=None,
  *                   SymbolTableView ssymbols=None,
  *                   bool acceptor=False,             # <<<<<<<<<<<<<<
  *                   title="",
  *                   double width=8.5,
  */
   bool __pyx_v_acceptor = ((bool)0);
-  PyObject *__pyx_v_title = ((PyObject *)__pyx_kp_u__11);
+  PyObject *__pyx_v_title = ((PyObject *)__pyx_kp_u__9);
   double __pyx_v_width = ((double)8.5);
   double __pyx_v_height = ((double)11.0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1671
+  /* "fstlib/cext/pywrapfst.pyx":1735
  *                   double width=8.5,
  *                   double height=11,
  *                   bool portrait=False,             # <<<<<<<<<<<<<<
  *                   bool vertical=False,
  *                   double ranksep=0.4,
  */
   bool __pyx_v_portrait = ((bool)0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1672
+  /* "fstlib/cext/pywrapfst.pyx":1736
  *                   double height=11,
  *                   bool portrait=False,
  *                   bool vertical=False,             # <<<<<<<<<<<<<<
  *                   double ranksep=0.4,
  *                   double nodesep=0.25,
  */
   bool __pyx_v_vertical = ((bool)0);
   double __pyx_v_ranksep = ((double)0.4);
   double __pyx_v_nodesep = ((double)0.25);
-  int32 __pyx_v_fontsize = ((int32)14);
-  int32 __pyx_v_precision = ((int32)5);
+  int32_t __pyx_v_fontsize = ((int32_t)14);
+  int32_t __pyx_v_precision = ((int32_t)5);
   PyObject *__pyx_v_float_format = ((PyObject *)__pyx_n_u_g);
 
-  /* "fstlib/cext/pywrapfst.pyx":1678
- *                   int32 precision=5,
+  /* "fstlib/cext/pywrapfst.pyx":1742
+ *                   int32_t precision=5,
  *                   float_format="g",
  *                   bool show_weight_one=False) except *:             # <<<<<<<<<<<<<<
  *     """
  *     draw(self, source, isymbols=None, osymbols=None, ssymbols=None,
  */
   bool __pyx_v_show_weight_one = ((bool)0);
   std::string __pyx_v__source;
@@ -19090,15 +19445,15 @@
             }
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1662
+  /* "fstlib/cext/pywrapfst.pyx":1726
  *     return _init_XFst(new fst.FstClass(deref(self._fst)))
  * 
  *   cpdef void draw(self,             # <<<<<<<<<<<<<<
  *                   source,
  *                   SymbolTableView isymbols=None,
  */
   /* Check if called by wrapper */
@@ -19106,36 +19461,36 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_draw); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1662, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_draw); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1726, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_17draw)) {
-        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_acceptor); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1662, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_acceptor); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1726, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_width); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1662, __pyx_L1_error)
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_width); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1726, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_5 = PyFloat_FromDouble(__pyx_v_height); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1662, __pyx_L1_error)
+        __pyx_t_5 = PyFloat_FromDouble(__pyx_v_height); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1726, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_6 = __Pyx_PyBool_FromLong(__pyx_v_portrait); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1662, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyBool_FromLong(__pyx_v_portrait); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1726, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyBool_FromLong(__pyx_v_vertical); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1662, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyBool_FromLong(__pyx_v_vertical); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1726, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_8 = PyFloat_FromDouble(__pyx_v_ranksep); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1662, __pyx_L1_error)
+        __pyx_t_8 = PyFloat_FromDouble(__pyx_v_ranksep); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1726, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_9 = PyFloat_FromDouble(__pyx_v_nodesep); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1662, __pyx_L1_error)
+        __pyx_t_9 = PyFloat_FromDouble(__pyx_v_nodesep); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1726, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
-        __pyx_t_10 = __Pyx_PyInt_From_int32_t(__pyx_v_fontsize); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1662, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyInt_From_int32_t(__pyx_v_fontsize); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1726, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_10);
-        __pyx_t_11 = __Pyx_PyInt_From_int32_t(__pyx_v_precision); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1662, __pyx_L1_error)
+        __pyx_t_11 = __Pyx_PyInt_From_int32_t(__pyx_v_precision); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1726, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
-        __pyx_t_12 = __Pyx_PyBool_FromLong(__pyx_v_show_weight_one); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1662, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_PyBool_FromLong(__pyx_v_show_weight_one); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1726, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_13 = __pyx_t_1; __pyx_t_14 = NULL;
         __pyx_t_15 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
           __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
           if (likely(__pyx_t_14)) {
@@ -19145,15 +19500,15 @@
             __Pyx_DECREF_SET(__pyx_t_13, function);
             __pyx_t_15 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_13)) {
           PyObject *__pyx_temp[17] = {__pyx_t_14, __pyx_v_source, ((PyObject *)__pyx_v_isymbols), ((PyObject *)__pyx_v_osymbols), ((PyObject *)__pyx_v_ssymbols), __pyx_t_3, __pyx_v_title, __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9, __pyx_t_10, __pyx_t_11, __pyx_v_float_format, __pyx_t_12};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_13, __pyx_temp+1-__pyx_t_15, 16+__pyx_t_15); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1662, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_13, __pyx_temp+1-__pyx_t_15, 16+__pyx_t_15); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1726, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
@@ -19163,15 +19518,15 @@
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_13)) {
           PyObject *__pyx_temp[17] = {__pyx_t_14, __pyx_v_source, ((PyObject *)__pyx_v_isymbols), ((PyObject *)__pyx_v_osymbols), ((PyObject *)__pyx_v_ssymbols), __pyx_t_3, __pyx_v_title, __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9, __pyx_t_10, __pyx_t_11, __pyx_v_float_format, __pyx_t_12};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_13, __pyx_temp+1-__pyx_t_15, 16+__pyx_t_15); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1662, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_13, __pyx_temp+1-__pyx_t_15, 16+__pyx_t_15); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1726, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
@@ -19179,15 +19534,15 @@
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
           __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
         } else
         #endif
         {
-          __pyx_t_16 = PyTuple_New(16+__pyx_t_15); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 1662, __pyx_L1_error)
+          __pyx_t_16 = PyTuple_New(16+__pyx_t_15); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 1726, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_16);
           if (__pyx_t_14) {
             __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_16, 0, __pyx_t_14); __pyx_t_14 = NULL;
           }
           __Pyx_INCREF(__pyx_v_source);
           __Pyx_GIVEREF(__pyx_v_source);
           PyTuple_SET_ITEM(__pyx_t_16, 0+__pyx_t_15, __pyx_v_source);
@@ -19232,15 +19587,15 @@
           __pyx_t_6 = 0;
           __pyx_t_7 = 0;
           __pyx_t_8 = 0;
           __pyx_t_9 = 0;
           __pyx_t_10 = 0;
           __pyx_t_11 = 0;
           __pyx_t_12 = 0;
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_16, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1662, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_16, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1726, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
         }
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
@@ -19254,210 +19609,210 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1710
+  /* "fstlib/cext/pywrapfst.pyx":1774
  *       show_weight_one: Should weights equivalent to semiring One be printed?
  *     """
  *     cdef string _source = path_tostring(source)             # <<<<<<<<<<<<<<
  *     cdef unique_ptr[ostream] _fstrm
  *     _fstrm.reset(new ofstream(_source))
  */
-  __pyx_t_17 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1710, __pyx_L1_error)
+  __pyx_t_17 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1774, __pyx_L1_error)
   __pyx_v__source = __pyx_t_17;
 
-  /* "fstlib/cext/pywrapfst.pyx":1712
+  /* "fstlib/cext/pywrapfst.pyx":1776
  *     cdef string _source = path_tostring(source)
  *     cdef unique_ptr[ostream] _fstrm
  *     _fstrm.reset(new ofstream(_source))             # <<<<<<<<<<<<<<
  *     cdef const fst.SymbolTable *_isymbols = self._fst.get().InputSymbols()
  *     if isymbols is not None:
  */
   __pyx_v__fstrm.reset(new std::ofstream(__pyx_v__source));
 
-  /* "fstlib/cext/pywrapfst.pyx":1713
+  /* "fstlib/cext/pywrapfst.pyx":1777
  *     cdef unique_ptr[ostream] _fstrm
  *     _fstrm.reset(new ofstream(_source))
  *     cdef const fst.SymbolTable *_isymbols = self._fst.get().InputSymbols()             # <<<<<<<<<<<<<<
  *     if isymbols is not None:
  *        _isymbols = isymbols._raw_ptr_or_raise()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1713, __pyx_L1_error)
+    __PYX_ERR(0, 1777, __pyx_L1_error)
   }
   __pyx_v__isymbols = __pyx_v_self->_fst.get()->InputSymbols();
 
-  /* "fstlib/cext/pywrapfst.pyx":1714
+  /* "fstlib/cext/pywrapfst.pyx":1778
  *     _fstrm.reset(new ofstream(_source))
  *     cdef const fst.SymbolTable *_isymbols = self._fst.get().InputSymbols()
  *     if isymbols is not None:             # <<<<<<<<<<<<<<
  *        _isymbols = isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  */
   __pyx_t_18 = (((PyObject *)__pyx_v_isymbols) != Py_None);
   __pyx_t_19 = (__pyx_t_18 != 0);
   if (__pyx_t_19) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1715
+    /* "fstlib/cext/pywrapfst.pyx":1779
  *     cdef const fst.SymbolTable *_isymbols = self._fst.get().InputSymbols()
  *     if isymbols is not None:
  *        _isymbols = isymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  *     if osymbols is not None:
  */
     if (unlikely(((PyObject *)__pyx_v_isymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 1715, __pyx_L1_error)
+      __PYX_ERR(0, 1779, __pyx_L1_error)
     }
-    __pyx_t_20 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_isymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_isymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1715, __pyx_L1_error)
+    __pyx_t_20 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_isymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_isymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1779, __pyx_L1_error)
     __pyx_v__isymbols = __pyx_t_20;
 
-    /* "fstlib/cext/pywrapfst.pyx":1714
+    /* "fstlib/cext/pywrapfst.pyx":1778
  *     _fstrm.reset(new ofstream(_source))
  *     cdef const fst.SymbolTable *_isymbols = self._fst.get().InputSymbols()
  *     if isymbols is not None:             # <<<<<<<<<<<<<<
  *        _isymbols = isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1716
+  /* "fstlib/cext/pywrapfst.pyx":1780
  *     if isymbols is not None:
  *        _isymbols = isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()             # <<<<<<<<<<<<<<
  *     if osymbols is not None:
  *        _osymbols = osymbols._raw_ptr_or_raise()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1716, __pyx_L1_error)
+    __PYX_ERR(0, 1780, __pyx_L1_error)
   }
   __pyx_v__osymbols = __pyx_v_self->_fst.get()->OutputSymbols();
 
-  /* "fstlib/cext/pywrapfst.pyx":1717
+  /* "fstlib/cext/pywrapfst.pyx":1781
  *        _isymbols = isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  *     if osymbols is not None:             # <<<<<<<<<<<<<<
  *        _osymbols = osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  */
   __pyx_t_19 = (((PyObject *)__pyx_v_osymbols) != Py_None);
   __pyx_t_18 = (__pyx_t_19 != 0);
   if (__pyx_t_18) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1718
+    /* "fstlib/cext/pywrapfst.pyx":1782
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  *     if osymbols is not None:
  *        _osymbols = osymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  *     if ssymbols is not None:
  */
     if (unlikely(((PyObject *)__pyx_v_osymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 1718, __pyx_L1_error)
+      __PYX_ERR(0, 1782, __pyx_L1_error)
     }
-    __pyx_t_20 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_osymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_osymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1718, __pyx_L1_error)
+    __pyx_t_20 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_osymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_osymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1782, __pyx_L1_error)
     __pyx_v__osymbols = __pyx_t_20;
 
-    /* "fstlib/cext/pywrapfst.pyx":1717
+    /* "fstlib/cext/pywrapfst.pyx":1781
  *        _isymbols = isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  *     if osymbols is not None:             # <<<<<<<<<<<<<<
  *        _osymbols = osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1719
+  /* "fstlib/cext/pywrapfst.pyx":1783
  *     if osymbols is not None:
  *        _osymbols = osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_ssymbols = NULL             # <<<<<<<<<<<<<<
  *     if ssymbols is not None:
  *       _ssymbols = ssymbols._raw_ptr_or_raise()
  */
   __pyx_v__ssymbols = NULL;
 
-  /* "fstlib/cext/pywrapfst.pyx":1720
+  /* "fstlib/cext/pywrapfst.pyx":1784
  *        _osymbols = osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  *     if ssymbols is not None:             # <<<<<<<<<<<<<<
  *       _ssymbols = ssymbols._raw_ptr_or_raise()
  *     fst.Draw(deref(self._fst),
  */
   __pyx_t_18 = (((PyObject *)__pyx_v_ssymbols) != Py_None);
   __pyx_t_19 = (__pyx_t_18 != 0);
   if (__pyx_t_19) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1721
+    /* "fstlib/cext/pywrapfst.pyx":1785
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  *     if ssymbols is not None:
  *       _ssymbols = ssymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     fst.Draw(deref(self._fst),
  *              _isymbols,
  */
     if (unlikely(((PyObject *)__pyx_v_ssymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 1721, __pyx_L1_error)
+      __PYX_ERR(0, 1785, __pyx_L1_error)
     }
-    __pyx_t_20 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_ssymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_ssymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1721, __pyx_L1_error)
+    __pyx_t_20 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_ssymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_ssymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1785, __pyx_L1_error)
     __pyx_v__ssymbols = __pyx_t_20;
 
-    /* "fstlib/cext/pywrapfst.pyx":1720
+    /* "fstlib/cext/pywrapfst.pyx":1784
  *        _osymbols = osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  *     if ssymbols is not None:             # <<<<<<<<<<<<<<
  *       _ssymbols = ssymbols._raw_ptr_or_raise()
  *     fst.Draw(deref(self._fst),
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1722
+  /* "fstlib/cext/pywrapfst.pyx":1786
  *     if ssymbols is not None:
  *       _ssymbols = ssymbols._raw_ptr_or_raise()
  *     fst.Draw(deref(self._fst),             # <<<<<<<<<<<<<<
  *              _isymbols,
  *              _osymbols,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1722, __pyx_L1_error)
+    __PYX_ERR(0, 1786, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1727
+  /* "fstlib/cext/pywrapfst.pyx":1791
  *              _ssymbols,
  *              acceptor,
  *              tostring(title),             # <<<<<<<<<<<<<<
  *              width,
  *              height,
  */
-  __pyx_t_17 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_title); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1727, __pyx_L1_error)
+  __pyx_t_17 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_title); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1791, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1736
+  /* "fstlib/cext/pywrapfst.pyx":1800
  *              fontsize,
  *              precision,
  *              tostring(float_format),             # <<<<<<<<<<<<<<
  *              show_weight_one,
  *              deref(_fstrm),
  */
-  __pyx_t_21 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_float_format); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1736, __pyx_L1_error)
+  __pyx_t_21 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_float_format); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1800, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1722
+  /* "fstlib/cext/pywrapfst.pyx":1786
  *     if ssymbols is not None:
  *       _ssymbols = ssymbols._raw_ptr_or_raise()
  *     fst.Draw(deref(self._fst),             # <<<<<<<<<<<<<<
  *              _isymbols,
  *              _osymbols,
  */
   fst::script::Draw((*__pyx_v_self->_fst), __pyx_v__isymbols, __pyx_v__osymbols, __pyx_v__ssymbols, __pyx_v_acceptor, __pyx_t_17, __pyx_v_width, __pyx_v_height, __pyx_v_portrait, __pyx_v_vertical, __pyx_v_ranksep, __pyx_v_nodesep, __pyx_v_fontsize, __pyx_v_precision, __pyx_t_21, __pyx_v_show_weight_one, (*__pyx_v__fstrm), __pyx_v__source);
 
-  /* "fstlib/cext/pywrapfst.pyx":1662
+  /* "fstlib/cext/pywrapfst.pyx":1726
  *     return _init_XFst(new fst.FstClass(deref(self._fst)))
  * 
  *   cpdef void draw(self,             # <<<<<<<<<<<<<<
  *                   source,
  *                   SymbolTableView isymbols=None,
  */
 
@@ -19496,55 +19851,55 @@
   PyObject *__pyx_v_title = 0;
   double __pyx_v_width;
   double __pyx_v_height;
   bool __pyx_v_portrait;
   bool __pyx_v_vertical;
   double __pyx_v_ranksep;
   double __pyx_v_nodesep;
-  int32 __pyx_v_fontsize;
-  int32 __pyx_v_precision;
+  int32_t __pyx_v_fontsize;
+  int32_t __pyx_v_precision;
   PyObject *__pyx_v_float_format = 0;
   bool __pyx_v_show_weight_one;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("draw (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_source,&__pyx_n_s_isymbols,&__pyx_n_s_osymbols,&__pyx_n_s_ssymbols,&__pyx_n_s_acceptor,&__pyx_n_s_title,&__pyx_n_s_width,&__pyx_n_s_height,&__pyx_n_s_portrait,&__pyx_n_s_vertical,&__pyx_n_s_ranksep,&__pyx_n_s_nodesep,&__pyx_n_s_fontsize,&__pyx_n_s_precision,&__pyx_n_s_float_format,&__pyx_n_s_show_weight_one,0};
     PyObject* values[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
 
-    /* "fstlib/cext/pywrapfst.pyx":1664
+    /* "fstlib/cext/pywrapfst.pyx":1728
  *   cpdef void draw(self,
  *                   source,
  *                   SymbolTableView isymbols=None,             # <<<<<<<<<<<<<<
  *                   SymbolTableView osymbols=None,
  *                   SymbolTableView ssymbols=None,
  */
     values[1] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-    /* "fstlib/cext/pywrapfst.pyx":1665
+    /* "fstlib/cext/pywrapfst.pyx":1729
  *                   source,
  *                   SymbolTableView isymbols=None,
  *                   SymbolTableView osymbols=None,             # <<<<<<<<<<<<<<
  *                   SymbolTableView ssymbols=None,
  *                   bool acceptor=False,
  */
     values[2] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-    /* "fstlib/cext/pywrapfst.pyx":1666
+    /* "fstlib/cext/pywrapfst.pyx":1730
  *                   SymbolTableView isymbols=None,
  *                   SymbolTableView osymbols=None,
  *                   SymbolTableView ssymbols=None,             # <<<<<<<<<<<<<<
  *                   bool acceptor=False,
  *                   title="",
  */
     values[3] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
-    values[5] = ((PyObject *)__pyx_kp_u__11);
+    values[5] = ((PyObject *)__pyx_kp_u__9);
     values[14] = ((PyObject *)__pyx_n_u_g);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case 16: values[15] = PyTuple_GET_ITEM(__pyx_args, 15);
         CYTHON_FALLTHROUGH;
@@ -19674,15 +20029,15 @@
         case 15:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_show_weight_one);
           if (value) { values[15] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "draw") < 0)) __PYX_ERR(0, 1662, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "draw") < 0)) __PYX_ERR(0, 1726, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case 16: values[15] = PyTuple_GET_ITEM(__pyx_args, 15);
         CYTHON_FALLTHROUGH;
         case 15: values[14] = PyTuple_GET_ITEM(__pyx_args, 14);
         CYTHON_FALLTHROUGH;
@@ -19718,112 +20073,112 @@
       }
     }
     __pyx_v_source = values[0];
     __pyx_v_isymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[1]);
     __pyx_v_osymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[2]);
     __pyx_v_ssymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[3]);
     if (values[4]) {
-      __pyx_v_acceptor = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_acceptor == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1667, __pyx_L3_error)
+      __pyx_v_acceptor = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_acceptor == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1731, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":1667
+      /* "fstlib/cext/pywrapfst.pyx":1731
  *                   SymbolTableView osymbols=None,
  *                   SymbolTableView ssymbols=None,
  *                   bool acceptor=False,             # <<<<<<<<<<<<<<
  *                   title="",
  *                   double width=8.5,
  */
       __pyx_v_acceptor = ((bool)0);
     }
     __pyx_v_title = values[5];
     if (values[6]) {
-      __pyx_v_width = __pyx_PyFloat_AsDouble(values[6]); if (unlikely((__pyx_v_width == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1669, __pyx_L3_error)
+      __pyx_v_width = __pyx_PyFloat_AsDouble(values[6]); if (unlikely((__pyx_v_width == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1733, __pyx_L3_error)
     } else {
       __pyx_v_width = ((double)8.5);
     }
     if (values[7]) {
-      __pyx_v_height = __pyx_PyFloat_AsDouble(values[7]); if (unlikely((__pyx_v_height == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1670, __pyx_L3_error)
+      __pyx_v_height = __pyx_PyFloat_AsDouble(values[7]); if (unlikely((__pyx_v_height == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1734, __pyx_L3_error)
     } else {
       __pyx_v_height = ((double)11.0);
     }
     if (values[8]) {
-      __pyx_v_portrait = __Pyx_PyObject_IsTrue(values[8]); if (unlikely((__pyx_v_portrait == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1671, __pyx_L3_error)
+      __pyx_v_portrait = __Pyx_PyObject_IsTrue(values[8]); if (unlikely((__pyx_v_portrait == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1735, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":1671
+      /* "fstlib/cext/pywrapfst.pyx":1735
  *                   double width=8.5,
  *                   double height=11,
  *                   bool portrait=False,             # <<<<<<<<<<<<<<
  *                   bool vertical=False,
  *                   double ranksep=0.4,
  */
       __pyx_v_portrait = ((bool)0);
     }
     if (values[9]) {
-      __pyx_v_vertical = __Pyx_PyObject_IsTrue(values[9]); if (unlikely((__pyx_v_vertical == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1672, __pyx_L3_error)
+      __pyx_v_vertical = __Pyx_PyObject_IsTrue(values[9]); if (unlikely((__pyx_v_vertical == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1736, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":1672
+      /* "fstlib/cext/pywrapfst.pyx":1736
  *                   double height=11,
  *                   bool portrait=False,
  *                   bool vertical=False,             # <<<<<<<<<<<<<<
  *                   double ranksep=0.4,
  *                   double nodesep=0.25,
  */
       __pyx_v_vertical = ((bool)0);
     }
     if (values[10]) {
-      __pyx_v_ranksep = __pyx_PyFloat_AsDouble(values[10]); if (unlikely((__pyx_v_ranksep == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1673, __pyx_L3_error)
+      __pyx_v_ranksep = __pyx_PyFloat_AsDouble(values[10]); if (unlikely((__pyx_v_ranksep == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1737, __pyx_L3_error)
     } else {
       __pyx_v_ranksep = ((double)0.4);
     }
     if (values[11]) {
-      __pyx_v_nodesep = __pyx_PyFloat_AsDouble(values[11]); if (unlikely((__pyx_v_nodesep == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1674, __pyx_L3_error)
+      __pyx_v_nodesep = __pyx_PyFloat_AsDouble(values[11]); if (unlikely((__pyx_v_nodesep == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1738, __pyx_L3_error)
     } else {
       __pyx_v_nodesep = ((double)0.25);
     }
     if (values[12]) {
-      __pyx_v_fontsize = __Pyx_PyInt_As_int32_t(values[12]); if (unlikely((__pyx_v_fontsize == ((int32)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1675, __pyx_L3_error)
+      __pyx_v_fontsize = __Pyx_PyInt_As_int32_t(values[12]); if (unlikely((__pyx_v_fontsize == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1739, __pyx_L3_error)
     } else {
-      __pyx_v_fontsize = ((int32)14);
+      __pyx_v_fontsize = ((int32_t)14);
     }
     if (values[13]) {
-      __pyx_v_precision = __Pyx_PyInt_As_int32_t(values[13]); if (unlikely((__pyx_v_precision == ((int32)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1676, __pyx_L3_error)
+      __pyx_v_precision = __Pyx_PyInt_As_int32_t(values[13]); if (unlikely((__pyx_v_precision == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1740, __pyx_L3_error)
     } else {
-      __pyx_v_precision = ((int32)5);
+      __pyx_v_precision = ((int32_t)5);
     }
     __pyx_v_float_format = values[14];
     if (values[15]) {
-      __pyx_v_show_weight_one = __Pyx_PyObject_IsTrue(values[15]); if (unlikely((__pyx_v_show_weight_one == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1678, __pyx_L3_error)
+      __pyx_v_show_weight_one = __Pyx_PyObject_IsTrue(values[15]); if (unlikely((__pyx_v_show_weight_one == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1742, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":1678
- *                   int32 precision=5,
+      /* "fstlib/cext/pywrapfst.pyx":1742
+ *                   int32_t precision=5,
  *                   float_format="g",
  *                   bool show_weight_one=False) except *:             # <<<<<<<<<<<<<<
  *     """
  *     draw(self, source, isymbols=None, osymbols=None, ssymbols=None,
  */
       __pyx_v_show_weight_one = ((bool)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("draw", 0, 1, 16, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1662, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("draw", 0, 1, 16, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1726, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Fst.draw", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_isymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "isymbols", 0))) __PYX_ERR(0, 1664, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_osymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "osymbols", 0))) __PYX_ERR(0, 1665, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ssymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "ssymbols", 0))) __PYX_ERR(0, 1666, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_isymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "isymbols", 0))) __PYX_ERR(0, 1728, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_osymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "osymbols", 0))) __PYX_ERR(0, 1729, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ssymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "ssymbols", 0))) __PYX_ERR(0, 1730, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_16draw(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), __pyx_v_source, __pyx_v_isymbols, __pyx_v_osymbols, __pyx_v_ssymbols, __pyx_v_acceptor, __pyx_v_title, __pyx_v_width, __pyx_v_height, __pyx_v_portrait, __pyx_v_vertical, __pyx_v_ranksep, __pyx_v_nodesep, __pyx_v_fontsize, __pyx_v_precision, __pyx_v_float_format, __pyx_v_show_weight_one);
 
-  /* "fstlib/cext/pywrapfst.pyx":1662
+  /* "fstlib/cext/pywrapfst.pyx":1726
  *     return _init_XFst(new fst.FstClass(deref(self._fst)))
  * 
  *   cpdef void draw(self,             # <<<<<<<<<<<<<<
  *                   source,
  *                   SymbolTableView isymbols=None,
  */
 
@@ -19832,15 +20187,15 @@
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_16draw(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, PyObject *__pyx_v_source, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_isymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_osymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_ssymbols, bool __pyx_v_acceptor, PyObject *__pyx_v_title, double __pyx_v_width, double __pyx_v_height, bool __pyx_v_portrait, bool __pyx_v_vertical, double __pyx_v_ranksep, double __pyx_v_nodesep, int32 __pyx_v_fontsize, int32 __pyx_v_precision, PyObject *__pyx_v_float_format, bool __pyx_v_show_weight_one) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_16draw(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, PyObject *__pyx_v_source, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_isymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_osymbols, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_ssymbols, bool __pyx_v_acceptor, PyObject *__pyx_v_title, double __pyx_v_width, double __pyx_v_height, bool __pyx_v_portrait, bool __pyx_v_vertical, double __pyx_v_ranksep, double __pyx_v_nodesep, int32_t __pyx_v_fontsize, int32_t __pyx_v_precision, PyObject *__pyx_v_float_format, bool __pyx_v_show_weight_one) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_draw __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
@@ -19858,16 +20213,16 @@
   __pyx_t_1.vertical = __pyx_v_vertical;
   __pyx_t_1.ranksep = __pyx_v_ranksep;
   __pyx_t_1.nodesep = __pyx_v_nodesep;
   __pyx_t_1.fontsize = __pyx_v_fontsize;
   __pyx_t_1.precision = __pyx_v_precision;
   __pyx_t_1.float_format = __pyx_v_float_format;
   __pyx_t_1.show_weight_one = __pyx_v_show_weight_one;
-  __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Fst->draw(__pyx_v_self, __pyx_v_source, 1, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1662, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1662, __pyx_L1_error)
+  __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Fst->draw(__pyx_v_self, __pyx_v_source, 1, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1726, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1726, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -19876,24 +20231,24 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1741
+/* "fstlib/cext/pywrapfst.pyx":1805
  *              _source)
  * 
- *   cpdef Weight final(self, int64 state):             # <<<<<<<<<<<<<<
+ *   cpdef Weight final(self, int64_t state):             # <<<<<<<<<<<<<<
  *     """
  *     final(self, state)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_19final(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
-static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch) {
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_v__weight = 0;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
@@ -19908,19 +20263,19 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_final); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1741, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_final); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1805, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_19final)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
-        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1741, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1805, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -19928,18 +20283,18 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1741, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1805, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight))))) __PYX_ERR(0, 1741, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight))))) __PYX_ERR(0, 1805, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -19950,110 +20305,110 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1756
+  /* "fstlib/cext/pywrapfst.pyx":1820
  *       FstIndexError: State index out of range.
  *     """
  *     cdef Weight _weight = Weight.__new__(Weight)             # <<<<<<<<<<<<<<
  *     _weight._weight.reset(new fst.WeightClass(self._fst.get().Final(state)))
  *     if not _weight.member():
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1756, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1820, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1757
+  /* "fstlib/cext/pywrapfst.pyx":1821
  *     """
  *     cdef Weight _weight = Weight.__new__(Weight)
  *     _weight._weight.reset(new fst.WeightClass(self._fst.get().Final(state)))             # <<<<<<<<<<<<<<
  *     if not _weight.member():
  *       raise FstIndexError("State index out of range")
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 1757, __pyx_L1_error)
+    __PYX_ERR(0, 1821, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1757, __pyx_L1_error)
+    __PYX_ERR(0, 1821, __pyx_L1_error)
   }
   __pyx_v__weight->_weight.reset(new fst::script::WeightClass(__pyx_v_self->_fst.get()->Final(__pyx_v_state)));
 
-  /* "fstlib/cext/pywrapfst.pyx":1758
+  /* "fstlib/cext/pywrapfst.pyx":1822
  *     cdef Weight _weight = Weight.__new__(Weight)
  *     _weight._weight.reset(new fst.WeightClass(self._fst.get().Final(state)))
  *     if not _weight.member():             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     return _weight
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "member");
-    __PYX_ERR(0, 1758, __pyx_L1_error)
+    __PYX_ERR(0, 1822, __pyx_L1_error)
   }
   __pyx_t_6 = ((!(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Weight *)__pyx_v__weight->__pyx_vtab)->member(__pyx_v__weight, 0) != 0)) != 0);
   if (unlikely(__pyx_t_6)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1759
+    /* "fstlib/cext/pywrapfst.pyx":1823
  *     _weight._weight.reset(new fst.WeightClass(self._fst.get().Final(state)))
  *     if not _weight.member():
  *       raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  *     return _weight
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1759, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1823, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_State_index_out_of_range);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1759, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1823, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1759, __pyx_L1_error)
+    __PYX_ERR(0, 1823, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1758
+    /* "fstlib/cext/pywrapfst.pyx":1822
  *     cdef Weight _weight = Weight.__new__(Weight)
  *     _weight._weight.reset(new fst.WeightClass(self._fst.get().Final(state)))
  *     if not _weight.member():             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     return _weight
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1760
+  /* "fstlib/cext/pywrapfst.pyx":1824
  *     if not _weight.member():
  *       raise FstIndexError("State index out of range")
  *     return _weight             # <<<<<<<<<<<<<<
  * 
  *   cpdef string fst_type(self):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = __pyx_v__weight;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1741
+  /* "fstlib/cext/pywrapfst.pyx":1805
  *              _source)
  * 
- *   cpdef Weight final(self, int64 state):             # <<<<<<<<<<<<<<
+ *   cpdef Weight final(self, int64_t state):             # <<<<<<<<<<<<<<
  *     """
  *     final(self, state)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -20070,47 +20425,47 @@
   return __pyx_r;
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_19final(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_3Fst_18final[] = "\n    final(self, state)\n\n    Returns the final weight of a state.\n\n    Args:\n      state: The integer index of a state.\n\n    Returns:\n      The final Weight of that state.\n\n    Raises:\n      FstIndexError: State index out of range.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_19final(PyObject *__pyx_v_self, PyObject *__pyx_arg_state) {
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("final (wrapper)", 0);
   assert(__pyx_arg_state); {
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1741, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1805, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Fst.final", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_18final(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), ((int64)__pyx_v_state));
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_18final(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), ((int64_t)__pyx_v_state));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_18final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_18final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("final", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_final(__pyx_v_self, __pyx_v_state, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1741, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_final(__pyx_v_self, __pyx_v_state, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1805, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -20119,15 +20474,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1762
+/* "fstlib/cext/pywrapfst.pyx":1826
  *     return _weight
  * 
  *   cpdef string fst_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     fst_type(self)
  */
 
@@ -20149,15 +20504,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_fst_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1762, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_fst_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1826, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_21fst_type)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -20165,18 +20520,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1762, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1826, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1762, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1826, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -20187,29 +20542,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1768
+  /* "fstlib/cext/pywrapfst.pyx":1832
  *     Returns a string indicating the FST type.
  *     """
  *     return self._fst.get().FstType()             # <<<<<<<<<<<<<<
  * 
  *   cpdef _FstSymbolTableView input_symbols(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1768, __pyx_L1_error)
+    __PYX_ERR(0, 1832, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_fst.get()->FstType();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1762
+  /* "fstlib/cext/pywrapfst.pyx":1826
  *     return _weight
  * 
  *   cpdef string fst_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     fst_type(self)
  */
 
@@ -20245,15 +20600,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("fst_type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_fst_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1762, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_fst_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1826, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -20262,15 +20617,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1770
+/* "fstlib/cext/pywrapfst.pyx":1834
  *     return self._fst.get().FstType()
  * 
  *   cpdef _FstSymbolTableView input_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     input_symbols(self)
  */
 
@@ -20292,15 +20647,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_input_symbols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1770, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_input_symbols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1834, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_23input_symbols)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -20309,18 +20664,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1770, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1834, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__FstSymbolTableView))))) __PYX_ERR(0, 1770, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__FstSymbolTableView))))) __PYX_ERR(0, 1834, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -20331,67 +20686,67 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1776
+  /* "fstlib/cext/pywrapfst.pyx":1840
  *     Returns the FST's input symbol table, or None if none is present.
  *     """
  *     if self._fst.get().InputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_FstSymbolTableView(self._fst, input_side=True)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1776, __pyx_L1_error)
+    __PYX_ERR(0, 1840, __pyx_L1_error)
   }
   __pyx_t_5 = ((__pyx_v_self->_fst.get()->InputSymbols() == NULL) != 0);
   if (__pyx_t_5) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1777
+    /* "fstlib/cext/pywrapfst.pyx":1841
  *     """
  *     if self._fst.get().InputSymbols() == NULL:
  *       return             # <<<<<<<<<<<<<<
  *     return _init_FstSymbolTableView(self._fst, input_side=True)
  * 
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *)Py_None); __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":1776
+    /* "fstlib/cext/pywrapfst.pyx":1840
  *     Returns the FST's input symbol table, or None if none is present.
  *     """
  *     if self._fst.get().InputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_FstSymbolTableView(self._fst, input_side=True)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1778
+  /* "fstlib/cext/pywrapfst.pyx":1842
  *     if self._fst.get().InputSymbols() == NULL:
  *       return
  *     return _init_FstSymbolTableView(self._fst, input_side=True)             # <<<<<<<<<<<<<<
  * 
- *   cpdef size_t num_arcs(self, int64 state) except *:
+ *   cpdef size_t num_arcs(self, int64_t state) except *:
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1778, __pyx_L1_error)
+    __PYX_ERR(0, 1842, __pyx_L1_error)
   }
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_FstSymbolTableView(__pyx_v_self->_fst, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1778, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_FstSymbolTableView(__pyx_v_self->_fst, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1842, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1770
+  /* "fstlib/cext/pywrapfst.pyx":1834
  *     return self._fst.get().FstType()
  * 
  *   cpdef _FstSymbolTableView input_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     input_symbols(self)
  */
 
@@ -20428,15 +20783,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("input_symbols", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_input_symbols(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1770, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_input_symbols(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1834, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -20445,24 +20800,24 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1780
+/* "fstlib/cext/pywrapfst.pyx":1844
  *     return _init_FstSymbolTableView(self._fst, input_side=True)
  * 
- *   cpdef size_t num_arcs(self, int64 state) except *:             # <<<<<<<<<<<<<<
+ *   cpdef size_t num_arcs(self, int64_t state) except *:             # <<<<<<<<<<<<<<
  *     """
  *     num_arcs(self, state)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_25num_arcs(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
-static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch) {
+static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch) {
   size_t __pyx_v__result;
   size_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
@@ -20478,18 +20833,18 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_arcs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1780, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_arcs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1844, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_25num_arcs)) {
-        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1780, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1844, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -20497,18 +20852,18 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1780, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1844, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_6 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_6 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1780, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_6 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1844, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_6;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -20519,88 +20874,88 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1795
+  /* "fstlib/cext/pywrapfst.pyx":1859
  *       FstIndexError: State index out of range.
  *     """
  *     cdef size_t _result = self._fst.get().NumArcs(state)             # <<<<<<<<<<<<<<
- *     if _result == SIZE_MAX:
+ *     if _result == numeric_limits[size_t].max():
  *       raise FstIndexError("State index out of range")
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1795, __pyx_L1_error)
+    __PYX_ERR(0, 1859, __pyx_L1_error)
   }
   __pyx_v__result = __pyx_v_self->_fst.get()->NumArcs(__pyx_v_state);
 
-  /* "fstlib/cext/pywrapfst.pyx":1796
+  /* "fstlib/cext/pywrapfst.pyx":1860
  *     """
  *     cdef size_t _result = self._fst.get().NumArcs(state)
- *     if _result == SIZE_MAX:             # <<<<<<<<<<<<<<
+ *     if _result == numeric_limits[size_t].max():             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     return _result
  */
-  __pyx_t_7 = ((__pyx_v__result == SIZE_MAX) != 0);
+  __pyx_t_7 = ((__pyx_v__result == std::numeric_limits<size_t> ::max()) != 0);
   if (unlikely(__pyx_t_7)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1797
+    /* "fstlib/cext/pywrapfst.pyx":1861
  *     cdef size_t _result = self._fst.get().NumArcs(state)
- *     if _result == SIZE_MAX:
+ *     if _result == numeric_limits[size_t].max():
  *       raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  *     return _result
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1797, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1861, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_State_index_out_of_range);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1797, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1861, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1797, __pyx_L1_error)
+    __PYX_ERR(0, 1861, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1796
+    /* "fstlib/cext/pywrapfst.pyx":1860
  *     """
  *     cdef size_t _result = self._fst.get().NumArcs(state)
- *     if _result == SIZE_MAX:             # <<<<<<<<<<<<<<
+ *     if _result == numeric_limits[size_t].max():             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     return _result
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1798
- *     if _result == SIZE_MAX:
+  /* "fstlib/cext/pywrapfst.pyx":1862
+ *     if _result == numeric_limits[size_t].max():
  *       raise FstIndexError("State index out of range")
  *     return _result             # <<<<<<<<<<<<<<
  * 
- *   cpdef size_t num_input_epsilons(self, int64 state) except *:
+ *   cpdef size_t num_input_epsilons(self, int64_t state) except *:
  */
   __pyx_r = __pyx_v__result;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1780
+  /* "fstlib/cext/pywrapfst.pyx":1844
  *     return _init_FstSymbolTableView(self._fst, input_side=True)
  * 
- *   cpdef size_t num_arcs(self, int64 state) except *:             # <<<<<<<<<<<<<<
+ *   cpdef size_t num_arcs(self, int64_t state) except *:             # <<<<<<<<<<<<<<
  *     """
  *     num_arcs(self, state)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -20615,49 +20970,49 @@
   return __pyx_r;
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_25num_arcs(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_3Fst_24num_arcs[] = "\n    num_arcs(self, state)\n\n    Returns the number of arcs leaving a state.\n\n    Args:\n      state: The integer index of a state.\n\n    Returns:\n      The number of arcs leaving that state.\n\n    Raises:\n      FstIndexError: State index out of range.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_25num_arcs(PyObject *__pyx_v_self, PyObject *__pyx_arg_state) {
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("num_arcs (wrapper)", 0);
   assert(__pyx_arg_state); {
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1780, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1844, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Fst.num_arcs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_24num_arcs(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), ((int64)__pyx_v_state));
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_24num_arcs(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), ((int64_t)__pyx_v_state));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_24num_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_24num_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   size_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("num_arcs", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_arcs(__pyx_v_self, __pyx_v_state, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1780, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyInt_FromSize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1780, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_arcs(__pyx_v_self, __pyx_v_state, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1844, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_FromSize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1844, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -20666,24 +21021,24 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1800
+/* "fstlib/cext/pywrapfst.pyx":1864
  *     return _result
  * 
- *   cpdef size_t num_input_epsilons(self, int64 state) except *:             # <<<<<<<<<<<<<<
+ *   cpdef size_t num_input_epsilons(self, int64_t state) except *:             # <<<<<<<<<<<<<<
  *     """
  *     num_input_epsilons(self, state)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_27num_input_epsilons(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
-static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_input_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch) {
+static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_input_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch) {
   size_t __pyx_v__result;
   size_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
@@ -20699,18 +21054,18 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_input_epsilons); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1800, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_input_epsilons); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1864, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_27num_input_epsilons)) {
-        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1800, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1864, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -20718,18 +21073,18 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1800, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1864, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_6 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_6 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1800, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_6 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1864, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_6;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -20740,88 +21095,88 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1815
+  /* "fstlib/cext/pywrapfst.pyx":1879
  *       FstIndexError: State index out of range.
  *     """
  *     cdef size_t _result = self._fst.get().NumInputEpsilons(state)             # <<<<<<<<<<<<<<
- *     if _result == SIZE_MAX:
+ *     if _result == numeric_limits[size_t].max():
  *       raise FstIndexError("State index out of range")
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1815, __pyx_L1_error)
+    __PYX_ERR(0, 1879, __pyx_L1_error)
   }
   __pyx_v__result = __pyx_v_self->_fst.get()->NumInputEpsilons(__pyx_v_state);
 
-  /* "fstlib/cext/pywrapfst.pyx":1816
+  /* "fstlib/cext/pywrapfst.pyx":1880
  *     """
  *     cdef size_t _result = self._fst.get().NumInputEpsilons(state)
- *     if _result == SIZE_MAX:             # <<<<<<<<<<<<<<
+ *     if _result == numeric_limits[size_t].max():             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     return _result
  */
-  __pyx_t_7 = ((__pyx_v__result == SIZE_MAX) != 0);
+  __pyx_t_7 = ((__pyx_v__result == std::numeric_limits<size_t> ::max()) != 0);
   if (unlikely(__pyx_t_7)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1817
+    /* "fstlib/cext/pywrapfst.pyx":1881
  *     cdef size_t _result = self._fst.get().NumInputEpsilons(state)
- *     if _result == SIZE_MAX:
+ *     if _result == numeric_limits[size_t].max():
  *       raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  *     return _result
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1817, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1881, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_State_index_out_of_range);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1817, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1881, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1817, __pyx_L1_error)
+    __PYX_ERR(0, 1881, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1816
+    /* "fstlib/cext/pywrapfst.pyx":1880
  *     """
  *     cdef size_t _result = self._fst.get().NumInputEpsilons(state)
- *     if _result == SIZE_MAX:             # <<<<<<<<<<<<<<
+ *     if _result == numeric_limits[size_t].max():             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     return _result
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1818
- *     if _result == SIZE_MAX:
+  /* "fstlib/cext/pywrapfst.pyx":1882
+ *     if _result == numeric_limits[size_t].max():
  *       raise FstIndexError("State index out of range")
  *     return _result             # <<<<<<<<<<<<<<
  * 
- *   cpdef size_t num_output_epsilons(self, int64 state) except *:
+ *   cpdef size_t num_output_epsilons(self, int64_t state) except *:
  */
   __pyx_r = __pyx_v__result;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1800
+  /* "fstlib/cext/pywrapfst.pyx":1864
  *     return _result
  * 
- *   cpdef size_t num_input_epsilons(self, int64 state) except *:             # <<<<<<<<<<<<<<
+ *   cpdef size_t num_input_epsilons(self, int64_t state) except *:             # <<<<<<<<<<<<<<
  *     """
  *     num_input_epsilons(self, state)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -20836,49 +21191,49 @@
   return __pyx_r;
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_27num_input_epsilons(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_3Fst_26num_input_epsilons[] = "\n    num_input_epsilons(self, state)\n\n    Returns the number of arcs with epsilon input labels leaving a state.\n\n    Args:\n      state: The integer index of a state.\n\n    Returns:\n      The number of epsilon-input-labeled arcs leaving that state.\n\n    Raises:\n      FstIndexError: State index out of range.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_27num_input_epsilons(PyObject *__pyx_v_self, PyObject *__pyx_arg_state) {
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("num_input_epsilons (wrapper)", 0);
   assert(__pyx_arg_state); {
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1800, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1864, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Fst.num_input_epsilons", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_26num_input_epsilons(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), ((int64)__pyx_v_state));
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_26num_input_epsilons(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), ((int64_t)__pyx_v_state));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_26num_input_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_26num_input_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   size_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("num_input_epsilons", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_input_epsilons(__pyx_v_self, __pyx_v_state, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1800, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyInt_FromSize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1800, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_input_epsilons(__pyx_v_self, __pyx_v_state, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1864, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_FromSize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1864, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -20887,24 +21242,24 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1820
+/* "fstlib/cext/pywrapfst.pyx":1884
  *     return _result
  * 
- *   cpdef size_t num_output_epsilons(self, int64 state) except *:             # <<<<<<<<<<<<<<
+ *   cpdef size_t num_output_epsilons(self, int64_t state) except *:             # <<<<<<<<<<<<<<
  *     """
  *     num_output_epsilons(self, state)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_29num_output_epsilons(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
-static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_output_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch) {
+static size_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_output_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch) {
   size_t __pyx_v__result;
   size_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
@@ -20920,18 +21275,18 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_output_epsilons); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1820, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_output_epsilons); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1884, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_29num_output_epsilons)) {
-        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1820, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1884, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -20939,18 +21294,18 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1820, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1884, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_6 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_6 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1820, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_6 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1884, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_6;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -20961,88 +21316,88 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1835
+  /* "fstlib/cext/pywrapfst.pyx":1899
  *       FstIndexError: State index out of range.
  *     """
  *     cdef size_t _result = self._fst.get().NumOutputEpsilons(state)             # <<<<<<<<<<<<<<
- *     if _result == SIZE_MAX:
+ *     if _result == numeric_limits[size_t].max():
  *       raise FstIndexError("State index out of range")
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1835, __pyx_L1_error)
+    __PYX_ERR(0, 1899, __pyx_L1_error)
   }
   __pyx_v__result = __pyx_v_self->_fst.get()->NumOutputEpsilons(__pyx_v_state);
 
-  /* "fstlib/cext/pywrapfst.pyx":1836
+  /* "fstlib/cext/pywrapfst.pyx":1900
  *     """
  *     cdef size_t _result = self._fst.get().NumOutputEpsilons(state)
- *     if _result == SIZE_MAX:             # <<<<<<<<<<<<<<
+ *     if _result == numeric_limits[size_t].max():             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     return _result
  */
-  __pyx_t_7 = ((__pyx_v__result == SIZE_MAX) != 0);
+  __pyx_t_7 = ((__pyx_v__result == std::numeric_limits<size_t> ::max()) != 0);
   if (unlikely(__pyx_t_7)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1837
+    /* "fstlib/cext/pywrapfst.pyx":1901
  *     cdef size_t _result = self._fst.get().NumOutputEpsilons(state)
- *     if _result == SIZE_MAX:
+ *     if _result == numeric_limits[size_t].max():
  *       raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  *     return _result
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1837, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1901, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_State_index_out_of_range);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1837, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1901, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1837, __pyx_L1_error)
+    __PYX_ERR(0, 1901, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":1836
+    /* "fstlib/cext/pywrapfst.pyx":1900
  *     """
  *     cdef size_t _result = self._fst.get().NumOutputEpsilons(state)
- *     if _result == SIZE_MAX:             # <<<<<<<<<<<<<<
+ *     if _result == numeric_limits[size_t].max():             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     return _result
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1838
- *     if _result == SIZE_MAX:
+  /* "fstlib/cext/pywrapfst.pyx":1902
+ *     if _result == numeric_limits[size_t].max():
  *       raise FstIndexError("State index out of range")
  *     return _result             # <<<<<<<<<<<<<<
  * 
  *   cpdef _FstSymbolTableView output_symbols(self):
  */
   __pyx_r = __pyx_v__result;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1820
+  /* "fstlib/cext/pywrapfst.pyx":1884
  *     return _result
  * 
- *   cpdef size_t num_output_epsilons(self, int64 state) except *:             # <<<<<<<<<<<<<<
+ *   cpdef size_t num_output_epsilons(self, int64_t state) except *:             # <<<<<<<<<<<<<<
  *     """
  *     num_output_epsilons(self, state)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -21057,49 +21412,49 @@
   return __pyx_r;
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_29num_output_epsilons(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_3Fst_28num_output_epsilons[] = "\n    num_output_epsilons(self, state)\n\n    Returns the number of arcs with epsilon output labels leaving a state.\n\n    Args:\n      state: The integer index of a state.\n\n    Returns:\n      The number of epsilon-output-labeled arcs leaving that state.\n\n    Raises:\n      FstIndexError: State index out of range.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_29num_output_epsilons(PyObject *__pyx_v_self, PyObject *__pyx_arg_state) {
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("num_output_epsilons (wrapper)", 0);
   assert(__pyx_arg_state); {
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1820, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1884, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Fst.num_output_epsilons", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_28num_output_epsilons(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), ((int64)__pyx_v_state));
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_28num_output_epsilons(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), ((int64_t)__pyx_v_state));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_28num_output_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64 __pyx_v_state) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_28num_output_epsilons(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int64_t __pyx_v_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   size_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("num_output_epsilons", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_output_epsilons(__pyx_v_self, __pyx_v_state, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1820, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyInt_FromSize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1820, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_output_epsilons(__pyx_v_self, __pyx_v_state, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1884, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_FromSize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1884, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -21108,15 +21463,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1840
+/* "fstlib/cext/pywrapfst.pyx":1904
  *     return _result
  * 
  *   cpdef _FstSymbolTableView output_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     output_symbols(self)
  */
 
@@ -21138,15 +21493,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_output_symbols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1840, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_output_symbols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1904, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_31output_symbols)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -21155,18 +21510,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1840, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1904, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__FstSymbolTableView))))) __PYX_ERR(0, 1840, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__FstSymbolTableView))))) __PYX_ERR(0, 1904, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -21177,67 +21532,67 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1846
+  /* "fstlib/cext/pywrapfst.pyx":1910
  *     Returns the FST's output symbol table, or None if none is present.
  *     """
  *     if self._fst.get().OutputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_FstSymbolTableView(self._fst, input_side=False)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1846, __pyx_L1_error)
+    __PYX_ERR(0, 1910, __pyx_L1_error)
   }
   __pyx_t_5 = ((__pyx_v_self->_fst.get()->OutputSymbols() == NULL) != 0);
   if (__pyx_t_5) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1847
+    /* "fstlib/cext/pywrapfst.pyx":1911
  *     """
  *     if self._fst.get().OutputSymbols() == NULL:
  *       return             # <<<<<<<<<<<<<<
  *     return _init_FstSymbolTableView(self._fst, input_side=False)
  * 
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *)Py_None); __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":1846
+    /* "fstlib/cext/pywrapfst.pyx":1910
  *     Returns the FST's output symbol table, or None if none is present.
  *     """
  *     if self._fst.get().OutputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_FstSymbolTableView(self._fst, input_side=False)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1848
+  /* "fstlib/cext/pywrapfst.pyx":1912
  *     if self._fst.get().OutputSymbols() == NULL:
  *       return
  *     return _init_FstSymbolTableView(self._fst, input_side=False)             # <<<<<<<<<<<<<<
  * 
  *   cpdef string print(self, SymbolTableView isymbols=None,
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1848, __pyx_L1_error)
+    __PYX_ERR(0, 1912, __pyx_L1_error)
   }
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_FstSymbolTableView(__pyx_v_self->_fst, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1848, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_FstSymbolTableView(__pyx_v_self->_fst, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1912, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1840
+  /* "fstlib/cext/pywrapfst.pyx":1904
  *     return _result
  * 
  *   cpdef _FstSymbolTableView output_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     output_symbols(self)
  */
 
@@ -21274,15 +21629,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("output_symbols", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_output_symbols(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1840, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_output_symbols(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1904, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -21291,46 +21646,46 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1850
+/* "fstlib/cext/pywrapfst.pyx":1914
  *     return _init_FstSymbolTableView(self._fst, input_side=False)
  * 
  *   cpdef string print(self, SymbolTableView isymbols=None,             # <<<<<<<<<<<<<<
  *       SymbolTableView osymbols=None, SymbolTableView ssymbols=None,
  *       bool acceptor=False, bool show_weight_one=False,
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_33print(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static std::string __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_print(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_print *__pyx_optional_args) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_isymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-  /* "fstlib/cext/pywrapfst.pyx":1851
+  /* "fstlib/cext/pywrapfst.pyx":1915
  * 
  *   cpdef string print(self, SymbolTableView isymbols=None,
  *       SymbolTableView osymbols=None, SymbolTableView ssymbols=None,             # <<<<<<<<<<<<<<
  *       bool acceptor=False, bool show_weight_one=False,
  *       missing_sym="") except *:
  */
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_osymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_ssymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-  /* "fstlib/cext/pywrapfst.pyx":1852
+  /* "fstlib/cext/pywrapfst.pyx":1916
  *   cpdef string print(self, SymbolTableView isymbols=None,
  *       SymbolTableView osymbols=None, SymbolTableView ssymbols=None,
  *       bool acceptor=False, bool show_weight_one=False,             # <<<<<<<<<<<<<<
  *       missing_sym="") except *:
  *     """
  */
   bool __pyx_v_acceptor = ((bool)0);
   bool __pyx_v_show_weight_one = ((bool)0);
-  PyObject *__pyx_v_missing_sym = ((PyObject *)__pyx_kp_u__11);
+  PyObject *__pyx_v_missing_sym = ((PyObject *)__pyx_kp_u__9);
   fst::SymbolTable const *__pyx_v__isymbols;
   fst::SymbolTable const *__pyx_v__osymbols;
   fst::SymbolTable const *__pyx_v__ssymbols;
   std::stringstream __pyx_v__sstrm;
   std::string __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
@@ -21366,15 +21721,15 @@
             }
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1850
+  /* "fstlib/cext/pywrapfst.pyx":1914
  *     return _init_FstSymbolTableView(self._fst, input_side=False)
  * 
  *   cpdef string print(self, SymbolTableView isymbols=None,             # <<<<<<<<<<<<<<
  *       SymbolTableView osymbols=None, SymbolTableView ssymbols=None,
  *       bool acceptor=False, bool show_weight_one=False,
  */
   /* Check if called by wrapper */
@@ -21382,20 +21737,20 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_print); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1850, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_print); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1914, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_33print)) {
-        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_acceptor); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1850, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_acceptor); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1914, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_show_weight_one); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1850, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_show_weight_one); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1914, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_5 = __pyx_t_1; __pyx_t_6 = NULL;
         __pyx_t_7 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
           __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
           if (likely(__pyx_t_6)) {
@@ -21405,33 +21760,33 @@
             __Pyx_DECREF_SET(__pyx_t_5, function);
             __pyx_t_7 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_5)) {
           PyObject *__pyx_temp[7] = {__pyx_t_6, ((PyObject *)__pyx_v_isymbols), ((PyObject *)__pyx_v_osymbols), ((PyObject *)__pyx_v_ssymbols), __pyx_t_3, __pyx_t_4, __pyx_v_missing_sym};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 6+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1850, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 6+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1914, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
           PyObject *__pyx_temp[7] = {__pyx_t_6, ((PyObject *)__pyx_v_isymbols), ((PyObject *)__pyx_v_osymbols), ((PyObject *)__pyx_v_ssymbols), __pyx_t_3, __pyx_t_4, __pyx_v_missing_sym};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 6+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1850, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 6+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1914, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         } else
         #endif
         {
-          __pyx_t_8 = PyTuple_New(6+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1850, __pyx_L1_error)
+          __pyx_t_8 = PyTuple_New(6+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1914, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_8);
           if (__pyx_t_6) {
             __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
           }
           __Pyx_INCREF(((PyObject *)__pyx_v_isymbols));
           __Pyx_GIVEREF(((PyObject *)__pyx_v_isymbols));
           PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, ((PyObject *)__pyx_v_isymbols));
@@ -21446,20 +21801,20 @@
           __Pyx_GIVEREF(__pyx_t_4);
           PyTuple_SET_ITEM(__pyx_t_8, 4+__pyx_t_7, __pyx_t_4);
           __Pyx_INCREF(__pyx_v_missing_sym);
           __Pyx_GIVEREF(__pyx_v_missing_sym);
           PyTuple_SET_ITEM(__pyx_t_8, 5+__pyx_t_7, __pyx_v_missing_sym);
           __pyx_t_3 = 0;
           __pyx_t_4 = 0;
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1850, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1914, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         }
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-        __pyx_t_9 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1850, __pyx_L1_error)
+        __pyx_t_9 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1914, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_9;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -21470,192 +21825,192 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1876
+  /* "fstlib/cext/pywrapfst.pyx":1940
  *     """
  *     # Prints FST to stringstream, then returns resulting string.
  *     cdef const fst.SymbolTable *_isymbols = self._fst.get().InputSymbols()             # <<<<<<<<<<<<<<
  *     if isymbols is not None:
  *        _isymbols = isymbols._raw_ptr_or_raise()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1876, __pyx_L1_error)
+    __PYX_ERR(0, 1940, __pyx_L1_error)
   }
   __pyx_v__isymbols = __pyx_v_self->_fst.get()->InputSymbols();
 
-  /* "fstlib/cext/pywrapfst.pyx":1877
+  /* "fstlib/cext/pywrapfst.pyx":1941
  *     # Prints FST to stringstream, then returns resulting string.
  *     cdef const fst.SymbolTable *_isymbols = self._fst.get().InputSymbols()
  *     if isymbols is not None:             # <<<<<<<<<<<<<<
  *        _isymbols = isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  */
   __pyx_t_10 = (((PyObject *)__pyx_v_isymbols) != Py_None);
   __pyx_t_11 = (__pyx_t_10 != 0);
   if (__pyx_t_11) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1878
+    /* "fstlib/cext/pywrapfst.pyx":1942
  *     cdef const fst.SymbolTable *_isymbols = self._fst.get().InputSymbols()
  *     if isymbols is not None:
  *        _isymbols = isymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  *     if osymbols is not None:
  */
     if (unlikely(((PyObject *)__pyx_v_isymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 1878, __pyx_L1_error)
+      __PYX_ERR(0, 1942, __pyx_L1_error)
     }
-    __pyx_t_12 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_isymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_isymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1878, __pyx_L1_error)
+    __pyx_t_12 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_isymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_isymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1942, __pyx_L1_error)
     __pyx_v__isymbols = __pyx_t_12;
 
-    /* "fstlib/cext/pywrapfst.pyx":1877
+    /* "fstlib/cext/pywrapfst.pyx":1941
  *     # Prints FST to stringstream, then returns resulting string.
  *     cdef const fst.SymbolTable *_isymbols = self._fst.get().InputSymbols()
  *     if isymbols is not None:             # <<<<<<<<<<<<<<
  *        _isymbols = isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1879
+  /* "fstlib/cext/pywrapfst.pyx":1943
  *     if isymbols is not None:
  *        _isymbols = isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()             # <<<<<<<<<<<<<<
  *     if osymbols is not None:
  *        _osymbols = osymbols._raw_ptr_or_raise()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1879, __pyx_L1_error)
+    __PYX_ERR(0, 1943, __pyx_L1_error)
   }
   __pyx_v__osymbols = __pyx_v_self->_fst.get()->OutputSymbols();
 
-  /* "fstlib/cext/pywrapfst.pyx":1880
+  /* "fstlib/cext/pywrapfst.pyx":1944
  *        _isymbols = isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  *     if osymbols is not None:             # <<<<<<<<<<<<<<
  *        _osymbols = osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  */
   __pyx_t_11 = (((PyObject *)__pyx_v_osymbols) != Py_None);
   __pyx_t_10 = (__pyx_t_11 != 0);
   if (__pyx_t_10) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1881
+    /* "fstlib/cext/pywrapfst.pyx":1945
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  *     if osymbols is not None:
  *        _osymbols = osymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  *     if ssymbols is not None:
  */
     if (unlikely(((PyObject *)__pyx_v_osymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 1881, __pyx_L1_error)
+      __PYX_ERR(0, 1945, __pyx_L1_error)
     }
-    __pyx_t_12 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_osymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_osymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1881, __pyx_L1_error)
+    __pyx_t_12 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_osymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_osymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1945, __pyx_L1_error)
     __pyx_v__osymbols = __pyx_t_12;
 
-    /* "fstlib/cext/pywrapfst.pyx":1880
+    /* "fstlib/cext/pywrapfst.pyx":1944
  *        _isymbols = isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_osymbols = self._fst.get().OutputSymbols()
  *     if osymbols is not None:             # <<<<<<<<<<<<<<
  *        _osymbols = osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1882
+  /* "fstlib/cext/pywrapfst.pyx":1946
  *     if osymbols is not None:
  *        _osymbols = osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_ssymbols = NULL             # <<<<<<<<<<<<<<
  *     if ssymbols is not None:
  *       _ssymbols = ssymbols._raw_ptr_or_raise()
  */
   __pyx_v__ssymbols = NULL;
 
-  /* "fstlib/cext/pywrapfst.pyx":1883
+  /* "fstlib/cext/pywrapfst.pyx":1947
  *        _osymbols = osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  *     if ssymbols is not None:             # <<<<<<<<<<<<<<
  *       _ssymbols = ssymbols._raw_ptr_or_raise()
  *     cdef stringstream _sstrm
  */
   __pyx_t_10 = (((PyObject *)__pyx_v_ssymbols) != Py_None);
   __pyx_t_11 = (__pyx_t_10 != 0);
   if (__pyx_t_11) {
 
-    /* "fstlib/cext/pywrapfst.pyx":1884
+    /* "fstlib/cext/pywrapfst.pyx":1948
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  *     if ssymbols is not None:
  *       _ssymbols = ssymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     cdef stringstream _sstrm
  *     fst.Print(deref(self._fst),
  */
     if (unlikely(((PyObject *)__pyx_v_ssymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 1884, __pyx_L1_error)
+      __PYX_ERR(0, 1948, __pyx_L1_error)
     }
-    __pyx_t_12 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_ssymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_ssymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1884, __pyx_L1_error)
+    __pyx_t_12 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_ssymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_ssymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1948, __pyx_L1_error)
     __pyx_v__ssymbols = __pyx_t_12;
 
-    /* "fstlib/cext/pywrapfst.pyx":1883
+    /* "fstlib/cext/pywrapfst.pyx":1947
  *        _osymbols = osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_ssymbols = NULL
  *     if ssymbols is not None:             # <<<<<<<<<<<<<<
  *       _ssymbols = ssymbols._raw_ptr_or_raise()
  *     cdef stringstream _sstrm
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1886
+  /* "fstlib/cext/pywrapfst.pyx":1950
  *       _ssymbols = ssymbols._raw_ptr_or_raise()
  *     cdef stringstream _sstrm
  *     fst.Print(deref(self._fst),             # <<<<<<<<<<<<<<
  *               _sstrm,
  *               b"<pywrapfst>",
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1886, __pyx_L1_error)
+    __PYX_ERR(0, 1950, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1894
+  /* "fstlib/cext/pywrapfst.pyx":1958
  *               acceptor,
  *               show_weight_one,
  *               tostring(missing_sym))             # <<<<<<<<<<<<<<
  *     return _sstrm.str()
  * 
  */
-  __pyx_t_9 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_missing_sym); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1894, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_missing_sym); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1958, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1886
+  /* "fstlib/cext/pywrapfst.pyx":1950
  *       _ssymbols = ssymbols._raw_ptr_or_raise()
  *     cdef stringstream _sstrm
  *     fst.Print(deref(self._fst),             # <<<<<<<<<<<<<<
  *               _sstrm,
  *               b"<pywrapfst>",
  */
   fst::script::Print((*__pyx_v_self->_fst), __pyx_v__sstrm, __pyx_k_pywrapfst, __pyx_v__isymbols, __pyx_v__osymbols, __pyx_v__ssymbols, __pyx_v_acceptor, __pyx_v_show_weight_one, __pyx_t_9);
 
-  /* "fstlib/cext/pywrapfst.pyx":1895
+  /* "fstlib/cext/pywrapfst.pyx":1959
  *               show_weight_one,
  *               tostring(missing_sym))
  *     return _sstrm.str()             # <<<<<<<<<<<<<<
  * 
  *   def properties(self, mask, bool test):
  */
   __pyx_r = __pyx_v__sstrm.str();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1850
+  /* "fstlib/cext/pywrapfst.pyx":1914
  *     return _init_FstSymbolTableView(self._fst, input_side=False)
  * 
  *   cpdef string print(self, SymbolTableView isymbols=None,             # <<<<<<<<<<<<<<
  *       SymbolTableView osymbols=None, SymbolTableView ssymbols=None,
  *       bool acceptor=False, bool show_weight_one=False,
  */
 
@@ -21692,24 +22047,24 @@
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("print (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_isymbols,&__pyx_n_s_osymbols,&__pyx_n_s_ssymbols,&__pyx_n_s_acceptor,&__pyx_n_s_show_weight_one,&__pyx_n_s_missing_sym,0};
     PyObject* values[6] = {0,0,0,0,0,0};
     values[0] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-    /* "fstlib/cext/pywrapfst.pyx":1851
+    /* "fstlib/cext/pywrapfst.pyx":1915
  * 
  *   cpdef string print(self, SymbolTableView isymbols=None,
  *       SymbolTableView osymbols=None, SymbolTableView ssymbols=None,             # <<<<<<<<<<<<<<
  *       bool acceptor=False, bool show_weight_one=False,
  *       missing_sym="") except *:
  */
     values[1] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
     values[2] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
-    values[5] = ((PyObject *)__pyx_kp_u__11);
+    values[5] = ((PyObject *)__pyx_kp_u__9);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
@@ -21760,15 +22115,15 @@
         case  5:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_missing_sym);
           if (value) { values[5] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "print") < 0)) __PYX_ERR(0, 1850, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "print") < 0)) __PYX_ERR(0, 1914, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
@@ -21784,47 +22139,47 @@
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_isymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[0]);
     __pyx_v_osymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[1]);
     __pyx_v_ssymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[2]);
     if (values[3]) {
-      __pyx_v_acceptor = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_acceptor == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1852, __pyx_L3_error)
+      __pyx_v_acceptor = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_acceptor == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1916, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":1852
+      /* "fstlib/cext/pywrapfst.pyx":1916
  *   cpdef string print(self, SymbolTableView isymbols=None,
  *       SymbolTableView osymbols=None, SymbolTableView ssymbols=None,
  *       bool acceptor=False, bool show_weight_one=False,             # <<<<<<<<<<<<<<
  *       missing_sym="") except *:
  *     """
  */
       __pyx_v_acceptor = ((bool)0);
     }
     if (values[4]) {
-      __pyx_v_show_weight_one = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_show_weight_one == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1852, __pyx_L3_error)
+      __pyx_v_show_weight_one = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_show_weight_one == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1916, __pyx_L3_error)
     } else {
       __pyx_v_show_weight_one = ((bool)0);
     }
     __pyx_v_missing_sym = values[5];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("print", 0, 0, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1850, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("print", 0, 0, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1914, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Fst.print", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_isymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "isymbols", 0))) __PYX_ERR(0, 1850, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_osymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "osymbols", 0))) __PYX_ERR(0, 1851, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ssymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "ssymbols", 0))) __PYX_ERR(0, 1851, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_isymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "isymbols", 0))) __PYX_ERR(0, 1914, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_osymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "osymbols", 0))) __PYX_ERR(0, 1915, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ssymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "ssymbols", 0))) __PYX_ERR(0, 1915, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_32print(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), __pyx_v_isymbols, __pyx_v_osymbols, __pyx_v_ssymbols, __pyx_v_acceptor, __pyx_v_show_weight_one, __pyx_v_missing_sym);
 
-  /* "fstlib/cext/pywrapfst.pyx":1850
+  /* "fstlib/cext/pywrapfst.pyx":1914
  *     return _init_FstSymbolTableView(self._fst, input_side=False)
  * 
  *   cpdef string print(self, SymbolTableView isymbols=None,             # <<<<<<<<<<<<<<
  *       SymbolTableView osymbols=None, SymbolTableView ssymbols=None,
  *       bool acceptor=False, bool show_weight_one=False,
  */
 
@@ -21851,16 +22206,16 @@
   __pyx_t_2.__pyx_n = 6;
   __pyx_t_2.isymbols = __pyx_v_isymbols;
   __pyx_t_2.osymbols = __pyx_v_osymbols;
   __pyx_t_2.ssymbols = __pyx_v_ssymbols;
   __pyx_t_2.acceptor = __pyx_v_acceptor;
   __pyx_t_2.show_weight_one = __pyx_v_show_weight_one;
   __pyx_t_2.missing_sym = __pyx_v_missing_sym;
-  __pyx_t_1 = __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Fst->print(__pyx_v_self, 1, &__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1850, __pyx_L1_error)
-  __pyx_t_3 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1850, __pyx_L1_error)
+  __pyx_t_1 = __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Fst->print(__pyx_v_self, 1, &__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1914, __pyx_L1_error)
+  __pyx_t_3 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1914, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -21869,15 +22224,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1897
+/* "fstlib/cext/pywrapfst.pyx":1961
  *     return _sstrm.str()
  * 
  *   def properties(self, mask, bool test):             # <<<<<<<<<<<<<<
  *     """
  *     properties(self, mask, test)
  */
 
@@ -21912,32 +22267,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mask)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_test)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("properties", 1, 2, 2, 1); __PYX_ERR(0, 1897, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("properties", 1, 2, 2, 1); __PYX_ERR(0, 1961, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "properties") < 0)) __PYX_ERR(0, 1897, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "properties") < 0)) __PYX_ERR(0, 1961, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_mask = values[0];
-    __pyx_v_test = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_test == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1897, __pyx_L3_error)
+    __pyx_v_test = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_test == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1961, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("properties", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1897, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("properties", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1961, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Fst.properties", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_34properties(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), __pyx_v_mask, __pyx_v_test);
 
@@ -21948,62 +22303,62 @@
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_3Fst_34properties(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, PyObject *__pyx_v_mask, bool __pyx_v_test) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
-  uint64 __pyx_t_4;
+  uint64_t __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("properties", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1915
+  /* "fstlib/cext/pywrapfst.pyx":1979
  *       A FstProperties representing a 64-bit bitmask of the requested properties.
  *     """
  *     return FstProperties(self._fst.get().Properties(mask.value, test))             # <<<<<<<<<<<<<<
  * 
  *   @classmethod
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstProperties); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1915, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstProperties); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1979, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1915, __pyx_L1_error)
+    __PYX_ERR(0, 1979, __pyx_L1_error)
   }
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1915, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1979, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyInt_As_uint64_t(__pyx_t_3); if (unlikely((__pyx_t_4 == ((uint64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1915, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_As_uint64_t(__pyx_t_3); if (unlikely((__pyx_t_4 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1979, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_self->_fst.get()->Properties(__pyx_t_4, __pyx_v_test)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1915, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_self->_fst.get()->Properties(__pyx_t_4, __pyx_v_test)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1979, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1915, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1979, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1897
+  /* "fstlib/cext/pywrapfst.pyx":1961
  *     return _sstrm.str()
  * 
  *   def properties(self, mask, bool test):             # <<<<<<<<<<<<<<
  *     """
  *     properties(self, mask, test)
  */
 
@@ -22017,15 +22372,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1918
+/* "fstlib/cext/pywrapfst.pyx":1982
  * 
  *   @classmethod
  *   def read(cls, source):             # <<<<<<<<<<<<<<
  *     """
  *     read(source)
  */
 
@@ -22048,29 +22403,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1933
+  /* "fstlib/cext/pywrapfst.pyx":1997
  *       FstIOError: Read failed.
  *     """
  *     return _read_Fst(source)             # <<<<<<<<<<<<<<
  * 
  *   @classmethod
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_Fst(__pyx_v_source, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1933, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_Fst(__pyx_v_source, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1997, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1918
+  /* "fstlib/cext/pywrapfst.pyx":1982
  * 
  *   @classmethod
  *   def read(cls, source):             # <<<<<<<<<<<<<<
  *     """
  *     read(source)
  */
 
@@ -22081,15 +22436,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1936
+/* "fstlib/cext/pywrapfst.pyx":2000
  * 
  *   @classmethod
  *   def read_from_string(cls, state):             # <<<<<<<<<<<<<<
  *     """
  *     read_from_string(state)
  */
 
@@ -22113,30 +22468,30 @@
   std::string __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read_from_string", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":1951
+  /* "fstlib/cext/pywrapfst.pyx":2015
  *       FstIOError: Read failed.
  *     """
  *     return _read_Fst_from_string(state)             # <<<<<<<<<<<<<<
  * 
- *   cpdef int64 start(self):
+ *   cpdef int64_t start(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_string_from_py_std__in_string(__pyx_v_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1951, __pyx_L1_error)
-  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_Fst_from_string(__pyx_t_1, 0)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1951, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_string_from_py_std__in_string(__pyx_v_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2015, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_Fst_from_string(__pyx_t_1, 0)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2015, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1936
+  /* "fstlib/cext/pywrapfst.pyx":2000
  * 
  *   @classmethod
  *   def read_from_string(cls, state):             # <<<<<<<<<<<<<<
  *     """
  *     read_from_string(state)
  */
 
@@ -22147,45 +22502,45 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1953
+/* "fstlib/cext/pywrapfst.pyx":2017
  *     return _read_Fst_from_string(state)
  * 
- *   cpdef int64 start(self):             # <<<<<<<<<<<<<<
+ *   cpdef int64_t start(self):             # <<<<<<<<<<<<<<
  *     """
  *     start(self)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_41start(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch) {
-  int64 __pyx_r;
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_self, int __pyx_skip_dispatch) {
+  int64_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  int64 __pyx_t_5;
+  int64_t __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("start", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_start); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1953, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_start); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2017, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_41start)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -22193,18 +22548,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1953, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2017, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1953, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2017, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -22215,32 +22570,32 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1959
+  /* "fstlib/cext/pywrapfst.pyx":2023
  *     Returns the start state.
  *     """
  *     return self._fst.get().Start()             # <<<<<<<<<<<<<<
  * 
  *   cpdef _StateIterator states(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1959, __pyx_L1_error)
+    __PYX_ERR(0, 2023, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_fst.get()->Start();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1953
+  /* "fstlib/cext/pywrapfst.pyx":2017
  *     return _read_Fst_from_string(state)
  * 
- *   cpdef int64 start(self):             # <<<<<<<<<<<<<<
+ *   cpdef int64_t start(self):             # <<<<<<<<<<<<<<
  *     """
  *     start(self)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -22273,15 +22628,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("start", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_start(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1953, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_start(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2017, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -22290,15 +22645,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1961
+/* "fstlib/cext/pywrapfst.pyx":2025
  *     return self._fst.get().Start()
  * 
  *   cpdef _StateIterator states(self):             # <<<<<<<<<<<<<<
  *     """
  *     states(self)
  */
 
@@ -22319,15 +22674,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_states); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1961, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_states); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2025, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_43states)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -22336,18 +22691,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1961, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2025, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__StateIterator))))) __PYX_ERR(0, 1961, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__StateIterator))))) __PYX_ERR(0, 2025, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -22358,29 +22713,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1970
+  /* "fstlib/cext/pywrapfst.pyx":2034
  *       A _StateIterator object for the FST.
  *     """
  *     return _StateIterator(self)             # <<<<<<<<<<<<<<
  * 
  *   cpdef bool verify(self):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__StateIterator), ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1970, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__StateIterator), ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2034, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1961
+  /* "fstlib/cext/pywrapfst.pyx":2025
  *     return self._fst.get().Start()
  * 
  *   cpdef _StateIterator states(self):             # <<<<<<<<<<<<<<
  *     """
  *     states(self)
  */
 
@@ -22417,15 +22772,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("states", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_states(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1961, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_states(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2025, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -22434,15 +22789,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1972
+/* "fstlib/cext/pywrapfst.pyx":2036
  *     return _StateIterator(self)
  * 
  *   cpdef bool verify(self):             # <<<<<<<<<<<<<<
  *     """
  *     verify(self)
  */
 
@@ -22464,15 +22819,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_verify); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1972, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_verify); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2036, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_45verify)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -22480,18 +22835,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1972, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2036, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1972, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2036, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -22502,29 +22857,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1981
+  /* "fstlib/cext/pywrapfst.pyx":2045
  *       True if the contents are sane, False otherwise.
  *     """
  *     return fst.Verify(deref(self._fst))             # <<<<<<<<<<<<<<
  * 
  *   cpdef string weight_type(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1981, __pyx_L1_error)
+    __PYX_ERR(0, 2045, __pyx_L1_error)
   }
   __pyx_r = fst::script::Verify((*__pyx_v_self->_fst));
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1972
+  /* "fstlib/cext/pywrapfst.pyx":2036
  *     return _StateIterator(self)
  * 
  *   cpdef bool verify(self):             # <<<<<<<<<<<<<<
  *     """
  *     verify(self)
  */
 
@@ -22560,15 +22915,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("verify", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_verify(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1972, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_verify(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2036, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -22577,15 +22932,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1983
+/* "fstlib/cext/pywrapfst.pyx":2047
  *     return fst.Verify(deref(self._fst))
  * 
  *   cpdef string weight_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     weight_type(self)
  */
 
@@ -22607,15 +22962,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_weight_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1983, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_weight_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2047, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_47weight_type)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -22623,18 +22978,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1983, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2047, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1983, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2047, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -22645,29 +23000,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1992
+  /* "fstlib/cext/pywrapfst.pyx":2056
  *       A string representing the weight type.
  *     """
  *     return self._fst.get().WeightType()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void write(self, source) except *:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 1992, __pyx_L1_error)
+    __PYX_ERR(0, 2056, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_fst.get()->WeightType();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1983
+  /* "fstlib/cext/pywrapfst.pyx":2047
  *     return fst.Verify(deref(self._fst))
  * 
  *   cpdef string weight_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     weight_type(self)
  */
 
@@ -22703,15 +23058,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("weight_type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_weight_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1983, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_weight_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2047, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -22720,15 +23075,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":1994
+/* "fstlib/cext/pywrapfst.pyx":2058
  *     return self._fst.get().WeightType()
  * 
  *   cpdef void write(self, source) except *:             # <<<<<<<<<<<<<<
  *     """
  *     write(self, source)
  */
 
@@ -22750,15 +23105,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1994, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2058, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_49write)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -22766,15 +23121,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_source) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_source);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1994, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2058, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -22786,41 +23141,41 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2008
+  /* "fstlib/cext/pywrapfst.pyx":2072
  *       FstIOError: Write failed.
  *     """
  *     if not self._fst.get().Write(path_tostring(source)):             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2008, __pyx_L1_error)
+    __PYX_ERR(0, 2072, __pyx_L1_error)
   }
-  __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2008, __pyx_L1_error)
+  __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2072, __pyx_L1_error)
   __pyx_t_6 = ((!(__pyx_v_self->_fst.get()->Write(__pyx_t_5) != 0)) != 0);
   if (unlikely(__pyx_t_6)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2009
+    /* "fstlib/cext/pywrapfst.pyx":2073
  *     """
  *     if not self._fst.get().Write(path_tostring(source)):
  *       raise FstIOError(f"Write failed: {source!r}")             # <<<<<<<<<<<<<<
  * 
  *   cpdef bytes write_to_string(self):
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2009, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2073, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2009, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2073, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Write_failed, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2009, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Write_failed, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2073, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -22828,31 +23183,31 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2009, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2073, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 2009, __pyx_L1_error)
+    __PYX_ERR(0, 2073, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2008
+    /* "fstlib/cext/pywrapfst.pyx":2072
  *       FstIOError: Write failed.
  *     """
  *     if not self._fst.get().Write(path_tostring(source)):             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":1994
+  /* "fstlib/cext/pywrapfst.pyx":2058
  *     return self._fst.get().WeightType()
  * 
  *   cpdef void write(self, source) except *:             # <<<<<<<<<<<<<<
  *     """
  *     write(self, source)
  */
 
@@ -22887,16 +23242,16 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("write", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_write(__pyx_v_self, __pyx_v_source, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1994, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1994, __pyx_L1_error)
+  __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_write(__pyx_v_self, __pyx_v_source, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2058, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2058, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -22905,15 +23260,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2011
+/* "fstlib/cext/pywrapfst.pyx":2075
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  *   cpdef bytes write_to_string(self):             # <<<<<<<<<<<<<<
  *     """
  *     write_to_string(self)
  */
 
@@ -22936,15 +23291,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_to_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2011, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_to_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2075, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Fst_51write_to_string)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -22953,18 +23308,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2011, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2075, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 2011, __pyx_L1_error)
+        if (!(likely(PyBytes_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 2075, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -22975,80 +23330,80 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2024
+  /* "fstlib/cext/pywrapfst.pyx":2088
  *     """
  *     cdef stringstream _sstrm
  *     if not self._fst.get().Write(_sstrm, b"<pywrapfst>"):             # <<<<<<<<<<<<<<
  *       raise FstIOError("Write to string failed")
  *     return _sstrm.str()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2024, __pyx_L1_error)
+    __PYX_ERR(0, 2088, __pyx_L1_error)
   }
   __pyx_t_5 = ((!(__pyx_v_self->_fst.get()->Write(__pyx_v__sstrm, __pyx_k_pywrapfst) != 0)) != 0);
   if (unlikely(__pyx_t_5)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2025
+    /* "fstlib/cext/pywrapfst.pyx":2089
  *     cdef stringstream _sstrm
  *     if not self._fst.get().Write(_sstrm, b"<pywrapfst>"):
  *       raise FstIOError("Write to string failed")             # <<<<<<<<<<<<<<
  *     return _sstrm.str()
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2025, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2089, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_kp_u_Write_to_string_failed) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_Write_to_string_failed);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2025, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2089, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 2025, __pyx_L1_error)
+    __PYX_ERR(0, 2089, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2024
+    /* "fstlib/cext/pywrapfst.pyx":2088
  *     """
  *     cdef stringstream _sstrm
  *     if not self._fst.get().Write(_sstrm, b"<pywrapfst>"):             # <<<<<<<<<<<<<<
  *       raise FstIOError("Write to string failed")
  *     return _sstrm.str()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2026
+  /* "fstlib/cext/pywrapfst.pyx":2090
  *     if not self._fst.get().Write(_sstrm, b"<pywrapfst>"):
  *       raise FstIOError("Write to string failed")
  *     return _sstrm.str()             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyBytes_string_to_py_std__in_string(__pyx_v__sstrm.str()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2026, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyBytes_string_to_py_std__in_string(__pyx_v__sstrm.str()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2090, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2011
+  /* "fstlib/cext/pywrapfst.pyx":2075
  *       raise FstIOError(f"Write failed: {source!r}")
  * 
  *   cpdef bytes write_to_string(self):             # <<<<<<<<<<<<<<
  *     """
  *     write_to_string(self)
  */
 
@@ -23085,15 +23440,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("write_to_string", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_write_to_string(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2011, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_3Fst_write_to_string(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2075, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -23102,15 +23457,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2039
+/* "fstlib/cext/pywrapfst.pyx":2103
  *   """
  * 
  *   cdef void _check_mutating_imethod(self) except *:             # <<<<<<<<<<<<<<
  *     """Checks whether an operation mutating the FST has produced an error.
  * 
  */
 
@@ -23121,66 +23476,66 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_check_mutating_imethod", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2044
+  /* "fstlib/cext/pywrapfst.pyx":2108
  *     This function is not visible to Python users.
  *     """
  *     if self._fst.get().Properties(fst.kError, True) == fst.kError:             # <<<<<<<<<<<<<<
  *       raise FstOpError("Operation failed")
- *   cdef void _add_arc(self, int64 state, Arc arc) except *:
+ *   cdef void _add_arc(self, int64_t state, Arc arc) except *:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2044, __pyx_L1_error)
+    __PYX_ERR(0, 2108, __pyx_L1_error)
   }
   __pyx_t_1 = ((__pyx_v_self->__pyx_base._fst.get()->Properties(fst::kError, 1) == fst::kError) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2045
+    /* "fstlib/cext/pywrapfst.pyx":2109
  *     """
  *     if self._fst.get().Properties(fst.kError, True) == fst.kError:
  *       raise FstOpError("Operation failed")             # <<<<<<<<<<<<<<
- *   cdef void _add_arc(self, int64 state, Arc arc) except *:
+ *   cdef void _add_arc(self, int64_t state, Arc arc) except *:
  *     if not self._fst.get().ValidStateId(state):
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2045, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2109, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Operation_failed) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Operation_failed);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2045, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2109, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 2045, __pyx_L1_error)
+    __PYX_ERR(0, 2109, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2044
+    /* "fstlib/cext/pywrapfst.pyx":2108
  *     This function is not visible to Python users.
  *     """
  *     if self._fst.get().Properties(fst.kError, True) == fst.kError:             # <<<<<<<<<<<<<<
  *       raise FstOpError("Operation failed")
- *   cdef void _add_arc(self, int64 state, Arc arc) except *:
+ *   cdef void _add_arc(self, int64_t state, Arc arc) except *:
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2039
+  /* "fstlib/cext/pywrapfst.pyx":2103
  *   """
  * 
  *   cdef void _check_mutating_imethod(self) except *:             # <<<<<<<<<<<<<<
  *     """Checks whether an operation mutating the FST has produced an error.
  * 
  */
 
@@ -23191,143 +23546,143 @@
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._check_mutating_imethod", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2046
+/* "fstlib/cext/pywrapfst.pyx":2110
  *     if self._fst.get().Properties(fst.kError, True) == fst.kError:
  *       raise FstOpError("Operation failed")
- *   cdef void _add_arc(self, int64 state, Arc arc) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _add_arc(self, int64_t state, Arc arc) except *:             # <<<<<<<<<<<<<<
  *     if not self._fst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")
  */
 
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__add_arc(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc) {
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__add_arc(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc) {
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_add_arc", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2047
+  /* "fstlib/cext/pywrapfst.pyx":2111
  *       raise FstOpError("Operation failed")
- *   cdef void _add_arc(self, int64 state, Arc arc) except *:
+ *   cdef void _add_arc(self, int64_t state, Arc arc) except *:
  *     if not self._fst.get().ValidStateId(state):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     if not self._mfst.get().AddArc(state, deref(arc._arc)):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2047, __pyx_L1_error)
+    __PYX_ERR(0, 2111, __pyx_L1_error)
   }
   __pyx_t_1 = ((!(__pyx_v_self->__pyx_base._fst.get()->ValidStateId(__pyx_v_state) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2048
- *   cdef void _add_arc(self, int64 state, Arc arc) except *:
+    /* "fstlib/cext/pywrapfst.pyx":2112
+ *   cdef void _add_arc(self, int64_t state, Arc arc) except *:
  *     if not self._fst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  *     if not self._mfst.get().AddArc(state, deref(arc._arc)):
  *       raise FstOpError("Incompatible or invalid weight type")
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2048, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2112, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_State_index_out_of_range);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2048, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2112, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 2048, __pyx_L1_error)
+    __PYX_ERR(0, 2112, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2047
+    /* "fstlib/cext/pywrapfst.pyx":2111
  *       raise FstOpError("Operation failed")
- *   cdef void _add_arc(self, int64 state, Arc arc) except *:
+ *   cdef void _add_arc(self, int64_t state, Arc arc) except *:
  *     if not self._fst.get().ValidStateId(state):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     if not self._mfst.get().AddArc(state, deref(arc._arc)):
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2049
+  /* "fstlib/cext/pywrapfst.pyx":2113
  *     if not self._fst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")
  *     if not self._mfst.get().AddArc(state, deref(arc._arc)):             # <<<<<<<<<<<<<<
  *       raise FstOpError("Incompatible or invalid weight type")
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2049, __pyx_L1_error)
+    __PYX_ERR(0, 2113, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_arc) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 2049, __pyx_L1_error)
+    __PYX_ERR(0, 2113, __pyx_L1_error)
   }
   __pyx_t_1 = ((!(__pyx_v_self->_mfst.get()->AddArc(__pyx_v_state, (*__pyx_v_arc->_arc)) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2050
+    /* "fstlib/cext/pywrapfst.pyx":2114
  *       raise FstIndexError("State index out of range")
  *     if not self._mfst.get().AddArc(state, deref(arc._arc)):
  *       raise FstOpError("Incompatible or invalid weight type")             # <<<<<<<<<<<<<<
  * 
- *   def add_arc(self, int64 state, Arc arc):
+ *   def add_arc(self, int64_t state, Arc arc):
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2050, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2114, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Incompatible_or_invalid_weight_t) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Incompatible_or_invalid_weight_t);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2050, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2114, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 2050, __pyx_L1_error)
+    __PYX_ERR(0, 2114, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2049
+    /* "fstlib/cext/pywrapfst.pyx":2113
  *     if not self._fst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")
  *     if not self._mfst.get().AddArc(state, deref(arc._arc)):             # <<<<<<<<<<<<<<
  *       raise FstOpError("Incompatible or invalid weight type")
  * 
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2046
+  /* "fstlib/cext/pywrapfst.pyx":2110
  *     if self._fst.get().Properties(fst.kError, True) == fst.kError:
  *       raise FstOpError("Operation failed")
- *   cdef void _add_arc(self, int64 state, Arc arc) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _add_arc(self, int64_t state, Arc arc) except *:             # <<<<<<<<<<<<<<
  *     if not self._fst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
@@ -23335,27 +23690,27 @@
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._add_arc", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2052
+/* "fstlib/cext/pywrapfst.pyx":2116
  *       raise FstOpError("Incompatible or invalid weight type")
  * 
- *   def add_arc(self, int64 state, Arc arc):             # <<<<<<<<<<<<<<
+ *   def add_arc(self, int64_t state, Arc arc):             # <<<<<<<<<<<<<<
  *     """
  *     add_arc(self, state, arc)
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_1add_arc(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_add_arc[] = "\n    add_arc(self, state, arc)\n\n    Adds a new arc to the FST and return self.\n\n    Args:\n      state: The integer index of the source state.\n      arc: The arc to add.\n\n    Returns:\n      self.\n\n    Raises:\n      FstIndexError: State index out of range.\n      FstOpdexError: Incompatible or invalid weight type.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_1add_arc(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("add_arc (wrapper)", 0);
@@ -23378,131 +23733,131 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_state)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_arc)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("add_arc", 1, 2, 2, 1); __PYX_ERR(0, 2052, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("add_arc", 1, 2, 2, 1); __PYX_ERR(0, 2116, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_arc") < 0)) __PYX_ERR(0, 2052, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_arc") < 0)) __PYX_ERR(0, 2116, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[0]); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2052, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[0]); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2116, __pyx_L3_error)
     __pyx_v_arc = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("add_arc", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2052, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("add_arc", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2116, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.add_arc", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arc), __pyx_ptype_6fstlib_4cext_9pywrapfst_Arc, 1, "arc", 0))) __PYX_ERR(0, 2052, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arc), __pyx_ptype_6fstlib_4cext_9pywrapfst_Arc, 1, "arc", 0))) __PYX_ERR(0, 2116, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_add_arc(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_state, __pyx_v_arc);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_add_arc(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_add_arc(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add_arc", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2069
+  /* "fstlib/cext/pywrapfst.pyx":2133
  *       FstOpdexError: Incompatible or invalid weight type.
  *     """
  *     self._add_arc(state, arc)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_add_arc");
-    __PYX_ERR(0, 2069, __pyx_L1_error)
+    __PYX_ERR(0, 2133, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_add_arc(__pyx_v_self, __pyx_v_state, __pyx_v_arc); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2069, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_add_arc(__pyx_v_self, __pyx_v_state, __pyx_v_arc); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2133, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2070
+  /* "fstlib/cext/pywrapfst.pyx":2134
  *     """
  *     self._add_arc(state, arc)
  *     return self             # <<<<<<<<<<<<<<
  * 
- *   cpdef int64 add_state(self):
+ *   cpdef int64_t add_state(self):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2052
+  /* "fstlib/cext/pywrapfst.pyx":2116
  *       raise FstOpError("Incompatible or invalid weight type")
  * 
- *   def add_arc(self, int64 state, Arc arc):             # <<<<<<<<<<<<<<
+ *   def add_arc(self, int64_t state, Arc arc):             # <<<<<<<<<<<<<<
  *     """
  *     add_arc(self, state, arc)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.add_arc", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2072
+/* "fstlib/cext/pywrapfst.pyx":2136
  *     return self
  * 
- *   cpdef int64 add_state(self):             # <<<<<<<<<<<<<<
+ *   cpdef int64_t add_state(self):             # <<<<<<<<<<<<<<
  *     """
  *     add_state(self)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_3add_state(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_state(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int __pyx_skip_dispatch) {
-  int64 __pyx_r;
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_state(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int __pyx_skip_dispatch) {
+  int64_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  int64 __pyx_t_5;
+  int64_t __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add_state", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_state); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2072, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_state); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2136, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_3add_state)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -23510,18 +23865,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2072, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2136, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2072, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2136, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -23532,32 +23887,32 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2081
+  /* "fstlib/cext/pywrapfst.pyx":2145
  *       The integer index of the new state.
  *     """
  *     return self._mfst.get().AddState()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void add_states(self, size_t n):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2081, __pyx_L1_error)
+    __PYX_ERR(0, 2145, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_mfst.get()->AddState();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2072
+  /* "fstlib/cext/pywrapfst.pyx":2136
  *     return self
  * 
- *   cpdef int64 add_state(self):             # <<<<<<<<<<<<<<
+ *   cpdef int64_t add_state(self):             # <<<<<<<<<<<<<<
  *     """
  *     add_state(self)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -23590,15 +23945,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add_state", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_state(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2072, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_state(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -23607,15 +23962,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2083
+/* "fstlib/cext/pywrapfst.pyx":2147
  *     return self._mfst.get().AddState()
  * 
  *   cpdef void add_states(self, size_t n):             # <<<<<<<<<<<<<<
  *     """
  *     add_states(self, n)
  */
 
@@ -23636,18 +23991,18 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_states); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2083, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_states); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2147, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_5add_states)) {
-        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_n); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2083, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_n); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2147, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -23655,15 +24010,15 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2083, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2147, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -23675,28 +24030,28 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2092
+  /* "fstlib/cext/pywrapfst.pyx":2156
  *       n: The number of states to add.
  *     """
  *     self._mfst.get().AddStates(n)             # <<<<<<<<<<<<<<
  * 
  *   cdef void _arcsort(self, sort_type="ilabel") except *:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2092, __pyx_L1_error)
+    __PYX_ERR(0, 2156, __pyx_L1_error)
   }
   __pyx_v_self->_mfst.get()->AddStates(__pyx_v_n);
 
-  /* "fstlib/cext/pywrapfst.pyx":2083
+  /* "fstlib/cext/pywrapfst.pyx":2147
  *     return self._mfst.get().AddState()
  * 
  *   cpdef void add_states(self, size_t n):             # <<<<<<<<<<<<<<
  *     """
  *     add_states(self, n)
  */
 
@@ -23721,15 +24076,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("add_states (wrapper)", 0);
   assert(__pyx_arg_n); {
-    __pyx_v_n = __Pyx_PyInt_As_size_t(__pyx_arg_n); if (unlikely((__pyx_v_n == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 2083, __pyx_L3_error)
+    __pyx_v_n = __Pyx_PyInt_As_size_t(__pyx_arg_n); if (unlikely((__pyx_v_n == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 2147, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.add_states", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
@@ -23745,15 +24100,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add_states", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_states(__pyx_v_self, __pyx_v_n, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2083, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_states(__pyx_v_self, __pyx_v_n, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2147, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -23762,15 +24117,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2094
+/* "fstlib/cext/pywrapfst.pyx":2158
  *     self._mfst.get().AddStates(n)
  * 
  *   cdef void _arcsort(self, sort_type="ilabel") except *:             # <<<<<<<<<<<<<<
  *     cdef fst.ArcSortType _sort_type
  *     if not fst.GetArcSortType(tostring(sort_type), addr(_sort_type)):
  */
 
@@ -23790,37 +24145,37 @@
   __Pyx_RefNannySetupContext("_arcsort", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_sort_type = __pyx_optional_args->sort_type;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2096
+  /* "fstlib/cext/pywrapfst.pyx":2160
  *   cdef void _arcsort(self, sort_type="ilabel") except *:
  *     cdef fst.ArcSortType _sort_type
  *     if not fst.GetArcSortType(tostring(sort_type), addr(_sort_type)):             # <<<<<<<<<<<<<<
  *       raise FstArgError(f"Unknown sort type: {sort_type!r}")
  *     fst.ArcSort(self._mfst.get(), _sort_type)
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_sort_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2096, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_sort_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2160, __pyx_L1_error)
   __pyx_t_2 = ((!(fst::script::GetArcSortType(__pyx_t_1, (&__pyx_v__sort_type)) != 0)) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2097
+    /* "fstlib/cext/pywrapfst.pyx":2161
  *     cdef fst.ArcSortType _sort_type
  *     if not fst.GetArcSortType(tostring(sort_type), addr(_sort_type)):
  *       raise FstArgError(f"Unknown sort type: {sort_type!r}")             # <<<<<<<<<<<<<<
  *     fst.ArcSort(self._mfst.get(), _sort_type)
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2097, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2161, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_sort_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2097, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_sort_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2161, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_sort_type, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2097, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_sort_type, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2161, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -23828,44 +24183,44 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2097, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2161, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 2097, __pyx_L1_error)
+    __PYX_ERR(0, 2161, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2096
+    /* "fstlib/cext/pywrapfst.pyx":2160
  *   cdef void _arcsort(self, sort_type="ilabel") except *:
  *     cdef fst.ArcSortType _sort_type
  *     if not fst.GetArcSortType(tostring(sort_type), addr(_sort_type)):             # <<<<<<<<<<<<<<
  *       raise FstArgError(f"Unknown sort type: {sort_type!r}")
  *     fst.ArcSort(self._mfst.get(), _sort_type)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2098
+  /* "fstlib/cext/pywrapfst.pyx":2162
  *     if not fst.GetArcSortType(tostring(sort_type), addr(_sort_type)):
  *       raise FstArgError(f"Unknown sort type: {sort_type!r}")
  *     fst.ArcSort(self._mfst.get(), _sort_type)             # <<<<<<<<<<<<<<
  * 
  *   def arcsort(self, sort_type="ilabel"):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2098, __pyx_L1_error)
+    __PYX_ERR(0, 2162, __pyx_L1_error)
   }
   fst::script::ArcSort(__pyx_v_self->_mfst.get(), __pyx_v__sort_type);
 
-  /* "fstlib/cext/pywrapfst.pyx":2094
+  /* "fstlib/cext/pywrapfst.pyx":2158
  *     self._mfst.get().AddStates(n)
  * 
  *   cdef void _arcsort(self, sort_type="ilabel") except *:             # <<<<<<<<<<<<<<
  *     cdef fst.ArcSortType _sort_type
  *     if not fst.GetArcSortType(tostring(sort_type), addr(_sort_type)):
  */
 
@@ -23877,15 +24232,15 @@
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._arcsort", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2100
+/* "fstlib/cext/pywrapfst.pyx":2164
  *     fst.ArcSort(self._mfst.get(), _sort_type)
  * 
  *   def arcsort(self, sort_type="ilabel"):             # <<<<<<<<<<<<<<
  *     """
  *     arcsort(self, sort_type="ilabel")
  */
 
@@ -23918,29 +24273,29 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_sort_type);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "arcsort") < 0)) __PYX_ERR(0, 2100, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "arcsort") < 0)) __PYX_ERR(0, 2164, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_sort_type = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("arcsort", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2100, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("arcsort", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2164, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.arcsort", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_6arcsort(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_sort_type);
 
@@ -23954,42 +24309,42 @@
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__arcsort __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("arcsort", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2119
+  /* "fstlib/cext/pywrapfst.pyx":2183
  *       FstArgError: Unknown sort type.
  *     """
  *     self._arcsort(sort_type)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arcsort");
-    __PYX_ERR(0, 2119, __pyx_L1_error)
+    __PYX_ERR(0, 2183, __pyx_L1_error)
   }
   __pyx_t_1.__pyx_n = 1;
   __pyx_t_1.sort_type = __pyx_v_sort_type;
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_arcsort(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2119, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_arcsort(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2183, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2120
+  /* "fstlib/cext/pywrapfst.pyx":2184
  *     """
  *     self._arcsort(sort_type)
  *     return self             # <<<<<<<<<<<<<<
  * 
- *   cdef void _closure(self, bool closure_plus=False):
+ *   cdef void _closure(self, closure_type="star"):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2100
+  /* "fstlib/cext/pywrapfst.pyx":2164
  *     fst.ArcSort(self._mfst.get(), _sort_type)
  * 
  *   def arcsort(self, sort_type="ilabel"):             # <<<<<<<<<<<<<<
  *     """
  *     arcsort(self, sort_type="ilabel")
  */
 
@@ -23999,235 +24354,236 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2122
+/* "fstlib/cext/pywrapfst.pyx":2186
  *     return self
  * 
- *   cdef void _closure(self, bool closure_plus=False):             # <<<<<<<<<<<<<<
- *     fst.Closure(self._mfst.get(), fst.GetClosureType(closure_plus))
+ *   cdef void _closure(self, closure_type="star"):             # <<<<<<<<<<<<<<
+ *     fst.Closure(self._mfst.get(), _get_closure_type(tostring(closure_type)))
  * 
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__closure(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__closure *__pyx_optional_args) {
-  bool __pyx_v_closure_plus = ((bool)0);
+  PyObject *__pyx_v_closure_type = ((PyObject *)__pyx_n_u_star);
   __Pyx_RefNannyDeclarations
+  std::string __pyx_t_1;
+  enum fst::ClosureType __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_closure", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
-      __pyx_v_closure_plus = __pyx_optional_args->closure_plus;
+      __pyx_v_closure_type = __pyx_optional_args->closure_type;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2123
+  /* "fstlib/cext/pywrapfst.pyx":2187
  * 
- *   cdef void _closure(self, bool closure_plus=False):
- *     fst.Closure(self._mfst.get(), fst.GetClosureType(closure_plus))             # <<<<<<<<<<<<<<
+ *   cdef void _closure(self, closure_type="star"):
+ *     fst.Closure(self._mfst.get(), _get_closure_type(tostring(closure_type)))             # <<<<<<<<<<<<<<
  * 
- *   def closure(self, bool closure_plus=False):
+ *   def closure(self, closure_type="star"):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2123, __pyx_L1_error)
+    __PYX_ERR(0, 2187, __pyx_L1_error)
   }
-  fst::script::Closure(__pyx_v_self->_mfst.get(), fst::script::GetClosureType(__pyx_v_closure_plus));
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_closure_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2187, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_closure_type(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2187, __pyx_L1_error)
+  fst::script::Closure(__pyx_v_self->_mfst.get(), __pyx_t_2);
 
-  /* "fstlib/cext/pywrapfst.pyx":2122
+  /* "fstlib/cext/pywrapfst.pyx":2186
  *     return self
  * 
- *   cdef void _closure(self, bool closure_plus=False):             # <<<<<<<<<<<<<<
- *     fst.Closure(self._mfst.get(), fst.GetClosureType(closure_plus))
+ *   cdef void _closure(self, closure_type="star"):             # <<<<<<<<<<<<<<
+ *     fst.Closure(self._mfst.get(), _get_closure_type(tostring(closure_type)))
  * 
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst.MutableFst._closure", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2125
- *     fst.Closure(self._mfst.get(), fst.GetClosureType(closure_plus))
+/* "fstlib/cext/pywrapfst.pyx":2189
+ *     fst.Closure(self._mfst.get(), _get_closure_type(tostring(closure_type)))
  * 
- *   def closure(self, bool closure_plus=False):             # <<<<<<<<<<<<<<
+ *   def closure(self, closure_type="star"):             # <<<<<<<<<<<<<<
  *     """
- *     closure(self, closure_plus=False)
+ *     closure(self, closure_type="star")
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_9closure(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_8closure[] = "\n    closure(self, closure_plus=False)\n\n    Computes concatenative closure.\n\n    This operation destructively converts the FST to its concatenative closure.\n    If A transduces string x to y with weight a, then the closure transduces x\n    to y with weight a, xx to yy with weight a \\otimes a, xxx to yyy with weight\n    a \\otimes a \\otimes a, and so on. The empty string is also transduced to\n    itself with semiring One if `closure_plus` is False.\n\n    Args:\n      closure_plus: If False, do not accept the empty string.\n\n    Returns:\n      self.\n    ";
+static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_8closure[] = "\n    closure(self, closure_type=\"star\")\n\n    Computes concatenative closure.\n\n    This operation destructively converts the FST to its concatenative closure.\n    If A transduces string x to y with weight a, then the closure transduces x\n    to y with weight a, xx to yy with weight a \\otimes a, xxx to yyy with weight\n    a \\otimes a \\otimes a, and so on. The empty string is also transduced to\n    itself with semiring One if `closure_type` is \"star\".\n\n    Args:\n      closure_type: If \"star\", do not accept the empty string. If \"plus\", accept the empty string.\n\n    Returns:\n      self.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_9closure(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  bool __pyx_v_closure_plus;
+  PyObject *__pyx_v_closure_type = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("closure (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_closure_plus,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_closure_type,0};
     PyObject* values[1] = {0};
+    values[0] = ((PyObject *)__pyx_n_u_star);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_closure_plus);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_closure_type);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "closure") < 0)) __PYX_ERR(0, 2125, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "closure") < 0)) __PYX_ERR(0, 2189, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
-    if (values[0]) {
-      __pyx_v_closure_plus = __Pyx_PyObject_IsTrue(values[0]); if (unlikely((__pyx_v_closure_plus == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2125, __pyx_L3_error)
-    } else {
-      __pyx_v_closure_plus = ((bool)0);
-    }
+    __pyx_v_closure_type = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("closure", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2125, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("closure", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2189, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.closure", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_8closure(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_closure_plus);
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_8closure(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_closure_type);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_8closure(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, bool __pyx_v_closure_plus) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_8closure(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_closure_type) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__closure __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("closure", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2143
+  /* "fstlib/cext/pywrapfst.pyx":2207
  *       self.
  *     """
- *     self._closure(closure_plus)             # <<<<<<<<<<<<<<
+ *     self._closure(closure_type)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_closure");
-    __PYX_ERR(0, 2143, __pyx_L1_error)
+    __PYX_ERR(0, 2207, __pyx_L1_error)
   }
   __pyx_t_1.__pyx_n = 1;
-  __pyx_t_1.closure_plus = __pyx_v_closure_plus;
+  __pyx_t_1.closure_type = __pyx_v_closure_type;
   ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_closure(__pyx_v_self, &__pyx_t_1); 
 
-  /* "fstlib/cext/pywrapfst.pyx":2144
+  /* "fstlib/cext/pywrapfst.pyx":2208
  *     """
- *     self._closure(closure_plus)
+ *     self._closure(closure_type)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _concat(self, Fst fst2) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2125
- *     fst.Closure(self._mfst.get(), fst.GetClosureType(closure_plus))
+  /* "fstlib/cext/pywrapfst.pyx":2189
+ *     fst.Closure(self._mfst.get(), _get_closure_type(tostring(closure_type)))
  * 
- *   def closure(self, bool closure_plus=False):             # <<<<<<<<<<<<<<
+ *   def closure(self, closure_type="star"):             # <<<<<<<<<<<<<<
  *     """
- *     closure(self, closure_plus=False)
+ *     closure(self, closure_type="star")
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.closure", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2146
+/* "fstlib/cext/pywrapfst.pyx":2210
  *     return self
  * 
  *   cdef void _concat(self, Fst fst2) except *:             # <<<<<<<<<<<<<<
  *     fst.Concat(self._mfst.get(), deref(fst2._fst))
  *     self._check_mutating_imethod()
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__concat(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_fst2) {
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_concat", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2147
+  /* "fstlib/cext/pywrapfst.pyx":2211
  * 
  *   cdef void _concat(self, Fst fst2) except *:
  *     fst.Concat(self._mfst.get(), deref(fst2._fst))             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2147, __pyx_L1_error)
+    __PYX_ERR(0, 2211, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_fst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2147, __pyx_L1_error)
+    __PYX_ERR(0, 2211, __pyx_L1_error)
   }
   fst::script::Concat(__pyx_v_self->_mfst.get(), (*__pyx_v_fst2->_fst));
 
-  /* "fstlib/cext/pywrapfst.pyx":2148
+  /* "fstlib/cext/pywrapfst.pyx":2212
  *   cdef void _concat(self, Fst fst2) except *:
  *     fst.Concat(self._mfst.get(), deref(fst2._fst))
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
  *   def concat(self, Fst fst2):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2148, __pyx_L1_error)
+    __PYX_ERR(0, 2212, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2148, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2212, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2146
+  /* "fstlib/cext/pywrapfst.pyx":2210
  *     return self
  * 
  *   cdef void _concat(self, Fst fst2) except *:             # <<<<<<<<<<<<<<
  *     fst.Concat(self._mfst.get(), deref(fst2._fst))
  *     self._check_mutating_imethod()
  */
 
@@ -24235,15 +24591,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._concat", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2150
+/* "fstlib/cext/pywrapfst.pyx":2214
  *     self._check_mutating_imethod()
  * 
  *   def concat(self, Fst fst2):             # <<<<<<<<<<<<<<
  *     """
  *     concat(self, fst2)
  */
 
@@ -24253,15 +24609,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_11concat(PyObject *__pyx_v_self, PyObject *__pyx_v_fst2) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("concat (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_fst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "fst2", 0))) __PYX_ERR(0, 2150, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_fst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "fst2", 0))) __PYX_ERR(0, 2214, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_10concat(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_fst2));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -24273,40 +24629,40 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("concat", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2167
+  /* "fstlib/cext/pywrapfst.pyx":2231
  *       self.
  *     """
  *     self._concat(fst2)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_concat");
-    __PYX_ERR(0, 2167, __pyx_L1_error)
+    __PYX_ERR(0, 2231, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_concat(__pyx_v_self, __pyx_v_fst2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2167, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_concat(__pyx_v_self, __pyx_v_fst2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2231, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2168
+  /* "fstlib/cext/pywrapfst.pyx":2232
  *     """
  *     self._concat(fst2)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _connect(self):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2150
+  /* "fstlib/cext/pywrapfst.pyx":2214
  *     self._check_mutating_imethod()
  * 
  *   def concat(self, Fst fst2):             # <<<<<<<<<<<<<<
  *     """
  *     concat(self, fst2)
  */
 
@@ -24316,43 +24672,43 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2170
+/* "fstlib/cext/pywrapfst.pyx":2234
  *     return self
  * 
  *   cdef void _connect(self):             # <<<<<<<<<<<<<<
  *     fst.Connect(self._mfst.get())
  * 
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__connect(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self) {
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_connect", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2171
+  /* "fstlib/cext/pywrapfst.pyx":2235
  * 
  *   cdef void _connect(self):
  *     fst.Connect(self._mfst.get())             # <<<<<<<<<<<<<<
  * 
  *   def connect(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2171, __pyx_L1_error)
+    __PYX_ERR(0, 2235, __pyx_L1_error)
   }
   fst::script::Connect(__pyx_v_self->_mfst.get());
 
-  /* "fstlib/cext/pywrapfst.pyx":2170
+  /* "fstlib/cext/pywrapfst.pyx":2234
  *     return self
  * 
  *   cdef void _connect(self):             # <<<<<<<<<<<<<<
  *     fst.Connect(self._mfst.get())
  * 
  */
 
@@ -24360,15 +24716,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst.MutableFst._connect", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2173
+/* "fstlib/cext/pywrapfst.pyx":2237
  *     fst.Connect(self._mfst.get())
  * 
  *   def connect(self):             # <<<<<<<<<<<<<<
  *     """
  *     connect(self)
  */
 
@@ -24390,40 +24746,40 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("connect", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2185
+  /* "fstlib/cext/pywrapfst.pyx":2249
  *       self.
  *     """
  *     self._connect()             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_connect");
-    __PYX_ERR(0, 2185, __pyx_L1_error)
+    __PYX_ERR(0, 2249, __pyx_L1_error)
   }
   ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_connect(__pyx_v_self);
 
-  /* "fstlib/cext/pywrapfst.pyx":2186
+  /* "fstlib/cext/pywrapfst.pyx":2250
  *     """
  *     self._connect()
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _decode(self, EncodeMapper mapper) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2173
+  /* "fstlib/cext/pywrapfst.pyx":2237
  *     fst.Connect(self._mfst.get())
  * 
  *   def connect(self):             # <<<<<<<<<<<<<<
  *     """
  *     connect(self)
  */
 
@@ -24433,60 +24789,60 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2188
+/* "fstlib/cext/pywrapfst.pyx":2252
  *     return self
  * 
  *   cdef void _decode(self, EncodeMapper mapper) except *:             # <<<<<<<<<<<<<<
  *     fst.Decode(self._mfst.get(), deref(mapper._mapper))
  *     self._check_mutating_imethod()
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__decode(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_mapper) {
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_decode", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2189
+  /* "fstlib/cext/pywrapfst.pyx":2253
  * 
  *   cdef void _decode(self, EncodeMapper mapper) except *:
  *     fst.Decode(self._mfst.get(), deref(mapper._mapper))             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2189, __pyx_L1_error)
+    __PYX_ERR(0, 2253, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_mapper) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 2189, __pyx_L1_error)
+    __PYX_ERR(0, 2253, __pyx_L1_error)
   }
   fst::script::Decode(__pyx_v_self->_mfst.get(), (*__pyx_v_mapper->_mapper));
 
-  /* "fstlib/cext/pywrapfst.pyx":2190
+  /* "fstlib/cext/pywrapfst.pyx":2254
  *   cdef void _decode(self, EncodeMapper mapper) except *:
  *     fst.Decode(self._mfst.get(), deref(mapper._mapper))
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
  *   def decode(self, EncodeMapper mapper):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2190, __pyx_L1_error)
+    __PYX_ERR(0, 2254, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2190, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2254, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2188
+  /* "fstlib/cext/pywrapfst.pyx":2252
  *     return self
  * 
  *   cdef void _decode(self, EncodeMapper mapper) except *:             # <<<<<<<<<<<<<<
  *     fst.Decode(self._mfst.get(), deref(mapper._mapper))
  *     self._check_mutating_imethod()
  */
 
@@ -24494,15 +24850,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._decode", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2192
+/* "fstlib/cext/pywrapfst.pyx":2256
  *     self._check_mutating_imethod()
  * 
  *   def decode(self, EncodeMapper mapper):             # <<<<<<<<<<<<<<
  *     """
  *     decode(self, mapper)
  */
 
@@ -24512,15 +24868,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_15decode(PyObject *__pyx_v_self, PyObject *__pyx_v_mapper) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("decode (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mapper), __pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper, 1, "mapper", 0))) __PYX_ERR(0, 2192, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mapper), __pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper, 1, "mapper", 0))) __PYX_ERR(0, 2256, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_14decode(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_mapper));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -24532,40 +24888,40 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("decode", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2206
+  /* "fstlib/cext/pywrapfst.pyx":2270
  *       self.
  *     """
  *     self._decode(mapper)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_decode");
-    __PYX_ERR(0, 2206, __pyx_L1_error)
+    __PYX_ERR(0, 2270, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_decode(__pyx_v_self, __pyx_v_mapper); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2206, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_decode(__pyx_v_self, __pyx_v_mapper); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2270, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2207
+  /* "fstlib/cext/pywrapfst.pyx":2271
  *     """
  *     self._decode(mapper)
  *     return self             # <<<<<<<<<<<<<<
  * 
- *   cdef void _delete_arcs(self, int64 state, size_t n=0) except *:
+ *   cdef void _delete_arcs(self, int64_t state, size_t n=0) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2192
+  /* "fstlib/cext/pywrapfst.pyx":2256
  *     self._check_mutating_imethod()
  * 
  *   def decode(self, EncodeMapper mapper):             # <<<<<<<<<<<<<<
  *     """
  *     decode(self, mapper)
  */
 
@@ -24575,23 +24931,23 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2209
+/* "fstlib/cext/pywrapfst.pyx":2273
  *     return self
  * 
- *   cdef void _delete_arcs(self, int64 state, size_t n=0) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _delete_arcs(self, int64_t state, size_t n=0) except *:             # <<<<<<<<<<<<<<
  *     if not (self._mfst.get().DeleteArcs(state, n) if n else
  *             self._mfst.get().DeleteArcs(state)):
  */
 
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs *__pyx_optional_args) {
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs *__pyx_optional_args) {
   size_t __pyx_v_n = ((size_t)0);
   __Pyx_RefNannyDeclarations
   bool __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -24601,107 +24957,107 @@
   __Pyx_RefNannySetupContext("_delete_arcs", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_n = __pyx_optional_args->n;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2210
+  /* "fstlib/cext/pywrapfst.pyx":2274
  * 
- *   cdef void _delete_arcs(self, int64 state, size_t n=0) except *:
+ *   cdef void _delete_arcs(self, int64_t state, size_t n=0) except *:
  *     if not (self._mfst.get().DeleteArcs(state, n) if n else             # <<<<<<<<<<<<<<
  *             self._mfst.get().DeleteArcs(state)):
  *       raise FstIndexError("State index out of range")
  */
   if ((__pyx_v_n != 0)) {
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-      __PYX_ERR(0, 2210, __pyx_L1_error)
+      __PYX_ERR(0, 2274, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_self->_mfst.get()->DeleteArcs(__pyx_v_state, __pyx_v_n);
   } else {
 
-    /* "fstlib/cext/pywrapfst.pyx":2211
- *   cdef void _delete_arcs(self, int64 state, size_t n=0) except *:
+    /* "fstlib/cext/pywrapfst.pyx":2275
+ *   cdef void _delete_arcs(self, int64_t state, size_t n=0) except *:
  *     if not (self._mfst.get().DeleteArcs(state, n) if n else
  *             self._mfst.get().DeleteArcs(state)):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     self._check_mutating_imethod()
  */
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-      __PYX_ERR(0, 2211, __pyx_L1_error)
+      __PYX_ERR(0, 2275, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_v_self->_mfst.get()->DeleteArcs(__pyx_v_state);
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2210
+  /* "fstlib/cext/pywrapfst.pyx":2274
  * 
- *   cdef void _delete_arcs(self, int64 state, size_t n=0) except *:
+ *   cdef void _delete_arcs(self, int64_t state, size_t n=0) except *:
  *     if not (self._mfst.get().DeleteArcs(state, n) if n else             # <<<<<<<<<<<<<<
  *             self._mfst.get().DeleteArcs(state)):
  *       raise FstIndexError("State index out of range")
  */
   __pyx_t_2 = ((!(__pyx_t_1 != 0)) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2212
+    /* "fstlib/cext/pywrapfst.pyx":2276
  *     if not (self._mfst.get().DeleteArcs(state, n) if n else
  *             self._mfst.get().DeleteArcs(state)):
  *       raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2212, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2276, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_kp_u_State_index_out_of_range);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2212, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2276, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 2212, __pyx_L1_error)
+    __PYX_ERR(0, 2276, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2210
+    /* "fstlib/cext/pywrapfst.pyx":2274
  * 
- *   cdef void _delete_arcs(self, int64 state, size_t n=0) except *:
+ *   cdef void _delete_arcs(self, int64_t state, size_t n=0) except *:
  *     if not (self._mfst.get().DeleteArcs(state, n) if n else             # <<<<<<<<<<<<<<
  *             self._mfst.get().DeleteArcs(state)):
  *       raise FstIndexError("State index out of range")
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2213
+  /* "fstlib/cext/pywrapfst.pyx":2277
  *             self._mfst.get().DeleteArcs(state)):
  *       raise FstIndexError("State index out of range")
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
- *   def delete_arcs(self, int64 state, size_t n=0):
+ *   def delete_arcs(self, int64_t state, size_t n=0):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2213, __pyx_L1_error)
+    __PYX_ERR(0, 2277, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2213, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2277, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2209
+  /* "fstlib/cext/pywrapfst.pyx":2273
  *     return self
  * 
- *   cdef void _delete_arcs(self, int64 state, size_t n=0) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _delete_arcs(self, int64_t state, size_t n=0) except *:             # <<<<<<<<<<<<<<
  *     if not (self._mfst.get().DeleteArcs(state, n) if n else
  *             self._mfst.get().DeleteArcs(state)):
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
@@ -24709,27 +25065,27 @@
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._delete_arcs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2215
+/* "fstlib/cext/pywrapfst.pyx":2279
  *     self._check_mutating_imethod()
  * 
- *   def delete_arcs(self, int64 state, size_t n=0):             # <<<<<<<<<<<<<<
+ *   def delete_arcs(self, int64_t state, size_t n=0):             # <<<<<<<<<<<<<<
  *     """
  *     delete_arcs(self, state, n=0)
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_17delete_arcs(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_16delete_arcs[] = "\n    delete_arcs(self, state, n=0)\n\n    Deletes arcs leaving a particular state.\n\n    Args:\n      state: The integer index of a state.\n      n: An optional argument indicating how many arcs to be deleted. If this\n          argument is omitted or passed as zero, all arcs from this state are\n          deleted.\n\n    Returns:\n      self.\n\n    Raises:\n      FstIndexError: State index out of range.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_17delete_arcs(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   size_t __pyx_v_n;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("delete_arcs (wrapper)", 0);
@@ -24756,229 +25112,229 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "delete_arcs") < 0)) __PYX_ERR(0, 2215, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "delete_arcs") < 0)) __PYX_ERR(0, 2279, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[0]); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2215, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[0]); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2279, __pyx_L3_error)
     if (values[1]) {
-      __pyx_v_n = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_n == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 2215, __pyx_L3_error)
+      __pyx_v_n = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_n == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 2279, __pyx_L3_error)
     } else {
       __pyx_v_n = ((size_t)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("delete_arcs", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2215, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("delete_arcs", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2279, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.delete_arcs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_16delete_arcs(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_state, __pyx_v_n);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_16delete_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, size_t __pyx_v_n) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_16delete_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, size_t __pyx_v_n) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("delete_arcs", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2233
+  /* "fstlib/cext/pywrapfst.pyx":2297
  *       FstIndexError: State index out of range.
  *     """
  *     self._delete_arcs(state, n)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_delete_arcs");
-    __PYX_ERR(0, 2233, __pyx_L1_error)
+    __PYX_ERR(0, 2297, __pyx_L1_error)
   }
   __pyx_t_1.__pyx_n = 1;
   __pyx_t_1.n = __pyx_v_n;
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_delete_arcs(__pyx_v_self, __pyx_v_state, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2233, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_delete_arcs(__pyx_v_self, __pyx_v_state, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2297, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2234
+  /* "fstlib/cext/pywrapfst.pyx":2298
  *     """
  *     self._delete_arcs(state, n)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _delete_states(self, states=None) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2215
+  /* "fstlib/cext/pywrapfst.pyx":2279
  *     self._check_mutating_imethod()
  * 
- *   def delete_arcs(self, int64 state, size_t n=0):             # <<<<<<<<<<<<<<
+ *   def delete_arcs(self, int64_t state, size_t n=0):             # <<<<<<<<<<<<<<
  *     """
  *     delete_arcs(self, state, n=0)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.delete_arcs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2236
+/* "fstlib/cext/pywrapfst.pyx":2300
  *     return self
  * 
  *   cdef void _delete_states(self, states=None) except *:             # <<<<<<<<<<<<<<
  *     # Only the former signature has a possible indexing failure.
  *     if states:
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states *__pyx_optional_args) {
   PyObject *__pyx_v_states = ((PyObject *)Py_None);
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
-  std::vector<int64>  __pyx_t_2;
+  std::vector<int64_t>  __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_delete_states", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_states = __pyx_optional_args->states;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2238
+  /* "fstlib/cext/pywrapfst.pyx":2302
  *   cdef void _delete_states(self, states=None) except *:
  *     # Only the former signature has a possible indexing failure.
  *     if states:             # <<<<<<<<<<<<<<
- *       if not self._mfst.get().DeleteStates(<const vector[int64]> states):
+ *       if not self._mfst.get().DeleteStates(<const vector[int64_t]> states):
  *         raise FstIndexError("State index out of range")
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_states); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2238, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_states); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2302, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2239
+    /* "fstlib/cext/pywrapfst.pyx":2303
  *     # Only the former signature has a possible indexing failure.
  *     if states:
- *       if not self._mfst.get().DeleteStates(<const vector[int64]> states):             # <<<<<<<<<<<<<<
+ *       if not self._mfst.get().DeleteStates(<const vector[int64_t]> states):             # <<<<<<<<<<<<<<
  *         raise FstIndexError("State index out of range")
  *     else:
  */
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-      __PYX_ERR(0, 2239, __pyx_L1_error)
+      __PYX_ERR(0, 2303, __pyx_L1_error)
     }
-    __pyx_t_2 = __pyx_convert_vector_from_py_int64(__pyx_v_states); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2239, __pyx_L1_error)
-    __pyx_t_1 = ((!(__pyx_v_self->_mfst.get()->DeleteStates(((std::vector<int64>  const )__pyx_t_2)) != 0)) != 0);
+    __pyx_t_2 = __pyx_convert_vector_from_py_int64_t(__pyx_v_states); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2303, __pyx_L1_error)
+    __pyx_t_1 = ((!(__pyx_v_self->_mfst.get()->DeleteStates(((std::vector<int64_t>  const )__pyx_t_2)) != 0)) != 0);
     if (unlikely(__pyx_t_1)) {
 
-      /* "fstlib/cext/pywrapfst.pyx":2240
+      /* "fstlib/cext/pywrapfst.pyx":2304
  *     if states:
- *       if not self._mfst.get().DeleteStates(<const vector[int64]> states):
+ *       if not self._mfst.get().DeleteStates(<const vector[int64_t]> states):
  *         raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  *     else:
  *       self._mfst.get().DeleteStates()
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2240, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2304, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __pyx_t_5 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
         __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
         if (likely(__pyx_t_5)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
           __Pyx_INCREF(__pyx_t_5);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_4, function);
         }
       }
       __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_kp_u_State_index_out_of_range);
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2240, __pyx_L1_error)
+      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2304, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_Raise(__pyx_t_3, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __PYX_ERR(0, 2240, __pyx_L1_error)
+      __PYX_ERR(0, 2304, __pyx_L1_error)
 
-      /* "fstlib/cext/pywrapfst.pyx":2239
+      /* "fstlib/cext/pywrapfst.pyx":2303
  *     # Only the former signature has a possible indexing failure.
  *     if states:
- *       if not self._mfst.get().DeleteStates(<const vector[int64]> states):             # <<<<<<<<<<<<<<
+ *       if not self._mfst.get().DeleteStates(<const vector[int64_t]> states):             # <<<<<<<<<<<<<<
  *         raise FstIndexError("State index out of range")
  *     else:
  */
     }
 
-    /* "fstlib/cext/pywrapfst.pyx":2238
+    /* "fstlib/cext/pywrapfst.pyx":2302
  *   cdef void _delete_states(self, states=None) except *:
  *     # Only the former signature has a possible indexing failure.
  *     if states:             # <<<<<<<<<<<<<<
- *       if not self._mfst.get().DeleteStates(<const vector[int64]> states):
+ *       if not self._mfst.get().DeleteStates(<const vector[int64_t]> states):
  *         raise FstIndexError("State index out of range")
  */
     goto __pyx_L3;
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2242
+  /* "fstlib/cext/pywrapfst.pyx":2306
  *         raise FstIndexError("State index out of range")
  *     else:
  *       self._mfst.get().DeleteStates()             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  * 
  */
   /*else*/ {
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-      __PYX_ERR(0, 2242, __pyx_L1_error)
+      __PYX_ERR(0, 2306, __pyx_L1_error)
     }
     __pyx_v_self->_mfst.get()->DeleteStates();
   }
   __pyx_L3:;
 
-  /* "fstlib/cext/pywrapfst.pyx":2243
+  /* "fstlib/cext/pywrapfst.pyx":2307
  *     else:
  *       self._mfst.get().DeleteStates()
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
  *   def delete_states(self, states=None):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2243, __pyx_L1_error)
+    __PYX_ERR(0, 2307, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2243, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2307, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2236
+  /* "fstlib/cext/pywrapfst.pyx":2300
  *     return self
  * 
  *   cdef void _delete_states(self, states=None) except *:             # <<<<<<<<<<<<<<
  *     # Only the former signature has a possible indexing failure.
  *     if states:
  */
 
@@ -24989,15 +25345,15 @@
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._delete_states", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2245
+/* "fstlib/cext/pywrapfst.pyx":2309
  *     self._check_mutating_imethod()
  * 
  *   def delete_states(self, states=None):             # <<<<<<<<<<<<<<
  *     """
  *     delete_states(self, states=None)
  */
 
@@ -25030,29 +25386,29 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_states);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "delete_states") < 0)) __PYX_ERR(0, 2245, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "delete_states") < 0)) __PYX_ERR(0, 2309, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_states = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("delete_states", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2245, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("delete_states", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2309, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.delete_states", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_18delete_states(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_states);
 
@@ -25066,42 +25422,42 @@
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("delete_states", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2261
+  /* "fstlib/cext/pywrapfst.pyx":2325
  *       FstIndexError: State index out of range.
  *     """
  *     self._delete_states(states)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_delete_states");
-    __PYX_ERR(0, 2261, __pyx_L1_error)
+    __PYX_ERR(0, 2325, __pyx_L1_error)
   }
   __pyx_t_1.__pyx_n = 1;
   __pyx_t_1.states = __pyx_v_states;
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_delete_states(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2261, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_delete_states(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2325, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2262
+  /* "fstlib/cext/pywrapfst.pyx":2326
  *     """
  *     self._delete_states(states)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _encode(self, EncodeMapper mapper) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2245
+  /* "fstlib/cext/pywrapfst.pyx":2309
  *     self._check_mutating_imethod()
  * 
  *   def delete_states(self, states=None):             # <<<<<<<<<<<<<<
  *     """
  *     delete_states(self, states=None)
  */
 
@@ -25111,60 +25467,60 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2264
+/* "fstlib/cext/pywrapfst.pyx":2328
  *     return self
  * 
  *   cdef void _encode(self, EncodeMapper mapper) except *:             # <<<<<<<<<<<<<<
  *     fst.Encode(self._mfst.get(), mapper._mapper.get())
  *     self._check_mutating_imethod()
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__encode(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *__pyx_v_mapper) {
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_encode", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2265
+  /* "fstlib/cext/pywrapfst.pyx":2329
  * 
  *   cdef void _encode(self, EncodeMapper mapper) except *:
  *     fst.Encode(self._mfst.get(), mapper._mapper.get())             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2265, __pyx_L1_error)
+    __PYX_ERR(0, 2329, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_mapper) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mapper");
-    __PYX_ERR(0, 2265, __pyx_L1_error)
+    __PYX_ERR(0, 2329, __pyx_L1_error)
   }
   fst::script::Encode(__pyx_v_self->_mfst.get(), __pyx_v_mapper->_mapper.get());
 
-  /* "fstlib/cext/pywrapfst.pyx":2266
+  /* "fstlib/cext/pywrapfst.pyx":2330
  *   cdef void _encode(self, EncodeMapper mapper) except *:
  *     fst.Encode(self._mfst.get(), mapper._mapper.get())
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
  *   def encode(self, EncodeMapper mapper):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2266, __pyx_L1_error)
+    __PYX_ERR(0, 2330, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2266, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2330, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2264
+  /* "fstlib/cext/pywrapfst.pyx":2328
  *     return self
  * 
  *   cdef void _encode(self, EncodeMapper mapper) except *:             # <<<<<<<<<<<<<<
  *     fst.Encode(self._mfst.get(), mapper._mapper.get())
  *     self._check_mutating_imethod()
  */
 
@@ -25172,15 +25528,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._encode", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2268
+/* "fstlib/cext/pywrapfst.pyx":2332
  *     self._check_mutating_imethod()
  * 
  *   def encode(self, EncodeMapper mapper):             # <<<<<<<<<<<<<<
  *     """
  *     encode(self, mapper)
  */
 
@@ -25190,15 +25546,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_21encode(PyObject *__pyx_v_self, PyObject *__pyx_v_mapper) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("encode (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mapper), __pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper, 1, "mapper", 0))) __PYX_ERR(0, 2268, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mapper), __pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper, 1, "mapper", 0))) __PYX_ERR(0, 2332, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_20encode(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *)__pyx_v_mapper));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -25210,40 +25566,40 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("encode", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2287
+  /* "fstlib/cext/pywrapfst.pyx":2351
  *       self.
  *     """
  *     self._encode(mapper)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_encode");
-    __PYX_ERR(0, 2287, __pyx_L1_error)
+    __PYX_ERR(0, 2351, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_encode(__pyx_v_self, __pyx_v_mapper); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2287, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_encode(__pyx_v_self, __pyx_v_mapper); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2351, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2288
+  /* "fstlib/cext/pywrapfst.pyx":2352
  *     """
  *     self._encode(mapper)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _invert(self):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2268
+  /* "fstlib/cext/pywrapfst.pyx":2332
  *     self._check_mutating_imethod()
  * 
  *   def encode(self, EncodeMapper mapper):             # <<<<<<<<<<<<<<
  *     """
  *     encode(self, mapper)
  */
 
@@ -25253,43 +25609,43 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2290
+/* "fstlib/cext/pywrapfst.pyx":2354
  *     return self
  * 
  *   cdef void _invert(self):             # <<<<<<<<<<<<<<
  *     fst.Invert(self._mfst.get())
  * 
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__invert(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self) {
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_invert", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2291
+  /* "fstlib/cext/pywrapfst.pyx":2355
  * 
  *   cdef void _invert(self):
  *     fst.Invert(self._mfst.get())             # <<<<<<<<<<<<<<
  * 
  *   def invert(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2291, __pyx_L1_error)
+    __PYX_ERR(0, 2355, __pyx_L1_error)
   }
   fst::script::Invert(__pyx_v_self->_mfst.get());
 
-  /* "fstlib/cext/pywrapfst.pyx":2290
+  /* "fstlib/cext/pywrapfst.pyx":2354
  *     return self
  * 
  *   cdef void _invert(self):             # <<<<<<<<<<<<<<
  *     fst.Invert(self._mfst.get())
  * 
  */
 
@@ -25297,15 +25653,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst.MutableFst._invert", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2293
+/* "fstlib/cext/pywrapfst.pyx":2357
  *     fst.Invert(self._mfst.get())
  * 
  *   def invert(self):             # <<<<<<<<<<<<<<
  *     """
  *     invert(self)
  */
 
@@ -25327,40 +25683,40 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("invert", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2305
+  /* "fstlib/cext/pywrapfst.pyx":2369
  *       self.
  *     """
  *     self._invert()             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_invert");
-    __PYX_ERR(0, 2305, __pyx_L1_error)
+    __PYX_ERR(0, 2369, __pyx_L1_error)
   }
   ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_invert(__pyx_v_self);
 
-  /* "fstlib/cext/pywrapfst.pyx":2306
+  /* "fstlib/cext/pywrapfst.pyx":2370
  *     """
  *     self._invert()
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _minimize(self,
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2293
+  /* "fstlib/cext/pywrapfst.pyx":2357
  *     fst.Invert(self._mfst.get())
  * 
  *   def invert(self):             # <<<<<<<<<<<<<<
  *     """
  *     invert(self)
  */
 
@@ -25370,26 +25726,26 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2308
+/* "fstlib/cext/pywrapfst.pyx":2372
  *     return self
  * 
  *   cdef void _minimize(self,             # <<<<<<<<<<<<<<
  *                       float delta=fst.kShortestDelta,
  *                       bool allow_nondet=False) except *:
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__minimize(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__minimize *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__12;
+  float __pyx_v_delta = __pyx_k__10;
 
-  /* "fstlib/cext/pywrapfst.pyx":2310
+  /* "fstlib/cext/pywrapfst.pyx":2374
  *   cdef void _minimize(self,
  *                       float delta=fst.kShortestDelta,
  *                       bool allow_nondet=False) except *:             # <<<<<<<<<<<<<<
  *     # This runs in-place when the second argument is null.
  *     fst.Minimize(self._mfst.get(), NULL, delta, allow_nondet)
  */
   bool __pyx_v_allow_nondet = ((bool)0);
@@ -25403,41 +25759,41 @@
       __pyx_v_delta = __pyx_optional_args->delta;
       if (__pyx_optional_args->__pyx_n > 1) {
         __pyx_v_allow_nondet = __pyx_optional_args->allow_nondet;
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2312
+  /* "fstlib/cext/pywrapfst.pyx":2376
  *                       bool allow_nondet=False) except *:
  *     # This runs in-place when the second argument is null.
  *     fst.Minimize(self._mfst.get(), NULL, delta, allow_nondet)             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2312, __pyx_L1_error)
+    __PYX_ERR(0, 2376, __pyx_L1_error)
   }
   fst::script::Minimize(__pyx_v_self->_mfst.get(), NULL, __pyx_v_delta, __pyx_v_allow_nondet);
 
-  /* "fstlib/cext/pywrapfst.pyx":2313
+  /* "fstlib/cext/pywrapfst.pyx":2377
  *     # This runs in-place when the second argument is null.
  *     fst.Minimize(self._mfst.get(), NULL, delta, allow_nondet)
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
  *   def minimize(self, float delta=fst.kShortestDelta, bool allow_nondet=False):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2313, __pyx_L1_error)
+    __PYX_ERR(0, 2377, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2313, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2377, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2308
+  /* "fstlib/cext/pywrapfst.pyx":2372
  *     return self
  * 
  *   cdef void _minimize(self,             # <<<<<<<<<<<<<<
  *                       float delta=fst.kShortestDelta,
  *                       bool allow_nondet=False) except *:
  */
 
@@ -25445,15 +25801,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._minimize", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2315
+/* "fstlib/cext/pywrapfst.pyx":2379
  *     self._check_mutating_imethod()
  * 
  *   def minimize(self, float delta=fst.kShortestDelta, bool allow_nondet=False):             # <<<<<<<<<<<<<<
  *     """
  *     minimize(self, delta=1e-6, allow_nondet=False)
  */
 
@@ -25494,40 +25850,40 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_allow_nondet);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "minimize") < 0)) __PYX_ERR(0, 2315, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "minimize") < 0)) __PYX_ERR(0, 2379, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     if (values[0]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[0]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 2315, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[0]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 2379, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__13;
+      __pyx_v_delta = __pyx_k__11;
     }
     if (values[1]) {
-      __pyx_v_allow_nondet = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_allow_nondet == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2315, __pyx_L3_error)
+      __pyx_v_allow_nondet = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_allow_nondet == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2379, __pyx_L3_error)
     } else {
       __pyx_v_allow_nondet = ((bool)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("minimize", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2315, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("minimize", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2379, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.minimize", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_24minimize(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_delta, __pyx_v_allow_nondet);
 
@@ -25541,43 +25897,43 @@
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__minimize __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("minimize", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2341
+  /* "fstlib/cext/pywrapfst.pyx":2405
  *       self.
  *     """
  *     self._minimize(delta, allow_nondet)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_minimize");
-    __PYX_ERR(0, 2341, __pyx_L1_error)
+    __PYX_ERR(0, 2405, __pyx_L1_error)
   }
   __pyx_t_1.__pyx_n = 2;
   __pyx_t_1.delta = __pyx_v_delta;
   __pyx_t_1.allow_nondet = __pyx_v_allow_nondet;
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_minimize(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2341, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_minimize(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2405, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2342
+  /* "fstlib/cext/pywrapfst.pyx":2406
  *     """
  *     self._minimize(delta, allow_nondet)
  *     return self             # <<<<<<<<<<<<<<
  * 
- *   cpdef _MutableArcIterator mutable_arcs(self, int64 state):
+ *   cpdef _MutableArcIterator mutable_arcs(self, int64_t state):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2315
+  /* "fstlib/cext/pywrapfst.pyx":2379
  *     self._check_mutating_imethod()
  * 
  *   def minimize(self, float delta=fst.kShortestDelta, bool allow_nondet=False):             # <<<<<<<<<<<<<<
  *     """
  *     minimize(self, delta=1e-6, allow_nondet=False)
  */
 
@@ -25587,24 +25943,24 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2344
+/* "fstlib/cext/pywrapfst.pyx":2408
  *     return self
  * 
- *   cpdef _MutableArcIterator mutable_arcs(self, int64 state):             # <<<<<<<<<<<<<<
+ *   cpdef _MutableArcIterator mutable_arcs(self, int64_t state):             # <<<<<<<<<<<<<<
  *     """
  *     mutable_arcs(self, state)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_27mutable_arcs(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
-static struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_mutable_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, int __pyx_skip_dispatch) {
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_mutable_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, int __pyx_skip_dispatch) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -25617,19 +25973,19 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_mutable_arcs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2344, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_mutable_arcs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2408, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_27mutable_arcs)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
-        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2344, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2408, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -25637,18 +25993,18 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2344, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2408, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__MutableArcIterator))))) __PYX_ERR(0, 2344, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst__MutableArcIterator))))) __PYX_ERR(0, 2408, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -25659,43 +26015,43 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2356
+  /* "fstlib/cext/pywrapfst.pyx":2420
  *       A _MutableArcIterator.
  *     """
  *     return _MutableArcIterator(self, state)             # <<<<<<<<<<<<<<
  * 
  *   def mutable_input_symbols(self):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2356, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_state); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2420, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2356, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2420, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
   PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__MutableArcIterator), __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2356, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst__MutableArcIterator), __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2420, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2344
+  /* "fstlib/cext/pywrapfst.pyx":2408
  *     return self
  * 
- *   cpdef _MutableArcIterator mutable_arcs(self, int64 state):             # <<<<<<<<<<<<<<
+ *   cpdef _MutableArcIterator mutable_arcs(self, int64_t state):             # <<<<<<<<<<<<<<
  *     """
  *     mutable_arcs(self, state)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -25711,47 +26067,47 @@
   return __pyx_r;
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_27mutable_arcs(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_26mutable_arcs[] = "\n    mutable_arcs(self, state)\n\n    Returns a mutable iterator over arcs leaving the specified state.\n\n    Args:\n      state: The source state ID.\n\n    Returns:\n      A _MutableArcIterator.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_27mutable_arcs(PyObject *__pyx_v_self, PyObject *__pyx_arg_state) {
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("mutable_arcs (wrapper)", 0);
   assert(__pyx_arg_state); {
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2344, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2408, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.mutable_arcs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_26mutable_arcs(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), ((int64)__pyx_v_state));
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_26mutable_arcs(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), ((int64_t)__pyx_v_state));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_26mutable_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_26mutable_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("mutable_arcs", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_mutable_arcs(__pyx_v_self, __pyx_v_state, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2344, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_mutable_arcs(__pyx_v_self, __pyx_v_state, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2408, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -25760,15 +26116,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2358
+/* "fstlib/cext/pywrapfst.pyx":2422
  *     return _MutableArcIterator(self, state)
  * 
  *   def mutable_input_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     mutable_input_symbols(self)
  */
 
@@ -25792,67 +26148,67 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("mutable_input_symbols", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2364
+  /* "fstlib/cext/pywrapfst.pyx":2428
  *     Returns the FST's (mutable) input symbol table, or None if none is present.
  *     """
  *     if self._mfst.get().MutableInputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=True)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2364, __pyx_L1_error)
+    __PYX_ERR(0, 2428, __pyx_L1_error)
   }
   __pyx_t_1 = ((__pyx_v_self->_mfst.get()->MutableInputSymbols() == NULL) != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2365
+    /* "fstlib/cext/pywrapfst.pyx":2429
  *     """
  *     if self._mfst.get().MutableInputSymbols() == NULL:
  *       return             # <<<<<<<<<<<<<<
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=True)
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":2364
+    /* "fstlib/cext/pywrapfst.pyx":2428
  *     Returns the FST's (mutable) input symbol table, or None if none is present.
  *     """
  *     if self._mfst.get().MutableInputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=True)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2366
+  /* "fstlib/cext/pywrapfst.pyx":2430
  *     if self._mfst.get().MutableInputSymbols() == NULL:
  *       return
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=True)             # <<<<<<<<<<<<<<
  * 
  *   def mutable_output_symbols(self):
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2366, __pyx_L1_error)
+    __PYX_ERR(0, 2430, __pyx_L1_error)
   }
-  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFstSymbolTableView(__pyx_v_self->_mfst, 1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2366, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFstSymbolTableView(__pyx_v_self->_mfst, 1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2430, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2358
+  /* "fstlib/cext/pywrapfst.pyx":2422
  *     return _MutableArcIterator(self, state)
  * 
  *   def mutable_input_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     mutable_input_symbols(self)
  */
 
@@ -25863,15 +26219,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2368
+/* "fstlib/cext/pywrapfst.pyx":2432
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=True)
  * 
  *   def mutable_output_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     mutable_output_symbols(self)
  */
 
@@ -25895,67 +26251,67 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("mutable_output_symbols", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2374
+  /* "fstlib/cext/pywrapfst.pyx":2438
  *     Returns the FST's (mutable) output symbol table, or None if none is present.
  *     """
  *     if self._mfst.get().MutableOutputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=False)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2374, __pyx_L1_error)
+    __PYX_ERR(0, 2438, __pyx_L1_error)
   }
   __pyx_t_1 = ((__pyx_v_self->_mfst.get()->MutableOutputSymbols() == NULL) != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2375
+    /* "fstlib/cext/pywrapfst.pyx":2439
  *     """
  *     if self._mfst.get().MutableOutputSymbols() == NULL:
  *       return             # <<<<<<<<<<<<<<
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=False)
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":2374
+    /* "fstlib/cext/pywrapfst.pyx":2438
  *     Returns the FST's (mutable) output symbol table, or None if none is present.
  *     """
  *     if self._mfst.get().MutableOutputSymbols() == NULL:             # <<<<<<<<<<<<<<
  *       return
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=False)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2376
+  /* "fstlib/cext/pywrapfst.pyx":2440
  *     if self._mfst.get().MutableOutputSymbols() == NULL:
  *       return
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=False)             # <<<<<<<<<<<<<<
  * 
- *   cpdef int64 num_states(self):
+ *   cpdef int64_t num_states(self):
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2376, __pyx_L1_error)
+    __PYX_ERR(0, 2440, __pyx_L1_error)
   }
-  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFstSymbolTableView(__pyx_v_self->_mfst, 0)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2376, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFstSymbolTableView(__pyx_v_self->_mfst, 0)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2440, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2368
+  /* "fstlib/cext/pywrapfst.pyx":2432
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=True)
  * 
  *   def mutable_output_symbols(self):             # <<<<<<<<<<<<<<
  *     """
  *     mutable_output_symbols(self)
  */
 
@@ -25966,45 +26322,45 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2378
+/* "fstlib/cext/pywrapfst.pyx":2442
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=False)
  * 
- *   cpdef int64 num_states(self):             # <<<<<<<<<<<<<<
+ *   cpdef int64_t num_states(self):             # <<<<<<<<<<<<<<
  *     """
  *     num_states(self)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_33num_states(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_num_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int __pyx_skip_dispatch) {
-  int64 __pyx_r;
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_num_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int __pyx_skip_dispatch) {
+  int64_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  int64 __pyx_t_5;
+  int64_t __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("num_states", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_states); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2378, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_states); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2442, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_33num_states)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -26012,18 +26368,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2378, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2442, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2378, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2442, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -26034,32 +26390,32 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2384
+  /* "fstlib/cext/pywrapfst.pyx":2448
  *     Returns the number of states.
  *     """
  *     return self._mfst.get().NumStates()             # <<<<<<<<<<<<<<
  * 
  *   cdef void _project(self, project_type) except *:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2384, __pyx_L1_error)
+    __PYX_ERR(0, 2448, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_mfst.get()->NumStates();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2378
+  /* "fstlib/cext/pywrapfst.pyx":2442
  *     return _init_MutableFstSymbolTableView(self._mfst, input_side=False)
  * 
- *   cpdef int64 num_states(self):             # <<<<<<<<<<<<<<
+ *   cpdef int64_t num_states(self):             # <<<<<<<<<<<<<<
  *     """
  *     num_states(self)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -26092,15 +26448,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("num_states", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_num_states(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2378, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_num_states(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2442, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -26109,15 +26465,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2386
+/* "fstlib/cext/pywrapfst.pyx":2450
  *     return self._mfst.get().NumStates()
  * 
  *   cdef void _project(self, project_type) except *:             # <<<<<<<<<<<<<<
  *     fst.Project(self._mfst.get(), _get_project_type(tostring(project_type)))
  * 
  */
 
@@ -26126,30 +26482,30 @@
   std::string __pyx_t_1;
   fst::ProjectType __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_project", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2387
+  /* "fstlib/cext/pywrapfst.pyx":2451
  * 
  *   cdef void _project(self, project_type) except *:
  *     fst.Project(self._mfst.get(), _get_project_type(tostring(project_type)))             # <<<<<<<<<<<<<<
  * 
  *   def project(self, project_type):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2387, __pyx_L1_error)
+    __PYX_ERR(0, 2451, __pyx_L1_error)
   }
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_project_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2387, __pyx_L1_error)
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_project_type(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2387, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_project_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2451, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_project_type(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2451, __pyx_L1_error)
   fst::script::Project(__pyx_v_self->_mfst.get(), __pyx_t_2);
 
-  /* "fstlib/cext/pywrapfst.pyx":2386
+  /* "fstlib/cext/pywrapfst.pyx":2450
  *     return self._mfst.get().NumStates()
  * 
  *   cdef void _project(self, project_type) except *:             # <<<<<<<<<<<<<<
  *     fst.Project(self._mfst.get(), _get_project_type(tostring(project_type)))
  * 
  */
 
@@ -26157,15 +26513,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._project", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2389
+/* "fstlib/cext/pywrapfst.pyx":2453
  *     fst.Project(self._mfst.get(), _get_project_type(tostring(project_type)))
  * 
  *   def project(self, project_type):             # <<<<<<<<<<<<<<
  *     """
  *     project(self, project_type)
  */
 
@@ -26187,40 +26543,40 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("project", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2406
+  /* "fstlib/cext/pywrapfst.pyx":2470
  *       self.
  *     """
  *     self._project(project_type)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_project");
-    __PYX_ERR(0, 2406, __pyx_L1_error)
+    __PYX_ERR(0, 2470, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_project(__pyx_v_self, __pyx_v_project_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2406, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_project(__pyx_v_self, __pyx_v_project_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2470, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2407
+  /* "fstlib/cext/pywrapfst.pyx":2471
  *     """
  *     self._project(project_type)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _prune(self,
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2389
+  /* "fstlib/cext/pywrapfst.pyx":2453
  *     fst.Project(self._mfst.get(), _get_project_type(tostring(project_type)))
  * 
  *   def project(self, project_type):             # <<<<<<<<<<<<<<
  *     """
  *     project(self, project_type)
  */
 
@@ -26230,29 +26586,29 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2409
+/* "fstlib/cext/pywrapfst.pyx":2473
  *     return self
  * 
  *   cdef void _prune(self,             # <<<<<<<<<<<<<<
  *                    float delta=fst.kDelta,
- *                    int64 nstate=fst.kNoStateId,
+ *                    int64_t nstate=fst.kNoStateId,
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__prune(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__prune *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__14;
-  int64 __pyx_v_nstate = __pyx_k__15;
+  float __pyx_v_delta = __pyx_k__12;
+  int64_t __pyx_v_nstate = __pyx_k__13;
 
-  /* "fstlib/cext/pywrapfst.pyx":2412
+  /* "fstlib/cext/pywrapfst.pyx":2476
  *                    float delta=fst.kDelta,
- *                    int64 nstate=fst.kNoStateId,
+ *                    int64_t nstate=fst.kNoStateId,
  *                    weight=None) except *:             # <<<<<<<<<<<<<<
  *     # Threshold is set to semiring Zero (no pruning) if no weight is specified.
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_zero(self.weight_type(),
  */
   PyObject *__pyx_v_weight = ((PyObject *)Py_None);
   fst::script::WeightClass __pyx_v__weight;
   __Pyx_RefNannyDeclarations
@@ -26269,106 +26625,106 @@
         if (__pyx_optional_args->__pyx_n > 2) {
           __pyx_v_weight = __pyx_optional_args->weight;
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2414
+  /* "fstlib/cext/pywrapfst.pyx":2478
  *                    weight=None) except *:
  *     # Threshold is set to semiring Zero (no pruning) if no weight is specified.
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_zero(self.weight_type(),             # <<<<<<<<<<<<<<
  *                                                             weight)
  *     fst.Prune(self._mfst.get(), _weight, nstate, delta)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "weight_type");
-    __PYX_ERR(0, 2414, __pyx_L1_error)
+    __PYX_ERR(0, 2478, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2415
+  /* "fstlib/cext/pywrapfst.pyx":2479
  *     # Threshold is set to semiring Zero (no pruning) if no weight is specified.
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_zero(self.weight_type(),
  *                                                             weight)             # <<<<<<<<<<<<<<
  *     fst.Prune(self._mfst.get(), _weight, nstate, delta)
  *     self._check_mutating_imethod()
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.weight_type(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2414, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.weight_type(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2478, __pyx_L1_error)
   __pyx_v__weight = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":2416
+  /* "fstlib/cext/pywrapfst.pyx":2480
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_zero(self.weight_type(),
  *                                                             weight)
  *     fst.Prune(self._mfst.get(), _weight, nstate, delta)             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2416, __pyx_L1_error)
+    __PYX_ERR(0, 2480, __pyx_L1_error)
   }
   fst::script::Prune(__pyx_v_self->_mfst.get(), __pyx_v__weight, __pyx_v_nstate, __pyx_v_delta);
 
-  /* "fstlib/cext/pywrapfst.pyx":2417
+  /* "fstlib/cext/pywrapfst.pyx":2481
  *                                                             weight)
  *     fst.Prune(self._mfst.get(), _weight, nstate, delta)
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
  *   def prune(self,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2417, __pyx_L1_error)
+    __PYX_ERR(0, 2481, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2417, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2481, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2409
+  /* "fstlib/cext/pywrapfst.pyx":2473
  *     return self
  * 
  *   cdef void _prune(self,             # <<<<<<<<<<<<<<
  *                    float delta=fst.kDelta,
- *                    int64 nstate=fst.kNoStateId,
+ *                    int64_t nstate=fst.kNoStateId,
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._prune", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2419
+/* "fstlib/cext/pywrapfst.pyx":2483
  *     self._check_mutating_imethod()
  * 
  *   def prune(self,             # <<<<<<<<<<<<<<
  *             float delta=fst.kDelta,
- *             int64 nstate=fst.kNoStateId,
+ *             int64_t nstate=fst.kNoStateId,
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_37prune(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_36prune[] = "\n    prune(self, delta=0.0009765625, nstate=NO_STATE_ID, weight=None)\n\n    Removes paths with weights below a certain threshold.\n\n    This operation deletes states and arcs in the input FST that do not belong\n    to a successful path whose weight is no more (w.r.t the natural semiring\n    order) than the threshold t \\otimes-times the weight of the shortest path in\n    the input FST. Weights must be commutative and have the path property.\n\n    Args:\n      delta: Comparison/quantization delta.\n      nstate: State number threshold.\n      weight: A Weight or weight string indicating the desired weight threshold\n          below which paths are pruned; if omitted, no paths are pruned.\n\n    Returns:\n      self.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_37prune(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   float __pyx_v_delta;
-  int64 __pyx_v_nstate;
+  int64_t __pyx_v_nstate;
   PyObject *__pyx_v_weight = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("prune (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_delta,&__pyx_n_s_nstate,&__pyx_n_s_weight,0};
     PyObject* values[3] = {0,0,0};
 
-    /* "fstlib/cext/pywrapfst.pyx":2422
+    /* "fstlib/cext/pywrapfst.pyx":2486
  *             float delta=fst.kDelta,
- *             int64 nstate=fst.kNoStateId,
+ *             int64_t nstate=fst.kNoStateId,
  *             weight=None):             # <<<<<<<<<<<<<<
  *     """
  *     prune(self, delta=0.0009765625, nstate=NO_STATE_ID, weight=None)
  */
     values[2] = ((PyObject *)Py_None);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
@@ -26400,186 +26756,190 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weight);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "prune") < 0)) __PYX_ERR(0, 2419, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "prune") < 0)) __PYX_ERR(0, 2483, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     if (values[0]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[0]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 2420, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[0]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 2484, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__16;
+      __pyx_v_delta = __pyx_k__14;
     }
     if (values[1]) {
-      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_nstate == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2421, __pyx_L3_error)
+      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_nstate == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2485, __pyx_L3_error)
     } else {
-      __pyx_v_nstate = __pyx_k__17;
+      __pyx_v_nstate = __pyx_k__15;
     }
     __pyx_v_weight = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("prune", 0, 0, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2419, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("prune", 0, 0, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2483, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.prune", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_36prune(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_delta, __pyx_v_nstate, __pyx_v_weight);
 
-  /* "fstlib/cext/pywrapfst.pyx":2419
+  /* "fstlib/cext/pywrapfst.pyx":2483
  *     self._check_mutating_imethod()
  * 
  *   def prune(self,             # <<<<<<<<<<<<<<
  *             float delta=fst.kDelta,
- *             int64 nstate=fst.kNoStateId,
+ *             int64_t nstate=fst.kNoStateId,
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_36prune(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, float __pyx_v_delta, int64 __pyx_v_nstate, PyObject *__pyx_v_weight) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_36prune(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, float __pyx_v_delta, int64_t __pyx_v_nstate, PyObject *__pyx_v_weight) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__prune __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("prune", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2442
+  /* "fstlib/cext/pywrapfst.pyx":2506
  *       self.
  *     """
  *     self._prune(delta, nstate, weight)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_prune");
-    __PYX_ERR(0, 2442, __pyx_L1_error)
+    __PYX_ERR(0, 2506, __pyx_L1_error)
   }
   __pyx_t_1.__pyx_n = 3;
   __pyx_t_1.delta = __pyx_v_delta;
   __pyx_t_1.nstate = __pyx_v_nstate;
   __pyx_t_1.weight = __pyx_v_weight;
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_prune(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2442, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_prune(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2506, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2443
+  /* "fstlib/cext/pywrapfst.pyx":2507
  *     """
  *     self._prune(delta, nstate, weight)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _push(self,
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2419
+  /* "fstlib/cext/pywrapfst.pyx":2483
  *     self._check_mutating_imethod()
  * 
  *   def prune(self,             # <<<<<<<<<<<<<<
  *             float delta=fst.kDelta,
- *             int64 nstate=fst.kNoStateId,
+ *             int64_t nstate=fst.kNoStateId,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.prune", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2445
+/* "fstlib/cext/pywrapfst.pyx":2509
  *     return self
  * 
  *   cdef void _push(self,             # <<<<<<<<<<<<<<
  *                   float delta=fst.kShortestDelta,
  *                   bool remove_total_weight=False,
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__push(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__push *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__18;
+  float __pyx_v_delta = __pyx_k__16;
 
-  /* "fstlib/cext/pywrapfst.pyx":2447
+  /* "fstlib/cext/pywrapfst.pyx":2511
  *   cdef void _push(self,
  *                   float delta=fst.kShortestDelta,
  *                   bool remove_total_weight=False,             # <<<<<<<<<<<<<<
- *                   bool to_final=False):
+ *                   reweight_type="to_initial"):
  *     fst.Push(self._mfst.get(),
  */
   bool __pyx_v_remove_total_weight = ((bool)0);
-
-  /* "fstlib/cext/pywrapfst.pyx":2448
- *                   float delta=fst.kShortestDelta,
- *                   bool remove_total_weight=False,
- *                   bool to_final=False):             # <<<<<<<<<<<<<<
- *     fst.Push(self._mfst.get(),
- *              fst.GetReweightType(to_final),
- */
-  bool __pyx_v_to_final = ((bool)0);
+  PyObject *__pyx_v_reweight_type = ((PyObject *)__pyx_n_u_to_initial);
   __Pyx_RefNannyDeclarations
+  std::string __pyx_t_1;
+  enum fst::ReweightType __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_push", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_delta = __pyx_optional_args->delta;
       if (__pyx_optional_args->__pyx_n > 1) {
         __pyx_v_remove_total_weight = __pyx_optional_args->remove_total_weight;
         if (__pyx_optional_args->__pyx_n > 2) {
-          __pyx_v_to_final = __pyx_optional_args->to_final;
+          __pyx_v_reweight_type = __pyx_optional_args->reweight_type;
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2449
+  /* "fstlib/cext/pywrapfst.pyx":2513
  *                   bool remove_total_weight=False,
- *                   bool to_final=False):
+ *                   reweight_type="to_initial"):
  *     fst.Push(self._mfst.get(),             # <<<<<<<<<<<<<<
- *              fst.GetReweightType(to_final),
+ *              _get_reweight_type(tostring(reweight_type)),
  *              delta,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2449, __pyx_L1_error)
+    __PYX_ERR(0, 2513, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2452
- *              fst.GetReweightType(to_final),
+  /* "fstlib/cext/pywrapfst.pyx":2514
+ *                   reweight_type="to_initial"):
+ *     fst.Push(self._mfst.get(),
+ *              _get_reweight_type(tostring(reweight_type)),             # <<<<<<<<<<<<<<
+ *              delta,
+ *              remove_total_weight)
+ */
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_reweight_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2514, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_reweight_type(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2514, __pyx_L1_error)
+
+  /* "fstlib/cext/pywrapfst.pyx":2513
+ *                   bool remove_total_weight=False,
+ *                   reweight_type="to_initial"):
+ *     fst.Push(self._mfst.get(),             # <<<<<<<<<<<<<<
+ *              _get_reweight_type(tostring(reweight_type)),
  *              delta,
- *              remove_total_weight)             # <<<<<<<<<<<<<<
- * 
- *   def push(self,
  */
-  fst::script::Push(__pyx_v_self->_mfst.get(), fst::script::GetReweightType(__pyx_v_to_final), __pyx_v_delta, __pyx_v_remove_total_weight);
+  fst::script::Push(__pyx_v_self->_mfst.get(), __pyx_t_2, __pyx_v_delta, __pyx_v_remove_total_weight);
 
-  /* "fstlib/cext/pywrapfst.pyx":2445
+  /* "fstlib/cext/pywrapfst.pyx":2509
  *     return self
  * 
  *   cdef void _push(self,             # <<<<<<<<<<<<<<
  *                   float delta=fst.kShortestDelta,
  *                   bool remove_total_weight=False,
  */
 
@@ -26587,38 +26947,39 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst.MutableFst._push", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2454
+/* "fstlib/cext/pywrapfst.pyx":2518
  *              remove_total_weight)
  * 
  *   def push(self,             # <<<<<<<<<<<<<<
  *            float delta=fst.kShortestDelta,
  *            bool remove_total_weight=False,
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_39push(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_38push[] = "\n    push(self, delta=1-e6, remove_total_weight=False, to_final=False)\n\n    Pushes weights towards the initial or final states.\n\n    This operation destructively produces an equivalent transducer by pushing\n    the weights towards the initial state or toward the final states. When\n    pushing weights towards the initial state, the sum of the weight of the\n    outgoing transitions and final weight at any non-initial state is equal to\n    one in the resulting machine. When pushing weights towards the final states,\n    the sum of the weight of the incoming transitions at any state is equal to\n    one. Weights need to be left distributive when pushing towards the initial\n    state and right distributive when pushing towards the final states.\n\n    Args:\n      delta: Comparison/quantization delta.\n      remove_total_weight: If pushing weights, should the total weight be\n          removed?\n      to_final: Push towards final states?\n\n    Returns:\n      self.\n    ";
+static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_38push[] = "\n    push(self, delta=1-e6, remove_total_weight=False, reweight_type=\"to_initial\")\n\n    Pushes weights towards the initial or final states.\n\n    This operation destructively produces an equivalent transducer by pushing\n    the weights towards the initial state or toward the final states. When\n    pushing weights towards the initial state, the sum of the weight of the\n    outgoing transitions and final weight at any non-initial state is equal to\n    one in the resulting machine. When pushing weights towards the final states,\n    the sum of the weight of the incoming transitions at any state is equal to\n    one. Weights need to be left distributive when pushing towards the initial\n    state and right distributive when pushing towards the final states.\n\n    Args:\n      delta: Comparison/quantization delta.\n      remove_total_weight: If pushing weights, should the total weight be\n          removed?\n      reweight_type: Push towards initial or final states: a string matching a\n          known reweight type: one of \"to_initial\", \"to_final\"\n\n    Returns:\n      self.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_39push(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   float __pyx_v_delta;
   bool __pyx_v_remove_total_weight;
-  bool __pyx_v_to_final;
+  PyObject *__pyx_v_reweight_type = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("push (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_delta,&__pyx_n_s_remove_total_weight,&__pyx_n_s_to_final,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_delta,&__pyx_n_s_remove_total_weight,&__pyx_n_s_reweight_type,0};
     PyObject* values[3] = {0,0,0};
+    values[2] = ((PyObject *)__pyx_n_u_to_initial);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
@@ -26640,127 +27001,115 @@
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_remove_total_weight);
           if (value) { values[1] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_final);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_reweight_type);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "push") < 0)) __PYX_ERR(0, 2454, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "push") < 0)) __PYX_ERR(0, 2518, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     if (values[0]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[0]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 2455, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[0]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 2519, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__19;
+      __pyx_v_delta = __pyx_k__17;
     }
     if (values[1]) {
-      __pyx_v_remove_total_weight = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_remove_total_weight == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2456, __pyx_L3_error)
+      __pyx_v_remove_total_weight = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_remove_total_weight == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2520, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":2456
+      /* "fstlib/cext/pywrapfst.pyx":2520
  *   def push(self,
  *            float delta=fst.kShortestDelta,
  *            bool remove_total_weight=False,             # <<<<<<<<<<<<<<
- *            bool to_final=False):
+ *            reweight_type="to_initial"):
  *     """
  */
       __pyx_v_remove_total_weight = ((bool)0);
     }
-    if (values[2]) {
-      __pyx_v_to_final = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_to_final == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2457, __pyx_L3_error)
-    } else {
-
-      /* "fstlib/cext/pywrapfst.pyx":2457
- *            float delta=fst.kShortestDelta,
- *            bool remove_total_weight=False,
- *            bool to_final=False):             # <<<<<<<<<<<<<<
- *     """
- *     push(self, delta=1-e6, remove_total_weight=False, to_final=False)
- */
-      __pyx_v_to_final = ((bool)0);
-    }
+    __pyx_v_reweight_type = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("push", 0, 0, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2454, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("push", 0, 0, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2518, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.push", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_38push(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_delta, __pyx_v_remove_total_weight, __pyx_v_to_final);
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_38push(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_delta, __pyx_v_remove_total_weight, __pyx_v_reweight_type);
 
-  /* "fstlib/cext/pywrapfst.pyx":2454
+  /* "fstlib/cext/pywrapfst.pyx":2518
  *              remove_total_weight)
  * 
  *   def push(self,             # <<<<<<<<<<<<<<
  *            float delta=fst.kShortestDelta,
  *            bool remove_total_weight=False,
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_38push(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, float __pyx_v_delta, bool __pyx_v_remove_total_weight, bool __pyx_v_to_final) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_38push(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, float __pyx_v_delta, bool __pyx_v_remove_total_weight, PyObject *__pyx_v_reweight_type) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__push __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("push", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2481
+  /* "fstlib/cext/pywrapfst.pyx":2546
  *       self.
  *     """
- *     self._push(delta, remove_total_weight, to_final)             # <<<<<<<<<<<<<<
+ *     self._push(delta, remove_total_weight, reweight_type)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_push");
-    __PYX_ERR(0, 2481, __pyx_L1_error)
+    __PYX_ERR(0, 2546, __pyx_L1_error)
   }
   __pyx_t_1.__pyx_n = 3;
   __pyx_t_1.delta = __pyx_v_delta;
   __pyx_t_1.remove_total_weight = __pyx_v_remove_total_weight;
-  __pyx_t_1.to_final = __pyx_v_to_final;
+  __pyx_t_1.reweight_type = __pyx_v_reweight_type;
   ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_push(__pyx_v_self, &__pyx_t_1); 
 
-  /* "fstlib/cext/pywrapfst.pyx":2482
+  /* "fstlib/cext/pywrapfst.pyx":2547
  *     """
- *     self._push(delta, remove_total_weight, to_final)
+ *     self._push(delta, remove_total_weight, reweight_type)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _relabel_pairs(self, ipairs=None, opairs=None) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2454
+  /* "fstlib/cext/pywrapfst.pyx":2518
  *              remove_total_weight)
  * 
  *   def push(self,             # <<<<<<<<<<<<<<
  *            float delta=fst.kShortestDelta,
  *            bool remove_total_weight=False,
  */
 
@@ -26770,15 +27119,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2484
+/* "fstlib/cext/pywrapfst.pyx":2549
  *     return self
  * 
  *   cdef void _relabel_pairs(self, ipairs=None, opairs=None) except *:             # <<<<<<<<<<<<<<
  *     cdef vector[fst.LabelPair] _ipairs
  *     cdef vector[fst.LabelPair] _opairs
  */
 
@@ -26795,16 +27144,16 @@
   Py_ssize_t __pyx_t_3;
   PyObject *(*__pyx_t_4)(PyObject *);
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   PyObject *(*__pyx_t_9)(PyObject *);
-  int64 __pyx_t_10;
-  int64 __pyx_t_11;
+  int64_t __pyx_t_10;
+  int64_t __pyx_t_11;
   __pyx_t_10cpywrapfst_LabelPair __pyx_t_12;
   int __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_relabel_pairs", 0);
   if (__pyx_optional_args) {
@@ -26812,311 +27161,311 @@
       __pyx_v_ipairs = __pyx_optional_args->ipairs;
       if (__pyx_optional_args->__pyx_n > 1) {
         __pyx_v_opairs = __pyx_optional_args->opairs;
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2487
+  /* "fstlib/cext/pywrapfst.pyx":2552
  *     cdef vector[fst.LabelPair] _ipairs
  *     cdef vector[fst.LabelPair] _opairs
  *     if ipairs:             # <<<<<<<<<<<<<<
  *       for (before, after) in ipairs:
  *         _ipairs.push_back(fst.LabelPair(before, after))
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_ipairs); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2487, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_ipairs); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2552, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2488
+    /* "fstlib/cext/pywrapfst.pyx":2553
  *     cdef vector[fst.LabelPair] _opairs
  *     if ipairs:
  *       for (before, after) in ipairs:             # <<<<<<<<<<<<<<
  *         _ipairs.push_back(fst.LabelPair(before, after))
  *     if opairs:
  */
     if (likely(PyList_CheckExact(__pyx_v_ipairs)) || PyTuple_CheckExact(__pyx_v_ipairs)) {
       __pyx_t_2 = __pyx_v_ipairs; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
       __pyx_t_4 = NULL;
     } else {
-      __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_ipairs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2488, __pyx_L1_error)
+      __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_ipairs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2553, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2488, __pyx_L1_error)
+      __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2553, __pyx_L1_error)
     }
     for (;;) {
       if (likely(!__pyx_t_4)) {
         if (likely(PyList_CheckExact(__pyx_t_2))) {
           if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 2488, __pyx_L1_error)
+          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 2553, __pyx_L1_error)
           #else
-          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2488, __pyx_L1_error)
+          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2553, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           #endif
         } else {
           if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 2488, __pyx_L1_error)
+          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 2553, __pyx_L1_error)
           #else
-          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2488, __pyx_L1_error)
+          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2553, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           #endif
         }
       } else {
         __pyx_t_5 = __pyx_t_4(__pyx_t_2);
         if (unlikely(!__pyx_t_5)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 2488, __pyx_L1_error)
+            else __PYX_ERR(0, 2553, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_5);
       }
       if ((likely(PyTuple_CheckExact(__pyx_t_5))) || (PyList_CheckExact(__pyx_t_5))) {
         PyObject* sequence = __pyx_t_5;
         Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
         if (unlikely(size != 2)) {
           if (size > 2) __Pyx_RaiseTooManyValuesError(2);
           else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-          __PYX_ERR(0, 2488, __pyx_L1_error)
+          __PYX_ERR(0, 2553, __pyx_L1_error)
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
         if (likely(PyTuple_CheckExact(sequence))) {
           __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
           __pyx_t_7 = PyTuple_GET_ITEM(sequence, 1); 
         } else {
           __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
           __pyx_t_7 = PyList_GET_ITEM(sequence, 1); 
         }
         __Pyx_INCREF(__pyx_t_6);
         __Pyx_INCREF(__pyx_t_7);
         #else
-        __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2488, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2553, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2488, __pyx_L1_error)
+        __pyx_t_7 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2553, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         #endif
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       } else {
         Py_ssize_t index = -1;
-        __pyx_t_8 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2488, __pyx_L1_error)
+        __pyx_t_8 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2553, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __pyx_t_9 = Py_TYPE(__pyx_t_8)->tp_iternext;
         index = 0; __pyx_t_6 = __pyx_t_9(__pyx_t_8); if (unlikely(!__pyx_t_6)) goto __pyx_L6_unpacking_failed;
         __Pyx_GOTREF(__pyx_t_6);
         index = 1; __pyx_t_7 = __pyx_t_9(__pyx_t_8); if (unlikely(!__pyx_t_7)) goto __pyx_L6_unpacking_failed;
         __Pyx_GOTREF(__pyx_t_7);
-        if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_8), 2) < 0) __PYX_ERR(0, 2488, __pyx_L1_error)
+        if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_8), 2) < 0) __PYX_ERR(0, 2553, __pyx_L1_error)
         __pyx_t_9 = NULL;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         goto __pyx_L7_unpacking_done;
         __pyx_L6_unpacking_failed:;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_9 = NULL;
         if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-        __PYX_ERR(0, 2488, __pyx_L1_error)
+        __PYX_ERR(0, 2553, __pyx_L1_error)
         __pyx_L7_unpacking_done:;
       }
       __Pyx_XDECREF_SET(__pyx_v_before, __pyx_t_6);
       __pyx_t_6 = 0;
       __Pyx_XDECREF_SET(__pyx_v_after, __pyx_t_7);
       __pyx_t_7 = 0;
 
-      /* "fstlib/cext/pywrapfst.pyx":2489
+      /* "fstlib/cext/pywrapfst.pyx":2554
  *     if ipairs:
  *       for (before, after) in ipairs:
  *         _ipairs.push_back(fst.LabelPair(before, after))             # <<<<<<<<<<<<<<
  *     if opairs:
  *       for (before, after) in opairs:
  */
-      __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_before); if (unlikely((__pyx_t_10 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2489, __pyx_L1_error)
-      __pyx_t_11 = __Pyx_PyInt_As_int64_t(__pyx_v_after); if (unlikely((__pyx_t_11 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2489, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_before); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2554, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyInt_As_int64_t(__pyx_v_after); if (unlikely((__pyx_t_11 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2554, __pyx_L1_error)
       try {
         __pyx_t_12 = __pyx_t_10cpywrapfst_LabelPair(__pyx_t_10, __pyx_t_11);
       } catch(...) {
         __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 2489, __pyx_L1_error)
+        __PYX_ERR(0, 2554, __pyx_L1_error)
       }
       try {
         __pyx_v__ipairs.push_back(__pyx_t_12);
       } catch(...) {
         __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 2489, __pyx_L1_error)
+        __PYX_ERR(0, 2554, __pyx_L1_error)
       }
 
-      /* "fstlib/cext/pywrapfst.pyx":2488
+      /* "fstlib/cext/pywrapfst.pyx":2553
  *     cdef vector[fst.LabelPair] _opairs
  *     if ipairs:
  *       for (before, after) in ipairs:             # <<<<<<<<<<<<<<
  *         _ipairs.push_back(fst.LabelPair(before, after))
  *     if opairs:
  */
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "fstlib/cext/pywrapfst.pyx":2487
+    /* "fstlib/cext/pywrapfst.pyx":2552
  *     cdef vector[fst.LabelPair] _ipairs
  *     cdef vector[fst.LabelPair] _opairs
  *     if ipairs:             # <<<<<<<<<<<<<<
  *       for (before, after) in ipairs:
  *         _ipairs.push_back(fst.LabelPair(before, after))
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2490
+  /* "fstlib/cext/pywrapfst.pyx":2555
  *       for (before, after) in ipairs:
  *         _ipairs.push_back(fst.LabelPair(before, after))
  *     if opairs:             # <<<<<<<<<<<<<<
  *       for (before, after) in opairs:
  *         _opairs.push_back(fst.LabelPair(before, after))
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_opairs); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2490, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_opairs); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 2555, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2491
+    /* "fstlib/cext/pywrapfst.pyx":2556
  *         _ipairs.push_back(fst.LabelPair(before, after))
  *     if opairs:
  *       for (before, after) in opairs:             # <<<<<<<<<<<<<<
  *         _opairs.push_back(fst.LabelPair(before, after))
  *     if _ipairs.empty() and _opairs.empty():
  */
     if (likely(PyList_CheckExact(__pyx_v_opairs)) || PyTuple_CheckExact(__pyx_v_opairs)) {
       __pyx_t_2 = __pyx_v_opairs; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
       __pyx_t_4 = NULL;
     } else {
-      __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_opairs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2491, __pyx_L1_error)
+      __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_opairs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2556, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2491, __pyx_L1_error)
+      __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2556, __pyx_L1_error)
     }
     for (;;) {
       if (likely(!__pyx_t_4)) {
         if (likely(PyList_CheckExact(__pyx_t_2))) {
           if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 2491, __pyx_L1_error)
+          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 2556, __pyx_L1_error)
           #else
-          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2491, __pyx_L1_error)
+          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2556, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           #endif
         } else {
           if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 2491, __pyx_L1_error)
+          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 2556, __pyx_L1_error)
           #else
-          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2491, __pyx_L1_error)
+          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2556, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           #endif
         }
       } else {
         __pyx_t_5 = __pyx_t_4(__pyx_t_2);
         if (unlikely(!__pyx_t_5)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 2491, __pyx_L1_error)
+            else __PYX_ERR(0, 2556, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_5);
       }
       if ((likely(PyTuple_CheckExact(__pyx_t_5))) || (PyList_CheckExact(__pyx_t_5))) {
         PyObject* sequence = __pyx_t_5;
         Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
         if (unlikely(size != 2)) {
           if (size > 2) __Pyx_RaiseTooManyValuesError(2);
           else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-          __PYX_ERR(0, 2491, __pyx_L1_error)
+          __PYX_ERR(0, 2556, __pyx_L1_error)
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
         if (likely(PyTuple_CheckExact(sequence))) {
           __pyx_t_7 = PyTuple_GET_ITEM(sequence, 0); 
           __pyx_t_6 = PyTuple_GET_ITEM(sequence, 1); 
         } else {
           __pyx_t_7 = PyList_GET_ITEM(sequence, 0); 
           __pyx_t_6 = PyList_GET_ITEM(sequence, 1); 
         }
         __Pyx_INCREF(__pyx_t_7);
         __Pyx_INCREF(__pyx_t_6);
         #else
-        __pyx_t_7 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2491, __pyx_L1_error)
+        __pyx_t_7 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2556, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2491, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2556, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       } else {
         Py_ssize_t index = -1;
-        __pyx_t_8 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2491, __pyx_L1_error)
+        __pyx_t_8 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2556, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __pyx_t_9 = Py_TYPE(__pyx_t_8)->tp_iternext;
         index = 0; __pyx_t_7 = __pyx_t_9(__pyx_t_8); if (unlikely(!__pyx_t_7)) goto __pyx_L11_unpacking_failed;
         __Pyx_GOTREF(__pyx_t_7);
         index = 1; __pyx_t_6 = __pyx_t_9(__pyx_t_8); if (unlikely(!__pyx_t_6)) goto __pyx_L11_unpacking_failed;
         __Pyx_GOTREF(__pyx_t_6);
-        if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_8), 2) < 0) __PYX_ERR(0, 2491, __pyx_L1_error)
+        if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_8), 2) < 0) __PYX_ERR(0, 2556, __pyx_L1_error)
         __pyx_t_9 = NULL;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         goto __pyx_L12_unpacking_done;
         __pyx_L11_unpacking_failed:;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_9 = NULL;
         if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-        __PYX_ERR(0, 2491, __pyx_L1_error)
+        __PYX_ERR(0, 2556, __pyx_L1_error)
         __pyx_L12_unpacking_done:;
       }
       __Pyx_XDECREF_SET(__pyx_v_before, __pyx_t_7);
       __pyx_t_7 = 0;
       __Pyx_XDECREF_SET(__pyx_v_after, __pyx_t_6);
       __pyx_t_6 = 0;
 
-      /* "fstlib/cext/pywrapfst.pyx":2492
+      /* "fstlib/cext/pywrapfst.pyx":2557
  *     if opairs:
  *       for (before, after) in opairs:
  *         _opairs.push_back(fst.LabelPair(before, after))             # <<<<<<<<<<<<<<
  *     if _ipairs.empty() and _opairs.empty():
  *       raise FstArgError("No relabeling pairs specified")
  */
-      __pyx_t_11 = __Pyx_PyInt_As_int64_t(__pyx_v_before); if (unlikely((__pyx_t_11 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2492, __pyx_L1_error)
-      __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_after); if (unlikely((__pyx_t_10 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2492, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyInt_As_int64_t(__pyx_v_before); if (unlikely((__pyx_t_11 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2557, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_after); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2557, __pyx_L1_error)
       try {
         __pyx_t_12 = __pyx_t_10cpywrapfst_LabelPair(__pyx_t_11, __pyx_t_10);
       } catch(...) {
         __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 2492, __pyx_L1_error)
+        __PYX_ERR(0, 2557, __pyx_L1_error)
       }
       try {
         __pyx_v__opairs.push_back(__pyx_t_12);
       } catch(...) {
         __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 2492, __pyx_L1_error)
+        __PYX_ERR(0, 2557, __pyx_L1_error)
       }
 
-      /* "fstlib/cext/pywrapfst.pyx":2491
+      /* "fstlib/cext/pywrapfst.pyx":2556
  *         _ipairs.push_back(fst.LabelPair(before, after))
  *     if opairs:
  *       for (before, after) in opairs:             # <<<<<<<<<<<<<<
  *         _opairs.push_back(fst.LabelPair(before, after))
  *     if _ipairs.empty() and _opairs.empty():
  */
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "fstlib/cext/pywrapfst.pyx":2490
+    /* "fstlib/cext/pywrapfst.pyx":2555
  *       for (before, after) in ipairs:
  *         _ipairs.push_back(fst.LabelPair(before, after))
  *     if opairs:             # <<<<<<<<<<<<<<
  *       for (before, after) in opairs:
  *         _opairs.push_back(fst.LabelPair(before, after))
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2493
+  /* "fstlib/cext/pywrapfst.pyx":2558
  *       for (before, after) in opairs:
  *         _opairs.push_back(fst.LabelPair(before, after))
  *     if _ipairs.empty() and _opairs.empty():             # <<<<<<<<<<<<<<
  *       raise FstArgError("No relabeling pairs specified")
  *     fst.Relabel(self._mfst.get(), _ipairs, _opairs)
  */
   __pyx_t_13 = (__pyx_v__ipairs.empty() != 0);
@@ -27126,78 +27475,78 @@
     goto __pyx_L14_bool_binop_done;
   }
   __pyx_t_13 = (__pyx_v__opairs.empty() != 0);
   __pyx_t_1 = __pyx_t_13;
   __pyx_L14_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2494
+    /* "fstlib/cext/pywrapfst.pyx":2559
  *         _opairs.push_back(fst.LabelPair(before, after))
  *     if _ipairs.empty() and _opairs.empty():
  *       raise FstArgError("No relabeling pairs specified")             # <<<<<<<<<<<<<<
  *     fst.Relabel(self._mfst.get(), _ipairs, _opairs)
  *     self._check_mutating_imethod()
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2494, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2559, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_6 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_6)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
         __Pyx_INCREF(__pyx_t_6);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
       }
     }
     __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_kp_u_No_relabeling_pairs_specified) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_kp_u_No_relabeling_pairs_specified);
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2494, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2559, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 2494, __pyx_L1_error)
+    __PYX_ERR(0, 2559, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2493
+    /* "fstlib/cext/pywrapfst.pyx":2558
  *       for (before, after) in opairs:
  *         _opairs.push_back(fst.LabelPair(before, after))
  *     if _ipairs.empty() and _opairs.empty():             # <<<<<<<<<<<<<<
  *       raise FstArgError("No relabeling pairs specified")
  *     fst.Relabel(self._mfst.get(), _ipairs, _opairs)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2495
+  /* "fstlib/cext/pywrapfst.pyx":2560
  *     if _ipairs.empty() and _opairs.empty():
  *       raise FstArgError("No relabeling pairs specified")
  *     fst.Relabel(self._mfst.get(), _ipairs, _opairs)             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2495, __pyx_L1_error)
+    __PYX_ERR(0, 2560, __pyx_L1_error)
   }
   fst::script::Relabel(__pyx_v_self->_mfst.get(), __pyx_v__ipairs, __pyx_v__opairs);
 
-  /* "fstlib/cext/pywrapfst.pyx":2496
+  /* "fstlib/cext/pywrapfst.pyx":2561
  *       raise FstArgError("No relabeling pairs specified")
  *     fst.Relabel(self._mfst.get(), _ipairs, _opairs)
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
  *   def relabel_pairs(self, ipairs=None, opairs=None):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2496, __pyx_L1_error)
+    __PYX_ERR(0, 2561, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2496, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2561, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2484
+  /* "fstlib/cext/pywrapfst.pyx":2549
  *     return self
  * 
  *   cdef void _relabel_pairs(self, ipairs=None, opairs=None) except *:             # <<<<<<<<<<<<<<
  *     cdef vector[fst.LabelPair] _ipairs
  *     cdef vector[fst.LabelPair] _opairs
  */
 
@@ -27212,15 +27561,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._relabel_pairs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_before);
   __Pyx_XDECREF(__pyx_v_after);
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2498
+/* "fstlib/cext/pywrapfst.pyx":2563
  *     self._check_mutating_imethod()
  * 
  *   def relabel_pairs(self, ipairs=None, opairs=None):             # <<<<<<<<<<<<<<
  *     """
  *     relabel_pairs(self, ipairs=None, opairs=None)
  */
 
@@ -27263,15 +27612,15 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_opairs);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "relabel_pairs") < 0)) __PYX_ERR(0, 2498, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "relabel_pairs") < 0)) __PYX_ERR(0, 2563, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
@@ -27280,15 +27629,15 @@
       }
     }
     __pyx_v_ipairs = values[0];
     __pyx_v_opairs = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("relabel_pairs", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2498, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("relabel_pairs", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2563, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.relabel_pairs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_40relabel_pairs(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_ipairs, __pyx_v_opairs);
 
@@ -27302,43 +27651,43 @@
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_pairs __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("relabel_pairs", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2518
+  /* "fstlib/cext/pywrapfst.pyx":2583
  *       FstArgError: No relabeling pairs specified.
  *     """
  *     self._relabel_pairs(ipairs, opairs)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_relabel_pairs");
-    __PYX_ERR(0, 2518, __pyx_L1_error)
+    __PYX_ERR(0, 2583, __pyx_L1_error)
   }
   __pyx_t_1.__pyx_n = 2;
   __pyx_t_1.ipairs = __pyx_v_ipairs;
   __pyx_t_1.opairs = __pyx_v_opairs;
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_relabel_pairs(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2518, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_relabel_pairs(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2583, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2519
+  /* "fstlib/cext/pywrapfst.pyx":2584
  *     """
  *     self._relabel_pairs(ipairs, opairs)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _relabel_tables(self,
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2498
+  /* "fstlib/cext/pywrapfst.pyx":2563
  *     self._check_mutating_imethod()
  * 
  *   def relabel_pairs(self, ipairs=None, opairs=None):             # <<<<<<<<<<<<<<
  *     """
  *     relabel_pairs(self, ipairs=None, opairs=None)
  */
 
@@ -27348,72 +27697,72 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2521
+/* "fstlib/cext/pywrapfst.pyx":2586
  *     return self
  * 
  *   cdef void _relabel_tables(self,             # <<<<<<<<<<<<<<
  *                             SymbolTableView old_isymbols=None,
  *                             SymbolTableView new_isymbols=None,
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_tables(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_tables *__pyx_optional_args) {
 
-  /* "fstlib/cext/pywrapfst.pyx":2522
+  /* "fstlib/cext/pywrapfst.pyx":2587
  * 
  *   cdef void _relabel_tables(self,
  *                             SymbolTableView old_isymbols=None,             # <<<<<<<<<<<<<<
  *                             SymbolTableView new_isymbols=None,
  *                             unknown_isymbol="",
  */
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_old_isymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-  /* "fstlib/cext/pywrapfst.pyx":2523
+  /* "fstlib/cext/pywrapfst.pyx":2588
  *   cdef void _relabel_tables(self,
  *                             SymbolTableView old_isymbols=None,
  *                             SymbolTableView new_isymbols=None,             # <<<<<<<<<<<<<<
  *                             unknown_isymbol="",
  *                             bool attach_new_isymbols=True,
  */
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_new_isymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
-  PyObject *__pyx_v_unknown_isymbol = ((PyObject *)__pyx_kp_u__11);
+  PyObject *__pyx_v_unknown_isymbol = ((PyObject *)__pyx_kp_u__9);
 
-  /* "fstlib/cext/pywrapfst.pyx":2525
+  /* "fstlib/cext/pywrapfst.pyx":2590
  *                             SymbolTableView new_isymbols=None,
  *                             unknown_isymbol="",
  *                             bool attach_new_isymbols=True,             # <<<<<<<<<<<<<<
  *                             SymbolTableView old_osymbols=None,
  *                             SymbolTableView new_osymbols=None,
  */
   bool __pyx_v_attach_new_isymbols = ((bool)1);
 
-  /* "fstlib/cext/pywrapfst.pyx":2526
+  /* "fstlib/cext/pywrapfst.pyx":2591
  *                             unknown_isymbol="",
  *                             bool attach_new_isymbols=True,
  *                             SymbolTableView old_osymbols=None,             # <<<<<<<<<<<<<<
  *                             SymbolTableView new_osymbols=None,
  *                             unknown_osymbol="",
  */
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_old_osymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-  /* "fstlib/cext/pywrapfst.pyx":2527
+  /* "fstlib/cext/pywrapfst.pyx":2592
  *                             bool attach_new_isymbols=True,
  *                             SymbolTableView old_osymbols=None,
  *                             SymbolTableView new_osymbols=None,             # <<<<<<<<<<<<<<
  *                             unknown_osymbol="",
  *                             bool attach_new_osymbols=True) except *:
  */
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *__pyx_v_new_osymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
-  PyObject *__pyx_v_unknown_osymbol = ((PyObject *)__pyx_kp_u__11);
+  PyObject *__pyx_v_unknown_osymbol = ((PyObject *)__pyx_kp_u__9);
 
-  /* "fstlib/cext/pywrapfst.pyx":2529
+  /* "fstlib/cext/pywrapfst.pyx":2594
  *                             SymbolTableView new_osymbols=None,
  *                             unknown_osymbol="",
  *                             bool attach_new_osymbols=True) except *:             # <<<<<<<<<<<<<<
  *     if new_isymbols is None and new_osymbols is None:
  *       raise FstArgError("No new SymbolTables specified")
  */
   bool __pyx_v_attach_new_osymbols = ((bool)1);
@@ -27458,15 +27807,15 @@
             }
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2530
+  /* "fstlib/cext/pywrapfst.pyx":2595
  *                             unknown_osymbol="",
  *                             bool attach_new_osymbols=True) except *:
  *     if new_isymbols is None and new_osymbols is None:             # <<<<<<<<<<<<<<
  *       raise FstArgError("No new SymbolTables specified")
  *     cdef const fst.SymbolTable *_old_isymbols = self._fst.get().InputSymbols()
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_new_isymbols) == Py_None);
@@ -27478,284 +27827,284 @@
   }
   __pyx_t_3 = (((PyObject *)__pyx_v_new_osymbols) == Py_None);
   __pyx_t_2 = (__pyx_t_3 != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2531
+    /* "fstlib/cext/pywrapfst.pyx":2596
  *                             bool attach_new_osymbols=True) except *:
  *     if new_isymbols is None and new_osymbols is None:
  *       raise FstArgError("No new SymbolTables specified")             # <<<<<<<<<<<<<<
  *     cdef const fst.SymbolTable *_old_isymbols = self._fst.get().InputSymbols()
  *     if old_isymbols is not None:
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2531, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2596, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_6 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_6)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
         __Pyx_INCREF(__pyx_t_6);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
       }
     }
     __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_kp_u_No_new_SymbolTables_specified) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_kp_u_No_new_SymbolTables_specified);
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2531, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2596, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 2531, __pyx_L1_error)
+    __PYX_ERR(0, 2596, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2530
+    /* "fstlib/cext/pywrapfst.pyx":2595
  *                             unknown_osymbol="",
  *                             bool attach_new_osymbols=True) except *:
  *     if new_isymbols is None and new_osymbols is None:             # <<<<<<<<<<<<<<
  *       raise FstArgError("No new SymbolTables specified")
  *     cdef const fst.SymbolTable *_old_isymbols = self._fst.get().InputSymbols()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2532
+  /* "fstlib/cext/pywrapfst.pyx":2597
  *     if new_isymbols is None and new_osymbols is None:
  *       raise FstArgError("No new SymbolTables specified")
  *     cdef const fst.SymbolTable *_old_isymbols = self._fst.get().InputSymbols()             # <<<<<<<<<<<<<<
  *     if old_isymbols is not None:
  *       _old_isymbols = old_isymbols._raw_ptr_or_raise()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2532, __pyx_L1_error)
+    __PYX_ERR(0, 2597, __pyx_L1_error)
   }
   __pyx_v__old_isymbols = __pyx_v_self->__pyx_base._fst.get()->InputSymbols();
 
-  /* "fstlib/cext/pywrapfst.pyx":2533
+  /* "fstlib/cext/pywrapfst.pyx":2598
  *       raise FstArgError("No new SymbolTables specified")
  *     cdef const fst.SymbolTable *_old_isymbols = self._fst.get().InputSymbols()
  *     if old_isymbols is not None:             # <<<<<<<<<<<<<<
  *       _old_isymbols = old_isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_old_osymbols = self._fst.get().OutputSymbols()
  */
   __pyx_t_1 = (((PyObject *)__pyx_v_old_isymbols) != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2534
+    /* "fstlib/cext/pywrapfst.pyx":2599
  *     cdef const fst.SymbolTable *_old_isymbols = self._fst.get().InputSymbols()
  *     if old_isymbols is not None:
  *       _old_isymbols = old_isymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     cdef const fst.SymbolTable *_old_osymbols = self._fst.get().OutputSymbols()
  *     if old_osymbols is not None:
  */
     if (unlikely(((PyObject *)__pyx_v_old_isymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 2534, __pyx_L1_error)
+      __PYX_ERR(0, 2599, __pyx_L1_error)
     }
-    __pyx_t_7 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_old_isymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_old_isymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2534, __pyx_L1_error)
+    __pyx_t_7 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_old_isymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_old_isymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2599, __pyx_L1_error)
     __pyx_v__old_isymbols = __pyx_t_7;
 
-    /* "fstlib/cext/pywrapfst.pyx":2533
+    /* "fstlib/cext/pywrapfst.pyx":2598
  *       raise FstArgError("No new SymbolTables specified")
  *     cdef const fst.SymbolTable *_old_isymbols = self._fst.get().InputSymbols()
  *     if old_isymbols is not None:             # <<<<<<<<<<<<<<
  *       _old_isymbols = old_isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_old_osymbols = self._fst.get().OutputSymbols()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2535
+  /* "fstlib/cext/pywrapfst.pyx":2600
  *     if old_isymbols is not None:
  *       _old_isymbols = old_isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_old_osymbols = self._fst.get().OutputSymbols()             # <<<<<<<<<<<<<<
  *     if old_osymbols is not None:
  *        _old_osymbols = old_osymbols._raw_ptr_or_raise()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2535, __pyx_L1_error)
+    __PYX_ERR(0, 2600, __pyx_L1_error)
   }
   __pyx_v__old_osymbols = __pyx_v_self->__pyx_base._fst.get()->OutputSymbols();
 
-  /* "fstlib/cext/pywrapfst.pyx":2536
+  /* "fstlib/cext/pywrapfst.pyx":2601
  *       _old_isymbols = old_isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_old_osymbols = self._fst.get().OutputSymbols()
  *     if old_osymbols is not None:             # <<<<<<<<<<<<<<
  *        _old_osymbols = old_osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_new_isymbols = NULL
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_old_osymbols) != Py_None);
   __pyx_t_1 = (__pyx_t_2 != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2537
+    /* "fstlib/cext/pywrapfst.pyx":2602
  *     cdef const fst.SymbolTable *_old_osymbols = self._fst.get().OutputSymbols()
  *     if old_osymbols is not None:
  *        _old_osymbols = old_osymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     cdef const fst.SymbolTable *_new_isymbols = NULL
  *     if new_isymbols is not None:
  */
     if (unlikely(((PyObject *)__pyx_v_old_osymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 2537, __pyx_L1_error)
+      __PYX_ERR(0, 2602, __pyx_L1_error)
     }
-    __pyx_t_7 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_old_osymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_old_osymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2537, __pyx_L1_error)
+    __pyx_t_7 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_old_osymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_old_osymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2602, __pyx_L1_error)
     __pyx_v__old_osymbols = __pyx_t_7;
 
-    /* "fstlib/cext/pywrapfst.pyx":2536
+    /* "fstlib/cext/pywrapfst.pyx":2601
  *       _old_isymbols = old_isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_old_osymbols = self._fst.get().OutputSymbols()
  *     if old_osymbols is not None:             # <<<<<<<<<<<<<<
  *        _old_osymbols = old_osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_new_isymbols = NULL
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2538
+  /* "fstlib/cext/pywrapfst.pyx":2603
  *     if old_osymbols is not None:
  *        _old_osymbols = old_osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_new_isymbols = NULL             # <<<<<<<<<<<<<<
  *     if new_isymbols is not None:
  *       _new_isymbols = new_isymbols._raw_ptr_or_raise()
  */
   __pyx_v__new_isymbols = NULL;
 
-  /* "fstlib/cext/pywrapfst.pyx":2539
+  /* "fstlib/cext/pywrapfst.pyx":2604
  *        _old_osymbols = old_osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_new_isymbols = NULL
  *     if new_isymbols is not None:             # <<<<<<<<<<<<<<
  *       _new_isymbols = new_isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_new_osymbols = NULL
  */
   __pyx_t_1 = (((PyObject *)__pyx_v_new_isymbols) != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2540
+    /* "fstlib/cext/pywrapfst.pyx":2605
  *     cdef const fst.SymbolTable *_new_isymbols = NULL
  *     if new_isymbols is not None:
  *       _new_isymbols = new_isymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     cdef const fst.SymbolTable *_new_osymbols = NULL
  *     if new_osymbols is not None:
  */
     if (unlikely(((PyObject *)__pyx_v_new_isymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 2540, __pyx_L1_error)
+      __PYX_ERR(0, 2605, __pyx_L1_error)
     }
-    __pyx_t_7 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_new_isymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_new_isymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2540, __pyx_L1_error)
+    __pyx_t_7 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_new_isymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_new_isymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2605, __pyx_L1_error)
     __pyx_v__new_isymbols = __pyx_t_7;
 
-    /* "fstlib/cext/pywrapfst.pyx":2539
+    /* "fstlib/cext/pywrapfst.pyx":2604
  *        _old_osymbols = old_osymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_new_isymbols = NULL
  *     if new_isymbols is not None:             # <<<<<<<<<<<<<<
  *       _new_isymbols = new_isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_new_osymbols = NULL
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2541
+  /* "fstlib/cext/pywrapfst.pyx":2606
  *     if new_isymbols is not None:
  *       _new_isymbols = new_isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_new_osymbols = NULL             # <<<<<<<<<<<<<<
  *     if new_osymbols is not None:
  *       _new_osymbols = new_osymbols._raw_ptr_or_raise()
  */
   __pyx_v__new_osymbols = NULL;
 
-  /* "fstlib/cext/pywrapfst.pyx":2542
+  /* "fstlib/cext/pywrapfst.pyx":2607
  *       _new_isymbols = new_isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_new_osymbols = NULL
  *     if new_osymbols is not None:             # <<<<<<<<<<<<<<
  *       _new_osymbols = new_osymbols._raw_ptr_or_raise()
  *     fst.Relabel(self._mfst.get(),
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_new_osymbols) != Py_None);
   __pyx_t_1 = (__pyx_t_2 != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2543
+    /* "fstlib/cext/pywrapfst.pyx":2608
  *     cdef const fst.SymbolTable *_new_osymbols = NULL
  *     if new_osymbols is not None:
  *       _new_osymbols = new_osymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     fst.Relabel(self._mfst.get(),
  *         _old_isymbols,
  */
     if (unlikely(((PyObject *)__pyx_v_new_osymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 2543, __pyx_L1_error)
+      __PYX_ERR(0, 2608, __pyx_L1_error)
     }
-    __pyx_t_7 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_new_osymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_new_osymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2543, __pyx_L1_error)
+    __pyx_t_7 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_new_osymbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_new_osymbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2608, __pyx_L1_error)
     __pyx_v__new_osymbols = __pyx_t_7;
 
-    /* "fstlib/cext/pywrapfst.pyx":2542
+    /* "fstlib/cext/pywrapfst.pyx":2607
  *       _new_isymbols = new_isymbols._raw_ptr_or_raise()
  *     cdef const fst.SymbolTable *_new_osymbols = NULL
  *     if new_osymbols is not None:             # <<<<<<<<<<<<<<
  *       _new_osymbols = new_osymbols._raw_ptr_or_raise()
  *     fst.Relabel(self._mfst.get(),
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2544
+  /* "fstlib/cext/pywrapfst.pyx":2609
  *     if new_osymbols is not None:
  *       _new_osymbols = new_osymbols._raw_ptr_or_raise()
  *     fst.Relabel(self._mfst.get(),             # <<<<<<<<<<<<<<
  *         _old_isymbols,
  *         _new_isymbols,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2544, __pyx_L1_error)
+    __PYX_ERR(0, 2609, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2547
+  /* "fstlib/cext/pywrapfst.pyx":2612
  *         _old_isymbols,
  *         _new_isymbols,
  *         tostring(unknown_isymbol),             # <<<<<<<<<<<<<<
  *         attach_new_isymbols,
  *         _old_osymbols,
  */
-  __pyx_t_8 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_unknown_isymbol); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2547, __pyx_L1_error)
+  __pyx_t_8 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_unknown_isymbol); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2612, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2551
+  /* "fstlib/cext/pywrapfst.pyx":2616
  *         _old_osymbols,
  *         _new_osymbols,
  *         tostring(unknown_osymbol),             # <<<<<<<<<<<<<<
  *         attach_new_osymbols)
  *     self._check_mutating_imethod()
  */
-  __pyx_t_9 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_unknown_osymbol); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2551, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_unknown_osymbol); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2616, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2544
+  /* "fstlib/cext/pywrapfst.pyx":2609
  *     if new_osymbols is not None:
  *       _new_osymbols = new_osymbols._raw_ptr_or_raise()
  *     fst.Relabel(self._mfst.get(),             # <<<<<<<<<<<<<<
  *         _old_isymbols,
  *         _new_isymbols,
  */
   fst::script::Relabel(__pyx_v_self->_mfst.get(), __pyx_v__old_isymbols, __pyx_v__new_isymbols, __pyx_t_8, __pyx_v_attach_new_isymbols, __pyx_v__old_osymbols, __pyx_v__new_osymbols, __pyx_t_9, __pyx_v_attach_new_osymbols);
 
-  /* "fstlib/cext/pywrapfst.pyx":2553
+  /* "fstlib/cext/pywrapfst.pyx":2618
  *         tostring(unknown_osymbol),
  *         attach_new_osymbols)
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
  *   def relabel_tables(self,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2553, __pyx_L1_error)
+    __PYX_ERR(0, 2618, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2553, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2618, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2521
+  /* "fstlib/cext/pywrapfst.pyx":2586
  *     return self
  * 
  *   cdef void _relabel_tables(self,             # <<<<<<<<<<<<<<
  *                             SymbolTableView old_isymbols=None,
  *                             SymbolTableView new_isymbols=None,
  */
 
@@ -27766,15 +28115,15 @@
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._relabel_tables", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2555
+/* "fstlib/cext/pywrapfst.pyx":2620
  *     self._check_mutating_imethod()
  * 
  *   def relabel_tables(self,             # <<<<<<<<<<<<<<
  *                      SymbolTableView old_isymbols=None,
  *                      SymbolTableView new_isymbols=None,
  */
 
@@ -27796,51 +28145,51 @@
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("relabel_tables (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_old_isymbols,&__pyx_n_s_new_isymbols,&__pyx_n_s_unknown_isymbol,&__pyx_n_s_attach_new_isymbols,&__pyx_n_s_old_osymbols,&__pyx_n_s_new_osymbols,&__pyx_n_s_unknown_osymbol,&__pyx_n_s_attach_new_osymbols,0};
     PyObject* values[8] = {0,0,0,0,0,0,0,0};
 
-    /* "fstlib/cext/pywrapfst.pyx":2556
+    /* "fstlib/cext/pywrapfst.pyx":2621
  * 
  *   def relabel_tables(self,
  *                      SymbolTableView old_isymbols=None,             # <<<<<<<<<<<<<<
  *                      SymbolTableView new_isymbols=None,
  *                      unknown_isymbol="",
  */
     values[0] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-    /* "fstlib/cext/pywrapfst.pyx":2557
+    /* "fstlib/cext/pywrapfst.pyx":2622
  *   def relabel_tables(self,
  *                      SymbolTableView old_isymbols=None,
  *                      SymbolTableView new_isymbols=None,             # <<<<<<<<<<<<<<
  *                      unknown_isymbol="",
  *                      bool attach_new_isymbols=True,
  */
     values[1] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
-    values[2] = ((PyObject *)__pyx_kp_u__11);
+    values[2] = ((PyObject *)__pyx_kp_u__9);
 
-    /* "fstlib/cext/pywrapfst.pyx":2560
+    /* "fstlib/cext/pywrapfst.pyx":2625
  *                      unknown_isymbol="",
  *                      bool attach_new_isymbols=True,
  *                      SymbolTableView old_osymbols=None,             # <<<<<<<<<<<<<<
  *                      SymbolTableView new_osymbols=None,
  *                      unknown_osymbol="",
  */
     values[4] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
 
-    /* "fstlib/cext/pywrapfst.pyx":2561
+    /* "fstlib/cext/pywrapfst.pyx":2626
  *                      bool attach_new_isymbols=True,
  *                      SymbolTableView old_osymbols=None,
  *                      SymbolTableView new_osymbols=None,             # <<<<<<<<<<<<<<
  *                      unknown_osymbol="",
  *                      bool attach_new_osymbols=True):
  */
     values[5] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)Py_None);
-    values[6] = ((PyObject *)__pyx_kp_u__11);
+    values[6] = ((PyObject *)__pyx_kp_u__9);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
         CYTHON_FALLTHROUGH;
         case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
@@ -27907,15 +28256,15 @@
         case  7:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_attach_new_osymbols);
           if (value) { values[7] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "relabel_tables") < 0)) __PYX_ERR(0, 2555, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "relabel_tables") < 0)) __PYX_ERR(0, 2620, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
         CYTHON_FALLTHROUGH;
         case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
@@ -27935,58 +28284,58 @@
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_old_isymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[0]);
     __pyx_v_new_isymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[1]);
     __pyx_v_unknown_isymbol = values[2];
     if (values[3]) {
-      __pyx_v_attach_new_isymbols = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_attach_new_isymbols == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2559, __pyx_L3_error)
+      __pyx_v_attach_new_isymbols = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_attach_new_isymbols == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2624, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":2559
+      /* "fstlib/cext/pywrapfst.pyx":2624
  *                      SymbolTableView new_isymbols=None,
  *                      unknown_isymbol="",
  *                      bool attach_new_isymbols=True,             # <<<<<<<<<<<<<<
  *                      SymbolTableView old_osymbols=None,
  *                      SymbolTableView new_osymbols=None,
  */
       __pyx_v_attach_new_isymbols = ((bool)1);
     }
     __pyx_v_old_osymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[4]);
     __pyx_v_new_osymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)values[5]);
     __pyx_v_unknown_osymbol = values[6];
     if (values[7]) {
-      __pyx_v_attach_new_osymbols = __Pyx_PyObject_IsTrue(values[7]); if (unlikely((__pyx_v_attach_new_osymbols == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2563, __pyx_L3_error)
+      __pyx_v_attach_new_osymbols = __Pyx_PyObject_IsTrue(values[7]); if (unlikely((__pyx_v_attach_new_osymbols == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2628, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":2563
+      /* "fstlib/cext/pywrapfst.pyx":2628
  *                      SymbolTableView new_osymbols=None,
  *                      unknown_osymbol="",
  *                      bool attach_new_osymbols=True):             # <<<<<<<<<<<<<<
  *     """
  *     relabel_tables(self, old_isymbols=None, new_isymbols=None,
  */
       __pyx_v_attach_new_osymbols = ((bool)1);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("relabel_tables", 0, 0, 8, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2555, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("relabel_tables", 0, 0, 8, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2620, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.relabel_tables", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_old_isymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "old_isymbols", 0))) __PYX_ERR(0, 2556, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_new_isymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "new_isymbols", 0))) __PYX_ERR(0, 2557, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_old_osymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "old_osymbols", 0))) __PYX_ERR(0, 2560, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_new_osymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "new_osymbols", 0))) __PYX_ERR(0, 2561, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_old_isymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "old_isymbols", 0))) __PYX_ERR(0, 2621, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_new_isymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "new_isymbols", 0))) __PYX_ERR(0, 2622, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_old_osymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "old_osymbols", 0))) __PYX_ERR(0, 2625, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_new_osymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "new_osymbols", 0))) __PYX_ERR(0, 2626, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_42relabel_tables(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_old_isymbols, __pyx_v_new_isymbols, __pyx_v_unknown_isymbol, __pyx_v_attach_new_isymbols, __pyx_v_old_osymbols, __pyx_v_new_osymbols, __pyx_v_unknown_osymbol, __pyx_v_attach_new_osymbols);
 
-  /* "fstlib/cext/pywrapfst.pyx":2555
+  /* "fstlib/cext/pywrapfst.pyx":2620
  *     self._check_mutating_imethod()
  * 
  *   def relabel_tables(self,             # <<<<<<<<<<<<<<
  *                      SymbolTableView old_isymbols=None,
  *                      SymbolTableView new_isymbols=None,
  */
 
@@ -28004,27 +28353,27 @@
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_tables __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("relabel_tables", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2597
+  /* "fstlib/cext/pywrapfst.pyx":2662
  *       FstArgError: No SymbolTable specified.
  *     """
  *     self._relabel_tables(old_isymbols,             # <<<<<<<<<<<<<<
  *                          new_isymbols,
  *                          unknown_isymbol,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_relabel_tables");
-    __PYX_ERR(0, 2597, __pyx_L1_error)
+    __PYX_ERR(0, 2662, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2604
+  /* "fstlib/cext/pywrapfst.pyx":2669
  *                          new_osymbols,
  *                          unknown_osymbol,
  *                          attach_new_osymbols)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   __pyx_t_1.__pyx_n = 8;
@@ -28032,29 +28381,29 @@
   __pyx_t_1.new_isymbols = __pyx_v_new_isymbols;
   __pyx_t_1.unknown_isymbol = __pyx_v_unknown_isymbol;
   __pyx_t_1.attach_new_isymbols = __pyx_v_attach_new_isymbols;
   __pyx_t_1.old_osymbols = __pyx_v_old_osymbols;
   __pyx_t_1.new_osymbols = __pyx_v_new_osymbols;
   __pyx_t_1.unknown_osymbol = __pyx_v_unknown_osymbol;
   __pyx_t_1.attach_new_osymbols = __pyx_v_attach_new_osymbols;
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_relabel_tables(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2597, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_relabel_tables(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2662, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2605
+  /* "fstlib/cext/pywrapfst.pyx":2670
  *                          unknown_osymbol,
  *                          attach_new_osymbols)
  *     return self             # <<<<<<<<<<<<<<
  * 
- *   cdef void _reserve_arcs(self, int64 state, size_t n) except *:
+ *   cdef void _reserve_arcs(self, int64_t state, size_t n) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2555
+  /* "fstlib/cext/pywrapfst.pyx":2620
  *     self._check_mutating_imethod()
  * 
  *   def relabel_tables(self,             # <<<<<<<<<<<<<<
  *                      SymbolTableView old_isymbols=None,
  *                      SymbolTableView new_isymbols=None,
  */
 
@@ -28064,101 +28413,101 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2607
+/* "fstlib/cext/pywrapfst.pyx":2672
  *     return self
  * 
- *   cdef void _reserve_arcs(self, int64 state, size_t n) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _reserve_arcs(self, int64_t state, size_t n) except *:             # <<<<<<<<<<<<<<
  *     if not self._mfst.get().ReserveArcs(state, n):
  *       raise FstIndexError("State index out of range")
  */
 
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, size_t __pyx_v_n) {
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, size_t __pyx_v_n) {
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_reserve_arcs", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2608
+  /* "fstlib/cext/pywrapfst.pyx":2673
  * 
- *   cdef void _reserve_arcs(self, int64 state, size_t n) except *:
+ *   cdef void _reserve_arcs(self, int64_t state, size_t n) except *:
  *     if not self._mfst.get().ReserveArcs(state, n):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     self._check_mutating_imethod()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2608, __pyx_L1_error)
+    __PYX_ERR(0, 2673, __pyx_L1_error)
   }
   __pyx_t_1 = ((!(__pyx_v_self->_mfst.get()->ReserveArcs(__pyx_v_state, __pyx_v_n) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2609
- *   cdef void _reserve_arcs(self, int64 state, size_t n) except *:
+    /* "fstlib/cext/pywrapfst.pyx":2674
+ *   cdef void _reserve_arcs(self, int64_t state, size_t n) except *:
  *     if not self._mfst.get().ReserveArcs(state, n):
  *       raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2609, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2674, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_State_index_out_of_range);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2609, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2674, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 2609, __pyx_L1_error)
+    __PYX_ERR(0, 2674, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2608
+    /* "fstlib/cext/pywrapfst.pyx":2673
  * 
- *   cdef void _reserve_arcs(self, int64 state, size_t n) except *:
+ *   cdef void _reserve_arcs(self, int64_t state, size_t n) except *:
  *     if not self._mfst.get().ReserveArcs(state, n):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     self._check_mutating_imethod()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2610
+  /* "fstlib/cext/pywrapfst.pyx":2675
  *     if not self._mfst.get().ReserveArcs(state, n):
  *       raise FstIndexError("State index out of range")
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
- *   def reserve_arcs(self, int64 state, size_t n):
+ *   def reserve_arcs(self, int64_t state, size_t n):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2610, __pyx_L1_error)
+    __PYX_ERR(0, 2675, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2610, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2675, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2607
+  /* "fstlib/cext/pywrapfst.pyx":2672
  *     return self
  * 
- *   cdef void _reserve_arcs(self, int64 state, size_t n) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _reserve_arcs(self, int64_t state, size_t n) except *:             # <<<<<<<<<<<<<<
  *     if not self._mfst.get().ReserveArcs(state, n):
  *       raise FstIndexError("State index out of range")
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
@@ -28166,27 +28515,27 @@
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._reserve_arcs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2612
+/* "fstlib/cext/pywrapfst.pyx":2677
  *     self._check_mutating_imethod()
  * 
- *   def reserve_arcs(self, int64 state, size_t n):             # <<<<<<<<<<<<<<
+ *   def reserve_arcs(self, int64_t state, size_t n):             # <<<<<<<<<<<<<<
  *     """
  *     reserve_arcs(self, state, n)
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_45reserve_arcs(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_44reserve_arcs[] = "\n    reserve_arcs(self, state, n)\n\n    Reserve n arcs at a particular state (best effort).\n\n    Args:\n      state: The integer index of a state.\n      n: The number of arcs to reserve.\n\n    Returns:\n      self.\n\n    Raises:\n      FstIndexError: State index out of range.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_45reserve_arcs(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   size_t __pyx_v_n;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("reserve_arcs (wrapper)", 0);
@@ -28209,371 +28558,391 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_state)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("reserve_arcs", 1, 2, 2, 1); __PYX_ERR(0, 2612, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("reserve_arcs", 1, 2, 2, 1); __PYX_ERR(0, 2677, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "reserve_arcs") < 0)) __PYX_ERR(0, 2612, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "reserve_arcs") < 0)) __PYX_ERR(0, 2677, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[0]); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2612, __pyx_L3_error)
-    __pyx_v_n = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_n == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 2612, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[0]); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2677, __pyx_L3_error)
+    __pyx_v_n = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_n == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 2677, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("reserve_arcs", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2612, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("reserve_arcs", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2677, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.reserve_arcs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_44reserve_arcs(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_state, __pyx_v_n);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_44reserve_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, size_t __pyx_v_n) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_44reserve_arcs(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, size_t __pyx_v_n) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("reserve_arcs", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2628
+  /* "fstlib/cext/pywrapfst.pyx":2693
  *       FstIndexError: State index out of range.
  *     """
  *     self._reserve_arcs(state, n)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reserve_arcs");
-    __PYX_ERR(0, 2628, __pyx_L1_error)
+    __PYX_ERR(0, 2693, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_reserve_arcs(__pyx_v_self, __pyx_v_state, __pyx_v_n); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2628, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_reserve_arcs(__pyx_v_self, __pyx_v_state, __pyx_v_n); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2693, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2629
+  /* "fstlib/cext/pywrapfst.pyx":2694
  *     """
  *     self._reserve_arcs(state, n)
  *     return self             # <<<<<<<<<<<<<<
  * 
- *   cdef void _reserve_states(self, int64 n):
+ *   cdef void _reserve_states(self, int64_t n):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2612
+  /* "fstlib/cext/pywrapfst.pyx":2677
  *     self._check_mutating_imethod()
  * 
- *   def reserve_arcs(self, int64 state, size_t n):             # <<<<<<<<<<<<<<
+ *   def reserve_arcs(self, int64_t state, size_t n):             # <<<<<<<<<<<<<<
  *     """
  *     reserve_arcs(self, state, n)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.reserve_arcs", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2631
+/* "fstlib/cext/pywrapfst.pyx":2696
  *     return self
  * 
- *   cdef void _reserve_states(self, int64 n):             # <<<<<<<<<<<<<<
+ *   cdef void _reserve_states(self, int64_t n):             # <<<<<<<<<<<<<<
  *     self._mfst.get().ReserveStates(n)
  * 
  */
 
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_n) {
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_n) {
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_reserve_states", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2632
+  /* "fstlib/cext/pywrapfst.pyx":2697
  * 
- *   cdef void _reserve_states(self, int64 n):
+ *   cdef void _reserve_states(self, int64_t n):
  *     self._mfst.get().ReserveStates(n)             # <<<<<<<<<<<<<<
  * 
- *   def reserve_states(self, int64 n):
+ *   def reserve_states(self, int64_t n):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2632, __pyx_L1_error)
+    __PYX_ERR(0, 2697, __pyx_L1_error)
   }
   __pyx_v_self->_mfst.get()->ReserveStates(__pyx_v_n);
 
-  /* "fstlib/cext/pywrapfst.pyx":2631
+  /* "fstlib/cext/pywrapfst.pyx":2696
  *     return self
  * 
- *   cdef void _reserve_states(self, int64 n):             # <<<<<<<<<<<<<<
+ *   cdef void _reserve_states(self, int64_t n):             # <<<<<<<<<<<<<<
  *     self._mfst.get().ReserveStates(n)
  * 
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst.MutableFst._reserve_states", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2634
+/* "fstlib/cext/pywrapfst.pyx":2699
  *     self._mfst.get().ReserveStates(n)
  * 
- *   def reserve_states(self, int64 n):             # <<<<<<<<<<<<<<
+ *   def reserve_states(self, int64_t n):             # <<<<<<<<<<<<<<
  *     """
  *     reserve_states(self, n)
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_47reserve_states(PyObject *__pyx_v_self, PyObject *__pyx_arg_n); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_46reserve_states[] = "\n    reserve_states(self, n)\n\n    Reserve n states (best effort).\n\n    Args:\n      n: The number of states to reserve.\n\n    Returns:\n      self.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_47reserve_states(PyObject *__pyx_v_self, PyObject *__pyx_arg_n) {
-  int64 __pyx_v_n;
+  int64_t __pyx_v_n;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("reserve_states (wrapper)", 0);
   assert(__pyx_arg_n); {
-    __pyx_v_n = __Pyx_PyInt_As_int64_t(__pyx_arg_n); if (unlikely((__pyx_v_n == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2634, __pyx_L3_error)
+    __pyx_v_n = __Pyx_PyInt_As_int64_t(__pyx_arg_n); if (unlikely((__pyx_v_n == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2699, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.reserve_states", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_46reserve_states(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), ((int64)__pyx_v_n));
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_46reserve_states(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), ((int64_t)__pyx_v_n));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_46reserve_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_n) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_46reserve_states(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_n) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("reserve_states", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2646
+  /* "fstlib/cext/pywrapfst.pyx":2711
  *       self.
  *     """
  *     self._reserve_states(n)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reserve_states");
-    __PYX_ERR(0, 2646, __pyx_L1_error)
+    __PYX_ERR(0, 2711, __pyx_L1_error)
   }
   ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_reserve_states(__pyx_v_self, __pyx_v_n);
 
-  /* "fstlib/cext/pywrapfst.pyx":2647
+  /* "fstlib/cext/pywrapfst.pyx":2712
  *     """
  *     self._reserve_states(n)
  *     return self             # <<<<<<<<<<<<<<
  * 
- *   cdef void _reweight(self, potentials, bool to_final=False) except *:
+ *   cdef void _reweight(self, potentials, reweight_type="to_initial") except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2634
+  /* "fstlib/cext/pywrapfst.pyx":2699
  *     self._mfst.get().ReserveStates(n)
  * 
- *   def reserve_states(self, int64 n):             # <<<<<<<<<<<<<<
+ *   def reserve_states(self, int64_t n):             # <<<<<<<<<<<<<<
  *     """
  *     reserve_states(self, n)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.reserve_states", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2649
+/* "fstlib/cext/pywrapfst.pyx":2714
  *     return self
  * 
- *   cdef void _reweight(self, potentials, bool to_final=False) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _reweight(self, potentials, reweight_type="to_initial") except *:             # <<<<<<<<<<<<<<
  *     cdef string _weight_type = self.weight_type()
  *     cdef vector[fst.WeightClass] _potentials
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reweight(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_potentials, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__reweight *__pyx_optional_args) {
-  bool __pyx_v_to_final = ((bool)0);
+  PyObject *__pyx_v_reweight_type = ((PyObject *)__pyx_n_u_to_initial);
   std::string __pyx_v__weight_type;
   std::vector<fst::script::WeightClass>  __pyx_v__potentials;
   PyObject *__pyx_v_weight = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   Py_ssize_t __pyx_t_2;
   PyObject *(*__pyx_t_3)(PyObject *);
   PyObject *__pyx_t_4 = NULL;
   fst::script::WeightClass __pyx_t_5;
+  std::string __pyx_t_6;
+  enum fst::ReweightType __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_reweight", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
-      __pyx_v_to_final = __pyx_optional_args->to_final;
+      __pyx_v_reweight_type = __pyx_optional_args->reweight_type;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2650
+  /* "fstlib/cext/pywrapfst.pyx":2715
  * 
- *   cdef void _reweight(self, potentials, bool to_final=False) except *:
+ *   cdef void _reweight(self, potentials, reweight_type="to_initial") except *:
  *     cdef string _weight_type = self.weight_type()             # <<<<<<<<<<<<<<
  *     cdef vector[fst.WeightClass] _potentials
  *     for weight in potentials:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "weight_type");
-    __PYX_ERR(0, 2650, __pyx_L1_error)
+    __PYX_ERR(0, 2715, __pyx_L1_error)
   }
   __pyx_v__weight_type = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.weight_type(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2652
+  /* "fstlib/cext/pywrapfst.pyx":2717
  *     cdef string _weight_type = self.weight_type()
  *     cdef vector[fst.WeightClass] _potentials
  *     for weight in potentials:             # <<<<<<<<<<<<<<
  *       _potentials.push_back(_get_WeightClass_or_one(_weight_type, weight))
- *     fst.Reweight(self._mfst.get(), _potentials, fst.GetReweightType(to_final))
+ *     fst.Reweight(self._mfst.get(), _potentials,
  */
   if (likely(PyList_CheckExact(__pyx_v_potentials)) || PyTuple_CheckExact(__pyx_v_potentials)) {
     __pyx_t_1 = __pyx_v_potentials; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
     __pyx_t_3 = NULL;
   } else {
-    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_potentials); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2652, __pyx_L1_error)
+    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_potentials); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2717, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2652, __pyx_L1_error)
+    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2717, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_3)) {
       if (likely(PyList_CheckExact(__pyx_t_1))) {
         if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 2652, __pyx_L1_error)
+        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 2717, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2652, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2717, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       } else {
         if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 2652, __pyx_L1_error)
+        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 2717, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2652, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2717, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       }
     } else {
       __pyx_t_4 = __pyx_t_3(__pyx_t_1);
       if (unlikely(!__pyx_t_4)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 2652, __pyx_L1_error)
+          else __PYX_ERR(0, 2717, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_4);
     }
     __Pyx_XDECREF_SET(__pyx_v_weight, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "fstlib/cext/pywrapfst.pyx":2653
+    /* "fstlib/cext/pywrapfst.pyx":2718
  *     cdef vector[fst.WeightClass] _potentials
  *     for weight in potentials:
  *       _potentials.push_back(_get_WeightClass_or_one(_weight_type, weight))             # <<<<<<<<<<<<<<
- *     fst.Reweight(self._mfst.get(), _potentials, fst.GetReweightType(to_final))
- *     self._check_mutating_imethod()
+ *     fst.Reweight(self._mfst.get(), _potentials,
+ *                  _get_reweight_type(tostring(reweight_type)))
  */
-    __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_one(__pyx_v__weight_type, __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2653, __pyx_L1_error)
+    __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_one(__pyx_v__weight_type, __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2718, __pyx_L1_error)
     try {
       __pyx_v__potentials.push_back(__pyx_t_5);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 2653, __pyx_L1_error)
+      __PYX_ERR(0, 2718, __pyx_L1_error)
     }
 
-    /* "fstlib/cext/pywrapfst.pyx":2652
+    /* "fstlib/cext/pywrapfst.pyx":2717
  *     cdef string _weight_type = self.weight_type()
  *     cdef vector[fst.WeightClass] _potentials
  *     for weight in potentials:             # <<<<<<<<<<<<<<
  *       _potentials.push_back(_get_WeightClass_or_one(_weight_type, weight))
- *     fst.Reweight(self._mfst.get(), _potentials, fst.GetReweightType(to_final))
+ *     fst.Reweight(self._mfst.get(), _potentials,
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2654
+  /* "fstlib/cext/pywrapfst.pyx":2719
  *     for weight in potentials:
  *       _potentials.push_back(_get_WeightClass_or_one(_weight_type, weight))
- *     fst.Reweight(self._mfst.get(), _potentials, fst.GetReweightType(to_final))             # <<<<<<<<<<<<<<
+ *     fst.Reweight(self._mfst.get(), _potentials,             # <<<<<<<<<<<<<<
+ *                  _get_reweight_type(tostring(reweight_type)))
  *     self._check_mutating_imethod()
- * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2654, __pyx_L1_error)
+    __PYX_ERR(0, 2719, __pyx_L1_error)
   }
-  fst::script::Reweight(__pyx_v_self->_mfst.get(), __pyx_v__potentials, fst::script::GetReweightType(__pyx_v_to_final));
 
-  /* "fstlib/cext/pywrapfst.pyx":2655
+  /* "fstlib/cext/pywrapfst.pyx":2720
  *       _potentials.push_back(_get_WeightClass_or_one(_weight_type, weight))
- *     fst.Reweight(self._mfst.get(), _potentials, fst.GetReweightType(to_final))
+ *     fst.Reweight(self._mfst.get(), _potentials,
+ *                  _get_reweight_type(tostring(reweight_type)))             # <<<<<<<<<<<<<<
+ *     self._check_mutating_imethod()
+ * 
+ */
+  __pyx_t_6 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_reweight_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2720, __pyx_L1_error)
+  __pyx_t_7 = __pyx_f_6fstlib_4cext_9pywrapfst__get_reweight_type(__pyx_t_6); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2720, __pyx_L1_error)
+
+  /* "fstlib/cext/pywrapfst.pyx":2719
+ *     for weight in potentials:
+ *       _potentials.push_back(_get_WeightClass_or_one(_weight_type, weight))
+ *     fst.Reweight(self._mfst.get(), _potentials,             # <<<<<<<<<<<<<<
+ *                  _get_reweight_type(tostring(reweight_type)))
+ *     self._check_mutating_imethod()
+ */
+  fst::script::Reweight(__pyx_v_self->_mfst.get(), __pyx_v__potentials, __pyx_t_7);
+
+  /* "fstlib/cext/pywrapfst.pyx":2721
+ *     fst.Reweight(self._mfst.get(), _potentials,
+ *                  _get_reweight_type(tostring(reweight_type)))
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
- *   def reweight(self, potentials, bool to_final=False):
+ *   def reweight(self, potentials, reweight_type="to_initial"):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2655, __pyx_L1_error)
+    __PYX_ERR(0, 2721, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2655, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2721, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2649
+  /* "fstlib/cext/pywrapfst.pyx":2714
  *     return self
  * 
- *   cdef void _reweight(self, potentials, bool to_final=False) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _reweight(self, potentials, reweight_type="to_initial") except *:             # <<<<<<<<<<<<<<
  *     cdef string _weight_type = self.weight_type()
  *     cdef vector[fst.WeightClass] _potentials
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
@@ -28581,37 +28950,38 @@
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._reweight", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_weight);
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2657
+/* "fstlib/cext/pywrapfst.pyx":2723
  *     self._check_mutating_imethod()
  * 
- *   def reweight(self, potentials, bool to_final=False):             # <<<<<<<<<<<<<<
+ *   def reweight(self, potentials, reweight_type="to_initial"):             # <<<<<<<<<<<<<<
  *     """
- *     reweight(self, potentials, to_final=False)
+ *     reweight(self, potentials, reweight_type="to_initial")
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_49reweight(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_48reweight[] = "\n    reweight(self, potentials, to_final=False)\n\n    Reweights an FST using an iterable of potentials.\n\n    This operation destructively reweights an FST according to the potentials\n    and in the direction specified by the user. An arc of weight w, with an\n    origin state of potential p and destination state of potential q, is\n    reweighted by p^{-1} \\otimes (w \\otimes q) when reweighting towards the\n    initial state, and by (p \\otimes w) \\otimes q^{-1} when reweighting towards\n    the final states. The weights must be left distributive when reweighting\n    towards the initial state and right distributive when reweighting towards\n    the final states (e.g., TropicalWeight and LogWeight).\n\n    Args:\n      potentials: An iterable of Weight or weight strings.\n      to_final: Push towards final states?\n\n    Returns:\n      self.\n    ";
+static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_48reweight[] = "\n    reweight(self, potentials, reweight_type=\"to_initial\")\n\n    Reweights an FST using an iterable of potentials.\n\n    This operation destructively reweights an FST according to the potentials\n    and in the direction specified by the user. An arc of weight w, with an\n    origin state of potential p and destination state of potential q, is\n    reweighted by p^{-1} \\otimes (w \\otimes q) when reweighting towards the\n    initial state, and by (p \\otimes w) \\otimes q^{-1} when reweighting towards\n    the final states. The weights must be left distributive when reweighting\n    towards the initial state and right distributive when reweighting towards\n    the final states (e.g., TropicalWeight and LogWeight).\n\n    Args:\n      potentials: An iterable of Weight or weight strings.\n      reweight_type: Push towards initial or final states: a string matching a\n          known reweight type: one of \"to_initial\", \"to_final\"\n\n    Returns:\n      self.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_49reweight(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_potentials = 0;
-  bool __pyx_v_to_final;
+  PyObject *__pyx_v_reweight_type = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("reweight (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_potentials,&__pyx_n_s_to_final,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_potentials,&__pyx_n_s_reweight_type,0};
     PyObject* values[2] = {0,0};
+    values[1] = ((PyObject *)__pyx_n_u_to_initial);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
@@ -28623,136 +28993,132 @@
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_potentials)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_final);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_reweight_type);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "reweight") < 0)) __PYX_ERR(0, 2657, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "reweight") < 0)) __PYX_ERR(0, 2723, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_potentials = values[0];
-    if (values[1]) {
-      __pyx_v_to_final = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_to_final == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2657, __pyx_L3_error)
-    } else {
-      __pyx_v_to_final = ((bool)0);
-    }
+    __pyx_v_reweight_type = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("reweight", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2657, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("reweight", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2723, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.reweight", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_48reweight(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_potentials, __pyx_v_to_final);
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_48reweight(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_potentials, __pyx_v_reweight_type);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_48reweight(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_potentials, bool __pyx_v_to_final) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_48reweight(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_potentials, PyObject *__pyx_v_reweight_type) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__reweight __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("reweight", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2679
+  /* "fstlib/cext/pywrapfst.pyx":2746
  *       self.
  *     """
- *     self._reweight(potentials, to_final)             # <<<<<<<<<<<<<<
+ *     self._reweight(potentials, reweight_type)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reweight");
-    __PYX_ERR(0, 2679, __pyx_L1_error)
+    __PYX_ERR(0, 2746, __pyx_L1_error)
   }
   __pyx_t_1.__pyx_n = 1;
-  __pyx_t_1.to_final = __pyx_v_to_final;
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_reweight(__pyx_v_self, __pyx_v_potentials, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2679, __pyx_L1_error)
+  __pyx_t_1.reweight_type = __pyx_v_reweight_type;
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_reweight(__pyx_v_self, __pyx_v_potentials, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2746, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2680
+  /* "fstlib/cext/pywrapfst.pyx":2747
  *     """
- *     self._reweight(potentials, to_final)
+ *     self._reweight(potentials, reweight_type)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _rmepsilon(self,
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2657
+  /* "fstlib/cext/pywrapfst.pyx":2723
  *     self._check_mutating_imethod()
  * 
- *   def reweight(self, potentials, bool to_final=False):             # <<<<<<<<<<<<<<
+ *   def reweight(self, potentials, reweight_type="to_initial"):             # <<<<<<<<<<<<<<
  *     """
- *     reweight(self, potentials, to_final=False)
+ *     reweight(self, potentials, reweight_type="to_initial")
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.reweight", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2682
+/* "fstlib/cext/pywrapfst.pyx":2749
  *     return self
  * 
  *   cdef void _rmepsilon(self,             # <<<<<<<<<<<<<<
  *                        queue_type="auto",
  *                        bool connect=True,
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__rmepsilon(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__rmepsilon *__pyx_optional_args) {
   PyObject *__pyx_v_queue_type = ((PyObject *)__pyx_n_u_auto);
 
-  /* "fstlib/cext/pywrapfst.pyx":2684
+  /* "fstlib/cext/pywrapfst.pyx":2751
  *   cdef void _rmepsilon(self,
  *                        queue_type="auto",
  *                        bool connect=True,             # <<<<<<<<<<<<<<
  *                        weight=None,
- *                        int64 nstate=fst.kNoStateId,
+ *                        int64_t nstate=fst.kNoStateId,
  */
   bool __pyx_v_connect = ((bool)1);
 
-  /* "fstlib/cext/pywrapfst.pyx":2685
+  /* "fstlib/cext/pywrapfst.pyx":2752
  *                        queue_type="auto",
  *                        bool connect=True,
  *                        weight=None,             # <<<<<<<<<<<<<<
- *                        int64 nstate=fst.kNoStateId,
+ *                        int64_t nstate=fst.kNoStateId,
  *                        float delta=fst.kShortestDelta) except *:
  */
   PyObject *__pyx_v_weight = ((PyObject *)Py_None);
-  int64 __pyx_v_nstate = __pyx_k__20;
-  float __pyx_v_delta = __pyx_k__21;
+  int64_t __pyx_v_nstate = __pyx_k__18;
+  float __pyx_v_delta = __pyx_k__19;
   fst::script::WeightClass __pyx_v__weight;
   std::unique_ptr<fst::script::RmEpsilonOptions>  __pyx_v__opts;
   __Pyx_RefNannyDeclarations
   fst::script::WeightClass __pyx_t_1;
   std::string __pyx_t_2;
   enum fst::QueueType __pyx_t_3;
   int __pyx_lineno = 0;
@@ -28773,82 +29139,82 @@
             }
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2688
- *                        int64 nstate=fst.kNoStateId,
+  /* "fstlib/cext/pywrapfst.pyx":2755
+ *                        int64_t nstate=fst.kNoStateId,
  *                        float delta=fst.kShortestDelta) except *:
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_zero(self.weight_type(),             # <<<<<<<<<<<<<<
  *                                                             weight)
  *     cdef unique_ptr[fst.RmEpsilonOptions] _opts
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "weight_type");
-    __PYX_ERR(0, 2688, __pyx_L1_error)
+    __PYX_ERR(0, 2755, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2689
+  /* "fstlib/cext/pywrapfst.pyx":2756
  *                        float delta=fst.kShortestDelta) except *:
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_zero(self.weight_type(),
  *                                                             weight)             # <<<<<<<<<<<<<<
  *     cdef unique_ptr[fst.RmEpsilonOptions] _opts
  *     _opts.reset(
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.weight_type(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2688, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.weight_type(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2755, __pyx_L1_error)
   __pyx_v__weight = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":2692
+  /* "fstlib/cext/pywrapfst.pyx":2759
  *     cdef unique_ptr[fst.RmEpsilonOptions] _opts
  *     _opts.reset(
  *         new fst.RmEpsilonOptions(_get_queue_type(tostring(queue_type)),             # <<<<<<<<<<<<<<
  *                                  connect,
  *                                  _weight,
  */
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_queue_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2692, __pyx_L1_error)
-  __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst__get_queue_type(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2692, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_queue_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2759, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst__get_queue_type(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2759, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2691
+  /* "fstlib/cext/pywrapfst.pyx":2758
  *                                                             weight)
  *     cdef unique_ptr[fst.RmEpsilonOptions] _opts
  *     _opts.reset(             # <<<<<<<<<<<<<<
  *         new fst.RmEpsilonOptions(_get_queue_type(tostring(queue_type)),
  *                                  connect,
  */
   __pyx_v__opts.reset(new fst::script::RmEpsilonOptions(__pyx_t_3, __pyx_v_connect, __pyx_v__weight, __pyx_v_nstate, __pyx_v_delta));
 
-  /* "fstlib/cext/pywrapfst.pyx":2697
+  /* "fstlib/cext/pywrapfst.pyx":2764
  *                                  nstate,
  *                                  delta))
  *     fst.RmEpsilon(self._mfst.get(), deref(_opts))             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2697, __pyx_L1_error)
+    __PYX_ERR(0, 2764, __pyx_L1_error)
   }
   fst::script::RmEpsilon(__pyx_v_self->_mfst.get(), (*__pyx_v__opts));
 
-  /* "fstlib/cext/pywrapfst.pyx":2698
+  /* "fstlib/cext/pywrapfst.pyx":2765
  *                                  delta))
  *     fst.RmEpsilon(self._mfst.get(), deref(_opts))
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
  *   def rmepsilon(self,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2698, __pyx_L1_error)
+    __PYX_ERR(0, 2765, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2698, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2765, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2682
+  /* "fstlib/cext/pywrapfst.pyx":2749
  *     return self
  * 
  *   cdef void _rmepsilon(self,             # <<<<<<<<<<<<<<
  *                        queue_type="auto",
  *                        bool connect=True,
  */
 
@@ -28856,47 +29222,47 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._rmepsilon", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2700
+/* "fstlib/cext/pywrapfst.pyx":2767
  *     self._check_mutating_imethod()
  * 
  *   def rmepsilon(self,             # <<<<<<<<<<<<<<
  *                 queue_type="auto",
  *                 bool connect=True,
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_51rmepsilon(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_50rmepsilon[] = "\n    rmepsilon(self, queue_type=\"auto\", connect=True, weight=None,\n              nstate=NO_STATE_ID, delta=1e-6):\n\n    Removes epsilon transitions.\n\n    This operation destructively removes epsilon transitions, i.e., those where\n    both input and output labels are epsilon) from an FST.\n\n    Args:\n      queue_type: A string matching a known queue type; one of: \"auto\", \"fifo\",\n          \"lifo\", \"shortest\", \"state\", \"top\".\n      connect: Should output be trimmed?\n      weight: A Weight or weight string indicating the desired weight threshold\n          below which paths are pruned; if omitted, no paths are pruned.\n      nstate: State number threshold.\n      delta: Comparison/quantization delta.\n\n    Returns:\n      self.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_51rmepsilon(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_queue_type = 0;
   bool __pyx_v_connect;
   PyObject *__pyx_v_weight = 0;
-  int64 __pyx_v_nstate;
+  int64_t __pyx_v_nstate;
   float __pyx_v_delta;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("rmepsilon (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_queue_type,&__pyx_n_s_connect,&__pyx_n_s_weight,&__pyx_n_s_nstate,&__pyx_n_s_delta,0};
     PyObject* values[5] = {0,0,0,0,0};
     values[0] = ((PyObject *)__pyx_n_u_auto);
 
-    /* "fstlib/cext/pywrapfst.pyx":2703
+    /* "fstlib/cext/pywrapfst.pyx":2770
  *                 queue_type="auto",
  *                 bool connect=True,
  *                 weight=None,             # <<<<<<<<<<<<<<
- *                 int64 nstate=fst.kNoStateId,
+ *                 int64_t nstate=fst.kNoStateId,
  *                 float delta=fst.kShortestDelta):
  */
     values[2] = ((PyObject *)Py_None);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
@@ -28942,15 +29308,15 @@
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_delta);
           if (value) { values[4] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "rmepsilon") < 0)) __PYX_ERR(0, 2700, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "rmepsilon") < 0)) __PYX_ERR(0, 2767, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
@@ -28962,102 +29328,102 @@
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_queue_type = values[0];
     if (values[1]) {
-      __pyx_v_connect = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_connect == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2702, __pyx_L3_error)
+      __pyx_v_connect = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_connect == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2769, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":2702
+      /* "fstlib/cext/pywrapfst.pyx":2769
  *   def rmepsilon(self,
  *                 queue_type="auto",
  *                 bool connect=True,             # <<<<<<<<<<<<<<
  *                 weight=None,
- *                 int64 nstate=fst.kNoStateId,
+ *                 int64_t nstate=fst.kNoStateId,
  */
       __pyx_v_connect = ((bool)1);
     }
     __pyx_v_weight = values[2];
     if (values[3]) {
-      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[3]); if (unlikely((__pyx_v_nstate == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2704, __pyx_L3_error)
+      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[3]); if (unlikely((__pyx_v_nstate == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2771, __pyx_L3_error)
     } else {
-      __pyx_v_nstate = __pyx_k__22;
+      __pyx_v_nstate = __pyx_k__20;
     }
     if (values[4]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[4]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 2705, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[4]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 2772, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__23;
+      __pyx_v_delta = __pyx_k__21;
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("rmepsilon", 0, 0, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2700, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("rmepsilon", 0, 0, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2767, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.rmepsilon", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_50rmepsilon(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_queue_type, __pyx_v_connect, __pyx_v_weight, __pyx_v_nstate, __pyx_v_delta);
 
-  /* "fstlib/cext/pywrapfst.pyx":2700
+  /* "fstlib/cext/pywrapfst.pyx":2767
  *     self._check_mutating_imethod()
  * 
  *   def rmepsilon(self,             # <<<<<<<<<<<<<<
  *                 queue_type="auto",
  *                 bool connect=True,
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_50rmepsilon(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_queue_type, bool __pyx_v_connect, PyObject *__pyx_v_weight, int64 __pyx_v_nstate, float __pyx_v_delta) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_50rmepsilon(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_queue_type, bool __pyx_v_connect, PyObject *__pyx_v_weight, int64_t __pyx_v_nstate, float __pyx_v_delta) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__rmepsilon __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("rmepsilon", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2727
+  /* "fstlib/cext/pywrapfst.pyx":2794
  *       self.
  *     """
  *     self._rmepsilon(queue_type, connect, weight, nstate, delta)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_rmepsilon");
-    __PYX_ERR(0, 2727, __pyx_L1_error)
+    __PYX_ERR(0, 2794, __pyx_L1_error)
   }
   __pyx_t_1.__pyx_n = 5;
   __pyx_t_1.queue_type = __pyx_v_queue_type;
   __pyx_t_1.connect = __pyx_v_connect;
   __pyx_t_1.weight = __pyx_v_weight;
   __pyx_t_1.nstate = __pyx_v_nstate;
   __pyx_t_1.delta = __pyx_v_delta;
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_rmepsilon(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2727, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_rmepsilon(__pyx_v_self, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2794, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2728
+  /* "fstlib/cext/pywrapfst.pyx":2795
  *     """
  *     self._rmepsilon(queue_type, connect, weight, nstate, delta)
  *     return self             # <<<<<<<<<<<<<<
  * 
- *   cdef void _set_final(self, int64 state, weight=None) except *:
+ *   cdef void _set_final(self, int64_t state, weight=None) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2700
+  /* "fstlib/cext/pywrapfst.pyx":2767
  *     self._check_mutating_imethod()
  * 
  *   def rmepsilon(self,             # <<<<<<<<<<<<<<
  *                 queue_type="auto",
  *                 bool connect=True,
  */
 
@@ -29067,23 +29433,23 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2730
+/* "fstlib/cext/pywrapfst.pyx":2797
  *     return self
  * 
- *   cdef void _set_final(self, int64 state, weight=None) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _set_final(self, int64_t state, weight=None) except *:             # <<<<<<<<<<<<<<
  *     if not self._mfst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")
  */
 
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final *__pyx_optional_args) {
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final *__pyx_optional_args) {
   PyObject *__pyx_v_weight = ((PyObject *)Py_None);
   fst::script::WeightClass __pyx_v__weight;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
@@ -29094,155 +29460,155 @@
   __Pyx_RefNannySetupContext("_set_final", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_weight = __pyx_optional_args->weight;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2731
+  /* "fstlib/cext/pywrapfst.pyx":2798
  * 
- *   cdef void _set_final(self, int64 state, weight=None) except *:
+ *   cdef void _set_final(self, int64_t state, weight=None) except *:
  *     if not self._mfst.get().ValidStateId(state):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_one(self.weight_type(),
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2731, __pyx_L1_error)
+    __PYX_ERR(0, 2798, __pyx_L1_error)
   }
   __pyx_t_1 = ((!(__pyx_v_self->_mfst.get()->ValidStateId(__pyx_v_state) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2732
- *   cdef void _set_final(self, int64 state, weight=None) except *:
+    /* "fstlib/cext/pywrapfst.pyx":2799
+ *   cdef void _set_final(self, int64_t state, weight=None) except *:
  *     if not self._mfst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_one(self.weight_type(),
  *                                                           weight)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2732, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2799, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_State_index_out_of_range);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2732, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2799, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 2732, __pyx_L1_error)
+    __PYX_ERR(0, 2799, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2731
+    /* "fstlib/cext/pywrapfst.pyx":2798
  * 
- *   cdef void _set_final(self, int64 state, weight=None) except *:
+ *   cdef void _set_final(self, int64_t state, weight=None) except *:
  *     if not self._mfst.get().ValidStateId(state):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_one(self.weight_type(),
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2733
+  /* "fstlib/cext/pywrapfst.pyx":2800
  *     if not self._mfst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_one(self.weight_type(),             # <<<<<<<<<<<<<<
  *                                                           weight)
  *     if not self._mfst.get().SetFinal(state, _weight):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "weight_type");
-    __PYX_ERR(0, 2733, __pyx_L1_error)
+    __PYX_ERR(0, 2800, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2734
+  /* "fstlib/cext/pywrapfst.pyx":2801
  *       raise FstIndexError("State index out of range")
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_one(self.weight_type(),
  *                                                           weight)             # <<<<<<<<<<<<<<
  *     if not self._mfst.get().SetFinal(state, _weight):
  *       raise FstOpError("Incompatible or invalid weight")
  */
-  __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_one(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.weight_type(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2733, __pyx_L1_error)
+  __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_one(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->__pyx_base.weight_type(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_self), 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2800, __pyx_L1_error)
   __pyx_v__weight = __pyx_t_5;
 
-  /* "fstlib/cext/pywrapfst.pyx":2735
+  /* "fstlib/cext/pywrapfst.pyx":2802
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_one(self.weight_type(),
  *                                                           weight)
  *     if not self._mfst.get().SetFinal(state, _weight):             # <<<<<<<<<<<<<<
  *       raise FstOpError("Incompatible or invalid weight")
  *     self._check_mutating_imethod()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2735, __pyx_L1_error)
+    __PYX_ERR(0, 2802, __pyx_L1_error)
   }
   __pyx_t_1 = ((!(__pyx_v_self->_mfst.get()->SetFinal(__pyx_v_state, __pyx_v__weight) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2736
+    /* "fstlib/cext/pywrapfst.pyx":2803
  *                                                           weight)
  *     if not self._mfst.get().SetFinal(state, _weight):
  *       raise FstOpError("Incompatible or invalid weight")             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2736, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2803, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Incompatible_or_invalid_weight) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Incompatible_or_invalid_weight);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2736, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2803, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 2736, __pyx_L1_error)
+    __PYX_ERR(0, 2803, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2735
+    /* "fstlib/cext/pywrapfst.pyx":2802
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_one(self.weight_type(),
  *                                                           weight)
  *     if not self._mfst.get().SetFinal(state, _weight):             # <<<<<<<<<<<<<<
  *       raise FstOpError("Incompatible or invalid weight")
  *     self._check_mutating_imethod()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2737
+  /* "fstlib/cext/pywrapfst.pyx":2804
  *     if not self._mfst.get().SetFinal(state, _weight):
  *       raise FstOpError("Incompatible or invalid weight")
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  * 
- *   def set_final(self, int64 state, weight=None):
+ *   def set_final(self, int64_t state, weight=None):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2737, __pyx_L1_error)
+    __PYX_ERR(0, 2804, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2737, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2804, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2730
+  /* "fstlib/cext/pywrapfst.pyx":2797
  *     return self
  * 
- *   cdef void _set_final(self, int64 state, weight=None) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _set_final(self, int64_t state, weight=None) except *:             # <<<<<<<<<<<<<<
  *     if not self._mfst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
@@ -29250,27 +29616,27 @@
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._set_final", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2739
+/* "fstlib/cext/pywrapfst.pyx":2806
  *     self._check_mutating_imethod()
  * 
- *   def set_final(self, int64 state, weight=None):             # <<<<<<<<<<<<<<
+ *   def set_final(self, int64_t state, weight=None):             # <<<<<<<<<<<<<<
  *     """
  *     set_final(self, state, weight)
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_53set_final(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_52set_final[] = "\n    set_final(self, state, weight)\n\n    Sets the final weight for a state.\n\n    Args:\n      state: The integer index of a state.\n      weight: A Weight or weight string indicating the desired final weight; if\n          omitted, it is set to semiring One.\n\n    Returns:\n      self.\n\n    Raises:\n      FstIndexError: State index out of range.\n      FstOpError: Incompatible or invalid weight.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_53set_final(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   PyObject *__pyx_v_weight = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_final (wrapper)", 0);
@@ -29298,98 +29664,98 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weight);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_final") < 0)) __PYX_ERR(0, 2739, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_final") < 0)) __PYX_ERR(0, 2806, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[0]); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2739, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[0]); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2806, __pyx_L3_error)
     __pyx_v_weight = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("set_final", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2739, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("set_final", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2806, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.set_final", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_52set_final(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_state, __pyx_v_weight);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_52set_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state, PyObject *__pyx_v_weight) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_52set_final(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state, PyObject *__pyx_v_weight) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_final", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2757
+  /* "fstlib/cext/pywrapfst.pyx":2824
  *       FstOpError: Incompatible or invalid weight.
  *     """
  *     self._set_final(state, weight)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_set_final");
-    __PYX_ERR(0, 2757, __pyx_L1_error)
+    __PYX_ERR(0, 2824, __pyx_L1_error)
   }
   __pyx_t_1.__pyx_n = 1;
   __pyx_t_1.weight = __pyx_v_weight;
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_set_final(__pyx_v_self, __pyx_v_state, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2757, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_set_final(__pyx_v_self, __pyx_v_state, &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2824, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2758
+  /* "fstlib/cext/pywrapfst.pyx":2825
  *     """
  *     self._set_final(state, weight)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2739
+  /* "fstlib/cext/pywrapfst.pyx":2806
  *     self._check_mutating_imethod()
  * 
- *   def set_final(self, int64 state, weight=None):             # <<<<<<<<<<<<<<
+ *   def set_final(self, int64_t state, weight=None):             # <<<<<<<<<<<<<<
  *     """
  *     set_final(self, state, weight)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.set_final", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2760
+/* "fstlib/cext/pywrapfst.pyx":2827
  *     return self
  * 
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:             # <<<<<<<<<<<<<<
  *     if symbols is None:
  *       self._mfst.get().SetInputSymbols(NULL)
  */
 
@@ -29399,75 +29765,75 @@
   int __pyx_t_2;
   fst::SymbolTable const *__pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_set_input_symbols", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2761
+  /* "fstlib/cext/pywrapfst.pyx":2828
  * 
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:             # <<<<<<<<<<<<<<
  *       self._mfst.get().SetInputSymbols(NULL)
  *       return
  */
   __pyx_t_1 = (((PyObject *)__pyx_v_symbols) == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2762
+    /* "fstlib/cext/pywrapfst.pyx":2829
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:
  *       self._mfst.get().SetInputSymbols(NULL)             # <<<<<<<<<<<<<<
  *       return
  *     self._mfst.get().SetInputSymbols(symbols._raw_ptr_or_raise())
  */
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-      __PYX_ERR(0, 2762, __pyx_L1_error)
+      __PYX_ERR(0, 2829, __pyx_L1_error)
     }
     __pyx_v_self->_mfst.get()->SetInputSymbols(NULL);
 
-    /* "fstlib/cext/pywrapfst.pyx":2763
+    /* "fstlib/cext/pywrapfst.pyx":2830
  *     if symbols is None:
  *       self._mfst.get().SetInputSymbols(NULL)
  *       return             # <<<<<<<<<<<<<<
  *     self._mfst.get().SetInputSymbols(symbols._raw_ptr_or_raise())
  * 
  */
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":2761
+    /* "fstlib/cext/pywrapfst.pyx":2828
  * 
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:             # <<<<<<<<<<<<<<
  *       self._mfst.get().SetInputSymbols(NULL)
  *       return
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2764
+  /* "fstlib/cext/pywrapfst.pyx":2831
  *       self._mfst.get().SetInputSymbols(NULL)
  *       return
  *     self._mfst.get().SetInputSymbols(symbols._raw_ptr_or_raise())             # <<<<<<<<<<<<<<
  * 
  *   def set_input_symbols(self, SymbolTableView symbols):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2764, __pyx_L1_error)
+    __PYX_ERR(0, 2831, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 2764, __pyx_L1_error)
+    __PYX_ERR(0, 2831, __pyx_L1_error)
   }
-  __pyx_t_3 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2764, __pyx_L1_error)
+  __pyx_t_3 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2831, __pyx_L1_error)
   __pyx_v_self->_mfst.get()->SetInputSymbols(__pyx_t_3);
 
-  /* "fstlib/cext/pywrapfst.pyx":2760
+  /* "fstlib/cext/pywrapfst.pyx":2827
  *     return self
  * 
  *   cdef void _set_input_symbols(self, SymbolTableView symbols) except *:             # <<<<<<<<<<<<<<
  *     if symbols is None:
  *       self._mfst.get().SetInputSymbols(NULL)
  */
 
@@ -29475,15 +29841,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._set_input_symbols", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2766
+/* "fstlib/cext/pywrapfst.pyx":2833
  *     self._mfst.get().SetInputSymbols(symbols._raw_ptr_or_raise())
  * 
  *   def set_input_symbols(self, SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *     """
  *     set_input_symbols(self, symbols)
  */
 
@@ -29493,15 +29859,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_55set_input_symbols(PyObject *__pyx_v_self, PyObject *__pyx_v_symbols) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_input_symbols (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 2766, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 2833, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_54set_input_symbols(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -29513,40 +29879,40 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_input_symbols", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2780
+  /* "fstlib/cext/pywrapfst.pyx":2847
  *       self.
  *     """
  *     self._set_input_symbols(symbols)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_set_input_symbols");
-    __PYX_ERR(0, 2780, __pyx_L1_error)
+    __PYX_ERR(0, 2847, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_set_input_symbols(__pyx_v_self, __pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2780, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_set_input_symbols(__pyx_v_self, __pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2847, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2781
+  /* "fstlib/cext/pywrapfst.pyx":2848
  *     """
  *     self._set_input_symbols(symbols)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2766
+  /* "fstlib/cext/pywrapfst.pyx":2833
  *     self._mfst.get().SetInputSymbols(symbols._raw_ptr_or_raise())
  * 
  *   def set_input_symbols(self, SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *     """
  *     set_input_symbols(self, symbols)
  */
 
@@ -29556,15 +29922,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2783
+/* "fstlib/cext/pywrapfst.pyx":2850
  *     return self
  * 
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:             # <<<<<<<<<<<<<<
  *     if symbols is None:
  *       self._mfst.get().SetOutputSymbols(NULL)
  */
 
@@ -29574,75 +29940,75 @@
   int __pyx_t_2;
   fst::SymbolTable const *__pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_set_output_symbols", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2784
+  /* "fstlib/cext/pywrapfst.pyx":2851
  * 
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:             # <<<<<<<<<<<<<<
  *       self._mfst.get().SetOutputSymbols(NULL)
  *       return
  */
   __pyx_t_1 = (((PyObject *)__pyx_v_symbols) == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2785
+    /* "fstlib/cext/pywrapfst.pyx":2852
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:
  *       self._mfst.get().SetOutputSymbols(NULL)             # <<<<<<<<<<<<<<
  *       return
  *     self._mfst.get().SetOutputSymbols(symbols._raw_ptr_or_raise())
  */
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-      __PYX_ERR(0, 2785, __pyx_L1_error)
+      __PYX_ERR(0, 2852, __pyx_L1_error)
     }
     __pyx_v_self->_mfst.get()->SetOutputSymbols(NULL);
 
-    /* "fstlib/cext/pywrapfst.pyx":2786
+    /* "fstlib/cext/pywrapfst.pyx":2853
  *     if symbols is None:
  *       self._mfst.get().SetOutputSymbols(NULL)
  *       return             # <<<<<<<<<<<<<<
  *     self._mfst.get().SetOutputSymbols(symbols._raw_ptr_or_raise())
  * 
  */
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":2784
+    /* "fstlib/cext/pywrapfst.pyx":2851
  * 
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:
  *     if symbols is None:             # <<<<<<<<<<<<<<
  *       self._mfst.get().SetOutputSymbols(NULL)
  *       return
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2787
+  /* "fstlib/cext/pywrapfst.pyx":2854
  *       self._mfst.get().SetOutputSymbols(NULL)
  *       return
  *     self._mfst.get().SetOutputSymbols(symbols._raw_ptr_or_raise())             # <<<<<<<<<<<<<<
  * 
  *   def set_output_symbols(self, SymbolTableView symbols):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2787, __pyx_L1_error)
+    __PYX_ERR(0, 2854, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_symbols) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-    __PYX_ERR(0, 2787, __pyx_L1_error)
+    __PYX_ERR(0, 2854, __pyx_L1_error)
   }
-  __pyx_t_3 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2787, __pyx_L1_error)
+  __pyx_t_3 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols->__pyx_vtab)->_raw_ptr_or_raise(__pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2854, __pyx_L1_error)
   __pyx_v_self->_mfst.get()->SetOutputSymbols(__pyx_t_3);
 
-  /* "fstlib/cext/pywrapfst.pyx":2783
+  /* "fstlib/cext/pywrapfst.pyx":2850
  *     return self
  * 
  *   cdef void _set_output_symbols(self, SymbolTableView symbols) except *:             # <<<<<<<<<<<<<<
  *     if symbols is None:
  *       self._mfst.get().SetOutputSymbols(NULL)
  */
 
@@ -29650,15 +30016,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._set_output_symbols", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2789
+/* "fstlib/cext/pywrapfst.pyx":2856
  *     self._mfst.get().SetOutputSymbols(symbols._raw_ptr_or_raise())
  * 
  *   def set_output_symbols(self, SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *     """
  *     set_output_symbols(self, symbols)
  */
 
@@ -29668,15 +30034,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_57set_output_symbols(PyObject *__pyx_v_self, PyObject *__pyx_v_symbols) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_output_symbols (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 2789, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_symbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView, 1, "symbols", 0))) __PYX_ERR(0, 2856, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_56set_output_symbols(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_symbols));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -29688,40 +30054,40 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_output_symbols", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2803
+  /* "fstlib/cext/pywrapfst.pyx":2870
  *       self.
  *     """
  *     self._set_output_symbols(symbols)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_set_output_symbols");
-    __PYX_ERR(0, 2803, __pyx_L1_error)
+    __PYX_ERR(0, 2870, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_set_output_symbols(__pyx_v_self, __pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2803, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_set_output_symbols(__pyx_v_self, __pyx_v_symbols); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2870, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2804
+  /* "fstlib/cext/pywrapfst.pyx":2871
  *     """
  *     self._set_output_symbols(symbols)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   def set_properties(self, props, mask):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2789
+  /* "fstlib/cext/pywrapfst.pyx":2856
  *     self._mfst.get().SetOutputSymbols(symbols._raw_ptr_or_raise())
  * 
  *   def set_output_symbols(self, SymbolTableView symbols):             # <<<<<<<<<<<<<<
  *     """
  *     set_output_symbols(self, symbols)
  */
 
@@ -29731,15 +30097,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2806
+/* "fstlib/cext/pywrapfst.pyx":2873
  *     return self
  * 
  *   def set_properties(self, props, mask):             # <<<<<<<<<<<<<<
  *     """
  *     set_properties(self, props, mask)
  */
 
@@ -29774,32 +30140,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_props)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mask)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("set_properties", 1, 2, 2, 1); __PYX_ERR(0, 2806, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("set_properties", 1, 2, 2, 1); __PYX_ERR(0, 2873, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_properties") < 0)) __PYX_ERR(0, 2806, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_properties") < 0)) __PYX_ERR(0, 2873, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_props = values[0];
     __pyx_v_mask = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("set_properties", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2806, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("set_properties", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2873, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.set_properties", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_58set_properties(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), __pyx_v_props, __pyx_v_mask);
 
@@ -29808,55 +30174,55 @@
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_58set_properties(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, PyObject *__pyx_v_props, PyObject *__pyx_v_mask) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
-  uint64 __pyx_t_2;
-  uint64 __pyx_t_3;
+  uint64_t __pyx_t_2;
+  uint64_t __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_properties", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2820
+  /* "fstlib/cext/pywrapfst.pyx":2887
  *       self.
  *     """
  *     self._mfst.get().SetProperties(props.value, mask.value)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2820, __pyx_L1_error)
+    __PYX_ERR(0, 2887, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_props, __pyx_n_s_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2820, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_props, __pyx_n_s_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2887, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_2 == ((uint64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2820, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_2 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2887, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2820, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2887, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_3 == ((uint64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2820, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_3 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2887, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_self->_mfst.get()->SetProperties(__pyx_t_2, __pyx_t_3);
 
-  /* "fstlib/cext/pywrapfst.pyx":2821
+  /* "fstlib/cext/pywrapfst.pyx":2888
  *     """
  *     self._mfst.get().SetProperties(props.value, mask.value)
  *     return self             # <<<<<<<<<<<<<<
  * 
- *   cdef void _set_start(self, int64 state) except *:
+ *   cdef void _set_start(self, int64_t state) except *:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2806
+  /* "fstlib/cext/pywrapfst.pyx":2873
  *     return self
  * 
  *   def set_properties(self, props, mask):             # <<<<<<<<<<<<<<
  *     """
  *     set_properties(self, props, mask)
  */
 
@@ -29867,88 +30233,88 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2823
+/* "fstlib/cext/pywrapfst.pyx":2890
  *     return self
  * 
- *   cdef void _set_start(self, int64 state) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _set_start(self, int64_t state) except *:             # <<<<<<<<<<<<<<
  *     if not self._mfst.get().SetStart(state):
  *       raise FstIndexError("State index out of range")
  */
 
-static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state) {
+static void __pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state) {
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_set_start", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2824
+  /* "fstlib/cext/pywrapfst.pyx":2891
  * 
- *   cdef void _set_start(self, int64 state) except *:
+ *   cdef void _set_start(self, int64_t state) except *:
  *     if not self._mfst.get().SetStart(state):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2824, __pyx_L1_error)
+    __PYX_ERR(0, 2891, __pyx_L1_error)
   }
   __pyx_t_1 = ((!(__pyx_v_self->_mfst.get()->SetStart(__pyx_v_state) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2825
- *   cdef void _set_start(self, int64 state) except *:
+    /* "fstlib/cext/pywrapfst.pyx":2892
+ *   cdef void _set_start(self, int64_t state) except *:
  *     if not self._mfst.get().SetStart(state):
  *       raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  * 
- *   def set_start(self, int64 state):
+ *   def set_start(self, int64_t state):
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2825, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_State_index_out_of_range);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2825, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 2825, __pyx_L1_error)
+    __PYX_ERR(0, 2892, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2824
+    /* "fstlib/cext/pywrapfst.pyx":2891
  * 
- *   cdef void _set_start(self, int64 state) except *:
+ *   cdef void _set_start(self, int64_t state) except *:
  *     if not self._mfst.get().SetStart(state):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  * 
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2823
+  /* "fstlib/cext/pywrapfst.pyx":2890
  *     return self
  * 
- *   cdef void _set_start(self, int64 state) except *:             # <<<<<<<<<<<<<<
+ *   cdef void _set_start(self, int64_t state) except *:             # <<<<<<<<<<<<<<
  *     if not self._mfst.get().SetStart(state):
  *       raise FstIndexError("State index out of range")
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
@@ -29956,101 +30322,101 @@
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst._set_start", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2827
+/* "fstlib/cext/pywrapfst.pyx":2894
  *       raise FstIndexError("State index out of range")
  * 
- *   def set_start(self, int64 state):             # <<<<<<<<<<<<<<
+ *   def set_start(self, int64_t state):             # <<<<<<<<<<<<<<
  *     """
  *     set_start(self, state)
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_61set_start(PyObject *__pyx_v_self, PyObject *__pyx_arg_state); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_10MutableFst_60set_start[] = "\n    set_start(self, state)\n\n    Sets a state to be the initial state state.\n\n    Args:\n      state: The integer index of a state.\n\n    Returns:\n      self.\n\n    Raises:\n      FstIndexError: State index out of range.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_10MutableFst_61set_start(PyObject *__pyx_v_self, PyObject *__pyx_arg_state) {
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_start (wrapper)", 0);
   assert(__pyx_arg_state); {
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2827, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(__pyx_arg_state); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 2894, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.set_start", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_60set_start(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), ((int64)__pyx_v_state));
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_60set_start(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self), ((int64_t)__pyx_v_state));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_60set_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64 __pyx_v_state) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_10MutableFst_60set_start(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_self, int64_t __pyx_v_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_start", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2842
+  /* "fstlib/cext/pywrapfst.pyx":2909
  *       FstIndexError: State index out of range.
  *     """
  *     self._set_start(state)             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_set_start");
-    __PYX_ERR(0, 2842, __pyx_L1_error)
+    __PYX_ERR(0, 2909, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_set_start(__pyx_v_self, __pyx_v_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2842, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_set_start(__pyx_v_self, __pyx_v_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2909, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2843
+  /* "fstlib/cext/pywrapfst.pyx":2910
  *     """
  *     self._set_start(state)
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   cdef void _topsort(self):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2827
+  /* "fstlib/cext/pywrapfst.pyx":2894
  *       raise FstIndexError("State index out of range")
  * 
- *   def set_start(self, int64 state):             # <<<<<<<<<<<<<<
+ *   def set_start(self, int64_t state):             # <<<<<<<<<<<<<<
  *     """
  *     set_start(self, state)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.MutableFst.set_start", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2845
+/* "fstlib/cext/pywrapfst.pyx":2912
  *     return self
  * 
  *   cdef void _topsort(self):             # <<<<<<<<<<<<<<
  *     # TopSort returns False if the FST is cyclic, and thus can't be TopSorted.
  *     if not fst.TopSort(self._mfst.get()):
  */
 
@@ -30061,67 +30427,67 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_topsort", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2847
+  /* "fstlib/cext/pywrapfst.pyx":2914
  *   cdef void _topsort(self):
  *     # TopSort returns False if the FST is cyclic, and thus can't be TopSorted.
  *     if not fst.TopSort(self._mfst.get()):             # <<<<<<<<<<<<<<
  *       logging.warning("Cannot topsort cyclic FST")
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2847, __pyx_L1_error)
+    __PYX_ERR(0, 2914, __pyx_L1_error)
   }
   __pyx_t_1 = ((!(fst::script::TopSort(__pyx_v_self->_mfst.get()) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2848
+    /* "fstlib/cext/pywrapfst.pyx":2915
  *     # TopSort returns False if the FST is cyclic, and thus can't be TopSorted.
  *     if not fst.TopSort(self._mfst.get()):
  *       logging.warning("Cannot topsort cyclic FST")             # <<<<<<<<<<<<<<
  * 
  *   def topsort(self):
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_logging); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2848, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_logging); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2915, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_warning); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2848, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_warning); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2915, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_kp_u_Cannot_topsort_cyclic_FST) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_kp_u_Cannot_topsort_cyclic_FST);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2848, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2915, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "fstlib/cext/pywrapfst.pyx":2847
+    /* "fstlib/cext/pywrapfst.pyx":2914
  *   cdef void _topsort(self):
  *     # TopSort returns False if the FST is cyclic, and thus can't be TopSorted.
  *     if not fst.TopSort(self._mfst.get()):             # <<<<<<<<<<<<<<
  *       logging.warning("Cannot topsort cyclic FST")
  * 
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2845
+  /* "fstlib/cext/pywrapfst.pyx":2912
  *     return self
  * 
  *   cdef void _topsort(self):             # <<<<<<<<<<<<<<
  *     # TopSort returns False if the FST is cyclic, and thus can't be TopSorted.
  *     if not fst.TopSort(self._mfst.get()):
  */
 
@@ -30132,15 +30498,15 @@
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst.MutableFst._topsort", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2850
+/* "fstlib/cext/pywrapfst.pyx":2917
  *       logging.warning("Cannot topsort cyclic FST")
  * 
  *   def topsort(self):             # <<<<<<<<<<<<<<
  *     """
  *     topsort(self)
  */
 
@@ -30162,40 +30528,40 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("topsort", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2863
+  /* "fstlib/cext/pywrapfst.pyx":2930
  *        self.
  *     """
  *     self._topsort()             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_topsort");
-    __PYX_ERR(0, 2863, __pyx_L1_error)
+    __PYX_ERR(0, 2930, __pyx_L1_error)
   }
   ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_topsort(__pyx_v_self);
 
-  /* "fstlib/cext/pywrapfst.pyx":2864
+  /* "fstlib/cext/pywrapfst.pyx":2931
  *     """
  *     self._topsort()
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   def union(self, *fsts2):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2850
+  /* "fstlib/cext/pywrapfst.pyx":2917
  *       logging.warning("Cannot topsort cyclic FST")
  * 
  *   def topsort(self):             # <<<<<<<<<<<<<<
  *     """
  *     topsort(self)
  */
 
@@ -30205,15 +30571,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2866
+/* "fstlib/cext/pywrapfst.pyx":2933
  *     return self
  * 
  *   def union(self, *fsts2):             # <<<<<<<<<<<<<<
  *     """
  *     union(self, *fsts2)
  */
 
@@ -30245,101 +30611,101 @@
   Py_ssize_t __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("union", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2884
+  /* "fstlib/cext/pywrapfst.pyx":2951
  *     cdef Fst _fst2
  *     cdef vector[const_FstClass_ptr] _fsts2
  *     for _fst2 in fsts2:             # <<<<<<<<<<<<<<
  *       _fsts2.push_back(_fst2._fst.get())
  *     fst.Union(self._mfst.get(), _fsts2)
  */
   __pyx_t_1 = __pyx_v_fsts2; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
   for (;;) {
     if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 2884, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 2951, __pyx_L1_error)
     #else
-    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2884, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2951, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     #endif
-    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst))))) __PYX_ERR(0, 2884, __pyx_L1_error)
+    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst))))) __PYX_ERR(0, 2951, __pyx_L1_error)
     __Pyx_XDECREF_SET(__pyx_v__fst2, ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_3));
     __pyx_t_3 = 0;
 
-    /* "fstlib/cext/pywrapfst.pyx":2885
+    /* "fstlib/cext/pywrapfst.pyx":2952
  *     cdef vector[const_FstClass_ptr] _fsts2
  *     for _fst2 in fsts2:
  *       _fsts2.push_back(_fst2._fst.get())             # <<<<<<<<<<<<<<
  *     fst.Union(self._mfst.get(), _fsts2)
  *     self._check_mutating_imethod()
  */
     if (unlikely(((PyObject *)__pyx_v__fst2) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-      __PYX_ERR(0, 2885, __pyx_L1_error)
+      __PYX_ERR(0, 2952, __pyx_L1_error)
     }
     try {
       __pyx_v__fsts2.push_back(__pyx_v__fst2->_fst.get());
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 2885, __pyx_L1_error)
+      __PYX_ERR(0, 2952, __pyx_L1_error)
     }
 
-    /* "fstlib/cext/pywrapfst.pyx":2884
+    /* "fstlib/cext/pywrapfst.pyx":2951
  *     cdef Fst _fst2
  *     cdef vector[const_FstClass_ptr] _fsts2
  *     for _fst2 in fsts2:             # <<<<<<<<<<<<<<
  *       _fsts2.push_back(_fst2._fst.get())
  *     fst.Union(self._mfst.get(), _fsts2)
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2886
+  /* "fstlib/cext/pywrapfst.pyx":2953
  *     for _fst2 in fsts2:
  *       _fsts2.push_back(_fst2._fst.get())
  *     fst.Union(self._mfst.get(), _fsts2)             # <<<<<<<<<<<<<<
  *     self._check_mutating_imethod()
  *     return self
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2886, __pyx_L1_error)
+    __PYX_ERR(0, 2953, __pyx_L1_error)
   }
   fst::script::Union(__pyx_v_self->_mfst.get(), __pyx_v__fsts2);
 
-  /* "fstlib/cext/pywrapfst.pyx":2887
+  /* "fstlib/cext/pywrapfst.pyx":2954
  *       _fsts2.push_back(_fst2._fst.get())
  *     fst.Union(self._mfst.get(), _fsts2)
  *     self._check_mutating_imethod()             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_check_mutating_imethod");
-    __PYX_ERR(0, 2887, __pyx_L1_error)
+    __PYX_ERR(0, 2954, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2887, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_v_self->__pyx_base.__pyx_vtab)->_check_mutating_imethod(__pyx_v_self); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2954, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":2888
+  /* "fstlib/cext/pywrapfst.pyx":2955
  *     fst.Union(self._mfst.get(), _fsts2)
  *     self._check_mutating_imethod()
  *     return self             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2866
+  /* "fstlib/cext/pywrapfst.pyx":2933
  *     return self
  * 
  *   def union(self, *fsts2):             # <<<<<<<<<<<<<<
  *     """
  *     union(self, *fsts2)
  */
 
@@ -30352,15 +30718,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__fst2);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2904
+/* "fstlib/cext/pywrapfst.pyx":2971
  *   """
  * 
  *   def __init__(self, arc_type="standard"):             # <<<<<<<<<<<<<<
  *     cdef unique_ptr[fst.MutableFstClass] _tfst
  *     _tfst.reset(new fst.VectorFstClass(tostring(arc_type)))
  */
 
@@ -30392,29 +30758,29 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_arc_type);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 2904, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 2971, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_arc_type = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2904, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 2971, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.VectorFst.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_9VectorFst___init__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_VectorFst *)__pyx_v_self), __pyx_v_arc_type);
 
@@ -30434,46 +30800,46 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2906
+  /* "fstlib/cext/pywrapfst.pyx":2973
  *   def __init__(self, arc_type="standard"):
  *     cdef unique_ptr[fst.MutableFstClass] _tfst
  *     _tfst.reset(new fst.VectorFstClass(tostring(arc_type)))             # <<<<<<<<<<<<<<
  *     if _tfst.get().Properties(fst.kError, True) == fst.kError:
  *       raise FstOpError(f"Unknown arc type: {arc_type!r}")
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_arc_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2906, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_arc_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2973, __pyx_L1_error)
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(__pyx_t_1));
 
-  /* "fstlib/cext/pywrapfst.pyx":2907
+  /* "fstlib/cext/pywrapfst.pyx":2974
  *     cdef unique_ptr[fst.MutableFstClass] _tfst
  *     _tfst.reset(new fst.VectorFstClass(tostring(arc_type)))
  *     if _tfst.get().Properties(fst.kError, True) == fst.kError:             # <<<<<<<<<<<<<<
  *       raise FstOpError(f"Unknown arc type: {arc_type!r}")
  *     self._fst.reset(_tfst.release())
  */
   __pyx_t_2 = ((__pyx_v__tfst.get()->Properties(fst::kError, 1) == fst::kError) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2908
+    /* "fstlib/cext/pywrapfst.pyx":2975
  *     _tfst.reset(new fst.VectorFstClass(tostring(arc_type)))
  *     if _tfst.get().Properties(fst.kError, True) == fst.kError:
  *       raise FstOpError(f"Unknown arc type: {arc_type!r}")             # <<<<<<<<<<<<<<
  *     self._fst.reset(_tfst.release())
  *     self._mfst = static_pointer_cast[fst.MutableFstClass,
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2908, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2975, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_arc_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2908, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_arc_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2975, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_arc_type, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2908, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_arc_type, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2975, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -30481,69 +30847,69 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2908, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2975, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 2908, __pyx_L1_error)
+    __PYX_ERR(0, 2975, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2907
+    /* "fstlib/cext/pywrapfst.pyx":2974
  *     cdef unique_ptr[fst.MutableFstClass] _tfst
  *     _tfst.reset(new fst.VectorFstClass(tostring(arc_type)))
  *     if _tfst.get().Properties(fst.kError, True) == fst.kError:             # <<<<<<<<<<<<<<
  *       raise FstOpError(f"Unknown arc type: {arc_type!r}")
  *     self._fst.reset(_tfst.release())
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2909
+  /* "fstlib/cext/pywrapfst.pyx":2976
  *     if _tfst.get().Properties(fst.kError, True) == fst.kError:
  *       raise FstOpError(f"Unknown arc type: {arc_type!r}")
  *     self._fst.reset(_tfst.release())             # <<<<<<<<<<<<<<
  *     self._mfst = static_pointer_cast[fst.MutableFstClass,
  *                                      fst.FstClass](self._fst)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2909, __pyx_L1_error)
+    __PYX_ERR(0, 2976, __pyx_L1_error)
   }
   __pyx_v_self->__pyx_base.__pyx_base._fst.reset(__pyx_v__tfst.release());
 
-  /* "fstlib/cext/pywrapfst.pyx":2911
+  /* "fstlib/cext/pywrapfst.pyx":2978
  *     self._fst.reset(_tfst.release())
  *     self._mfst = static_pointer_cast[fst.MutableFstClass,
  *                                      fst.FstClass](self._fst)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2911, __pyx_L1_error)
+    __PYX_ERR(0, 2978, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2910
+  /* "fstlib/cext/pywrapfst.pyx":2977
  *       raise FstOpError(f"Unknown arc type: {arc_type!r}")
  *     self._fst.reset(_tfst.release())
  *     self._mfst = static_pointer_cast[fst.MutableFstClass,             # <<<<<<<<<<<<<<
  *                                      fst.FstClass](self._fst)
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2910, __pyx_L1_error)
+    __PYX_ERR(0, 2977, __pyx_L1_error)
   }
   __pyx_v_self->__pyx_base._mfst = std::static_pointer_cast<fst::script::MutableFstClass,fst::script::FstClass>(__pyx_v_self->__pyx_base.__pyx_base._fst);
 
-  /* "fstlib/cext/pywrapfst.pyx":2904
+  /* "fstlib/cext/pywrapfst.pyx":2971
  *   """
  * 
  *   def __init__(self, arc_type="standard"):             # <<<<<<<<<<<<<<
  *     cdef unique_ptr[fst.MutableFstClass] _tfst
  *     _tfst.reset(new fst.VectorFstClass(tostring(arc_type)))
  */
 
@@ -30558,15 +30924,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.VectorFst.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2930
+/* "fstlib/cext/pywrapfst.pyx":2997
  * 
  * 
  * cdef Fst _init_Fst(FstClass_ptr tfst):             # <<<<<<<<<<<<<<
  *   if tfst.Properties(fst.kError, True) == fst.kError:
  *     raise FstOpError("Operation failed")
  */
 
@@ -30579,99 +30945,99 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_init_Fst", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2931
+  /* "fstlib/cext/pywrapfst.pyx":2998
  * 
  * cdef Fst _init_Fst(FstClass_ptr tfst):
  *   if tfst.Properties(fst.kError, True) == fst.kError:             # <<<<<<<<<<<<<<
  *     raise FstOpError("Operation failed")
  *   cdef Fst _ofst = Fst.__new__(Fst)
  */
   __pyx_t_1 = ((__pyx_v_tfst->Properties(fst::kError, 1) == fst::kError) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2932
+    /* "fstlib/cext/pywrapfst.pyx":2999
  * cdef Fst _init_Fst(FstClass_ptr tfst):
  *   if tfst.Properties(fst.kError, True) == fst.kError:
  *     raise FstOpError("Operation failed")             # <<<<<<<<<<<<<<
  *   cdef Fst _ofst = Fst.__new__(Fst)
  *   _ofst._fst.reset(tfst)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2932, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2999, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Operation_failed) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Operation_failed);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2932, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2999, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 2932, __pyx_L1_error)
+    __PYX_ERR(0, 2999, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2931
+    /* "fstlib/cext/pywrapfst.pyx":2998
  * 
  * cdef Fst _init_Fst(FstClass_ptr tfst):
  *   if tfst.Properties(fst.kError, True) == fst.kError:             # <<<<<<<<<<<<<<
  *     raise FstOpError("Operation failed")
  *   cdef Fst _ofst = Fst.__new__(Fst)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2933
+  /* "fstlib/cext/pywrapfst.pyx":3000
  *   if tfst.Properties(fst.kError, True) == fst.kError:
  *     raise FstOpError("Operation failed")
  *   cdef Fst _ofst = Fst.__new__(Fst)             # <<<<<<<<<<<<<<
  *   _ofst._fst.reset(tfst)
  *   return _ofst
  */
-  __pyx_t_2 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Fst(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2933, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Fst(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3000, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_2));
   __pyx_v__ofst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2934
+  /* "fstlib/cext/pywrapfst.pyx":3001
  *     raise FstOpError("Operation failed")
  *   cdef Fst _ofst = Fst.__new__(Fst)
  *   _ofst._fst.reset(tfst)             # <<<<<<<<<<<<<<
  *   return _ofst
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__ofst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2934, __pyx_L1_error)
+    __PYX_ERR(0, 3001, __pyx_L1_error)
   }
   __pyx_v__ofst->_fst.reset(__pyx_v_tfst);
 
-  /* "fstlib/cext/pywrapfst.pyx":2935
+  /* "fstlib/cext/pywrapfst.pyx":3002
  *   cdef Fst _ofst = Fst.__new__(Fst)
  *   _ofst._fst.reset(tfst)
  *   return _ofst             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__ofst));
   __pyx_r = __pyx_v__ofst;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2930
+  /* "fstlib/cext/pywrapfst.pyx":2997
  * 
  * 
  * cdef Fst _init_Fst(FstClass_ptr tfst):             # <<<<<<<<<<<<<<
  *   if tfst.Properties(fst.kError, True) == fst.kError:
  *     raise FstOpError("Operation failed")
  */
 
@@ -30685,15 +31051,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__ofst);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2938
+/* "fstlib/cext/pywrapfst.pyx":3005
  * 
  * 
  * cdef MutableFst _init_MutableFst(MutableFstClass_ptr tfst):             # <<<<<<<<<<<<<<
  *   if tfst.Properties(fst.kError, True) == fst.kError:
  *     raise FstOpError("Operation failed")
  */
 
@@ -30706,124 +31072,124 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_init_MutableFst", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2939
+  /* "fstlib/cext/pywrapfst.pyx":3006
  * 
  * cdef MutableFst _init_MutableFst(MutableFstClass_ptr tfst):
  *   if tfst.Properties(fst.kError, True) == fst.kError:             # <<<<<<<<<<<<<<
  *     raise FstOpError("Operation failed")
  *   cdef MutableFst _ofst = MutableFst.__new__(MutableFst)
  */
   __pyx_t_1 = ((__pyx_v_tfst->Properties(fst::kError, 1) == fst::kError) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2940
+    /* "fstlib/cext/pywrapfst.pyx":3007
  * cdef MutableFst _init_MutableFst(MutableFstClass_ptr tfst):
  *   if tfst.Properties(fst.kError, True) == fst.kError:
  *     raise FstOpError("Operation failed")             # <<<<<<<<<<<<<<
  *   cdef MutableFst _ofst = MutableFst.__new__(MutableFst)
  *   _ofst._fst.reset(tfst)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2940, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3007, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Operation_failed) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Operation_failed);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2940, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3007, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 2940, __pyx_L1_error)
+    __PYX_ERR(0, 3007, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2939
+    /* "fstlib/cext/pywrapfst.pyx":3006
  * 
  * cdef MutableFst _init_MutableFst(MutableFstClass_ptr tfst):
  *   if tfst.Properties(fst.kError, True) == fst.kError:             # <<<<<<<<<<<<<<
  *     raise FstOpError("Operation failed")
  *   cdef MutableFst _ofst = MutableFst.__new__(MutableFst)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2941
+  /* "fstlib/cext/pywrapfst.pyx":3008
  *   if tfst.Properties(fst.kError, True) == fst.kError:
  *     raise FstOpError("Operation failed")
  *   cdef MutableFst _ofst = MutableFst.__new__(MutableFst)             # <<<<<<<<<<<<<<
  *   _ofst._fst.reset(tfst)
  *   # Makes a copy of it as the derived type! Cool.
  */
-  __pyx_t_2 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_MutableFst(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_MutableFst), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2941, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_MutableFst(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_MutableFst), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3008, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_2));
   __pyx_v__ofst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2942
+  /* "fstlib/cext/pywrapfst.pyx":3009
  *     raise FstOpError("Operation failed")
  *   cdef MutableFst _ofst = MutableFst.__new__(MutableFst)
  *   _ofst._fst.reset(tfst)             # <<<<<<<<<<<<<<
  *   # Makes a copy of it as the derived type! Cool.
  *   _ofst._mfst = static_pointer_cast[fst.MutableFstClass,
  */
   if (unlikely(((PyObject *)__pyx_v__ofst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2942, __pyx_L1_error)
+    __PYX_ERR(0, 3009, __pyx_L1_error)
   }
   __pyx_v__ofst->__pyx_base._fst.reset(__pyx_v_tfst);
 
-  /* "fstlib/cext/pywrapfst.pyx":2945
+  /* "fstlib/cext/pywrapfst.pyx":3012
  *   # Makes a copy of it as the derived type! Cool.
  *   _ofst._mfst = static_pointer_cast[fst.MutableFstClass,
  *                                     fst.FstClass](_ofst._fst)             # <<<<<<<<<<<<<<
  *   return _ofst
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__ofst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 2945, __pyx_L1_error)
+    __PYX_ERR(0, 3012, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2944
+  /* "fstlib/cext/pywrapfst.pyx":3011
  *   _ofst._fst.reset(tfst)
  *   # Makes a copy of it as the derived type! Cool.
  *   _ofst._mfst = static_pointer_cast[fst.MutableFstClass,             # <<<<<<<<<<<<<<
  *                                     fst.FstClass](_ofst._fst)
  *   return _ofst
  */
   if (unlikely(((PyObject *)__pyx_v__ofst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 2944, __pyx_L1_error)
+    __PYX_ERR(0, 3011, __pyx_L1_error)
   }
   __pyx_v__ofst->_mfst = std::static_pointer_cast<fst::script::MutableFstClass,fst::script::FstClass>(__pyx_v__ofst->__pyx_base._fst);
 
-  /* "fstlib/cext/pywrapfst.pyx":2946
+  /* "fstlib/cext/pywrapfst.pyx":3013
  *   _ofst._mfst = static_pointer_cast[fst.MutableFstClass,
  *                                     fst.FstClass](_ofst._fst)
  *   return _ofst             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v__ofst));
   __pyx_r = __pyx_v__ofst;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2938
+  /* "fstlib/cext/pywrapfst.pyx":3005
  * 
  * 
  * cdef MutableFst _init_MutableFst(MutableFstClass_ptr tfst):             # <<<<<<<<<<<<<<
  *   if tfst.Properties(fst.kError, True) == fst.kError:
  *     raise FstOpError("Operation failed")
  */
 
@@ -30837,15 +31203,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__ofst);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2949
+/* "fstlib/cext/pywrapfst.pyx":3016
  * 
  * 
  * cdef Fst _init_XFst(FstClass_ptr tfst):             # <<<<<<<<<<<<<<
  *   if tfst.Properties(fst.kMutable, True) == fst.kMutable:
  *     return _init_MutableFst(static_cast[MutableFstClass_ptr](tfst))
  */
 
@@ -30855,64 +31221,64 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_init_XFst", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2950
+  /* "fstlib/cext/pywrapfst.pyx":3017
  * 
  * cdef Fst _init_XFst(FstClass_ptr tfst):
  *   if tfst.Properties(fst.kMutable, True) == fst.kMutable:             # <<<<<<<<<<<<<<
  *     return _init_MutableFst(static_cast[MutableFstClass_ptr](tfst))
  *   else:
  */
   __pyx_t_1 = ((__pyx_v_tfst->Properties(fst::kMutable, 1) == fst::kMutable) != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2951
+    /* "fstlib/cext/pywrapfst.pyx":3018
  * cdef Fst _init_XFst(FstClass_ptr tfst):
  *   if tfst.Properties(fst.kMutable, True) == fst.kMutable:
  *     return _init_MutableFst(static_cast[MutableFstClass_ptr](tfst))             # <<<<<<<<<<<<<<
  *   else:
  *     return _init_Fst(tfst)
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
-    __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(static_cast<__pyx_t_6fstlib_4cext_9pywrapfst_MutableFstClass_ptr>(__pyx_v_tfst))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2951, __pyx_L1_error)
+    __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(static_cast<__pyx_t_6fstlib_4cext_9pywrapfst_MutableFstClass_ptr>(__pyx_v_tfst))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3018, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_2);
     __pyx_t_2 = 0;
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":2950
+    /* "fstlib/cext/pywrapfst.pyx":3017
  * 
  * cdef Fst _init_XFst(FstClass_ptr tfst):
  *   if tfst.Properties(fst.kMutable, True) == fst.kMutable:             # <<<<<<<<<<<<<<
  *     return _init_MutableFst(static_cast[MutableFstClass_ptr](tfst))
  *   else:
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2953
+  /* "fstlib/cext/pywrapfst.pyx":3020
  *     return _init_MutableFst(static_cast[MutableFstClass_ptr](tfst))
  *   else:
  *     return _init_Fst(tfst)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   /*else*/ {
     __Pyx_XDECREF(((PyObject *)__pyx_r));
-    __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_Fst(__pyx_v_tfst)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2953, __pyx_L1_error)
+    __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_Fst(__pyx_v_tfst)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3020, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_2);
     __pyx_t_2 = 0;
     goto __pyx_L0;
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2949
+  /* "fstlib/cext/pywrapfst.pyx":3016
  * 
  * 
  * cdef Fst _init_XFst(FstClass_ptr tfst):             # <<<<<<<<<<<<<<
  *   if tfst.Properties(fst.kMutable, True) == fst.kMutable:
  *     return _init_MutableFst(static_cast[MutableFstClass_ptr](tfst))
  */
 
@@ -30923,20 +31289,20 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2956
+/* "fstlib/cext/pywrapfst.pyx":3023
  * 
  * 
  * cpdef Fst _read_Fst(source):             # <<<<<<<<<<<<<<
- *   cdef unique_ptr[fst.FstClass] _tfst
- *   _tfst.reset(fst.FstClass.Read(path_tostring(source)))
+ *   cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.Read(path_tostring(source))
+ *   if _tfst.get() == NULL:
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_17_read_Fst(PyObject *__pyx_self, PyObject *__pyx_v_source); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_f_6fstlib_4cext_9pywrapfst__read_Fst(PyObject *__pyx_v_source, CYTHON_UNUSED int __pyx_skip_dispatch) {
   std::unique_ptr<fst::script::FstClass>  __pyx_v__tfst;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
@@ -30947,46 +31313,46 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_read_Fst", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2958
+  /* "fstlib/cext/pywrapfst.pyx":3024
+ * 
  * cpdef Fst _read_Fst(source):
- *   cdef unique_ptr[fst.FstClass] _tfst
- *   _tfst.reset(fst.FstClass.Read(path_tostring(source)))             # <<<<<<<<<<<<<<
+ *   cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.Read(path_tostring(source))             # <<<<<<<<<<<<<<
  *   if _tfst.get() == NULL:
  *     raise FstIOError(f"Read failed: {source!r}")
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2958, __pyx_L1_error)
-  __pyx_v__tfst.reset(fst::script::FstClass::Read(__pyx_t_1));
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3024, __pyx_L1_error)
+  __pyx_v__tfst = fst::script::FstClass::Read(__pyx_t_1);
 
-  /* "fstlib/cext/pywrapfst.pyx":2959
- *   cdef unique_ptr[fst.FstClass] _tfst
- *   _tfst.reset(fst.FstClass.Read(path_tostring(source)))
+  /* "fstlib/cext/pywrapfst.pyx":3025
+ * cpdef Fst _read_Fst(source):
+ *   cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.Read(path_tostring(source))
  *   if _tfst.get() == NULL:             # <<<<<<<<<<<<<<
  *     raise FstIOError(f"Read failed: {source!r}")
  *   return _init_XFst(_tfst.release())
  */
   __pyx_t_2 = ((__pyx_v__tfst.get() == NULL) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2960
- *   _tfst.reset(fst.FstClass.Read(path_tostring(source)))
+    /* "fstlib/cext/pywrapfst.pyx":3026
+ *   cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.Read(path_tostring(source))
  *   if _tfst.get() == NULL:
  *     raise FstIOError(f"Read failed: {source!r}")             # <<<<<<<<<<<<<<
  *   return _init_XFst(_tfst.release())
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2960, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3026, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2960, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3026, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_failed, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2960, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_failed, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3026, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -30994,50 +31360,50 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2960, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3026, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 2960, __pyx_L1_error)
+    __PYX_ERR(0, 3026, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2959
- *   cdef unique_ptr[fst.FstClass] _tfst
- *   _tfst.reset(fst.FstClass.Read(path_tostring(source)))
+    /* "fstlib/cext/pywrapfst.pyx":3025
+ * cpdef Fst _read_Fst(source):
+ *   cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.Read(path_tostring(source))
  *   if _tfst.get() == NULL:             # <<<<<<<<<<<<<<
  *     raise FstIOError(f"Read failed: {source!r}")
  *   return _init_XFst(_tfst.release())
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2961
+  /* "fstlib/cext/pywrapfst.pyx":3027
  *   if _tfst.get() == NULL:
  *     raise FstIOError(f"Read failed: {source!r}")
  *   return _init_XFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2961, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3027, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2956
+  /* "fstlib/cext/pywrapfst.pyx":3023
  * 
  * 
  * cpdef Fst _read_Fst(source):             # <<<<<<<<<<<<<<
- *   cdef unique_ptr[fst.FstClass] _tfst
- *   _tfst.reset(fst.FstClass.Read(path_tostring(source)))
+ *   cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.Read(path_tostring(source))
+ *   if _tfst.get() == NULL:
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
@@ -31068,15 +31434,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_read_Fst", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_Fst(__pyx_v_source, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2956, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_Fst(__pyx_v_source, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3023, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -31085,15 +31451,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":2964
+/* "fstlib/cext/pywrapfst.pyx":3030
  * 
  * 
  * cpdef Fst _read_Fst_from_string(string state):             # <<<<<<<<<<<<<<
  *   cdef stringstream _sstrm
  *   _sstrm << state
  */
 
@@ -31108,94 +31474,94 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_read_Fst_from_string", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":2966
+  /* "fstlib/cext/pywrapfst.pyx":3032
  * cpdef Fst _read_Fst_from_string(string state):
  *   cdef stringstream _sstrm
  *   _sstrm << state             # <<<<<<<<<<<<<<
- *   cdef unique_ptr[fst.FstClass] _tfst
- *   _tfst.reset(fst.FstClass.ReadStream(_sstrm, b"<pywrapfst>"))
+ *   cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.ReadStream(_sstrm,
+ *                                                                 b"<pywrapfst>")
  */
   (void)((__pyx_v__sstrm << __pyx_v_state));
 
-  /* "fstlib/cext/pywrapfst.pyx":2968
+  /* "fstlib/cext/pywrapfst.pyx":3033
+ *   cdef stringstream _sstrm
  *   _sstrm << state
- *   cdef unique_ptr[fst.FstClass] _tfst
- *   _tfst.reset(fst.FstClass.ReadStream(_sstrm, b"<pywrapfst>"))             # <<<<<<<<<<<<<<
+ *   cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.ReadStream(_sstrm,             # <<<<<<<<<<<<<<
+ *                                                                 b"<pywrapfst>")
  *   if _tfst.get() == NULL:
- *     raise FstIOError("Read from string failed")
  */
-  __pyx_v__tfst.reset(fst::script::FstClass::Read(__pyx_v__sstrm, __pyx_k_pywrapfst));
+  __pyx_v__tfst = fst::script::FstClass::Read(__pyx_v__sstrm, __pyx_k_pywrapfst);
 
-  /* "fstlib/cext/pywrapfst.pyx":2969
- *   cdef unique_ptr[fst.FstClass] _tfst
- *   _tfst.reset(fst.FstClass.ReadStream(_sstrm, b"<pywrapfst>"))
+  /* "fstlib/cext/pywrapfst.pyx":3035
+ *   cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.ReadStream(_sstrm,
+ *                                                                 b"<pywrapfst>")
  *   if _tfst.get() == NULL:             # <<<<<<<<<<<<<<
  *     raise FstIOError("Read from string failed")
  *   return _init_XFst(_tfst.release())
  */
   __pyx_t_1 = ((__pyx_v__tfst.get() == NULL) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":2970
- *   _tfst.reset(fst.FstClass.ReadStream(_sstrm, b"<pywrapfst>"))
+    /* "fstlib/cext/pywrapfst.pyx":3036
+ *                                                                 b"<pywrapfst>")
  *   if _tfst.get() == NULL:
  *     raise FstIOError("Read from string failed")             # <<<<<<<<<<<<<<
  *   return _init_XFst(_tfst.release())
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2970, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3036, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Read_from_string_failed) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Read_from_string_failed);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2970, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3036, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 2970, __pyx_L1_error)
+    __PYX_ERR(0, 3036, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":2969
- *   cdef unique_ptr[fst.FstClass] _tfst
- *   _tfst.reset(fst.FstClass.ReadStream(_sstrm, b"<pywrapfst>"))
+    /* "fstlib/cext/pywrapfst.pyx":3035
+ *   cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.ReadStream(_sstrm,
+ *                                                                 b"<pywrapfst>")
  *   if _tfst.get() == NULL:             # <<<<<<<<<<<<<<
  *     raise FstIOError("Read from string failed")
  *   return _init_XFst(_tfst.release())
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":2971
+  /* "fstlib/cext/pywrapfst.pyx":3037
  *   if _tfst.get() == NULL:
  *     raise FstIOError("Read from string failed")
  *   return _init_XFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2971, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3037, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_2);
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2964
+  /* "fstlib/cext/pywrapfst.pyx":3030
  * 
  * 
  * cpdef Fst _read_Fst_from_string(string state):             # <<<<<<<<<<<<<<
  *   cdef stringstream _sstrm
  *   _sstrm << state
  */
 
@@ -31219,15 +31585,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_read_Fst_from_string (wrapper)", 0);
   assert(__pyx_arg_state); {
-    __pyx_v_state = __pyx_convert_string_from_py_std__in_string(__pyx_arg_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2964, __pyx_L3_error)
+    __pyx_v_state = __pyx_convert_string_from_py_std__in_string(__pyx_arg_state); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3030, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._read_Fst_from_string", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
@@ -31243,15 +31609,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_read_Fst_from_string", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_Fst_from_string(__pyx_v_state, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2964, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__read_Fst_from_string(__pyx_v_state, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3030, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -31260,15 +31626,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3090
+/* "fstlib/cext/pywrapfst.pyx":3156
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<Arc at 0x{id(self):x}>"
  * 
  */
 
@@ -31294,52 +31660,52 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3091
+  /* "fstlib/cext/pywrapfst.pyx":3157
  * 
  *   def __repr__(self):
  *     return f"<Arc at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
- *   def __init__(self, int64 ilabel, int64 olabel, weight, int64 nextstate):
+ *   def __init__(self, int64_t ilabel, int64_t olabel, weight, int64_t nextstate):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3091, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3157, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_Arc_at_0x);
   __pyx_t_2 += 10;
   __Pyx_GIVEREF(__pyx_kp_u_Arc_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Arc_at_0x);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3091, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3157, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3091, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3157, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3091, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3157, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3090
+  /* "fstlib/cext/pywrapfst.pyx":3156
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<Arc at 0x{id(self):x}>"
  * 
  */
 
@@ -31352,29 +31718,29 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3093
+/* "fstlib/cext/pywrapfst.pyx":3159
  *     return f"<Arc at 0x{id(self):x}>"
  * 
- *   def __init__(self, int64 ilabel, int64 olabel, weight, int64 nextstate):             # <<<<<<<<<<<<<<
+ *   def __init__(self, int64_t ilabel, int64_t olabel, weight, int64_t nextstate):             # <<<<<<<<<<<<<<
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_one(b"tropical", weight)
  *     self._arc.reset(new fst.ArcClass(ilabel, olabel, _weight, nextstate))
  */
 
 /* Python wrapper */
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_3Arc_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_3Arc_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  int64 __pyx_v_ilabel;
-  int64 __pyx_v_olabel;
+  int64_t __pyx_v_ilabel;
+  int64_t __pyx_v_olabel;
   PyObject *__pyx_v_weight = 0;
-  int64 __pyx_v_nextstate;
+  int64_t __pyx_v_nextstate;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
   {
@@ -31400,97 +31766,97 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ilabel)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_olabel)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 1); __PYX_ERR(0, 3093, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 1); __PYX_ERR(0, 3159, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weight)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 2); __PYX_ERR(0, 3093, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 2); __PYX_ERR(0, 3159, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_nextstate)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 3); __PYX_ERR(0, 3093, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 3); __PYX_ERR(0, 3159, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 3093, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 3159, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
-    __pyx_v_ilabel = __Pyx_PyInt_As_int64_t(values[0]); if (unlikely((__pyx_v_ilabel == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3093, __pyx_L3_error)
-    __pyx_v_olabel = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_olabel == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3093, __pyx_L3_error)
+    __pyx_v_ilabel = __Pyx_PyInt_As_int64_t(values[0]); if (unlikely((__pyx_v_ilabel == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3159, __pyx_L3_error)
+    __pyx_v_olabel = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_olabel == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3159, __pyx_L3_error)
     __pyx_v_weight = values[2];
-    __pyx_v_nextstate = __Pyx_PyInt_As_int64_t(values[3]); if (unlikely((__pyx_v_nextstate == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3093, __pyx_L3_error)
+    __pyx_v_nextstate = __Pyx_PyInt_As_int64_t(values[3]); if (unlikely((__pyx_v_nextstate == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3159, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3093, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3159, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Arc.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_2__init__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_v_self), __pyx_v_ilabel, __pyx_v_olabel, __pyx_v_weight, __pyx_v_nextstate);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64 __pyx_v_ilabel, int64 __pyx_v_olabel, PyObject *__pyx_v_weight, int64 __pyx_v_nextstate) {
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64_t __pyx_v_ilabel, int64_t __pyx_v_olabel, PyObject *__pyx_v_weight, int64_t __pyx_v_nextstate) {
   fst::script::WeightClass __pyx_v__weight;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   fst::script::WeightClass __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3094
+  /* "fstlib/cext/pywrapfst.pyx":3160
  * 
- *   def __init__(self, int64 ilabel, int64 olabel, weight, int64 nextstate):
+ *   def __init__(self, int64_t ilabel, int64_t olabel, weight, int64_t nextstate):
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_one(b"tropical", weight)             # <<<<<<<<<<<<<<
  *     self._arc.reset(new fst.ArcClass(ilabel, olabel, _weight, nextstate))
  * 
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_one(__pyx_k_tropical, __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3094, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_one(__pyx_k_tropical, __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3160, __pyx_L1_error)
   __pyx_v__weight = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":3095
- *   def __init__(self, int64 ilabel, int64 olabel, weight, int64 nextstate):
+  /* "fstlib/cext/pywrapfst.pyx":3161
+ *   def __init__(self, int64_t ilabel, int64_t olabel, weight, int64_t nextstate):
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_one(b"tropical", weight)
  *     self._arc.reset(new fst.ArcClass(ilabel, olabel, _weight, nextstate))             # <<<<<<<<<<<<<<
  * 
  *   cpdef Arc copy(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 3095, __pyx_L1_error)
+    __PYX_ERR(0, 3161, __pyx_L1_error)
   }
   __pyx_v_self->_arc.reset(new fst::script::ArcClass(__pyx_v_ilabel, __pyx_v_olabel, __pyx_v__weight, __pyx_v_nextstate));
 
-  /* "fstlib/cext/pywrapfst.pyx":3093
+  /* "fstlib/cext/pywrapfst.pyx":3159
  *     return f"<Arc at 0x{id(self):x}>"
  * 
- *   def __init__(self, int64 ilabel, int64 olabel, weight, int64 nextstate):             # <<<<<<<<<<<<<<
+ *   def __init__(self, int64_t ilabel, int64_t olabel, weight, int64_t nextstate):             # <<<<<<<<<<<<<<
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_one(b"tropical", weight)
  *     self._arc.reset(new fst.ArcClass(ilabel, olabel, _weight, nextstate))
  */
 
   /* function exit code */
   __pyx_r = 0;
   goto __pyx_L0;
@@ -31498,15 +31864,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Arc.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3097
+/* "fstlib/cext/pywrapfst.pyx":3163
  *     self._arc.reset(new fst.ArcClass(ilabel, olabel, _weight, nextstate))
  * 
  *   cpdef Arc copy(self):             # <<<<<<<<<<<<<<
  *     return Arc(self.ilabel, self.olabel, self.weight, self.nextstate)
  * 
  */
 
@@ -31528,15 +31894,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3097, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_copy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3163, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_3Arc_5copy)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -31545,18 +31911,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3097, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3163, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Arc))))) __PYX_ERR(0, 3097, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Arc))))) __PYX_ERR(0, 3163, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -31567,52 +31933,52 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3098
+  /* "fstlib/cext/pywrapfst.pyx":3164
  * 
  *   cpdef Arc copy(self):
  *     return Arc(self.ilabel, self.olabel, self.weight, self.nextstate)             # <<<<<<<<<<<<<<
  * 
  *   property ilabel:
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_ilabel); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3098, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_ilabel); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3164, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_olabel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3098, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_olabel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3164, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_weight); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3098, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_weight); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3164, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nextstate); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3098, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nextstate); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3164, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3098, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3164, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_t_4);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
   __pyx_t_3 = 0;
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Arc), __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3098, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Arc), __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3164, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_t_4);
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3097
+  /* "fstlib/cext/pywrapfst.pyx":3163
  *     self._arc.reset(new fst.ArcClass(ilabel, olabel, _weight, nextstate))
  * 
  *   cpdef Arc copy(self):             # <<<<<<<<<<<<<<
  *     return Arc(self.ilabel, self.olabel, self.weight, self.nextstate)
  * 
  */
 
@@ -31649,15 +32015,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("copy", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Arc_copy(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3097, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_3Arc_copy(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3163, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -31666,15 +32032,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3102
+/* "fstlib/cext/pywrapfst.pyx":3168
  *   property ilabel:
  * 
  *     def __get__(self):             # <<<<<<<<<<<<<<
  *       return deref(self._arc).ilabel
  * 
  */
 
@@ -31696,33 +32062,33 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3103
+  /* "fstlib/cext/pywrapfst.pyx":3169
  * 
  *     def __get__(self):
  *       return deref(self._arc).ilabel             # <<<<<<<<<<<<<<
  * 
- *     def __set__(self, int64 value):
+ *     def __set__(self, int64_t value):
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 3103, __pyx_L1_error)
+    __PYX_ERR(0, 3169, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t((*__pyx_v_self->_arc).ilabel); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3103, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t((*__pyx_v_self->_arc).ilabel); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3102
+  /* "fstlib/cext/pywrapfst.pyx":3168
  *   property ilabel:
  * 
  *     def __get__(self):             # <<<<<<<<<<<<<<
  *       return deref(self._arc).ilabel
  * 
  */
 
@@ -31733,73 +32099,73 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3105
+/* "fstlib/cext/pywrapfst.pyx":3171
  *       return deref(self._arc).ilabel
  * 
- *     def __set__(self, int64 value):             # <<<<<<<<<<<<<<
+ *     def __set__(self, int64_t value):             # <<<<<<<<<<<<<<
  *       deref(self._arc).ilabel = value
  * 
  */
 
 /* Python wrapper */
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_3Arc_6ilabel_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_3Arc_6ilabel_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_value) {
-  int64 __pyx_v_value;
+  int64_t __pyx_v_value;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
   assert(__pyx_arg_value); {
-    __pyx_v_value = __Pyx_PyInt_As_int64_t(__pyx_arg_value); if (unlikely((__pyx_v_value == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3105, __pyx_L3_error)
+    __pyx_v_value = __Pyx_PyInt_As_int64_t(__pyx_arg_value); if (unlikely((__pyx_v_value == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3171, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Arc.ilabel.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6ilabel_2__set__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_v_self), ((int64)__pyx_v_value));
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6ilabel_2__set__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_v_self), ((int64_t)__pyx_v_value));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6ilabel_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64 __pyx_v_value) {
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6ilabel_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64_t __pyx_v_value) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3106
+  /* "fstlib/cext/pywrapfst.pyx":3172
  * 
- *     def __set__(self, int64 value):
+ *     def __set__(self, int64_t value):
  *       deref(self._arc).ilabel = value             # <<<<<<<<<<<<<<
  * 
  *   property olabel:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 3106, __pyx_L1_error)
+    __PYX_ERR(0, 3172, __pyx_L1_error)
   }
   (*__pyx_v_self->_arc).ilabel = __pyx_v_value;
 
-  /* "fstlib/cext/pywrapfst.pyx":3105
+  /* "fstlib/cext/pywrapfst.pyx":3171
  *       return deref(self._arc).ilabel
  * 
- *     def __set__(self, int64 value):             # <<<<<<<<<<<<<<
+ *     def __set__(self, int64_t value):             # <<<<<<<<<<<<<<
  *       deref(self._arc).ilabel = value
  * 
  */
 
   /* function exit code */
   __pyx_r = 0;
   goto __pyx_L0;
@@ -31807,15 +32173,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Arc.ilabel.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3110
+/* "fstlib/cext/pywrapfst.pyx":3176
  *   property olabel:
  * 
  *     def __get__(self):             # <<<<<<<<<<<<<<
  *       return deref(self._arc).olabel
  * 
  */
 
@@ -31837,33 +32203,33 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3111
+  /* "fstlib/cext/pywrapfst.pyx":3177
  * 
  *     def __get__(self):
  *       return deref(self._arc).olabel             # <<<<<<<<<<<<<<
  * 
- *     def __set__(self, int64 value):
+ *     def __set__(self, int64_t value):
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 3111, __pyx_L1_error)
+    __PYX_ERR(0, 3177, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t((*__pyx_v_self->_arc).olabel); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3111, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t((*__pyx_v_self->_arc).olabel); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3177, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3110
+  /* "fstlib/cext/pywrapfst.pyx":3176
  *   property olabel:
  * 
  *     def __get__(self):             # <<<<<<<<<<<<<<
  *       return deref(self._arc).olabel
  * 
  */
 
@@ -31874,73 +32240,73 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3113
+/* "fstlib/cext/pywrapfst.pyx":3179
  *       return deref(self._arc).olabel
  * 
- *     def __set__(self, int64 value):             # <<<<<<<<<<<<<<
+ *     def __set__(self, int64_t value):             # <<<<<<<<<<<<<<
  *       deref(self._arc).olabel = value
  * 
  */
 
 /* Python wrapper */
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_3Arc_6olabel_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_3Arc_6olabel_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_value) {
-  int64 __pyx_v_value;
+  int64_t __pyx_v_value;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
   assert(__pyx_arg_value); {
-    __pyx_v_value = __Pyx_PyInt_As_int64_t(__pyx_arg_value); if (unlikely((__pyx_v_value == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3113, __pyx_L3_error)
+    __pyx_v_value = __Pyx_PyInt_As_int64_t(__pyx_arg_value); if (unlikely((__pyx_v_value == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3179, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Arc.olabel.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6olabel_2__set__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_v_self), ((int64)__pyx_v_value));
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6olabel_2__set__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_v_self), ((int64_t)__pyx_v_value));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6olabel_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64 __pyx_v_value) {
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_6olabel_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64_t __pyx_v_value) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3114
+  /* "fstlib/cext/pywrapfst.pyx":3180
  * 
- *     def __set__(self, int64 value):
+ *     def __set__(self, int64_t value):
  *       deref(self._arc).olabel = value             # <<<<<<<<<<<<<<
  * 
  *   property weight:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 3114, __pyx_L1_error)
+    __PYX_ERR(0, 3180, __pyx_L1_error)
   }
   (*__pyx_v_self->_arc).olabel = __pyx_v_value;
 
-  /* "fstlib/cext/pywrapfst.pyx":3113
+  /* "fstlib/cext/pywrapfst.pyx":3179
  *       return deref(self._arc).olabel
  * 
- *     def __set__(self, int64 value):             # <<<<<<<<<<<<<<
+ *     def __set__(self, int64_t value):             # <<<<<<<<<<<<<<
  *       deref(self._arc).olabel = value
  * 
  */
 
   /* function exit code */
   __pyx_r = 0;
   goto __pyx_L0;
@@ -31948,15 +32314,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Arc.olabel.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3118
+/* "fstlib/cext/pywrapfst.pyx":3184
  *   property weight:
  * 
  *     def __get__(self):             # <<<<<<<<<<<<<<
  *       cdef Weight _weight = Weight.__new__(Weight)
  *       _weight._weight.reset(new fst.WeightClass(deref(self._arc).weight))
  */
 
@@ -31979,56 +32345,56 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3119
+  /* "fstlib/cext/pywrapfst.pyx":3185
  * 
  *     def __get__(self):
  *       cdef Weight _weight = Weight.__new__(Weight)             # <<<<<<<<<<<<<<
  *       _weight._weight.reset(new fst.WeightClass(deref(self._arc).weight))
  *       return _weight
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3119, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3185, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3120
+  /* "fstlib/cext/pywrapfst.pyx":3186
  *     def __get__(self):
  *       cdef Weight _weight = Weight.__new__(Weight)
  *       _weight._weight.reset(new fst.WeightClass(deref(self._arc).weight))             # <<<<<<<<<<<<<<
  *       return _weight
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 3120, __pyx_L1_error)
+    __PYX_ERR(0, 3186, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 3120, __pyx_L1_error)
+    __PYX_ERR(0, 3186, __pyx_L1_error)
   }
   __pyx_v__weight->_weight.reset(new fst::script::WeightClass((*__pyx_v_self->_arc).weight));
 
-  /* "fstlib/cext/pywrapfst.pyx":3121
+  /* "fstlib/cext/pywrapfst.pyx":3187
  *       cdef Weight _weight = Weight.__new__(Weight)
  *       _weight._weight.reset(new fst.WeightClass(deref(self._arc).weight))
  *       return _weight             # <<<<<<<<<<<<<<
  * 
  *     def __set__(self, weight):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __pyx_r = ((PyObject *)__pyx_v__weight);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3118
+  /* "fstlib/cext/pywrapfst.pyx":3184
  *   property weight:
  * 
  *     def __get__(self):             # <<<<<<<<<<<<<<
  *       cdef Weight _weight = Weight.__new__(Weight)
  *       _weight._weight.reset(new fst.WeightClass(deref(self._arc).weight))
  */
 
@@ -32040,15 +32406,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3123
+/* "fstlib/cext/pywrapfst.pyx":3189
  *       return _weight
  * 
  *     def __set__(self, weight):             # <<<<<<<<<<<<<<
  *       deref(self._arc).weight = _get_WeightClass_or_one(b"tropical", weight)
  * 
  */
 
@@ -32070,29 +32436,29 @@
   __Pyx_RefNannyDeclarations
   fst::script::WeightClass __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3124
+  /* "fstlib/cext/pywrapfst.pyx":3190
  * 
  *     def __set__(self, weight):
  *       deref(self._arc).weight = _get_WeightClass_or_one(b"tropical", weight)             # <<<<<<<<<<<<<<
  * 
  *   property nextstate:
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_one(__pyx_k_tropical, __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3124, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_one(__pyx_k_tropical, __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3190, __pyx_L1_error)
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 3124, __pyx_L1_error)
+    __PYX_ERR(0, 3190, __pyx_L1_error)
   }
   (*__pyx_v_self->_arc).weight = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":3123
+  /* "fstlib/cext/pywrapfst.pyx":3189
  *       return _weight
  * 
  *     def __set__(self, weight):             # <<<<<<<<<<<<<<
  *       deref(self._arc).weight = _get_WeightClass_or_one(b"tropical", weight)
  * 
  */
 
@@ -32103,15 +32469,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Arc.weight.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3128
+/* "fstlib/cext/pywrapfst.pyx":3194
  *   property nextstate:
  * 
  *     def __get__(self):             # <<<<<<<<<<<<<<
  *       return deref(self._arc).nextstate
  * 
  */
 
@@ -32133,33 +32499,33 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3129
+  /* "fstlib/cext/pywrapfst.pyx":3195
  * 
  *     def __get__(self):
  *       return deref(self._arc).nextstate             # <<<<<<<<<<<<<<
  * 
- *     def __set__(self, int64 value):
+ *     def __set__(self, int64_t value):
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 3129, __pyx_L1_error)
+    __PYX_ERR(0, 3195, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t((*__pyx_v_self->_arc).nextstate); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3129, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t((*__pyx_v_self->_arc).nextstate); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3195, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3128
+  /* "fstlib/cext/pywrapfst.pyx":3194
  *   property nextstate:
  * 
  *     def __get__(self):             # <<<<<<<<<<<<<<
  *       return deref(self._arc).nextstate
  * 
  */
 
@@ -32170,73 +32536,73 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3131
+/* "fstlib/cext/pywrapfst.pyx":3197
  *       return deref(self._arc).nextstate
  * 
- *     def __set__(self, int64 value):             # <<<<<<<<<<<<<<
+ *     def __set__(self, int64_t value):             # <<<<<<<<<<<<<<
  *       deref(self._arc).nextstate = value
  * 
  */
 
 /* Python wrapper */
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_3Arc_9nextstate_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_3Arc_9nextstate_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_arg_value) {
-  int64 __pyx_v_value;
+  int64_t __pyx_v_value;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
   assert(__pyx_arg_value); {
-    __pyx_v_value = __Pyx_PyInt_As_int64_t(__pyx_arg_value); if (unlikely((__pyx_v_value == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3131, __pyx_L3_error)
+    __pyx_v_value = __Pyx_PyInt_As_int64_t(__pyx_arg_value); if (unlikely((__pyx_v_value == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3197, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Arc.nextstate.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_9nextstate_2__set__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_v_self), ((int64)__pyx_v_value));
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_9nextstate_2__set__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_v_self), ((int64_t)__pyx_v_value));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_9nextstate_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64 __pyx_v_value) {
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_3Arc_9nextstate_2__set__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_self, int64_t __pyx_v_value) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3132
+  /* "fstlib/cext/pywrapfst.pyx":3198
  * 
- *     def __set__(self, int64 value):
+ *     def __set__(self, int64_t value):
  *       deref(self._arc).nextstate = value             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 3132, __pyx_L1_error)
+    __PYX_ERR(0, 3198, __pyx_L1_error)
   }
   (*__pyx_v_self->_arc).nextstate = __pyx_v_value;
 
-  /* "fstlib/cext/pywrapfst.pyx":3131
+  /* "fstlib/cext/pywrapfst.pyx":3197
  *       return deref(self._arc).nextstate
  * 
- *     def __set__(self, int64 value):             # <<<<<<<<<<<<<<
+ *     def __set__(self, int64_t value):             # <<<<<<<<<<<<<<
  *       deref(self._arc).nextstate = value
  * 
  */
 
   /* function exit code */
   __pyx_r = 0;
   goto __pyx_L0;
@@ -32278,15 +32644,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._arc cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._arc cannot be converted to a Python object for pickling")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -32334,15 +32700,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._arc cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._arc cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__25, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__23, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -32357,15 +32723,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Arc.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3135
+/* "fstlib/cext/pywrapfst.pyx":3201
  * 
  * 
  * cdef Arc _init_Arc(const fst.ArcClass &arc):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(arc.weight))
  */
 
@@ -32378,75 +32744,75 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_init_Arc", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3136
+  /* "fstlib/cext/pywrapfst.pyx":3202
  * 
  * cdef Arc _init_Arc(const fst.ArcClass &arc):
  *   cdef Weight _weight = Weight.__new__(Weight)             # <<<<<<<<<<<<<<
  *   _weight._weight.reset(new fst.WeightClass(arc.weight))
  *   return Arc(arc.ilabel, arc.olabel, _weight, arc.nextstate)
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3136, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_Weight(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3202, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v__weight = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3137
+  /* "fstlib/cext/pywrapfst.pyx":3203
  * cdef Arc _init_Arc(const fst.ArcClass &arc):
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(arc.weight))             # <<<<<<<<<<<<<<
  *   return Arc(arc.ilabel, arc.olabel, _weight, arc.nextstate)
  * 
  */
   if (unlikely(((PyObject *)__pyx_v__weight) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_weight");
-    __PYX_ERR(0, 3137, __pyx_L1_error)
+    __PYX_ERR(0, 3203, __pyx_L1_error)
   }
   __pyx_v__weight->_weight.reset(new fst::script::WeightClass(__pyx_v_arc.weight));
 
-  /* "fstlib/cext/pywrapfst.pyx":3138
+  /* "fstlib/cext/pywrapfst.pyx":3204
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(arc.weight))
  *   return Arc(arc.ilabel, arc.olabel, _weight, arc.nextstate)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_arc.ilabel); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3138, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_arc.ilabel); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3204, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_v_arc.olabel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3138, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_v_arc.olabel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3204, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_arc.nextstate); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3138, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_arc.nextstate); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3204, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3138, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3204, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
   __Pyx_INCREF(((PyObject *)__pyx_v__weight));
   __Pyx_GIVEREF(((PyObject *)__pyx_v__weight));
   PyTuple_SET_ITEM(__pyx_t_4, 2, ((PyObject *)__pyx_v__weight));
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 3, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Arc), __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3138, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Arc), __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3204, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3135
+  /* "fstlib/cext/pywrapfst.pyx":3201
  * 
  * 
  * cdef Arc _init_Arc(const fst.ArcClass &arc):             # <<<<<<<<<<<<<<
  *   cdef Weight _weight = Weight.__new__(Weight)
  *   _weight._weight.reset(new fst.WeightClass(arc.weight))
  */
 
@@ -32461,15 +32827,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__weight);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3152
+/* "fstlib/cext/pywrapfst.pyx":3218
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<_ArcIterator at 0x{id(self):x}>"
  * 
  */
 
@@ -32495,52 +32861,52 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3153
+  /* "fstlib/cext/pywrapfst.pyx":3219
  * 
  *   def __repr__(self):
  *     return f"<_ArcIterator at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
- *   def __init__(self, Fst ifst, int64 state):
+ *   def __init__(self, Fst ifst, int64_t state):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3153, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_ArcIterator_at_0x);
   __pyx_t_2 += 19;
   __Pyx_GIVEREF(__pyx_kp_u_ArcIterator_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_ArcIterator_at_0x);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3153, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3153, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3153, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3152
+  /* "fstlib/cext/pywrapfst.pyx":3218
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<_ArcIterator at 0x{id(self):x}>"
  * 
  */
 
@@ -32553,27 +32919,27 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3155
+/* "fstlib/cext/pywrapfst.pyx":3221
  *     return f"<_ArcIterator at 0x{id(self):x}>"
  * 
- *   def __init__(self, Fst ifst, int64 state):             # <<<<<<<<<<<<<<
+ *   def __init__(self, Fst ifst, int64_t state):             # <<<<<<<<<<<<<<
  *     if not ifst._fst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")
  */
 
 /* Python wrapper */
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst = 0;
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
   {
@@ -32595,152 +32961,152 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_state)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, 1); __PYX_ERR(0, 3155, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, 1); __PYX_ERR(0, 3221, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 3155, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 3221, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3155, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3221, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3155, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3221, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._ArcIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3155, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3221, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_2__init__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *)__pyx_v_self), __pyx_v_ifst, __pyx_v_state);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, int64 __pyx_v_state) {
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, int64_t __pyx_v_state) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   std::shared_ptr<fst::script::FstClass>  __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3156
+  /* "fstlib/cext/pywrapfst.pyx":3222
  * 
- *   def __init__(self, Fst ifst, int64 state):
+ *   def __init__(self, Fst ifst, int64_t state):
  *     if not ifst._fst.get().ValidStateId(state):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3156, __pyx_L1_error)
+    __PYX_ERR(0, 3222, __pyx_L1_error)
   }
   __pyx_t_1 = ((!(__pyx_v_ifst->_fst.get()->ValidStateId(__pyx_v_state) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":3157
- *   def __init__(self, Fst ifst, int64 state):
+    /* "fstlib/cext/pywrapfst.pyx":3223
+ *   def __init__(self, Fst ifst, int64_t state):
  *     if not ifst._fst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  *     self._fst = ifst._fst
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3157, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3223, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_State_index_out_of_range);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3157, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3223, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 3157, __pyx_L1_error)
+    __PYX_ERR(0, 3223, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":3156
+    /* "fstlib/cext/pywrapfst.pyx":3222
  * 
- *   def __init__(self, Fst ifst, int64 state):
+ *   def __init__(self, Fst ifst, int64_t state):
  *     if not ifst._fst.get().ValidStateId(state):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3159
+  /* "fstlib/cext/pywrapfst.pyx":3225
  *       raise FstIndexError("State index out of range")
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  *     self._fst = ifst._fst             # <<<<<<<<<<<<<<
  *     self._aiter.reset(new fst.ArcIteratorClass(deref(self._fst), state))
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3159, __pyx_L1_error)
+    __PYX_ERR(0, 3225, __pyx_L1_error)
   }
   __pyx_t_5 = __pyx_v_ifst->_fst;
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3159, __pyx_L1_error)
+    __PYX_ERR(0, 3225, __pyx_L1_error)
   }
   __pyx_v_self->_fst = __pyx_t_5;
 
-  /* "fstlib/cext/pywrapfst.pyx":3160
+  /* "fstlib/cext/pywrapfst.pyx":3226
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  *     self._fst = ifst._fst
  *     self._aiter.reset(new fst.ArcIteratorClass(deref(self._fst), state))             # <<<<<<<<<<<<<<
  * 
  *   # This just registers this class as a possible iterator.
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3160, __pyx_L1_error)
+    __PYX_ERR(0, 3226, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3160, __pyx_L1_error)
+    __PYX_ERR(0, 3226, __pyx_L1_error)
   }
   __pyx_v_self->_aiter.reset(new fst::script::ArcIteratorClass((*__pyx_v_self->_fst), __pyx_v_state));
 
-  /* "fstlib/cext/pywrapfst.pyx":3155
+  /* "fstlib/cext/pywrapfst.pyx":3221
  *     return f"<_ArcIterator at 0x{id(self):x}>"
  * 
- *   def __init__(self, Fst ifst, int64 state):             # <<<<<<<<<<<<<<
+ *   def __init__(self, Fst ifst, int64_t state):             # <<<<<<<<<<<<<<
  *     if not ifst._fst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")
  */
 
   /* function exit code */
   __pyx_r = 0;
   goto __pyx_L0;
@@ -32751,15 +33117,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._ArcIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3163
+/* "fstlib/cext/pywrapfst.pyx":3229
  * 
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
 
@@ -32777,42 +33143,42 @@
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_4__iter__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__iter__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3164
+  /* "fstlib/cext/pywrapfst.pyx":3230
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3163
+  /* "fstlib/cext/pywrapfst.pyx":3229
  * 
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3167
+/* "fstlib/cext/pywrapfst.pyx":3233
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):             # <<<<<<<<<<<<<<
  *     if self.done():
  *       raise StopIteration
  */
 
@@ -32826,119 +33192,119 @@
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_6__next__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self) {
-  PyObject *__pyx_v_result = NULL;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_result = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__next__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3168
+  /* "fstlib/cext/pywrapfst.pyx":3234
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):
  *     if self.done():             # <<<<<<<<<<<<<<
  *       raise StopIteration
- *     result = self.value()
+ *     result = self._value()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "done");
-    __PYX_ERR(0, 3168, __pyx_L1_error)
+    __PYX_ERR(0, 3234, __pyx_L1_error)
   }
   __pyx_t_1 = (((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__ArcIterator *)__pyx_v_self->__pyx_vtab)->done(__pyx_v_self, 0) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":3169
+    /* "fstlib/cext/pywrapfst.pyx":3235
  *   def __next__(self):
  *     if self.done():
  *       raise StopIteration             # <<<<<<<<<<<<<<
- *     result = self.value()
+ *     result = self._value()
  *     self.next()
  */
     __Pyx_Raise(__pyx_builtin_StopIteration, 0, 0, 0);
-    __PYX_ERR(0, 3169, __pyx_L1_error)
+    __PYX_ERR(0, 3235, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":3168
+    /* "fstlib/cext/pywrapfst.pyx":3234
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):
  *     if self.done():             # <<<<<<<<<<<<<<
  *       raise StopIteration
- *     result = self.value()
+ *     result = self._value()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3170
+  /* "fstlib/cext/pywrapfst.pyx":3236
  *     if self.done():
  *       raise StopIteration
- *     result = self.value()             # <<<<<<<<<<<<<<
+ *     result = self._value()             # <<<<<<<<<<<<<<
  *     self.next()
  *     return result
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
-    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "value");
-    __PYX_ERR(0, 3170, __pyx_L1_error)
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_value");
+    __PYX_ERR(0, 3236, __pyx_L1_error)
   }
-  __pyx_t_2 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__ArcIterator *)__pyx_v_self->__pyx_vtab)->value(__pyx_v_self, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3170, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__ArcIterator *)__pyx_v_self->__pyx_vtab)->_value(__pyx_v_self)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3236, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_v_result = __pyx_t_2;
+  __pyx_v_result = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3171
+  /* "fstlib/cext/pywrapfst.pyx":3237
  *       raise StopIteration
- *     result = self.value()
+ *     result = self._value()
  *     self.next()             # <<<<<<<<<<<<<<
  *     return result
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "next");
-    __PYX_ERR(0, 3171, __pyx_L1_error)
+    __PYX_ERR(0, 3237, __pyx_L1_error)
   }
   ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__ArcIterator *)__pyx_v_self->__pyx_vtab)->next(__pyx_v_self, 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3172
- *     result = self.value()
+  /* "fstlib/cext/pywrapfst.pyx":3238
+ *     result = self._value()
  *     self.next()
  *     return result             # <<<<<<<<<<<<<<
  * 
  *   cpdef bool done(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(__pyx_v_result);
-  __pyx_r = __pyx_v_result;
+  __Pyx_INCREF(((PyObject *)__pyx_v_result));
+  __pyx_r = ((PyObject *)__pyx_v_result);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3167
+  /* "fstlib/cext/pywrapfst.pyx":3233
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):             # <<<<<<<<<<<<<<
  *     if self.done():
  *       raise StopIteration
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._ArcIterator.__next__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_result);
+  __Pyx_XDECREF((PyObject *)__pyx_v_result);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3174
+/* "fstlib/cext/pywrapfst.pyx":3240
  *     return result
  * 
  *   cpdef bool done(self):             # <<<<<<<<<<<<<<
  *     """
  *     done(self)
  */
 
@@ -32960,15 +33326,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_done); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3174, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_done); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3240, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_9done)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -32976,18 +33342,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3174, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3240, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3174, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3240, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -32998,29 +33364,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3183
+  /* "fstlib/cext/pywrapfst.pyx":3249
  *       True if the iterator is exhausted, False otherwise.
  *     """
  *     return self._aiter.get().Done()             # <<<<<<<<<<<<<<
  * 
- *   cpdef uint8 flags(self):
+ *   cpdef uint8_t flags(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3183, __pyx_L1_error)
+    __PYX_ERR(0, 3249, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_aiter.get()->Done();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3174
+  /* "fstlib/cext/pywrapfst.pyx":3240
  *     return result
  * 
  *   cpdef bool done(self):             # <<<<<<<<<<<<<<
  *     """
  *     done(self)
  */
 
@@ -33056,15 +33422,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("done", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_done(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3174, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_done(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -33073,45 +33439,45 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3185
+/* "fstlib/cext/pywrapfst.pyx":3251
  *     return self._aiter.get().Done()
  * 
- *   cpdef uint8 flags(self):             # <<<<<<<<<<<<<<
+ *   cpdef uint8_t flags(self):             # <<<<<<<<<<<<<<
  *     """
  *     flags(self)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_11flags(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static uint8 __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, int __pyx_skip_dispatch) {
-  uint8 __pyx_r;
+static uint8_t __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, int __pyx_skip_dispatch) {
+  uint8_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  uint8 __pyx_t_5;
+  uint8_t __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("flags", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3185, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3251, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_11flags)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -33119,18 +33485,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3185, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3251, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyInt_As_uint8_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((uint8)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3185, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_As_uint8_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((uint8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3251, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -33141,32 +33507,32 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3194
+  /* "fstlib/cext/pywrapfst.pyx":3260
  *       The current iterator behavioral flags as an integer.
  *     """
  *     return self._aiter.get().Flags()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void next(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3194, __pyx_L1_error)
+    __PYX_ERR(0, 3260, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_aiter.get()->Flags();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3185
+  /* "fstlib/cext/pywrapfst.pyx":3251
  *     return self._aiter.get().Done()
  * 
- *   cpdef uint8 flags(self):             # <<<<<<<<<<<<<<
+ *   cpdef uint8_t flags(self):             # <<<<<<<<<<<<<<
  *     """
  *     flags(self)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -33199,15 +33565,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("flags", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_uint8_t(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_flags(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3185, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_uint8_t(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_flags(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3251, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -33216,15 +33582,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3196
+/* "fstlib/cext/pywrapfst.pyx":3262
  *     return self._aiter.get().Flags()
  * 
  *   cpdef void next(self):             # <<<<<<<<<<<<<<
  *     """
  *     next(self)
  */
 
@@ -33244,15 +33610,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_next); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3196, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_next); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3262, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_13next)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -33260,15 +33626,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3196, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3262, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -33280,28 +33646,28 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3202
+  /* "fstlib/cext/pywrapfst.pyx":3268
  *     Advances the iterator.
  *     """
  *     self._aiter.get().Next()             # <<<<<<<<<<<<<<
  * 
  *   cpdef size_t position(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3202, __pyx_L1_error)
+    __PYX_ERR(0, 3268, __pyx_L1_error)
   }
   __pyx_v_self->_aiter.get()->Next();
 
-  /* "fstlib/cext/pywrapfst.pyx":3196
+  /* "fstlib/cext/pywrapfst.pyx":3262
  *     return self._aiter.get().Flags()
  * 
  *   cpdef void next(self):             # <<<<<<<<<<<<<<
  *     """
  *     next(self)
  */
 
@@ -33336,15 +33702,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("next", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_next(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3196, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_next(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3262, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -33353,15 +33719,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3204
+/* "fstlib/cext/pywrapfst.pyx":3270
  *     self._aiter.get().Next()
  * 
  *   cpdef size_t position(self):             # <<<<<<<<<<<<<<
  *     """
  *     position(self)
  */
 
@@ -33383,15 +33749,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_position); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3204, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_position); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3270, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_15position)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -33399,18 +33765,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3204, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3270, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_5 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 3204, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_5 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 3270, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -33421,29 +33787,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3213
+  /* "fstlib/cext/pywrapfst.pyx":3279
  *       The iterator's position, expressed as an integer.
  *     """
  *     return self._aiter.get().Position()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void reset(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3213, __pyx_L1_error)
+    __PYX_ERR(0, 3279, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_aiter.get()->Position();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3204
+  /* "fstlib/cext/pywrapfst.pyx":3270
  *     self._aiter.get().Next()
  * 
  *   cpdef size_t position(self):             # <<<<<<<<<<<<<<
  *     """
  *     position(self)
  */
 
@@ -33479,15 +33845,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("position", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_FromSize_t(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_position(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3204, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_FromSize_t(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_position(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -33496,15 +33862,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3215
+/* "fstlib/cext/pywrapfst.pyx":3281
  *     return self._aiter.get().Position()
  * 
  *   cpdef void reset(self):             # <<<<<<<<<<<<<<
  *     """
  *     reset(self)
  */
 
@@ -33524,15 +33890,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3215, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3281, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_17reset)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -33540,15 +33906,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3215, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3281, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -33560,28 +33926,28 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3221
+  /* "fstlib/cext/pywrapfst.pyx":3287
  *     Resets the iterator to the initial position.
  *     """
  *     self._aiter.get().Reset()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void seek(self, size_t a):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3221, __pyx_L1_error)
+    __PYX_ERR(0, 3287, __pyx_L1_error)
   }
   __pyx_v_self->_aiter.get()->Reset();
 
-  /* "fstlib/cext/pywrapfst.pyx":3215
+  /* "fstlib/cext/pywrapfst.pyx":3281
  *     return self._aiter.get().Position()
  * 
  *   cpdef void reset(self):             # <<<<<<<<<<<<<<
  *     """
  *     reset(self)
  */
 
@@ -33616,15 +33982,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("reset", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_reset(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3215, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_reset(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3281, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -33633,15 +33999,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3223
+/* "fstlib/cext/pywrapfst.pyx":3289
  *     self._aiter.get().Reset()
  * 
  *   cpdef void seek(self, size_t a):             # <<<<<<<<<<<<<<
  *     """
  *     seek(self, a)
  */
 
@@ -33662,18 +34028,18 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_seek); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3223, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_seek); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3289, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_19seek)) {
-        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3223, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3289, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -33681,15 +34047,15 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3223, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3289, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -33701,28 +34067,28 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3232
+  /* "fstlib/cext/pywrapfst.pyx":3298
  *       a: The position to seek to.
  *     """
  *     self._aiter.get().Seek(a)             # <<<<<<<<<<<<<<
  * 
- *   cpdef void set_flags(self, uint8 flags, uint8 mask):
+ *   cpdef void set_flags(self, uint8_t flags, uint8_t mask):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3232, __pyx_L1_error)
+    __PYX_ERR(0, 3298, __pyx_L1_error)
   }
   __pyx_v_self->_aiter.get()->Seek(__pyx_v_a);
 
-  /* "fstlib/cext/pywrapfst.pyx":3223
+  /* "fstlib/cext/pywrapfst.pyx":3289
  *     self._aiter.get().Reset()
  * 
  *   cpdef void seek(self, size_t a):             # <<<<<<<<<<<<<<
  *     """
  *     seek(self, a)
  */
 
@@ -33747,15 +34113,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("seek (wrapper)", 0);
   assert(__pyx_arg_a); {
-    __pyx_v_a = __Pyx_PyInt_As_size_t(__pyx_arg_a); if (unlikely((__pyx_v_a == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 3223, __pyx_L3_error)
+    __pyx_v_a = __Pyx_PyInt_As_size_t(__pyx_arg_a); if (unlikely((__pyx_v_a == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 3289, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._ArcIterator.seek", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
@@ -33771,15 +34137,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("seek", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_seek(__pyx_v_self, __pyx_v_a, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3223, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_seek(__pyx_v_self, __pyx_v_a, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3289, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -33788,24 +34154,24 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3234
+/* "fstlib/cext/pywrapfst.pyx":3300
  *     self._aiter.get().Seek(a)
  * 
- *   cpdef void set_flags(self, uint8 flags, uint8 mask):             # <<<<<<<<<<<<<<
+ *   cpdef void set_flags(self, uint8_t flags, uint8_t mask):             # <<<<<<<<<<<<<<
  *     """
  *     set_flags(self, flags, mask)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_21set_flags(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, uint8 __pyx_v_flags, uint8 __pyx_v_mask, int __pyx_skip_dispatch) {
+static void __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, uint8_t __pyx_v_flags, uint8_t __pyx_v_mask, int __pyx_skip_dispatch) {
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
@@ -33820,20 +34186,20 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3234, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3300, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_21set_flags)) {
-        __pyx_t_3 = __Pyx_PyInt_From_uint8_t(__pyx_v_flags); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3234, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_uint8_t(__pyx_v_flags); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3300, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_4 = __Pyx_PyInt_From_uint8_t(__pyx_v_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3234, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyInt_From_uint8_t(__pyx_v_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3300, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_5 = __pyx_t_1; __pyx_t_6 = NULL;
         __pyx_t_7 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
           __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
           if (likely(__pyx_t_6)) {
@@ -33843,44 +34209,44 @@
             __Pyx_DECREF_SET(__pyx_t_5, function);
             __pyx_t_7 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_5)) {
           PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_3, __pyx_t_4};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3234, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3300, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
           PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_3, __pyx_t_4};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3234, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3300, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         } else
         #endif
         {
-          __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3234, __pyx_L1_error)
+          __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3300, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_8);
           if (__pyx_t_6) {
             __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
           }
           __Pyx_GIVEREF(__pyx_t_3);
           PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_3);
           __Pyx_GIVEREF(__pyx_t_4);
           PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_4);
           __pyx_t_3 = 0;
           __pyx_t_4 = 0;
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3234, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3300, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         }
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
@@ -33894,31 +34260,31 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3244
+  /* "fstlib/cext/pywrapfst.pyx":3310
  *       mask: A mask to be applied to the `flags` argument before setting them.
  *     """
  *     self._aiter.get().SetFlags(flags, mask)             # <<<<<<<<<<<<<<
  * 
- *   cpdef object value(self):
+ *   cdef Arc _value(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3244, __pyx_L1_error)
+    __PYX_ERR(0, 3310, __pyx_L1_error)
   }
   __pyx_v_self->_aiter.get()->SetFlags(__pyx_v_flags, __pyx_v_mask);
 
-  /* "fstlib/cext/pywrapfst.pyx":3234
+  /* "fstlib/cext/pywrapfst.pyx":3300
  *     self._aiter.get().Seek(a)
  * 
- *   cpdef void set_flags(self, uint8 flags, uint8 mask):             # <<<<<<<<<<<<<<
+ *   cpdef void set_flags(self, uint8_t flags, uint8_t mask):             # <<<<<<<<<<<<<<
  *     """
  *     set_flags(self, flags, mask)
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
@@ -33934,16 +34300,16 @@
   __Pyx_RefNannyFinishContext();
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_21set_flags(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_12_ArcIterator_20set_flags[] = "\n    set_flags(self, flags, mask)\n\n    Sets the current iterator behavioral flags.\n\n    Args:\n      flags: The properties to be set.\n      mask: A mask to be applied to the `flags` argument before setting them.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_21set_flags(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  uint8 __pyx_v_flags;
-  uint8 __pyx_v_mask;
+  uint8_t __pyx_v_flags;
+  uint8_t __pyx_v_mask;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_flags (wrapper)", 0);
   {
@@ -33965,54 +34331,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_flags)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mask)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("set_flags", 1, 2, 2, 1); __PYX_ERR(0, 3234, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("set_flags", 1, 2, 2, 1); __PYX_ERR(0, 3300, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_flags") < 0)) __PYX_ERR(0, 3234, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_flags") < 0)) __PYX_ERR(0, 3300, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
-    __pyx_v_flags = __Pyx_PyInt_As_uint8_t(values[0]); if (unlikely((__pyx_v_flags == ((uint8)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3234, __pyx_L3_error)
-    __pyx_v_mask = __Pyx_PyInt_As_uint8_t(values[1]); if (unlikely((__pyx_v_mask == ((uint8)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3234, __pyx_L3_error)
+    __pyx_v_flags = __Pyx_PyInt_As_uint8_t(values[0]); if (unlikely((__pyx_v_flags == ((uint8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3300, __pyx_L3_error)
+    __pyx_v_mask = __Pyx_PyInt_As_uint8_t(values[1]); if (unlikely((__pyx_v_mask == ((uint8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3300, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("set_flags", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3234, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("set_flags", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3300, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._ArcIterator.set_flags", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_20set_flags(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *)__pyx_v_self), __pyx_v_flags, __pyx_v_mask);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_20set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, uint8 __pyx_v_flags, uint8 __pyx_v_mask) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_20set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, uint8_t __pyx_v_flags, uint8_t __pyx_v_mask) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_flags", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_set_flags(__pyx_v_self, __pyx_v_flags, __pyx_v_mask, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3234, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_set_flags(__pyx_v_self, __pyx_v_flags, __pyx_v_mask, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3300, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -34021,153 +34387,184 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3246
+/* "fstlib/cext/pywrapfst.pyx":3312
  *     self._aiter.get().SetFlags(flags, mask)
  * 
- *   cpdef object value(self):             # <<<<<<<<<<<<<<
+ *   cdef Arc _value(self):             # <<<<<<<<<<<<<<
  *     """
  *     value(self)
  */
 
-static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_23value(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static PyObject *__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self, int __pyx_skip_dispatch) {
-  PyObject *__pyx_r = NULL;
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator__value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self) {
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("value", 0);
-  /* Check if called by wrapper */
-  if (unlikely(__pyx_skip_dispatch)) ;
-  /* Check if overridden in Python */
-  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
-    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
-    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
-    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
-      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
-      #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3246, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_23value)) {
-        __Pyx_XDECREF(__pyx_r);
-        __Pyx_INCREF(__pyx_t_1);
-        __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
-        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
-          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
-          if (likely(__pyx_t_4)) {
-            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
-            __Pyx_INCREF(__pyx_t_4);
-            __Pyx_INCREF(function);
-            __Pyx_DECREF_SET(__pyx_t_3, function);
-          }
-        }
-        __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
-        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3246, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_2);
-        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_r = __pyx_t_2;
-        __pyx_t_2 = 0;
-        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        goto __pyx_L0;
-      }
-      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
-      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
-      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
-      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
-        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
-      }
-      #endif
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
-    }
-    #endif
-  }
+  __Pyx_RefNannySetupContext("_value", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3252
- *     Returns the current arc.
+  /* "fstlib/cext/pywrapfst.pyx":3321
+ *        The current arc.
  *     """
  *     return _init_Arc(self._aiter.get().Value())             # <<<<<<<<<<<<<<
  * 
- * 
+ *   def value(self):
  */
-  __Pyx_XDECREF(__pyx_r);
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3252, __pyx_L1_error)
+    __PYX_ERR(0, 3321, __pyx_L1_error)
   }
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_Arc(__pyx_v_self->_aiter.get()->Value())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3252, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_Arc(__pyx_v_self->_aiter.get()->Value())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3321, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
+  __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3246
+  /* "fstlib/cext/pywrapfst.pyx":3312
  *     self._aiter.get().SetFlags(flags, mask)
  * 
- *   cpdef object value(self):             # <<<<<<<<<<<<<<
+ *   cdef Arc _value(self):             # <<<<<<<<<<<<<<
  *     """
  *     value(self)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("fstlib.cext.pywrapfst._ArcIterator.value", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("fstlib.cext.pywrapfst._ArcIterator._value", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "fstlib/cext/pywrapfst.pyx":3323
+ *     return _init_Arc(self._aiter.get().Value())
+ * 
+ *   def value(self):             # <<<<<<<<<<<<<<
+ *     """
+ *     value(self)
+ */
+
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_23value(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static char __pyx_doc_6fstlib_4cext_9pywrapfst_12_ArcIterator_22value[] = "\n    value(self)\n\n    Returns the current arc.\n    ";
+static char __pyx_doc_6fstlib_4cext_9pywrapfst_12_ArcIterator_22value[] = "\n    value(self)\n\n    Returns the current arc.\n\n    Returns:\n       The current arc.\n\n    Raises:\n      FstOpError: Can't get value from an exhausted iterator.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_12_ArcIterator_23value(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("value (wrapper)", 0);
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_22value(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_12_ArcIterator_22value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("value", 0);
+
+  /* "fstlib/cext/pywrapfst.pyx":3335
+ *       FstOpError: Can't get value from an exhausted iterator.
+ *     """
+ *     if self._aiter.get().Done():             # <<<<<<<<<<<<<<
+ *       raise FstOpError("Can't get value from an exhausted iterator")
+ *     return self._value()
+ */
+  if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
+    __PYX_ERR(0, 3335, __pyx_L1_error)
+  }
+  __pyx_t_1 = (__pyx_v_self->_aiter.get()->Done() != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "fstlib/cext/pywrapfst.pyx":3336
+ *     """
+ *     if self._aiter.get().Done():
+ *       raise FstOpError("Can't get value from an exhausted iterator")             # <<<<<<<<<<<<<<
+ *     return self._value()
+ * 
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3336, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+      if (likely(__pyx_t_4)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+        __Pyx_INCREF(__pyx_t_4);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_3, function);
+      }
+    }
+    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Can_t_get_value_from_an_exhauste) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Can_t_get_value_from_an_exhauste);
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3336, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 3336, __pyx_L1_error)
+
+    /* "fstlib/cext/pywrapfst.pyx":3335
+ *       FstOpError: Can't get value from an exhausted iterator.
+ *     """
+ *     if self._aiter.get().Done():             # <<<<<<<<<<<<<<
+ *       raise FstOpError("Can't get value from an exhausted iterator")
+ *     return self._value()
+ */
+  }
+
+  /* "fstlib/cext/pywrapfst.pyx":3337
+ *     if self._aiter.get().Done():
+ *       raise FstOpError("Can't get value from an exhausted iterator")
+ *     return self._value()             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_value(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3246, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_value");
+    __PYX_ERR(0, 3337, __pyx_L1_error)
+  }
+  __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__ArcIterator *)__pyx_v_self->__pyx_vtab)->_value(__pyx_v_self)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3337, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
+  /* "fstlib/cext/pywrapfst.pyx":3323
+ *     return _init_Arc(self._aiter.get().Value())
+ * 
+ *   def value(self):             # <<<<<<<<<<<<<<
+ *     """
+ *     value(self)
+ */
+
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._ArcIterator.value", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
@@ -34202,15 +34599,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._aiter,self._fst cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._aiter,self._fst cannot be converted to a Python object for pickling")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__26, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -34258,15 +34655,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._aiter,self._fst cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._aiter,self._fst cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__27, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__25, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -34281,15 +34678,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._ArcIterator.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3264
+/* "fstlib/cext/pywrapfst.pyx":3349
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<_MutableArcIterator at 0x{id(self):x}>"
  * 
  */
 
@@ -34315,52 +34712,52 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3265
+  /* "fstlib/cext/pywrapfst.pyx":3350
  * 
  *   def __repr__(self):
  *     return f"<_MutableArcIterator at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
- *   def __init__(self, MutableFst ifst, int64 state):
+ *   def __init__(self, MutableFst ifst, int64_t state):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3265, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_MutableArcIterator_at_0x);
   __pyx_t_2 += 26;
   __Pyx_GIVEREF(__pyx_kp_u_MutableArcIterator_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_MutableArcIterator_at_0x);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3265, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3265, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3265, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3264
+  /* "fstlib/cext/pywrapfst.pyx":3349
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<_MutableArcIterator at 0x{id(self):x}>"
  * 
  */
 
@@ -34373,27 +34770,27 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3267
+/* "fstlib/cext/pywrapfst.pyx":3352
  *     return f"<_MutableArcIterator at 0x{id(self):x}>"
  * 
- *   def __init__(self, MutableFst ifst, int64 state):             # <<<<<<<<<<<<<<
+ *   def __init__(self, MutableFst ifst, int64_t state):             # <<<<<<<<<<<<<<
  *     if not ifst._fst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")
  */
 
 /* Python wrapper */
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_3__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_ifst = 0;
-  int64 __pyx_v_state;
+  int64_t __pyx_v_state;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
   {
@@ -34415,152 +34812,152 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_state)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, 1); __PYX_ERR(0, 3267, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, 1); __PYX_ERR(0, 3352, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 3267, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 3352, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)values[0]);
-    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_state == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3267, __pyx_L3_error)
+    __pyx_v_state = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_state == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3352, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3267, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3352, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._MutableArcIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_MutableFst, 1, "ifst", 0))) __PYX_ERR(0, 3267, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_MutableFst, 1, "ifst", 0))) __PYX_ERR(0, 3352, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_2__init__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_v_self), __pyx_v_ifst, __pyx_v_state);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_ifst, int64 __pyx_v_state) {
+static int __pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_2__init__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_v_ifst, int64_t __pyx_v_state) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   std::shared_ptr<fst::script::MutableFstClass>  __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3268
+  /* "fstlib/cext/pywrapfst.pyx":3353
  * 
- *   def __init__(self, MutableFst ifst, int64 state):
+ *   def __init__(self, MutableFst ifst, int64_t state):
  *     if not ifst._fst.get().ValidStateId(state):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3268, __pyx_L1_error)
+    __PYX_ERR(0, 3353, __pyx_L1_error)
   }
   __pyx_t_1 = ((!(__pyx_v_ifst->__pyx_base._fst.get()->ValidStateId(__pyx_v_state) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":3269
- *   def __init__(self, MutableFst ifst, int64 state):
+    /* "fstlib/cext/pywrapfst.pyx":3354
+ *   def __init__(self, MutableFst ifst, int64_t state):
  *     if not ifst._fst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")             # <<<<<<<<<<<<<<
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  *     self._mfst = ifst._mfst
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3269, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstIndexError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3354, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_State_index_out_of_range) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_State_index_out_of_range);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3269, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3354, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 3269, __pyx_L1_error)
+    __PYX_ERR(0, 3354, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":3268
+    /* "fstlib/cext/pywrapfst.pyx":3353
  * 
- *   def __init__(self, MutableFst ifst, int64 state):
+ *   def __init__(self, MutableFst ifst, int64_t state):
  *     if not ifst._fst.get().ValidStateId(state):             # <<<<<<<<<<<<<<
  *       raise FstIndexError("State index out of range")
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3271
+  /* "fstlib/cext/pywrapfst.pyx":3356
  *       raise FstIndexError("State index out of range")
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  *     self._mfst = ifst._mfst             # <<<<<<<<<<<<<<
  *     self._aiter.reset(new fst.MutableArcIteratorClass(ifst._mfst.get(), state))
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 3271, __pyx_L1_error)
+    __PYX_ERR(0, 3356, __pyx_L1_error)
   }
   __pyx_t_5 = __pyx_v_ifst->_mfst;
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 3271, __pyx_L1_error)
+    __PYX_ERR(0, 3356, __pyx_L1_error)
   }
   __pyx_v_self->_mfst = __pyx_t_5;
 
-  /* "fstlib/cext/pywrapfst.pyx":3272
+  /* "fstlib/cext/pywrapfst.pyx":3357
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  *     self._mfst = ifst._mfst
  *     self._aiter.reset(new fst.MutableArcIteratorClass(ifst._mfst.get(), state))             # <<<<<<<<<<<<<<
  * 
  *   # Magic method used to get a Pythonic Iterator API out of the C++ API.
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3272, __pyx_L1_error)
+    __PYX_ERR(0, 3357, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_mfst");
-    __PYX_ERR(0, 3272, __pyx_L1_error)
+    __PYX_ERR(0, 3357, __pyx_L1_error)
   }
   __pyx_v_self->_aiter.reset(new fst::script::MutableArcIteratorClass(__pyx_v_ifst->_mfst.get(), __pyx_v_state));
 
-  /* "fstlib/cext/pywrapfst.pyx":3267
+  /* "fstlib/cext/pywrapfst.pyx":3352
  *     return f"<_MutableArcIterator at 0x{id(self):x}>"
  * 
- *   def __init__(self, MutableFst ifst, int64 state):             # <<<<<<<<<<<<<<
+ *   def __init__(self, MutableFst ifst, int64_t state):             # <<<<<<<<<<<<<<
  *     if not ifst._fst.get().ValidStateId(state):
  *       raise FstIndexError("State index out of range")
  */
 
   /* function exit code */
   __pyx_r = 0;
   goto __pyx_L0;
@@ -34572,15 +34969,15 @@
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_6generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "fstlib/cext/pywrapfst.pyx":3275
+/* "fstlib/cext/pywrapfst.pyx":3360
  * 
  *   # Magic method used to get a Pythonic Iterator API out of the C++ API.
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     while not self.done():
  *       yield self.value()
  */
 
@@ -34605,23 +35002,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__iter__", 0);
   __pyx_cur_scope = (struct __pyx_obj_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__ *)__pyx_tp_new_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__(__pyx_ptype_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__ *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 3275, __pyx_L1_error)
+    __PYX_ERR(0, 3360, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_6generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_iter, __pyx_n_s_MutableArcIterator___iter, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!gen)) __PYX_ERR(0, 3275, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_6generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_iter, __pyx_n_s_MutableArcIterator___iter, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!gen)) __PYX_ERR(0, 3360, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -34635,109 +35032,124 @@
 
 static PyObject *__pyx_gb_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_6generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
 {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__ *__pyx_cur_scope = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__ *)__pyx_generator->closure);
   PyObject *__pyx_r = NULL;
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__iter__", 0);
   switch (__pyx_generator->resume_label) {
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L6_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3275, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3360, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":3276
+  /* "fstlib/cext/pywrapfst.pyx":3361
  *   # Magic method used to get a Pythonic Iterator API out of the C++ API.
  *   def __iter__(self):
  *     while not self.done():             # <<<<<<<<<<<<<<
  *       yield self.value()
  *       self.next()
  */
   while (1) {
     if (unlikely(((PyObject *)__pyx_cur_scope->__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "done");
-      __PYX_ERR(0, 3276, __pyx_L1_error)
+      __PYX_ERR(0, 3361, __pyx_L1_error)
     }
     __pyx_t_1 = ((!(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->done(__pyx_cur_scope->__pyx_v_self, 0) != 0)) != 0);
     if (!__pyx_t_1) break;
 
-    /* "fstlib/cext/pywrapfst.pyx":3277
+    /* "fstlib/cext/pywrapfst.pyx":3362
  *   def __iter__(self):
  *     while not self.done():
  *       yield self.value()             # <<<<<<<<<<<<<<
  *       self.next()
  * 
  */
-    if (unlikely(((PyObject *)__pyx_cur_scope->__pyx_v_self) == Py_None)) {
-      PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "value");
-      __PYX_ERR(0, 3277, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3362, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = NULL;
+    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
+      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+      if (likely(__pyx_t_4)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+        __Pyx_INCREF(__pyx_t_4);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_3, function);
+      }
     }
-    __pyx_t_2 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->value(__pyx_cur_scope->__pyx_v_self, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3277, __pyx_L1_error)
+    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3362, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __pyx_t_2;
     __pyx_t_2 = 0;
     __Pyx_XGIVEREF(__pyx_r);
     __Pyx_RefNannyFinishContext();
     __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
     /* return from generator, yielding value */
     __pyx_generator->resume_label = 1;
     return __pyx_r;
     __pyx_L6_resume_from_yield:;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3277, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 3362, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":3278
+    /* "fstlib/cext/pywrapfst.pyx":3363
  *     while not self.done():
  *       yield self.value()
  *       self.next()             # <<<<<<<<<<<<<<
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  */
     if (unlikely(((PyObject *)__pyx_cur_scope->__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "next");
-      __PYX_ERR(0, 3278, __pyx_L1_error)
+      __PYX_ERR(0, 3363, __pyx_L1_error)
     }
     ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_cur_scope->__pyx_v_self->__pyx_vtab)->next(__pyx_cur_scope->__pyx_v_self, 0);
   }
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "fstlib/cext/pywrapfst.pyx":3275
+  /* "fstlib/cext/pywrapfst.pyx":3360
  * 
  *   # Magic method used to get a Pythonic Iterator API out of the C++ API.
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     while not self.done():
  *       yield self.value()
  */
 
   /* function exit code */
   PyErr_SetNone(PyExc_StopIteration);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_r); __pyx_r = 0;
   #if !CYTHON_USE_EXC_INFO_STACK
   __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3281
+/* "fstlib/cext/pywrapfst.pyx":3366
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):             # <<<<<<<<<<<<<<
  *     if self.done():
  *       raise StopIteration
  */
 
@@ -34751,119 +35163,119 @@
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_7__next__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self) {
-  PyObject *__pyx_v_result = NULL;
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_result = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__next__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3282
+  /* "fstlib/cext/pywrapfst.pyx":3367
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):
  *     if self.done():             # <<<<<<<<<<<<<<
  *       raise StopIteration
- *     result = self.value()
+ *     result = self._value()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "done");
-    __PYX_ERR(0, 3282, __pyx_L1_error)
+    __PYX_ERR(0, 3367, __pyx_L1_error)
   }
   __pyx_t_1 = (((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_v_self->__pyx_vtab)->done(__pyx_v_self, 0) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":3283
+    /* "fstlib/cext/pywrapfst.pyx":3368
  *   def __next__(self):
  *     if self.done():
  *       raise StopIteration             # <<<<<<<<<<<<<<
- *     result = self.value()
+ *     result = self._value()
  *     self.next()
  */
     __Pyx_Raise(__pyx_builtin_StopIteration, 0, 0, 0);
-    __PYX_ERR(0, 3283, __pyx_L1_error)
+    __PYX_ERR(0, 3368, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":3282
+    /* "fstlib/cext/pywrapfst.pyx":3367
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):
  *     if self.done():             # <<<<<<<<<<<<<<
  *       raise StopIteration
- *     result = self.value()
+ *     result = self._value()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3284
+  /* "fstlib/cext/pywrapfst.pyx":3369
  *     if self.done():
  *       raise StopIteration
- *     result = self.value()             # <<<<<<<<<<<<<<
+ *     result = self._value()             # <<<<<<<<<<<<<<
  *     self.next()
  *     return result
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
-    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "value");
-    __PYX_ERR(0, 3284, __pyx_L1_error)
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_value");
+    __PYX_ERR(0, 3369, __pyx_L1_error)
   }
-  __pyx_t_2 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_v_self->__pyx_vtab)->value(__pyx_v_self, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3284, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_v_self->__pyx_vtab)->_value(__pyx_v_self)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_v_result = __pyx_t_2;
+  __pyx_v_result = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3285
+  /* "fstlib/cext/pywrapfst.pyx":3370
  *       raise StopIteration
- *     result = self.value()
+ *     result = self._value()
  *     self.next()             # <<<<<<<<<<<<<<
  *     return result
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "next");
-    __PYX_ERR(0, 3285, __pyx_L1_error)
+    __PYX_ERR(0, 3370, __pyx_L1_error)
   }
   ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_v_self->__pyx_vtab)->next(__pyx_v_self, 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3286
- *     result = self.value()
+  /* "fstlib/cext/pywrapfst.pyx":3371
+ *     result = self._value()
  *     self.next()
  *     return result             # <<<<<<<<<<<<<<
  * 
  *   cpdef bool done(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(__pyx_v_result);
-  __pyx_r = __pyx_v_result;
+  __Pyx_INCREF(((PyObject *)__pyx_v_result));
+  __pyx_r = ((PyObject *)__pyx_v_result);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3281
+  /* "fstlib/cext/pywrapfst.pyx":3366
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):             # <<<<<<<<<<<<<<
  *     if self.done():
  *       raise StopIteration
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._MutableArcIterator.__next__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_result);
+  __Pyx_XDECREF((PyObject *)__pyx_v_result);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3288
+/* "fstlib/cext/pywrapfst.pyx":3373
  *     return result
  * 
  *   cpdef bool done(self):             # <<<<<<<<<<<<<<
  *     """
  *     done(self)
  */
 
@@ -34885,15 +35297,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_done); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3288, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_done); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3373, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_10done)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -34901,18 +35313,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3288, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3373, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3288, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3373, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -34923,29 +35335,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3297
+  /* "fstlib/cext/pywrapfst.pyx":3382
  *       True if the iterator is exhausted, False otherwise.
  *     """
  *     return self._aiter.get().Done()             # <<<<<<<<<<<<<<
  * 
- *   cpdef uint8 flags(self):
+ *   cpdef uint8_t flags(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3297, __pyx_L1_error)
+    __PYX_ERR(0, 3382, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_aiter.get()->Done();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3288
+  /* "fstlib/cext/pywrapfst.pyx":3373
  *     return result
  * 
  *   cpdef bool done(self):             # <<<<<<<<<<<<<<
  *     """
  *     done(self)
  */
 
@@ -34981,15 +35393,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("done", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_done(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3288, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_done(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3373, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -34998,45 +35410,45 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3299
+/* "fstlib/cext/pywrapfst.pyx":3384
  *     return self._aiter.get().Done()
  * 
- *   cpdef uint8 flags(self):             # <<<<<<<<<<<<<<
+ *   cpdef uint8_t flags(self):             # <<<<<<<<<<<<<<
  *     """
  *     flags(self)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_12flags(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static uint8 __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, int __pyx_skip_dispatch) {
-  uint8 __pyx_r;
+static uint8_t __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, int __pyx_skip_dispatch) {
+  uint8_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  uint8 __pyx_t_5;
+  uint8_t __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("flags", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3299, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3384, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_12flags)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -35044,18 +35456,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3299, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3384, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyInt_As_uint8_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((uint8)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3299, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_As_uint8_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((uint8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3384, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -35066,32 +35478,32 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3308
+  /* "fstlib/cext/pywrapfst.pyx":3393
  *       The current iterator behavioral flags as an integer.
  *     """
  *     return self._aiter.get().Flags()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void next(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3308, __pyx_L1_error)
+    __PYX_ERR(0, 3393, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_aiter.get()->Flags();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3299
+  /* "fstlib/cext/pywrapfst.pyx":3384
  *     return self._aiter.get().Done()
  * 
- *   cpdef uint8 flags(self):             # <<<<<<<<<<<<<<
+ *   cpdef uint8_t flags(self):             # <<<<<<<<<<<<<<
  *     """
  *     flags(self)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -35124,15 +35536,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("flags", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_uint8_t(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_flags(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3299, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_uint8_t(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_flags(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3384, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -35141,15 +35553,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3310
+/* "fstlib/cext/pywrapfst.pyx":3395
  *     return self._aiter.get().Flags()
  * 
  *   cpdef void next(self):             # <<<<<<<<<<<<<<
  *     """
  *     next(self)
  */
 
@@ -35169,15 +35581,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_next); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3310, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_next); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3395, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_14next)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -35185,15 +35597,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3310, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3395, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -35205,28 +35617,28 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3316
+  /* "fstlib/cext/pywrapfst.pyx":3401
  *     Advances the iterator.
  *     """
  *     self._aiter.get().Next()             # <<<<<<<<<<<<<<
  * 
  *   cpdef size_t position(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3316, __pyx_L1_error)
+    __PYX_ERR(0, 3401, __pyx_L1_error)
   }
   __pyx_v_self->_aiter.get()->Next();
 
-  /* "fstlib/cext/pywrapfst.pyx":3310
+  /* "fstlib/cext/pywrapfst.pyx":3395
  *     return self._aiter.get().Flags()
  * 
  *   cpdef void next(self):             # <<<<<<<<<<<<<<
  *     """
  *     next(self)
  */
 
@@ -35261,15 +35673,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("next", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_next(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3310, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_next(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3395, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -35278,15 +35690,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3318
+/* "fstlib/cext/pywrapfst.pyx":3403
  *     self._aiter.get().Next()
  * 
  *   cpdef size_t position(self):             # <<<<<<<<<<<<<<
  *     """
  *     position(self)
  */
 
@@ -35308,15 +35720,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_position); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3318, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_position); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3403, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_16position)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -35324,18 +35736,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3318, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3403, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_5 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 3318, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_5 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 3403, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -35346,29 +35758,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3327
+  /* "fstlib/cext/pywrapfst.pyx":3412
  *       The iterator's position, expressed as an integer.
  *     """
  *     return self._aiter.get().Position()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void reset(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3327, __pyx_L1_error)
+    __PYX_ERR(0, 3412, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_aiter.get()->Position();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3318
+  /* "fstlib/cext/pywrapfst.pyx":3403
  *     self._aiter.get().Next()
  * 
  *   cpdef size_t position(self):             # <<<<<<<<<<<<<<
  *     """
  *     position(self)
  */
 
@@ -35404,15 +35816,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("position", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_FromSize_t(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_position(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3318, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_FromSize_t(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_position(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3403, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -35421,15 +35833,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3329
+/* "fstlib/cext/pywrapfst.pyx":3414
  *     return self._aiter.get().Position()
  * 
  *   cpdef void reset(self):             # <<<<<<<<<<<<<<
  *     """
  *     reset(self)
  */
 
@@ -35449,15 +35861,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3329, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3414, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_18reset)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -35465,15 +35877,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3329, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3414, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -35485,28 +35897,28 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3335
+  /* "fstlib/cext/pywrapfst.pyx":3420
  *     Resets the iterator to the initial position.
  *     """
  *     self._aiter.get().Reset()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void seek(self, size_t a):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3335, __pyx_L1_error)
+    __PYX_ERR(0, 3420, __pyx_L1_error)
   }
   __pyx_v_self->_aiter.get()->Reset();
 
-  /* "fstlib/cext/pywrapfst.pyx":3329
+  /* "fstlib/cext/pywrapfst.pyx":3414
  *     return self._aiter.get().Position()
  * 
  *   cpdef void reset(self):             # <<<<<<<<<<<<<<
  *     """
  *     reset(self)
  */
 
@@ -35541,15 +35953,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("reset", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_reset(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3329, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_reset(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3414, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -35558,15 +35970,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3337
+/* "fstlib/cext/pywrapfst.pyx":3422
  *     self._aiter.get().Reset()
  * 
  *   cpdef void seek(self, size_t a):             # <<<<<<<<<<<<<<
  *     """
  *     seek(self, a)
  */
 
@@ -35587,18 +35999,18 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_seek); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3337, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_seek); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3422, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_20seek)) {
-        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3337, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3422, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -35606,15 +36018,15 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3337, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3422, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -35626,28 +36038,28 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3346
+  /* "fstlib/cext/pywrapfst.pyx":3431
  *       a: The position to seek to.
  *     """
  *     self._aiter.get().Seek(a)             # <<<<<<<<<<<<<<
  * 
- *   cpdef void set_flags(self, uint8 flags, uint8 mask):
+ *   cpdef void set_flags(self, uint8_t flags, uint8_t mask):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3346, __pyx_L1_error)
+    __PYX_ERR(0, 3431, __pyx_L1_error)
   }
   __pyx_v_self->_aiter.get()->Seek(__pyx_v_a);
 
-  /* "fstlib/cext/pywrapfst.pyx":3337
+  /* "fstlib/cext/pywrapfst.pyx":3422
  *     self._aiter.get().Reset()
  * 
  *   cpdef void seek(self, size_t a):             # <<<<<<<<<<<<<<
  *     """
  *     seek(self, a)
  */
 
@@ -35672,15 +36084,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("seek (wrapper)", 0);
   assert(__pyx_arg_a); {
-    __pyx_v_a = __Pyx_PyInt_As_size_t(__pyx_arg_a); if (unlikely((__pyx_v_a == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 3337, __pyx_L3_error)
+    __pyx_v_a = __Pyx_PyInt_As_size_t(__pyx_arg_a); if (unlikely((__pyx_v_a == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 3422, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._MutableArcIterator.seek", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
@@ -35696,15 +36108,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("seek", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_seek(__pyx_v_self, __pyx_v_a, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3337, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_seek(__pyx_v_self, __pyx_v_a, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3422, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -35713,24 +36125,24 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3348
+/* "fstlib/cext/pywrapfst.pyx":3433
  *     self._aiter.get().Seek(a)
  * 
- *   cpdef void set_flags(self, uint8 flags, uint8 mask):             # <<<<<<<<<<<<<<
+ *   cpdef void set_flags(self, uint8_t flags, uint8_t mask):             # <<<<<<<<<<<<<<
  *     """
  *     set_flags(self, flags, mask)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_22set_flags(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, uint8 __pyx_v_flags, uint8 __pyx_v_mask, int __pyx_skip_dispatch) {
+static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, uint8_t __pyx_v_flags, uint8_t __pyx_v_mask, int __pyx_skip_dispatch) {
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
@@ -35745,20 +36157,20 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3348, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3433, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_22set_flags)) {
-        __pyx_t_3 = __Pyx_PyInt_From_uint8_t(__pyx_v_flags); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3348, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_uint8_t(__pyx_v_flags); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3433, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_4 = __Pyx_PyInt_From_uint8_t(__pyx_v_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3348, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyInt_From_uint8_t(__pyx_v_mask); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3433, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_5 = __pyx_t_1; __pyx_t_6 = NULL;
         __pyx_t_7 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
           __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
           if (likely(__pyx_t_6)) {
@@ -35768,44 +36180,44 @@
             __Pyx_DECREF_SET(__pyx_t_5, function);
             __pyx_t_7 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_5)) {
           PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_3, __pyx_t_4};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3348, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3433, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
           PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_3, __pyx_t_4};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3348, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3433, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         } else
         #endif
         {
-          __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3348, __pyx_L1_error)
+          __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3433, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_8);
           if (__pyx_t_6) {
             __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
           }
           __Pyx_GIVEREF(__pyx_t_3);
           PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_3);
           __Pyx_GIVEREF(__pyx_t_4);
           PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_4);
           __pyx_t_3 = 0;
           __pyx_t_4 = 0;
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3348, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3433, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         }
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
@@ -35819,31 +36231,31 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3358
+  /* "fstlib/cext/pywrapfst.pyx":3443
  *       mask: A mask to be applied to the `flags` argument before setting them.
  *     """
  *     self._aiter.get().SetFlags(flags, mask)             # <<<<<<<<<<<<<<
  * 
- *   cpdef void set_value(self, Arc arc):
+ *   cdef void _set_value(self, Arc arc):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3358, __pyx_L1_error)
+    __PYX_ERR(0, 3443, __pyx_L1_error)
   }
   __pyx_v_self->_aiter.get()->SetFlags(__pyx_v_flags, __pyx_v_mask);
 
-  /* "fstlib/cext/pywrapfst.pyx":3348
+  /* "fstlib/cext/pywrapfst.pyx":3433
  *     self._aiter.get().Seek(a)
  * 
- *   cpdef void set_flags(self, uint8 flags, uint8 mask):             # <<<<<<<<<<<<<<
+ *   cpdef void set_flags(self, uint8_t flags, uint8_t mask):             # <<<<<<<<<<<<<<
  *     """
  *     set_flags(self, flags, mask)
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
@@ -35859,16 +36271,16 @@
   __Pyx_RefNannyFinishContext();
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_22set_flags(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_21set_flags[] = "\n    set_flags(self, flags, mask)\n\n    Sets the current iterator behavioral flags.\n\n    Args:\n      flags: The properties to be set.\n      mask: A mask to be applied to the `flags` argument before setting them.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_22set_flags(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  uint8 __pyx_v_flags;
-  uint8 __pyx_v_mask;
+  uint8_t __pyx_v_flags;
+  uint8_t __pyx_v_mask;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_flags (wrapper)", 0);
   {
@@ -35890,54 +36302,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_flags)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mask)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("set_flags", 1, 2, 2, 1); __PYX_ERR(0, 3348, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("set_flags", 1, 2, 2, 1); __PYX_ERR(0, 3433, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_flags") < 0)) __PYX_ERR(0, 3348, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_flags") < 0)) __PYX_ERR(0, 3433, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
-    __pyx_v_flags = __Pyx_PyInt_As_uint8_t(values[0]); if (unlikely((__pyx_v_flags == ((uint8)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3348, __pyx_L3_error)
-    __pyx_v_mask = __Pyx_PyInt_As_uint8_t(values[1]); if (unlikely((__pyx_v_mask == ((uint8)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3348, __pyx_L3_error)
+    __pyx_v_flags = __Pyx_PyInt_As_uint8_t(values[0]); if (unlikely((__pyx_v_flags == ((uint8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3433, __pyx_L3_error)
+    __pyx_v_mask = __Pyx_PyInt_As_uint8_t(values[1]); if (unlikely((__pyx_v_mask == ((uint8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3433, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("set_flags", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3348, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("set_flags", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3433, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._MutableArcIterator.set_flags", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_21set_flags(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_v_self), __pyx_v_flags, __pyx_v_mask);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_21set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, uint8 __pyx_v_flags, uint8 __pyx_v_mask) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_21set_flags(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, uint8_t __pyx_v_flags, uint8_t __pyx_v_mask) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_flags", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_flags(__pyx_v_self, __pyx_v_flags, __pyx_v_mask, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3348, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_flags(__pyx_v_self, __pyx_v_flags, __pyx_v_mask, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3433, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -35946,302 +36358,361 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3360
+/* "fstlib/cext/pywrapfst.pyx":3445
  *     self._aiter.get().SetFlags(flags, mask)
  * 
- *   cpdef void set_value(self, Arc arc):             # <<<<<<<<<<<<<<
+ *   cdef void _set_value(self, Arc arc):             # <<<<<<<<<<<<<<
  *     """
  *     set_value(self, arc)
  */
 
-static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_24set_value(PyObject *__pyx_v_self, PyObject *__pyx_v_arc); /*proto*/
-static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc, int __pyx_skip_dispatch) {
+static void __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator__set_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc) {
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("set_value", 0);
-  /* Check if called by wrapper */
-  if (unlikely(__pyx_skip_dispatch)) ;
-  /* Check if overridden in Python */
-  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
-    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
-    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
-    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
-      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
-      #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_set_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3360, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_24set_value)) {
-        __Pyx_INCREF(__pyx_t_1);
-        __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
-        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
-          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
-          if (likely(__pyx_t_4)) {
-            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
-            __Pyx_INCREF(__pyx_t_4);
-            __Pyx_INCREF(function);
-            __Pyx_DECREF_SET(__pyx_t_3, function);
-          }
-        }
-        __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_arc)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_arc));
-        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3360, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_2);
-        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        goto __pyx_L0;
-      }
-      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
-      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
-      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
-      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
-        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
-      }
-      #endif
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
-    }
-    #endif
-  }
+  __Pyx_RefNannySetupContext("_set_value", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3369
+  /* "fstlib/cext/pywrapfst.pyx":3455
  *       arc: The arc to replace the current arc with.
  *     """
  *     self._aiter.get().SetValue(deref(arc._arc))             # <<<<<<<<<<<<<<
  * 
- *   cpdef object value(self):
+ *   def set_value(self, Arc arc):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3369, __pyx_L1_error)
+    __PYX_ERR(0, 3455, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_arc) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc");
-    __PYX_ERR(0, 3369, __pyx_L1_error)
+    __PYX_ERR(0, 3455, __pyx_L1_error)
   }
   __pyx_v_self->_aiter.get()->SetValue((*__pyx_v_arc->_arc));
 
-  /* "fstlib/cext/pywrapfst.pyx":3360
+  /* "fstlib/cext/pywrapfst.pyx":3445
  *     self._aiter.get().SetFlags(flags, mask)
  * 
- *   cpdef void set_value(self, Arc arc):             # <<<<<<<<<<<<<<
+ *   cdef void _set_value(self, Arc arc):             # <<<<<<<<<<<<<<
  *     """
  *     set_value(self, arc)
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_WriteUnraisable("fstlib.cext.pywrapfst._MutableArcIterator.set_value", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
+  __Pyx_WriteUnraisable("fstlib.cext.pywrapfst._MutableArcIterator._set_value", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
+/* "fstlib/cext/pywrapfst.pyx":3457
+ *     self._aiter.get().SetValue(deref(arc._arc))
+ * 
+ *   def set_value(self, Arc arc):             # <<<<<<<<<<<<<<
+ *     """
+ *     set_value(self, arc)
+ */
+
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_24set_value(PyObject *__pyx_v_self, PyObject *__pyx_v_arc); /*proto*/
-static char __pyx_doc_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_23set_value[] = "\n    set_value(self, arc)\n\n    Replace the current arc with a new arc.\n\n    Args:\n      arc: The arc to replace the current arc with.\n    ";
+static char __pyx_doc_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_23set_value[] = "\n    set_value(self, arc)\n\n    Replace the current arc with a new arc.\n\n    Args:\n      arc: The arc to replace the current arc with.\n\n    Raises:\n      FstOpError: Can't set value on an exhausted iterator.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_24set_value(PyObject *__pyx_v_self, PyObject *__pyx_v_arc) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_value (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arc), __pyx_ptype_6fstlib_4cext_9pywrapfst_Arc, 1, "arc", 0))) __PYX_ERR(0, 3360, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arc), __pyx_ptype_6fstlib_4cext_9pywrapfst_Arc, 1, "arc", 0))) __PYX_ERR(0, 3457, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_23set_value(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_v_self), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_v_arc));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_23set_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_v_arc) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("set_value", 0);
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_value(__pyx_v_self, __pyx_v_arc, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3360, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
+
+  /* "fstlib/cext/pywrapfst.pyx":3469
+ *       FstOpError: Can't set value on an exhausted iterator.
+ *     """
+ *     if self._aiter.get().Done():             # <<<<<<<<<<<<<<
+ *       raise FstOpError("Can't set value on an exhausted iterator")
+ *     self._set_value(arc)
+ */
+  if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
+    __PYX_ERR(0, 3469, __pyx_L1_error)
+  }
+  __pyx_t_1 = (__pyx_v_self->_aiter.get()->Done() != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "fstlib/cext/pywrapfst.pyx":3470
+ *     """
+ *     if self._aiter.get().Done():
+ *       raise FstOpError("Can't set value on an exhausted iterator")             # <<<<<<<<<<<<<<
+ *     self._set_value(arc)
+ * 
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3470, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+      if (likely(__pyx_t_4)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+        __Pyx_INCREF(__pyx_t_4);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_3, function);
+      }
+    }
+    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Can_t_set_value_on_an_exhausted) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Can_t_set_value_on_an_exhausted);
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3470, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 3470, __pyx_L1_error)
+
+    /* "fstlib/cext/pywrapfst.pyx":3469
+ *       FstOpError: Can't set value on an exhausted iterator.
+ *     """
+ *     if self._aiter.get().Done():             # <<<<<<<<<<<<<<
+ *       raise FstOpError("Can't set value on an exhausted iterator")
+ *     self._set_value(arc)
+ */
+  }
+
+  /* "fstlib/cext/pywrapfst.pyx":3471
+ *     if self._aiter.get().Done():
+ *       raise FstOpError("Can't set value on an exhausted iterator")
+ *     self._set_value(arc)             # <<<<<<<<<<<<<<
+ * 
+ *   cdef Arc _value(self):
+ */
+  if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_set_value");
+    __PYX_ERR(0, 3471, __pyx_L1_error)
+  }
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_v_self->__pyx_vtab)->_set_value(__pyx_v_self, __pyx_v_arc);
+
+  /* "fstlib/cext/pywrapfst.pyx":3457
+ *     self._aiter.get().SetValue(deref(arc._arc))
+ * 
+ *   def set_value(self, Arc arc):             # <<<<<<<<<<<<<<
+ *     """
+ *     set_value(self, arc)
+ */
 
   /* function exit code */
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._MutableArcIterator.set_value", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3371
- *     self._aiter.get().SetValue(deref(arc._arc))
+/* "fstlib/cext/pywrapfst.pyx":3473
+ *     self._set_value(arc)
  * 
- *   cpdef object value(self):             # <<<<<<<<<<<<<<
+ *   cdef Arc _value(self):             # <<<<<<<<<<<<<<
  *     """
  *     value(self)
  */
 
-static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_26value(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static PyObject *__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self, int __pyx_skip_dispatch) {
-  PyObject *__pyx_r = NULL;
+static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator__value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self) {
+  struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("value", 0);
-  /* Check if called by wrapper */
-  if (unlikely(__pyx_skip_dispatch)) ;
-  /* Check if overridden in Python */
-  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
-    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
-    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
-    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
-      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
-      #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3371, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_26value)) {
-        __Pyx_XDECREF(__pyx_r);
-        __Pyx_INCREF(__pyx_t_1);
-        __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
-        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
-          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
-          if (likely(__pyx_t_4)) {
-            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
-            __Pyx_INCREF(__pyx_t_4);
-            __Pyx_INCREF(function);
-            __Pyx_DECREF_SET(__pyx_t_3, function);
-          }
-        }
-        __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
-        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3371, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_2);
-        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_r = __pyx_t_2;
-        __pyx_t_2 = 0;
-        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        goto __pyx_L0;
-      }
-      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
-      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
-      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
-      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
-        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
-      }
-      #endif
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
-    }
-    #endif
-  }
+  __Pyx_RefNannySetupContext("_value", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3377
- *     Returns the current arc.
+  /* "fstlib/cext/pywrapfst.pyx":3482
+ *        The current arc.
  *     """
  *     return _init_Arc(self._aiter.get().Value())             # <<<<<<<<<<<<<<
  * 
- * 
+ *   def value(self):
  */
-  __Pyx_XDECREF(__pyx_r);
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
-    __PYX_ERR(0, 3377, __pyx_L1_error)
+    __PYX_ERR(0, 3482, __pyx_L1_error)
   }
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_Arc(__pyx_v_self->_aiter.get()->Value())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3377, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_Arc(__pyx_v_self->_aiter.get()->Value())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
+  __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3371
- *     self._aiter.get().SetValue(deref(arc._arc))
+  /* "fstlib/cext/pywrapfst.pyx":3473
+ *     self._set_value(arc)
  * 
- *   cpdef object value(self):             # <<<<<<<<<<<<<<
+ *   cdef Arc _value(self):             # <<<<<<<<<<<<<<
  *     """
  *     value(self)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("fstlib.cext.pywrapfst._MutableArcIterator.value", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("fstlib.cext.pywrapfst._MutableArcIterator._value", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "fstlib/cext/pywrapfst.pyx":3484
+ *     return _init_Arc(self._aiter.get().Value())
+ * 
+ *   def value(self):             # <<<<<<<<<<<<<<
+ *     """
+ *     value(self)
+ */
+
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_26value(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static char __pyx_doc_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_25value[] = "\n    value(self)\n\n    Returns the current arc.\n    ";
+static char __pyx_doc_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_25value[] = "\n    value(self)\n\n    Returns the current arc.\n\n    Returns:\n      The current arc.\n\n    Raises:\n      FstOpError: Can't get value from an exhausted iterator.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_26value(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("value (wrapper)", 0);
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_25value(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_25value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("value", 0);
+
+  /* "fstlib/cext/pywrapfst.pyx":3496
+ *       FstOpError: Can't get value from an exhausted iterator.
+ *     """
+ *     if self._aiter.get().Done():             # <<<<<<<<<<<<<<
+ *       raise FstOpError("Can't get value from an exhausted iterator")
+ *     return self._value()
+ */
+  if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_aiter");
+    __PYX_ERR(0, 3496, __pyx_L1_error)
+  }
+  __pyx_t_1 = (__pyx_v_self->_aiter.get()->Done() != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "fstlib/cext/pywrapfst.pyx":3497
+ *     """
+ *     if self._aiter.get().Done():
+ *       raise FstOpError("Can't get value from an exhausted iterator")             # <<<<<<<<<<<<<<
+ *     return self._value()
+ * 
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3497, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+      if (likely(__pyx_t_4)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+        __Pyx_INCREF(__pyx_t_4);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_3, function);
+      }
+    }
+    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_kp_u_Can_t_get_value_from_an_exhauste) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_kp_u_Can_t_get_value_from_an_exhauste);
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3497, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 3497, __pyx_L1_error)
+
+    /* "fstlib/cext/pywrapfst.pyx":3496
+ *       FstOpError: Can't get value from an exhausted iterator.
+ *     """
+ *     if self._aiter.get().Done():             # <<<<<<<<<<<<<<
+ *       raise FstOpError("Can't get value from an exhausted iterator")
+ *     return self._value()
+ */
+  }
+
+  /* "fstlib/cext/pywrapfst.pyx":3498
+ *     if self._aiter.get().Done():
+ *       raise FstOpError("Can't get value from an exhausted iterator")
+ *     return self._value()             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_value(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3371, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_value");
+    __PYX_ERR(0, 3498, __pyx_L1_error)
+  }
+  __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__MutableArcIterator *)__pyx_v_self->__pyx_vtab)->_value(__pyx_v_self)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3498, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
+  /* "fstlib/cext/pywrapfst.pyx":3484
+ *     return _init_Arc(self._aiter.get().Value())
+ * 
+ *   def value(self):             # <<<<<<<<<<<<<<
+ *     """
+ *     value(self)
+ */
+
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._MutableArcIterator.value", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
@@ -36276,15 +36747,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._aiter,self._mfst cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._aiter,self._mfst cannot be converted to a Python object for pickling")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__28, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__26, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -36332,15 +36803,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._aiter,self._mfst cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._aiter,self._mfst cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__29, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__27, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -36355,15 +36826,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._MutableArcIterator.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3391
+/* "fstlib/cext/pywrapfst.pyx":3512
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<_StateIterator at 0x{id(self):x}>"
  * 
  */
 
@@ -36389,52 +36860,52 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3392
+  /* "fstlib/cext/pywrapfst.pyx":3513
  * 
  *   def __repr__(self):
  *     return f"<_StateIterator at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
  *   def __init__(self, Fst ifst):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3392, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3513, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u_StateIterator_at_0x);
   __pyx_t_2 += 21;
   __Pyx_GIVEREF(__pyx_kp_u_StateIterator_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_StateIterator_at_0x);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3392, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3513, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3392, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3513, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3392, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3513, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3391
+  /* "fstlib/cext/pywrapfst.pyx":3512
  *   """
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<_StateIterator at 0x{id(self):x}>"
  * 
  */
 
@@ -36447,15 +36918,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3394
+/* "fstlib/cext/pywrapfst.pyx":3515
  *     return f"<_StateIterator at 0x{id(self):x}>"
  * 
  *   def __init__(self, Fst ifst):             # <<<<<<<<<<<<<<
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  *     self._fst = ifst._fst
  */
 
@@ -36484,32 +36955,32 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 3394, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 3515, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3394, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3515, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._StateIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3394, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3515, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator_2__init__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *)__pyx_v_self), __pyx_v_ifst);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -36522,50 +36993,50 @@
   __Pyx_RefNannyDeclarations
   std::shared_ptr<fst::script::FstClass>  __pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3396
+  /* "fstlib/cext/pywrapfst.pyx":3517
  *   def __init__(self, Fst ifst):
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  *     self._fst = ifst._fst             # <<<<<<<<<<<<<<
  *     self._siter.reset(new fst.StateIteratorClass(deref(self._fst)))
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3396, __pyx_L1_error)
+    __PYX_ERR(0, 3517, __pyx_L1_error)
   }
   __pyx_t_1 = __pyx_v_ifst->_fst;
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3396, __pyx_L1_error)
+    __PYX_ERR(0, 3517, __pyx_L1_error)
   }
   __pyx_v_self->_fst = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":3397
+  /* "fstlib/cext/pywrapfst.pyx":3518
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  *     self._fst = ifst._fst
  *     self._siter.reset(new fst.StateIteratorClass(deref(self._fst)))             # <<<<<<<<<<<<<<
  * 
  *   # This just registers this class as a possible iterator.
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
-    __PYX_ERR(0, 3397, __pyx_L1_error)
+    __PYX_ERR(0, 3518, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3397, __pyx_L1_error)
+    __PYX_ERR(0, 3518, __pyx_L1_error)
   }
   __pyx_v_self->_siter.reset(new fst::script::StateIteratorClass((*__pyx_v_self->_fst)));
 
-  /* "fstlib/cext/pywrapfst.pyx":3394
+  /* "fstlib/cext/pywrapfst.pyx":3515
  *     return f"<_StateIterator at 0x{id(self):x}>"
  * 
  *   def __init__(self, Fst ifst):             # <<<<<<<<<<<<<<
  *     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
  *     self._fst = ifst._fst
  */
 
@@ -36576,15 +37047,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._StateIterator.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3400
+/* "fstlib/cext/pywrapfst.pyx":3521
  * 
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
 
@@ -36602,42 +37073,42 @@
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator_4__iter__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__iter__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3401
+  /* "fstlib/cext/pywrapfst.pyx":3522
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):
  *     return self             # <<<<<<<<<<<<<<
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3400
+  /* "fstlib/cext/pywrapfst.pyx":3521
  * 
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3404
+/* "fstlib/cext/pywrapfst.pyx":3525
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):             # <<<<<<<<<<<<<<
  *     if self.done():
  *       raise StopIteration
  */
 
@@ -36651,98 +37122,98 @@
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator_6__next__(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self) {
-  int64 __pyx_v_result;
+  int64_t __pyx_v_result;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__next__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3405
+  /* "fstlib/cext/pywrapfst.pyx":3526
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):
  *     if self.done():             # <<<<<<<<<<<<<<
  *       raise StopIteration
- *     cdef int64 result = self.value()
+ *     cdef int64_t result = self._value()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "done");
-    __PYX_ERR(0, 3405, __pyx_L1_error)
+    __PYX_ERR(0, 3526, __pyx_L1_error)
   }
   __pyx_t_1 = (((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator *)__pyx_v_self->__pyx_vtab)->done(__pyx_v_self, 0) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":3406
+    /* "fstlib/cext/pywrapfst.pyx":3527
  *   def __next__(self):
  *     if self.done():
  *       raise StopIteration             # <<<<<<<<<<<<<<
- *     cdef int64 result = self.value()
+ *     cdef int64_t result = self._value()
  *     self.next()
  */
     __Pyx_Raise(__pyx_builtin_StopIteration, 0, 0, 0);
-    __PYX_ERR(0, 3406, __pyx_L1_error)
+    __PYX_ERR(0, 3527, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":3405
+    /* "fstlib/cext/pywrapfst.pyx":3526
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):
  *     if self.done():             # <<<<<<<<<<<<<<
  *       raise StopIteration
- *     cdef int64 result = self.value()
+ *     cdef int64_t result = self._value()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3407
+  /* "fstlib/cext/pywrapfst.pyx":3528
  *     if self.done():
  *       raise StopIteration
- *     cdef int64 result = self.value()             # <<<<<<<<<<<<<<
+ *     cdef int64_t result = self._value()             # <<<<<<<<<<<<<<
  *     self.next()
  *     return result
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
-    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "value");
-    __PYX_ERR(0, 3407, __pyx_L1_error)
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_value");
+    __PYX_ERR(0, 3528, __pyx_L1_error)
   }
-  __pyx_v_result = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator *)__pyx_v_self->__pyx_vtab)->value(__pyx_v_self, 0);
+  __pyx_v_result = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator *)__pyx_v_self->__pyx_vtab)->_value(__pyx_v_self);
 
-  /* "fstlib/cext/pywrapfst.pyx":3408
+  /* "fstlib/cext/pywrapfst.pyx":3529
  *       raise StopIteration
- *     cdef int64 result = self.value()
+ *     cdef int64_t result = self._value()
  *     self.next()             # <<<<<<<<<<<<<<
  *     return result
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "next");
-    __PYX_ERR(0, 3408, __pyx_L1_error)
+    __PYX_ERR(0, 3529, __pyx_L1_error)
   }
   ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator *)__pyx_v_self->__pyx_vtab)->next(__pyx_v_self, 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3409
- *     cdef int64 result = self.value()
+  /* "fstlib/cext/pywrapfst.pyx":3530
+ *     cdef int64_t result = self._value()
  *     self.next()
  *     return result             # <<<<<<<<<<<<<<
  * 
  *   cpdef bool done(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_v_result); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3409, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_v_result); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3530, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3404
+  /* "fstlib/cext/pywrapfst.pyx":3525
  * 
  *   # Magic method used to get a Pythonic API out of the C++ API.
  *   def __next__(self):             # <<<<<<<<<<<<<<
  *     if self.done():
  *       raise StopIteration
  */
 
@@ -36753,15 +37224,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3411
+/* "fstlib/cext/pywrapfst.pyx":3532
  *     return result
  * 
  *   cpdef bool done(self):             # <<<<<<<<<<<<<<
  *     """
  *     done(self)
  */
 
@@ -36783,15 +37254,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_done); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3411, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_done); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3532, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_14_StateIterator_9done)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -36799,18 +37270,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3411, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3532, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3411, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3532, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -36821,29 +37292,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3420
+  /* "fstlib/cext/pywrapfst.pyx":3541
  *       True if the iterator is exhausted, False otherwise.
  *     """
  *     return self._siter.get().Done()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void next(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
-    __PYX_ERR(0, 3420, __pyx_L1_error)
+    __PYX_ERR(0, 3541, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_siter.get()->Done();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3411
+  /* "fstlib/cext/pywrapfst.pyx":3532
  *     return result
  * 
  *   cpdef bool done(self):             # <<<<<<<<<<<<<<
  *     """
  *     done(self)
  */
 
@@ -36879,15 +37350,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("done", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_done(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3411, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_done(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3532, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -36896,15 +37367,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3422
+/* "fstlib/cext/pywrapfst.pyx":3543
  *     return self._siter.get().Done()
  * 
  *   cpdef void next(self):             # <<<<<<<<<<<<<<
  *     """
  *     next(self)
  */
 
@@ -36924,15 +37395,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_next); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3422, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_next); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3543, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_14_StateIterator_11next)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -36940,15 +37411,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3422, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3543, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -36960,28 +37431,28 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3428
+  /* "fstlib/cext/pywrapfst.pyx":3549
  *     Advances the iterator.
  *     """
  *     self._siter.get().Next()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void reset(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
-    __PYX_ERR(0, 3428, __pyx_L1_error)
+    __PYX_ERR(0, 3549, __pyx_L1_error)
   }
   __pyx_v_self->_siter.get()->Next();
 
-  /* "fstlib/cext/pywrapfst.pyx":3422
+  /* "fstlib/cext/pywrapfst.pyx":3543
  *     return self._siter.get().Done()
  * 
  *   cpdef void next(self):             # <<<<<<<<<<<<<<
  *     """
  *     next(self)
  */
 
@@ -37016,15 +37487,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("next", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_next(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3422, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_next(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3543, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -37033,15 +37504,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3430
+/* "fstlib/cext/pywrapfst.pyx":3551
  *     self._siter.get().Next()
  * 
  *   cpdef void reset(self):             # <<<<<<<<<<<<<<
  *     """
  *     reset(self)
  */
 
@@ -37061,15 +37532,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3430, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3551, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_14_StateIterator_13reset)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -37077,15 +37548,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3430, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3551, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -37097,28 +37568,28 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3436
+  /* "fstlib/cext/pywrapfst.pyx":3557
  *     Resets the iterator to the initial position.
  *     """
  *     self._siter.get().Reset()             # <<<<<<<<<<<<<<
  * 
- *   cpdef int64 value(self):
+ *   cdef int64_t _value(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
-    __PYX_ERR(0, 3436, __pyx_L1_error)
+    __PYX_ERR(0, 3557, __pyx_L1_error)
   }
   __pyx_v_self->_siter.get()->Reset();
 
-  /* "fstlib/cext/pywrapfst.pyx":3430
+  /* "fstlib/cext/pywrapfst.pyx":3551
  *     self._siter.get().Next()
  * 
  *   cpdef void reset(self):             # <<<<<<<<<<<<<<
  *     """
  *     reset(self)
  */
 
@@ -37153,15 +37624,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("reset", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_reset(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3430, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_reset(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3551, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -37170,45 +37641,93 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3438
+/* "fstlib/cext/pywrapfst.pyx":3559
  *     self._siter.get().Reset()
  * 
- *   cpdef int64 value(self):             # <<<<<<<<<<<<<<
+ *   cdef int64_t _value(self):             # <<<<<<<<<<<<<<
+ *     """
+ *     _value(self)
+ */
+
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator__value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self) {
+  int64_t __pyx_r;
+  __Pyx_RefNannyDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("_value", 0);
+
+  /* "fstlib/cext/pywrapfst.pyx":3569
+ *        The current state.
+ *     """
+ *     return self._siter.get().Value()             # <<<<<<<<<<<<<<
+ * 
+ *   cpdef int64_t value(self) except *:
+ */
+  if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
+    __PYX_ERR(0, 3569, __pyx_L1_error)
+  }
+  __pyx_r = __pyx_v_self->_siter.get()->Value();
+  goto __pyx_L0;
+
+  /* "fstlib/cext/pywrapfst.pyx":3559
+ *     self._siter.get().Reset()
+ * 
+ *   cdef int64_t _value(self):             # <<<<<<<<<<<<<<
+ *     """
+ *     _value(self)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_WriteUnraisable("fstlib.cext.pywrapfst._StateIterator._value", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "fstlib/cext/pywrapfst.pyx":3571
+ *     return self._siter.get().Value()
+ * 
+ *   cpdef int64_t value(self) except *:             # <<<<<<<<<<<<<<
  *     """
  *     value(self)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_14_StateIterator_15value(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static int64 __pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self, int __pyx_skip_dispatch) {
-  int64 __pyx_r;
+static int64_t __pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self, int __pyx_skip_dispatch) {
+  int64_t __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  int64 __pyx_t_5;
+  int64_t __pyx_t_5;
+  int __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("value", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3438, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3571, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_14_StateIterator_15value)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -37216,18 +37735,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3438, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3571, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3438, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3571, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -37238,81 +37757,134 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3444
- *     Returns the current state index.
+  /* "fstlib/cext/pywrapfst.pyx":3583
+ *       FstOpError: Can't get value from an exhausted iterator.
  *     """
- *     return self._siter.get().Value()             # <<<<<<<<<<<<<<
+ *     if self._siter.get().Done():             # <<<<<<<<<<<<<<
+ *       raise FstOpError("Can't get value from an exhausted iterator")
+ *     return self._value()
+ */
+  if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
+    __PYX_ERR(0, 3583, __pyx_L1_error)
+  }
+  __pyx_t_6 = (__pyx_v_self->_siter.get()->Done() != 0);
+  if (unlikely(__pyx_t_6)) {
+
+    /* "fstlib/cext/pywrapfst.pyx":3584
+ *     """
+ *     if self._siter.get().Done():
+ *       raise FstOpError("Can't get value from an exhausted iterator")             # <<<<<<<<<<<<<<
+ *     return self._value()
+ * 
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3584, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_3 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
+      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
+      if (likely(__pyx_t_3)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
+        __Pyx_INCREF(__pyx_t_3);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_2, function);
+      }
+    }
+    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_kp_u_Can_t_get_value_from_an_exhauste) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_Can_t_get_value_from_an_exhauste);
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3584, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __PYX_ERR(0, 3584, __pyx_L1_error)
+
+    /* "fstlib/cext/pywrapfst.pyx":3583
+ *       FstOpError: Can't get value from an exhausted iterator.
+ *     """
+ *     if self._siter.get().Done():             # <<<<<<<<<<<<<<
+ *       raise FstOpError("Can't get value from an exhausted iterator")
+ *     return self._value()
+ */
+  }
+
+  /* "fstlib/cext/pywrapfst.pyx":3585
+ *     if self._siter.get().Done():
+ *       raise FstOpError("Can't get value from an exhausted iterator")
+ *     return self._value()             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
-    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_siter");
-    __PYX_ERR(0, 3444, __pyx_L1_error)
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_value");
+    __PYX_ERR(0, 3585, __pyx_L1_error)
   }
-  __pyx_r = __pyx_v_self->_siter.get()->Value();
+  __pyx_r = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst__StateIterator *)__pyx_v_self->__pyx_vtab)->_value(__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3438
- *     self._siter.get().Reset()
+  /* "fstlib/cext/pywrapfst.pyx":3571
+ *     return self._siter.get().Value()
  * 
- *   cpdef int64 value(self):             # <<<<<<<<<<<<<<
+ *   cpdef int64_t value(self) except *:             # <<<<<<<<<<<<<<
  *     """
  *     value(self)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_WriteUnraisable("fstlib.cext.pywrapfst._StateIterator.value", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
+  __Pyx_AddTraceback("fstlib.cext.pywrapfst._StateIterator.value", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_14_StateIterator_15value(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static char __pyx_doc_6fstlib_4cext_9pywrapfst_14_StateIterator_14value[] = "\n    value(self)\n\n    Returns the current state index.\n    ";
+static char __pyx_doc_6fstlib_4cext_9pywrapfst_14_StateIterator_14value[] = "\n    value(self)\n\n    Returns the current state.\n\n    Returns:\n       The current state.\n\n    Raises:\n      FstOpError: Can't get value from an exhausted iterator.\n    ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_14_StateIterator_15value(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("value (wrapper)", 0);
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator_14value(((struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_14_StateIterator_14value(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  int64_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("value", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_value(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3438, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_value(__pyx_v_self, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3571, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3571, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._StateIterator.value", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
@@ -37347,15 +37919,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._fst,self._siter cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._fst,self._siter cannot be converted to a Python object for pickling")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__30, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__28, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -37403,15 +37975,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._fst,self._siter cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._fst,self._siter cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__31, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__29, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -37426,28 +37998,28 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._StateIterator.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3450
+/* "fstlib/cext/pywrapfst.pyx":3591
  * 
  * 
  * cdef Fst _map(Fst ifst,             # <<<<<<<<<<<<<<
  *                float delta=fst.kDelta,
  *                map_type="identity",
  */
 
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_f_6fstlib_4cext_9pywrapfst__map(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst__map *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__32;
+  float __pyx_v_delta = __pyx_k__30;
   PyObject *__pyx_v_map_type = ((PyObject *)__pyx_n_u_identity);
   double __pyx_v_power = ((double)1.);
 
-  /* "fstlib/cext/pywrapfst.pyx":3454
+  /* "fstlib/cext/pywrapfst.pyx":3595
  *                map_type="identity",
  *                double power=1.,
  *                weight=None):             # <<<<<<<<<<<<<<
  *   cdef fst.MapType _map_type
  *   if not fst.GetMapType(tostring(map_type), addr(_map_type)):
  */
   PyObject *__pyx_v_weight = ((PyObject *)Py_None);
@@ -37477,37 +38049,37 @@
             __pyx_v_weight = __pyx_optional_args->weight;
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3456
+  /* "fstlib/cext/pywrapfst.pyx":3597
  *                weight=None):
  *   cdef fst.MapType _map_type
  *   if not fst.GetMapType(tostring(map_type), addr(_map_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown map type: {map_type!r}")
  *   cdef fst.WeightClass _weight
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_map_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3456, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_map_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3597, __pyx_L1_error)
   __pyx_t_2 = ((!(fst::script::GetMapType(__pyx_t_1, (&__pyx_v__map_type)) != 0)) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":3457
+    /* "fstlib/cext/pywrapfst.pyx":3598
  *   cdef fst.MapType _map_type
  *   if not fst.GetMapType(tostring(map_type), addr(_map_type)):
  *     raise FstArgError(f"Unknown map type: {map_type!r}")             # <<<<<<<<<<<<<<
  *   cdef fst.WeightClass _weight
  *   if _map_type == fst.MapType.TIMES_MAPPER:
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3457, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3598, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_map_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3457, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_map_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3598, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_map_type, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3457, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_map_type, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3598, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -37515,116 +38087,116 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3457, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3598, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 3457, __pyx_L1_error)
+    __PYX_ERR(0, 3598, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":3456
+    /* "fstlib/cext/pywrapfst.pyx":3597
  *                weight=None):
  *   cdef fst.MapType _map_type
  *   if not fst.GetMapType(tostring(map_type), addr(_map_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown map type: {map_type!r}")
  *   cdef fst.WeightClass _weight
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3459
+  /* "fstlib/cext/pywrapfst.pyx":3600
  *     raise FstArgError(f"Unknown map type: {map_type!r}")
  *   cdef fst.WeightClass _weight
  *   if _map_type == fst.MapType.TIMES_MAPPER:             # <<<<<<<<<<<<<<
  *       _weight = _get_WeightClass_or_one(ifst.weight_type(), weight)
  *   else:
  */
   __pyx_t_2 = ((__pyx_v__map_type == fst::script::MapType::TIMES) != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":3460
+    /* "fstlib/cext/pywrapfst.pyx":3601
  *   cdef fst.WeightClass _weight
  *   if _map_type == fst.MapType.TIMES_MAPPER:
  *       _weight = _get_WeightClass_or_one(ifst.weight_type(), weight)             # <<<<<<<<<<<<<<
  *   else:
  *       _weight = _get_WeightClass_or_zero(ifst.weight_type(), weight)
  */
     if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "weight_type");
-      __PYX_ERR(0, 3460, __pyx_L1_error)
+      __PYX_ERR(0, 3601, __pyx_L1_error)
     }
-    __pyx_t_7 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_one(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3460, __pyx_L1_error)
+    __pyx_t_7 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_one(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3601, __pyx_L1_error)
     __pyx_v__weight = __pyx_t_7;
 
-    /* "fstlib/cext/pywrapfst.pyx":3459
+    /* "fstlib/cext/pywrapfst.pyx":3600
  *     raise FstArgError(f"Unknown map type: {map_type!r}")
  *   cdef fst.WeightClass _weight
  *   if _map_type == fst.MapType.TIMES_MAPPER:             # <<<<<<<<<<<<<<
  *       _weight = _get_WeightClass_or_one(ifst.weight_type(), weight)
  *   else:
  */
     goto __pyx_L4;
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3462
+  /* "fstlib/cext/pywrapfst.pyx":3603
  *       _weight = _get_WeightClass_or_one(ifst.weight_type(), weight)
  *   else:
  *       _weight = _get_WeightClass_or_zero(ifst.weight_type(), weight)             # <<<<<<<<<<<<<<
  *   return _init_XFst(
  *     fst.Map(deref(ifst._fst), _map_type, delta, power, _weight).release())
  */
   /*else*/ {
     if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "weight_type");
-      __PYX_ERR(0, 3462, __pyx_L1_error)
+      __PYX_ERR(0, 3603, __pyx_L1_error)
     }
-    __pyx_t_7 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3462, __pyx_L1_error)
+    __pyx_t_7 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3603, __pyx_L1_error)
     __pyx_v__weight = __pyx_t_7;
   }
   __pyx_L4:;
 
-  /* "fstlib/cext/pywrapfst.pyx":3463
+  /* "fstlib/cext/pywrapfst.pyx":3604
  *   else:
  *       _weight = _get_WeightClass_or_zero(ifst.weight_type(), weight)
  *   return _init_XFst(             # <<<<<<<<<<<<<<
  *     fst.Map(deref(ifst._fst), _map_type, delta, power, _weight).release())
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
 
-  /* "fstlib/cext/pywrapfst.pyx":3464
+  /* "fstlib/cext/pywrapfst.pyx":3605
  *       _weight = _get_WeightClass_or_zero(ifst.weight_type(), weight)
  *   return _init_XFst(
  *     fst.Map(deref(ifst._fst), _map_type, delta, power, _weight).release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3464, __pyx_L1_error)
+    __PYX_ERR(0, 3605, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3463
+  /* "fstlib/cext/pywrapfst.pyx":3604
  *   else:
  *       _weight = _get_WeightClass_or_zero(ifst.weight_type(), weight)
  *   return _init_XFst(             # <<<<<<<<<<<<<<
  *     fst.Map(deref(ifst._fst), _map_type, delta, power, _weight).release())
  * 
  */
-  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(fst::script::Map((*__pyx_v_ifst->_fst), __pyx_v__map_type, __pyx_v_delta, __pyx_v_power, __pyx_v__weight).release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3463, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(fst::script::Map((*__pyx_v_ifst->_fst), __pyx_v__map_type, __pyx_v_delta, __pyx_v_power, __pyx_v__weight).release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3604, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3450
+  /* "fstlib/cext/pywrapfst.pyx":3591
  * 
  * 
  * cdef Fst _map(Fst ifst,             # <<<<<<<<<<<<<<
  *                float delta=fst.kDelta,
  *                map_type="identity",
  */
 
@@ -37638,29 +38210,29 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3467
+/* "fstlib/cext/pywrapfst.pyx":3608
  * 
  * 
  * cpdef Fst arcmap(Fst ifst,             # <<<<<<<<<<<<<<
  *                  float delta=fst.kDelta,
  *                  map_type="identity",
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_21arcmap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_f_6fstlib_4cext_9pywrapfst_arcmap(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_arcmap *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__33;
+  float __pyx_v_delta = __pyx_k__31;
   PyObject *__pyx_v_map_type = ((PyObject *)__pyx_n_u_identity);
   double __pyx_v_power = ((double)1.);
 
-  /* "fstlib/cext/pywrapfst.pyx":3471
+  /* "fstlib/cext/pywrapfst.pyx":3612
  *                  map_type="identity",
  *                  double power=1.,
  *                  weight=None):             # <<<<<<<<<<<<<<
  *   """
  *   arcmap(ifst, delta=0.0009765625, map_type="identity", power=1., weight=None)
  */
   PyObject *__pyx_v_weight = ((PyObject *)Py_None);
@@ -37683,34 +38255,34 @@
             __pyx_v_weight = __pyx_optional_args->weight;
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3511
+  /* "fstlib/cext/pywrapfst.pyx":3652
  *     FstArgError: Unknown map type.
  *   """
  *   return _map(ifst, delta, map_type, power, weight)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __pyx_t_2.__pyx_n = 4;
   __pyx_t_2.delta = __pyx_v_delta;
   __pyx_t_2.map_type = __pyx_v_map_type;
   __pyx_t_2.power = __pyx_v_power;
   __pyx_t_2.weight = __pyx_v_weight;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__map(__pyx_v_ifst, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3511, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__map(__pyx_v_ifst, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3652, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3467
+  /* "fstlib/cext/pywrapfst.pyx":3608
  * 
  * 
  * cpdef Fst arcmap(Fst ifst,             # <<<<<<<<<<<<<<
  *                  float delta=fst.kDelta,
  *                  map_type="identity",
  */
 
@@ -37741,15 +38313,15 @@
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("arcmap (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ifst,&__pyx_n_s_delta,&__pyx_n_s_map_type,&__pyx_n_s_power,&__pyx_n_s_weight,0};
     PyObject* values[5] = {0,0,0,0,0};
     values[2] = ((PyObject *)__pyx_n_u_identity);
 
-    /* "fstlib/cext/pywrapfst.pyx":3471
+    /* "fstlib/cext/pywrapfst.pyx":3612
  *                  map_type="identity",
  *                  double power=1.,
  *                  weight=None):             # <<<<<<<<<<<<<<
  *   """
  *   arcmap(ifst, delta=0.0009765625, map_type="identity", power=1., weight=None)
  */
     values[4] = ((PyObject *)Py_None);
@@ -37797,15 +38369,15 @@
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weight);
           if (value) { values[4] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "arcmap") < 0)) __PYX_ERR(0, 3467, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "arcmap") < 0)) __PYX_ERR(0, 3608, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
@@ -37816,38 +38388,38 @@
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     if (values[1]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3468, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3609, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__33;
+      __pyx_v_delta = __pyx_k__31;
     }
     __pyx_v_map_type = values[2];
     if (values[3]) {
-      __pyx_v_power = __pyx_PyFloat_AsDouble(values[3]); if (unlikely((__pyx_v_power == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 3470, __pyx_L3_error)
+      __pyx_v_power = __pyx_PyFloat_AsDouble(values[3]); if (unlikely((__pyx_v_power == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 3611, __pyx_L3_error)
     } else {
       __pyx_v_power = ((double)1.);
     }
     __pyx_v_weight = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("arcmap", 0, 1, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3467, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("arcmap", 0, 1, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3608, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.arcmap", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3467, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3608, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_20arcmap(__pyx_self, __pyx_v_ifst, __pyx_v_delta, __pyx_v_map_type, __pyx_v_power, __pyx_v_weight);
 
-  /* "fstlib/cext/pywrapfst.pyx":3467
+  /* "fstlib/cext/pywrapfst.pyx":3608
  * 
  * 
  * cpdef Fst arcmap(Fst ifst,             # <<<<<<<<<<<<<<
  *                  float delta=fst.kDelta,
  *                  map_type="identity",
  */
 
@@ -37871,15 +38443,15 @@
   __Pyx_RefNannySetupContext("arcmap", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 4;
   __pyx_t_2.delta = __pyx_v_delta;
   __pyx_t_2.map_type = __pyx_v_map_type;
   __pyx_t_2.power = __pyx_v_power;
   __pyx_t_2.weight = __pyx_v_weight;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_arcmap(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3467, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_arcmap(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3608, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -37888,27 +38460,27 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3514
+/* "fstlib/cext/pywrapfst.pyx":3655
  * 
  * 
  * cpdef MutableFst compose(Fst ifst1,             # <<<<<<<<<<<<<<
  *                          Fst ifst2,
  *                          compose_filter="auto",
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_23compose(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_compose(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_compose *__pyx_optional_args) {
   PyObject *__pyx_v_compose_filter = ((PyObject *)__pyx_n_u_auto);
 
-  /* "fstlib/cext/pywrapfst.pyx":3517
+  /* "fstlib/cext/pywrapfst.pyx":3658
  *                          Fst ifst2,
  *                          compose_filter="auto",
  *                          bool connect=True):             # <<<<<<<<<<<<<<
  *   """
  *   compose(ifst1, ifst2, compose_filter="auto", connect=True)
  */
   bool __pyx_v_connect = ((bool)1);
@@ -37928,78 +38500,78 @@
       __pyx_v_compose_filter = __pyx_optional_args->compose_filter;
       if (__pyx_optional_args->__pyx_n > 1) {
         __pyx_v_connect = __pyx_optional_args->connect;
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3541
+  /* "fstlib/cext/pywrapfst.pyx":3682
  *   """
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst1.arc_type()))             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.ComposeOptions] _opts
  *   _opts.reset(
  */
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 3541, __pyx_L1_error)
+    __PYX_ERR(0, 3682, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst1->__pyx_vtab)->arc_type(__pyx_v_ifst1, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":3545
+  /* "fstlib/cext/pywrapfst.pyx":3686
  *   _opts.reset(
  *       new fst.ComposeOptions(connect,
  *                              _get_compose_filter(tostring(compose_filter))))             # <<<<<<<<<<<<<<
  *   fst.Compose(deref(ifst1._fst), deref(ifst2._fst), _tfst.get(), deref(_opts))
  *   return _init_MutableFst(_tfst.release())
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_compose_filter); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3545, __pyx_L1_error)
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_compose_filter(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3545, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_compose_filter); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3686, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_compose_filter(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3686, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":3543
+  /* "fstlib/cext/pywrapfst.pyx":3684
  *   _tfst.reset(new fst.VectorFstClass(ifst1.arc_type()))
  *   cdef unique_ptr[fst.ComposeOptions] _opts
  *   _opts.reset(             # <<<<<<<<<<<<<<
  *       new fst.ComposeOptions(connect,
  *                              _get_compose_filter(tostring(compose_filter))))
  */
   __pyx_v__opts.reset(new fst::ComposeOptions(__pyx_v_connect, __pyx_t_2));
 
-  /* "fstlib/cext/pywrapfst.pyx":3546
+  /* "fstlib/cext/pywrapfst.pyx":3687
  *       new fst.ComposeOptions(connect,
  *                              _get_compose_filter(tostring(compose_filter))))
  *   fst.Compose(deref(ifst1._fst), deref(ifst2._fst), _tfst.get(), deref(_opts))             # <<<<<<<<<<<<<<
  *   return _init_MutableFst(_tfst.release())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3546, __pyx_L1_error)
+    __PYX_ERR(0, 3687, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3546, __pyx_L1_error)
+    __PYX_ERR(0, 3687, __pyx_L1_error)
   }
   fst::script::Compose((*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst), __pyx_v__tfst.get(), (*__pyx_v__opts));
 
-  /* "fstlib/cext/pywrapfst.pyx":3547
+  /* "fstlib/cext/pywrapfst.pyx":3688
  *                              _get_compose_filter(tostring(compose_filter))))
  *   fst.Compose(deref(ifst1._fst), deref(ifst2._fst), _tfst.get(), deref(_opts))
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3547, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3688, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3514
+  /* "fstlib/cext/pywrapfst.pyx":3655
  * 
  * 
  * cpdef MutableFst compose(Fst ifst1,             # <<<<<<<<<<<<<<
  *                          Fst ifst2,
  *                          compose_filter="auto",
  */
 
@@ -38052,15 +38624,15 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("compose", 0, 2, 4, 1); __PYX_ERR(0, 3514, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compose", 0, 2, 4, 1); __PYX_ERR(0, 3655, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_compose_filter);
           if (value) { values[2] = value; kw_args--; }
         }
@@ -38068,15 +38640,15 @@
         case  3:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_connect);
           if (value) { values[3] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "compose") < 0)) __PYX_ERR(0, 3514, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "compose") < 0)) __PYX_ERR(0, 3655, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
@@ -38086,40 +38658,40 @@
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
     __pyx_v_compose_filter = values[2];
     if (values[3]) {
-      __pyx_v_connect = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_connect == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3517, __pyx_L3_error)
+      __pyx_v_connect = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_connect == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3658, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":3517
+      /* "fstlib/cext/pywrapfst.pyx":3658
  *                          Fst ifst2,
  *                          compose_filter="auto",
  *                          bool connect=True):             # <<<<<<<<<<<<<<
  *   """
  *   compose(ifst1, ifst2, compose_filter="auto", connect=True)
  */
       __pyx_v_connect = ((bool)1);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("compose", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3514, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("compose", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3655, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.compose", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3514, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3515, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3655, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3656, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_22compose(__pyx_self, __pyx_v_ifst1, __pyx_v_ifst2, __pyx_v_compose_filter, __pyx_v_connect);
 
-  /* "fstlib/cext/pywrapfst.pyx":3514
+  /* "fstlib/cext/pywrapfst.pyx":3655
  * 
  * 
  * cpdef MutableFst compose(Fst ifst1,             # <<<<<<<<<<<<<<
  *                          Fst ifst2,
  *                          compose_filter="auto",
  */
 
@@ -38141,15 +38713,15 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("compose", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 2;
   __pyx_t_2.compose_filter = __pyx_v_compose_filter;
   __pyx_t_2.connect = __pyx_v_connect;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_compose(__pyx_v_ifst1, __pyx_v_ifst2, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3514, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_compose(__pyx_v_ifst1, __pyx_v_ifst2, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3655, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -38158,25 +38730,25 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3550
+/* "fstlib/cext/pywrapfst.pyx":3691
  * 
  * 
  * cpdef Fst convert(Fst ifst, fst_type=""):             # <<<<<<<<<<<<<<
  *   """
  *   convert(ifst, fst_type="")
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_25convert(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_f_6fstlib_4cext_9pywrapfst_convert(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_convert *__pyx_optional_args) {
-  PyObject *__pyx_v_fst_type = ((PyObject *)__pyx_kp_u__11);
+  PyObject *__pyx_v_fst_type = ((PyObject *)__pyx_kp_u__9);
   std::string __pyx_v__fst_type;
   std::unique_ptr<fst::script::FstClass>  __pyx_v__tfst;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   std::string __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
@@ -38191,76 +38763,76 @@
   __Pyx_RefNannySetupContext("convert", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_fst_type = __pyx_optional_args->fst_type;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3567
+  /* "fstlib/cext/pywrapfst.pyx":3708
  *     FstOpError: Conversion failed.
  *   """
  *   cdef string _fst_type = tostring(fst_type)             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.FstClass] _tfst
  *   _tfst = fst.Convert(deref(ifst._fst), _fst_type)
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_fst_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3567, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_fst_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3708, __pyx_L1_error)
   __pyx_v__fst_type = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":3569
+  /* "fstlib/cext/pywrapfst.pyx":3710
  *   cdef string _fst_type = tostring(fst_type)
  *   cdef unique_ptr[fst.FstClass] _tfst
  *   _tfst = fst.Convert(deref(ifst._fst), _fst_type)             # <<<<<<<<<<<<<<
  *   # Script-land Convert returns a null pointer to signal failure.
  *   if _tfst.get() == NULL:
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3569, __pyx_L1_error)
+    __PYX_ERR(0, 3710, __pyx_L1_error)
   }
   __pyx_v__tfst = fst::script::Convert((*__pyx_v_ifst->_fst), __pyx_v__fst_type);
 
-  /* "fstlib/cext/pywrapfst.pyx":3571
+  /* "fstlib/cext/pywrapfst.pyx":3712
  *   _tfst = fst.Convert(deref(ifst._fst), _fst_type)
  *   # Script-land Convert returns a null pointer to signal failure.
  *   if _tfst.get() == NULL:             # <<<<<<<<<<<<<<
  *     raise FstOpError(f"Conversion to {fst_type!r} failed")
  *   return _init_XFst(_tfst.release())
  */
   __pyx_t_2 = ((__pyx_v__tfst.get() == NULL) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":3572
+    /* "fstlib/cext/pywrapfst.pyx":3713
  *   # Script-land Convert returns a null pointer to signal failure.
  *   if _tfst.get() == NULL:
  *     raise FstOpError(f"Conversion to {fst_type!r} failed")             # <<<<<<<<<<<<<<
  *   return _init_XFst(_tfst.release())
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3572, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3713, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3572, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3713, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_6 = 0;
     __pyx_t_7 = 127;
     __Pyx_INCREF(__pyx_kp_u_Conversion_to);
     __pyx_t_6 += 14;
     __Pyx_GIVEREF(__pyx_kp_u_Conversion_to);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_Conversion_to);
-    __pyx_t_8 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_fst_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3572, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_fst_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3713, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
     __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_8);
     PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_8);
     __pyx_t_8 = 0;
     __Pyx_INCREF(__pyx_kp_u_failed);
     __pyx_t_6 += 7;
     __Pyx_GIVEREF(__pyx_kp_u_failed);
     PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_kp_u_failed);
-    __pyx_t_8 = __Pyx_PyUnicode_Join(__pyx_t_5, 3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3572, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyUnicode_Join(__pyx_t_5, 3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3713, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -38268,45 +38840,45 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_8) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_8);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3572, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3713, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 3572, __pyx_L1_error)
+    __PYX_ERR(0, 3713, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":3571
+    /* "fstlib/cext/pywrapfst.pyx":3712
  *   _tfst = fst.Convert(deref(ifst._fst), _fst_type)
  *   # Script-land Convert returns a null pointer to signal failure.
  *   if _tfst.get() == NULL:             # <<<<<<<<<<<<<<
  *     raise FstOpError(f"Conversion to {fst_type!r} failed")
  *   return _init_XFst(_tfst.release())
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3573
+  /* "fstlib/cext/pywrapfst.pyx":3714
  *   if _tfst.get() == NULL:
  *     raise FstOpError(f"Conversion to {fst_type!r} failed")
  *   return _init_XFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3573, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3714, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3550
+  /* "fstlib/cext/pywrapfst.pyx":3691
  * 
  * 
  * cpdef Fst convert(Fst ifst, fst_type=""):             # <<<<<<<<<<<<<<
  *   """
  *   convert(ifst, fst_type="")
  */
 
@@ -38335,15 +38907,15 @@
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("convert (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ifst,&__pyx_n_s_fst_type,0};
     PyObject* values[2] = {0,0};
-    values[1] = ((PyObject *)__pyx_kp_u__11);
+    values[1] = ((PyObject *)__pyx_kp_u__9);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
@@ -38360,15 +38932,15 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_fst_type);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "convert") < 0)) __PYX_ERR(0, 3550, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "convert") < 0)) __PYX_ERR(0, 3691, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
@@ -38376,21 +38948,21 @@
       }
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_fst_type = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("convert", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3550, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("convert", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3691, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.convert", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3550, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3691, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_24convert(__pyx_self, __pyx_v_ifst, __pyx_v_fst_type);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -38406,15 +38978,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("convert", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.fst_type = __pyx_v_fst_type;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_convert(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3550, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_convert(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3691, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -38423,40 +38995,40 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3576
+/* "fstlib/cext/pywrapfst.pyx":3717
  * 
  * 
  * cpdef MutableFst determinize(Fst ifst,             # <<<<<<<<<<<<<<
  *                              float delta=fst.kShortestDelta,
  *                              det_type="functional",
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_27determinize(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_determinize(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_determinize *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__34;
+  float __pyx_v_delta = __pyx_k__32;
   PyObject *__pyx_v_det_type = ((PyObject *)__pyx_n_u_functional);
-  int64 __pyx_v_nstate = __pyx_k__35;
-  int64 __pyx_v_subsequential_label = ((int64)0);
+  int64_t __pyx_v_nstate = __pyx_k__33;
+  int64_t __pyx_v_subsequential_label = ((int64_t)0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3581
- *                              int64 nstate=fst.kNoStateId,
- *                              int64 subsequential_label=0,
+  /* "fstlib/cext/pywrapfst.pyx":3722
+ *                              int64_t nstate=fst.kNoStateId,
+ *                              int64_t subsequential_label=0,
  *                              weight=None,             # <<<<<<<<<<<<<<
  *                              bool increment_subsequential_label=False):
  *   """
  */
   PyObject *__pyx_v_weight = ((PyObject *)Py_None);
 
-  /* "fstlib/cext/pywrapfst.pyx":3582
- *                              int64 subsequential_label=0,
+  /* "fstlib/cext/pywrapfst.pyx":3723
+ *                              int64_t subsequential_label=0,
  *                              weight=None,
  *                              bool increment_subsequential_label=False):             # <<<<<<<<<<<<<<
  *   """
  *   determinize(ifst, delta=1e-6, det_type="functional",
  */
   bool __pyx_v_increment_subsequential_label = ((bool)0);
   std::unique_ptr<fst::script::VectorFstClass>  __pyx_v__tfst;
@@ -38493,72 +39065,72 @@
             }
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3616
+  /* "fstlib/cext/pywrapfst.pyx":3757
  *   """
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))             # <<<<<<<<<<<<<<
  *   # Threshold is set to semiring Zero (no pruning) if weight unspecified.
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 3616, __pyx_L1_error)
+    __PYX_ERR(0, 3757, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->arc_type(__pyx_v_ifst, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":3618
+  /* "fstlib/cext/pywrapfst.pyx":3759
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   # Threshold is set to semiring Zero (no pruning) if weight unspecified.
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),             # <<<<<<<<<<<<<<
  *                                                           weight)
  *   cdef fst.DeterminizeType _det_type
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "weight_type");
-    __PYX_ERR(0, 3618, __pyx_L1_error)
+    __PYX_ERR(0, 3759, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3619
+  /* "fstlib/cext/pywrapfst.pyx":3760
  *   # Threshold is set to semiring Zero (no pruning) if weight unspecified.
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),
  *                                                           weight)             # <<<<<<<<<<<<<<
  *   cdef fst.DeterminizeType _det_type
  *   if not fst.GetDeterminizeType(tostring(det_type), addr(_det_type)):
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3618, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3759, __pyx_L1_error)
   __pyx_v__weight = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":3621
+  /* "fstlib/cext/pywrapfst.pyx":3762
  *                                                           weight)
  *   cdef fst.DeterminizeType _det_type
  *   if not fst.GetDeterminizeType(tostring(det_type), addr(_det_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown determinization type: {det_type!r}")
  *   cdef unique_ptr[fst.DeterminizeOptions] _opts
  */
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_det_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3621, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_det_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3762, __pyx_L1_error)
   __pyx_t_3 = ((!(fst::script::GetDeterminizeType(__pyx_t_2, (&__pyx_v__det_type)) != 0)) != 0);
   if (unlikely(__pyx_t_3)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":3622
+    /* "fstlib/cext/pywrapfst.pyx":3763
  *   cdef fst.DeterminizeType _det_type
  *   if not fst.GetDeterminizeType(tostring(det_type), addr(_det_type)):
  *     raise FstArgError(f"Unknown determinization type: {det_type!r}")             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.DeterminizeOptions] _opts
  *   _opts.reset(
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3622, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_FstArgError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3763, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_det_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3622, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_det_type), __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3763, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_7 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_determinization_type, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3622, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unknown_determinization_type, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3763, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_t_6 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_6)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
@@ -38566,67 +39138,67 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
       }
     }
     __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_7);
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3622, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3763, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 3622, __pyx_L1_error)
+    __PYX_ERR(0, 3763, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":3621
+    /* "fstlib/cext/pywrapfst.pyx":3762
  *                                                           weight)
  *   cdef fst.DeterminizeType _det_type
  *   if not fst.GetDeterminizeType(tostring(det_type), addr(_det_type)):             # <<<<<<<<<<<<<<
  *     raise FstArgError(f"Unknown determinization type: {det_type!r}")
  *   cdef unique_ptr[fst.DeterminizeOptions] _opts
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3624
+  /* "fstlib/cext/pywrapfst.pyx":3765
  *     raise FstArgError(f"Unknown determinization type: {det_type!r}")
  *   cdef unique_ptr[fst.DeterminizeOptions] _opts
  *   _opts.reset(             # <<<<<<<<<<<<<<
  *       new fst.DeterminizeOptions(delta,
  *                                  _weight,
  */
   __pyx_v__opts.reset(new fst::script::DeterminizeOptions(__pyx_v_delta, __pyx_v__weight, __pyx_v_nstate, __pyx_v_subsequential_label, __pyx_v__det_type, __pyx_v_increment_subsequential_label));
 
-  /* "fstlib/cext/pywrapfst.pyx":3631
+  /* "fstlib/cext/pywrapfst.pyx":3772
  *                                  _det_type,
  *                                  increment_subsequential_label))
  *   fst.Determinize(deref(ifst._fst), _tfst.get(), deref(_opts))             # <<<<<<<<<<<<<<
  *   return _init_MutableFst(_tfst.release())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3631, __pyx_L1_error)
+    __PYX_ERR(0, 3772, __pyx_L1_error)
   }
   fst::script::Determinize((*__pyx_v_ifst->_fst), __pyx_v__tfst.get(), (*__pyx_v__opts));
 
-  /* "fstlib/cext/pywrapfst.pyx":3632
+  /* "fstlib/cext/pywrapfst.pyx":3773
  *                                  increment_subsequential_label))
  *   fst.Determinize(deref(ifst._fst), _tfst.get(), deref(_opts))
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_4 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3632, __pyx_L1_error)
+  __pyx_t_4 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3773, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_4);
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3576
+  /* "fstlib/cext/pywrapfst.pyx":3717
  * 
  * 
  * cpdef MutableFst determinize(Fst ifst,             # <<<<<<<<<<<<<<
  *                              float delta=fst.kShortestDelta,
  *                              det_type="functional",
  */
 
@@ -38647,32 +39219,32 @@
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_27determinize(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_26determinize[] = "\n  determinize(ifst, delta=1e-6, det_type=\"functional\",\n              nstate=NO_STATE_ID, subsequential_label=0, weight=None,\n              incremental_subsequential_label=False)\n\n  Constructively determinizes a weighted FST.\n\n  This operations creates an equivalent FST that has the property that no\n  state has two transitions with the same input label. For this algorithm,\n  epsilon transitions are treated as regular symbols (cf. `rmepsilon`).\n\n  Args:\n    ifst: The input FST.\n    delta: Comparison/quantization delta.\n    det_type: Type of determinization; one of: \"functional\" (input transducer is\n        functional), \"nonfunctional\" (input transducer is not functional) and\n        disambiguate\" (input transducer is not functional but only keep the min\n        of ambiguous outputs).\n    nstate: State number threshold.\n    subsequential_label: Input label of arc corresponding to residual final\n        output when producing a subsequential transducer.\n    weight: A Weight or weight string indicating the desired weight threshold\n        below which paths are pruned; if omitted, no paths are pruned.\n    increment_subsequential_label: Increment subsequential when creating\n        several arcs for the residual final output at a given state.\n\n  Returns:\n    An equivalent deterministic FST.\n\n  Raises:\n    FstArgError: Unknown determinization type.\n  ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_27determinize(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst = 0;
   float __pyx_v_delta;
   PyObject *__pyx_v_det_type = 0;
-  int64 __pyx_v_nstate;
-  int64 __pyx_v_subsequential_label;
+  int64_t __pyx_v_nstate;
+  int64_t __pyx_v_subsequential_label;
   PyObject *__pyx_v_weight = 0;
   bool __pyx_v_increment_subsequential_label;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("determinize (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ifst,&__pyx_n_s_delta,&__pyx_n_s_det_type,&__pyx_n_s_nstate,&__pyx_n_s_subsequential_label,&__pyx_n_s_weight,&__pyx_n_s_increment_subsequential_label,0};
     PyObject* values[7] = {0,0,0,0,0,0,0};
     values[2] = ((PyObject *)__pyx_n_u_functional);
 
-    /* "fstlib/cext/pywrapfst.pyx":3581
- *                              int64 nstate=fst.kNoStateId,
- *                              int64 subsequential_label=0,
+    /* "fstlib/cext/pywrapfst.pyx":3722
+ *                              int64_t nstate=fst.kNoStateId,
+ *                              int64_t subsequential_label=0,
  *                              weight=None,             # <<<<<<<<<<<<<<
  *                              bool increment_subsequential_label=False):
  *   """
  */
     values[5] = ((PyObject *)Py_None);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
@@ -38734,15 +39306,15 @@
         case  6:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_increment_subsequential_label);
           if (value) { values[6] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "determinize") < 0)) __PYX_ERR(0, 3576, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "determinize") < 0)) __PYX_ERR(0, 3717, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
@@ -38757,56 +39329,56 @@
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     if (values[1]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3577, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3718, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__34;
+      __pyx_v_delta = __pyx_k__32;
     }
     __pyx_v_det_type = values[2];
     if (values[3]) {
-      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[3]); if (unlikely((__pyx_v_nstate == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3579, __pyx_L3_error)
+      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[3]); if (unlikely((__pyx_v_nstate == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3720, __pyx_L3_error)
     } else {
-      __pyx_v_nstate = __pyx_k__35;
+      __pyx_v_nstate = __pyx_k__33;
     }
     if (values[4]) {
-      __pyx_v_subsequential_label = __Pyx_PyInt_As_int64_t(values[4]); if (unlikely((__pyx_v_subsequential_label == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3580, __pyx_L3_error)
+      __pyx_v_subsequential_label = __Pyx_PyInt_As_int64_t(values[4]); if (unlikely((__pyx_v_subsequential_label == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3721, __pyx_L3_error)
     } else {
-      __pyx_v_subsequential_label = ((int64)0);
+      __pyx_v_subsequential_label = ((int64_t)0);
     }
     __pyx_v_weight = values[5];
     if (values[6]) {
-      __pyx_v_increment_subsequential_label = __Pyx_PyObject_IsTrue(values[6]); if (unlikely((__pyx_v_increment_subsequential_label == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3582, __pyx_L3_error)
+      __pyx_v_increment_subsequential_label = __Pyx_PyObject_IsTrue(values[6]); if (unlikely((__pyx_v_increment_subsequential_label == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3723, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":3582
- *                              int64 subsequential_label=0,
+      /* "fstlib/cext/pywrapfst.pyx":3723
+ *                              int64_t subsequential_label=0,
  *                              weight=None,
  *                              bool increment_subsequential_label=False):             # <<<<<<<<<<<<<<
  *   """
  *   determinize(ifst, delta=1e-6, det_type="functional",
  */
       __pyx_v_increment_subsequential_label = ((bool)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("determinize", 0, 1, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3576, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("determinize", 0, 1, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3717, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.determinize", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3576, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3717, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_26determinize(__pyx_self, __pyx_v_ifst, __pyx_v_delta, __pyx_v_det_type, __pyx_v_nstate, __pyx_v_subsequential_label, __pyx_v_weight, __pyx_v_increment_subsequential_label);
 
-  /* "fstlib/cext/pywrapfst.pyx":3576
+  /* "fstlib/cext/pywrapfst.pyx":3717
  * 
  * 
  * cpdef MutableFst determinize(Fst ifst,             # <<<<<<<<<<<<<<
  *                              float delta=fst.kShortestDelta,
  *                              det_type="functional",
  */
 
@@ -38815,15 +39387,15 @@
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_26determinize(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, PyObject *__pyx_v_det_type, int64 __pyx_v_nstate, int64 __pyx_v_subsequential_label, PyObject *__pyx_v_weight, bool __pyx_v_increment_subsequential_label) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_26determinize(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, PyObject *__pyx_v_det_type, int64_t __pyx_v_nstate, int64_t __pyx_v_subsequential_label, PyObject *__pyx_v_weight, bool __pyx_v_increment_subsequential_label) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_determinize __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
@@ -38832,15 +39404,15 @@
   __pyx_t_2.__pyx_n = 6;
   __pyx_t_2.delta = __pyx_v_delta;
   __pyx_t_2.det_type = __pyx_v_det_type;
   __pyx_t_2.nstate = __pyx_v_nstate;
   __pyx_t_2.subsequential_label = __pyx_v_subsequential_label;
   __pyx_t_2.weight = __pyx_v_weight;
   __pyx_t_2.increment_subsequential_label = __pyx_v_increment_subsequential_label;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_determinize(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3576, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_determinize(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3717, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -38849,27 +39421,27 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3635
+/* "fstlib/cext/pywrapfst.pyx":3776
  * 
  * 
  * cpdef MutableFst difference(Fst ifst1,             # <<<<<<<<<<<<<<
  *                             Fst ifst2,
  *                             compose_filter="auto",
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_29difference(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_difference(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_difference *__pyx_optional_args) {
   PyObject *__pyx_v_compose_filter = ((PyObject *)__pyx_n_u_auto);
 
-  /* "fstlib/cext/pywrapfst.pyx":3638
+  /* "fstlib/cext/pywrapfst.pyx":3779
  *                             Fst ifst2,
  *                             compose_filter="auto",
  *                             bool connect=True):             # <<<<<<<<<<<<<<
  *   """
  *   difference(ifst1, ifst2, compose_filter="auto", connect=True)
  */
   bool __pyx_v_connect = ((bool)1);
@@ -38889,94 +39461,94 @@
       __pyx_v_compose_filter = __pyx_optional_args->compose_filter;
       if (__pyx_optional_args->__pyx_n > 1) {
         __pyx_v_connect = __pyx_optional_args->connect;
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3663
+  /* "fstlib/cext/pywrapfst.pyx":3804
  *   """
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst1.arc_type()))             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.ComposeOptions] _opts
  *   _opts.reset(
  */
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 3663, __pyx_L1_error)
+    __PYX_ERR(0, 3804, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst1->__pyx_vtab)->arc_type(__pyx_v_ifst1, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":3667
+  /* "fstlib/cext/pywrapfst.pyx":3808
  *   _opts.reset(
  *       new fst.ComposeOptions(connect,
  *                             _get_compose_filter(tostring(compose_filter))))             # <<<<<<<<<<<<<<
  *   fst.Difference(deref(ifst1._fst),
  *                  deref(ifst2._fst),
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_compose_filter); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3667, __pyx_L1_error)
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_compose_filter(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3667, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_compose_filter); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3808, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_compose_filter(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3808, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":3665
+  /* "fstlib/cext/pywrapfst.pyx":3806
  *   _tfst.reset(new fst.VectorFstClass(ifst1.arc_type()))
  *   cdef unique_ptr[fst.ComposeOptions] _opts
  *   _opts.reset(             # <<<<<<<<<<<<<<
  *       new fst.ComposeOptions(connect,
  *                             _get_compose_filter(tostring(compose_filter))))
  */
   __pyx_v__opts.reset(new fst::ComposeOptions(__pyx_v_connect, __pyx_t_2));
 
-  /* "fstlib/cext/pywrapfst.pyx":3668
+  /* "fstlib/cext/pywrapfst.pyx":3809
  *       new fst.ComposeOptions(connect,
  *                             _get_compose_filter(tostring(compose_filter))))
  *   fst.Difference(deref(ifst1._fst),             # <<<<<<<<<<<<<<
  *                  deref(ifst2._fst),
  *                  _tfst.get(),
  */
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3668, __pyx_L1_error)
+    __PYX_ERR(0, 3809, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3669
+  /* "fstlib/cext/pywrapfst.pyx":3810
  *                             _get_compose_filter(tostring(compose_filter))))
  *   fst.Difference(deref(ifst1._fst),
  *                  deref(ifst2._fst),             # <<<<<<<<<<<<<<
  *                  _tfst.get(),
  *                  deref(_opts))
  */
   if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3669, __pyx_L1_error)
+    __PYX_ERR(0, 3810, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3668
+  /* "fstlib/cext/pywrapfst.pyx":3809
  *       new fst.ComposeOptions(connect,
  *                             _get_compose_filter(tostring(compose_filter))))
  *   fst.Difference(deref(ifst1._fst),             # <<<<<<<<<<<<<<
  *                  deref(ifst2._fst),
  *                  _tfst.get(),
  */
   fst::script::Difference((*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst), __pyx_v__tfst.get(), (*__pyx_v__opts));
 
-  /* "fstlib/cext/pywrapfst.pyx":3672
+  /* "fstlib/cext/pywrapfst.pyx":3813
  *                  _tfst.get(),
  *                  deref(_opts))
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3672, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3813, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3635
+  /* "fstlib/cext/pywrapfst.pyx":3776
  * 
  * 
  * cpdef MutableFst difference(Fst ifst1,             # <<<<<<<<<<<<<<
  *                             Fst ifst2,
  *                             compose_filter="auto",
  */
 
@@ -39029,15 +39601,15 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("difference", 0, 2, 4, 1); __PYX_ERR(0, 3635, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("difference", 0, 2, 4, 1); __PYX_ERR(0, 3776, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_compose_filter);
           if (value) { values[2] = value; kw_args--; }
         }
@@ -39045,15 +39617,15 @@
         case  3:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_connect);
           if (value) { values[3] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "difference") < 0)) __PYX_ERR(0, 3635, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "difference") < 0)) __PYX_ERR(0, 3776, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
@@ -39063,40 +39635,40 @@
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
     __pyx_v_compose_filter = values[2];
     if (values[3]) {
-      __pyx_v_connect = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_connect == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3638, __pyx_L3_error)
+      __pyx_v_connect = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_connect == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3779, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":3638
+      /* "fstlib/cext/pywrapfst.pyx":3779
  *                             Fst ifst2,
  *                             compose_filter="auto",
  *                             bool connect=True):             # <<<<<<<<<<<<<<
  *   """
  *   difference(ifst1, ifst2, compose_filter="auto", connect=True)
  */
       __pyx_v_connect = ((bool)1);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("difference", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3635, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("difference", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3776, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.difference", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3635, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3636, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3776, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3777, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_28difference(__pyx_self, __pyx_v_ifst1, __pyx_v_ifst2, __pyx_v_compose_filter, __pyx_v_connect);
 
-  /* "fstlib/cext/pywrapfst.pyx":3635
+  /* "fstlib/cext/pywrapfst.pyx":3776
  * 
  * 
  * cpdef MutableFst difference(Fst ifst1,             # <<<<<<<<<<<<<<
  *                             Fst ifst2,
  *                             compose_filter="auto",
  */
 
@@ -39118,15 +39690,15 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("difference", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 2;
   __pyx_t_2.compose_filter = __pyx_v_compose_filter;
   __pyx_t_2.connect = __pyx_v_connect;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_difference(__pyx_v_ifst1, __pyx_v_ifst2, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3635, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_difference(__pyx_v_ifst1, __pyx_v_ifst2, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3776, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -39135,31 +39707,31 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3675
+/* "fstlib/cext/pywrapfst.pyx":3816
  * 
  * 
  * cpdef MutableFst disambiguate(Fst ifst,             # <<<<<<<<<<<<<<
  *                               float delta=fst.kDelta,
- *                               int64 nstate=fst.kNoStateId,
+ *                               int64_t nstate=fst.kNoStateId,
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_31disambiguate(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_disambiguate(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_disambiguate *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__36;
-  int64 __pyx_v_nstate = __pyx_k__37;
-  int64 __pyx_v_subsequential_label = ((int64)0);
+  float __pyx_v_delta = __pyx_k__34;
+  int64_t __pyx_v_nstate = __pyx_k__35;
+  int64_t __pyx_v_subsequential_label = ((int64_t)0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3679
- *                               int64 nstate=fst.kNoStateId,
- *                               int64 subsequential_label=0,
+  /* "fstlib/cext/pywrapfst.pyx":3820
+ *                               int64_t nstate=fst.kNoStateId,
+ *                               int64_t subsequential_label=0,
  *                               weight=None):             # <<<<<<<<<<<<<<
  *   """
  *   disambiguate(ifst, delta=0.0009765625, nstate=NO_STATE_ID,
  */
   PyObject *__pyx_v_weight = ((PyObject *)Py_None);
   std::unique_ptr<fst::script::VectorFstClass>  __pyx_v__tfst;
   fst::script::WeightClass __pyx_v__weight;
@@ -39183,91 +39755,91 @@
             __pyx_v_weight = __pyx_optional_args->weight;
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3704
+  /* "fstlib/cext/pywrapfst.pyx":3845
  *   """
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))             # <<<<<<<<<<<<<<
  *   # Threshold is set to semiring Zero (no pruning) if no weight is specified.
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 3704, __pyx_L1_error)
+    __PYX_ERR(0, 3845, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->arc_type(__pyx_v_ifst, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":3706
+  /* "fstlib/cext/pywrapfst.pyx":3847
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   # Threshold is set to semiring Zero (no pruning) if no weight is specified.
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),             # <<<<<<<<<<<<<<
  *                                                      weight)
  *   cdef unique_ptr[fst.DisambiguateOptions] _opts
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "weight_type");
-    __PYX_ERR(0, 3706, __pyx_L1_error)
+    __PYX_ERR(0, 3847, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3707
+  /* "fstlib/cext/pywrapfst.pyx":3848
  *   # Threshold is set to semiring Zero (no pruning) if no weight is specified.
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),
  *                                                      weight)             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.DisambiguateOptions] _opts
  *   _opts.reset(
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3706, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3847, __pyx_L1_error)
   __pyx_v__weight = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":3709
+  /* "fstlib/cext/pywrapfst.pyx":3850
  *                                                      weight)
  *   cdef unique_ptr[fst.DisambiguateOptions] _opts
  *   _opts.reset(             # <<<<<<<<<<<<<<
  *       new fst.DisambiguateOptions(delta,
  *                                   _weight,
  */
   __pyx_v__opts.reset(new fst::script::DisambiguateOptions(__pyx_v_delta, __pyx_v__weight, __pyx_v_nstate, __pyx_v_subsequential_label));
 
-  /* "fstlib/cext/pywrapfst.pyx":3714
+  /* "fstlib/cext/pywrapfst.pyx":3855
  *                                   nstate,
  *                                   subsequential_label))
  *   fst.Disambiguate(deref(ifst._fst), _tfst.get(), deref(_opts))             # <<<<<<<<<<<<<<
  *   return _init_MutableFst(_tfst.release())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3714, __pyx_L1_error)
+    __PYX_ERR(0, 3855, __pyx_L1_error)
   }
   fst::script::Disambiguate((*__pyx_v_ifst->_fst), __pyx_v__tfst.get(), (*__pyx_v__opts));
 
-  /* "fstlib/cext/pywrapfst.pyx":3715
+  /* "fstlib/cext/pywrapfst.pyx":3856
  *                                   subsequential_label))
  *   fst.Disambiguate(deref(ifst._fst), _tfst.get(), deref(_opts))
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3715, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3856, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_2);
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3675
+  /* "fstlib/cext/pywrapfst.pyx":3816
  * 
  * 
  * cpdef MutableFst disambiguate(Fst ifst,             # <<<<<<<<<<<<<<
  *                               float delta=fst.kDelta,
- *                               int64 nstate=fst.kNoStateId,
+ *                               int64_t nstate=fst.kNoStateId,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.disambiguate", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
@@ -39279,30 +39851,30 @@
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_31disambiguate(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_30disambiguate[] = "\n  disambiguate(ifst, delta=0.0009765625, nstate=NO_STATE_ID,\n               subsequential_label=0, weight=None):\n\n  Constructively disambiguates a weighted transducer.\n\n  This operation disambiguates a weighted transducer. The result will be an\n  equivalent FST that has the property that no two successful paths have the\n  same input labeling. For this algorithm, epsilon transitions are treated as\n  regular symbols (cf. `rmepsilon`).\n\n  Args:\n    ifst: The input FST.\n    delta: Comparison/quantization delta.\n    nstate: State number threshold.\n    subsequential_label: Input label of arc corresponding to residual final\n        output when producing a subsequential transducer.\n    weight: A Weight or weight string indicating the desired weight threshold\n        below which paths are pruned; if omitted, no paths are pruned.\n\n  Returns:\n    An equivalent disambiguated FST.\n  ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_31disambiguate(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst = 0;
   float __pyx_v_delta;
-  int64 __pyx_v_nstate;
-  int64 __pyx_v_subsequential_label;
+  int64_t __pyx_v_nstate;
+  int64_t __pyx_v_subsequential_label;
   PyObject *__pyx_v_weight = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("disambiguate (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ifst,&__pyx_n_s_delta,&__pyx_n_s_nstate,&__pyx_n_s_subsequential_label,&__pyx_n_s_weight,0};
     PyObject* values[5] = {0,0,0,0,0};
 
-    /* "fstlib/cext/pywrapfst.pyx":3679
- *                               int64 nstate=fst.kNoStateId,
- *                               int64 subsequential_label=0,
+    /* "fstlib/cext/pywrapfst.pyx":3820
+ *                               int64_t nstate=fst.kNoStateId,
+ *                               int64_t subsequential_label=0,
  *                               weight=None):             # <<<<<<<<<<<<<<
  *   """
  *   disambiguate(ifst, delta=0.0009765625, nstate=NO_STATE_ID,
  */
     values[4] = ((PyObject *)Py_None);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
@@ -39348,15 +39920,15 @@
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weight);
           if (value) { values[4] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "disambiguate") < 0)) __PYX_ERR(0, 3675, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "disambiguate") < 0)) __PYX_ERR(0, 3816, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
@@ -39367,74 +39939,74 @@
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     if (values[1]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3676, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3817, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__36;
+      __pyx_v_delta = __pyx_k__34;
     }
     if (values[2]) {
-      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[2]); if (unlikely((__pyx_v_nstate == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3677, __pyx_L3_error)
+      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[2]); if (unlikely((__pyx_v_nstate == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3818, __pyx_L3_error)
     } else {
-      __pyx_v_nstate = __pyx_k__37;
+      __pyx_v_nstate = __pyx_k__35;
     }
     if (values[3]) {
-      __pyx_v_subsequential_label = __Pyx_PyInt_As_int64_t(values[3]); if (unlikely((__pyx_v_subsequential_label == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3678, __pyx_L3_error)
+      __pyx_v_subsequential_label = __Pyx_PyInt_As_int64_t(values[3]); if (unlikely((__pyx_v_subsequential_label == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3819, __pyx_L3_error)
     } else {
-      __pyx_v_subsequential_label = ((int64)0);
+      __pyx_v_subsequential_label = ((int64_t)0);
     }
     __pyx_v_weight = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("disambiguate", 0, 1, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3675, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("disambiguate", 0, 1, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3816, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.disambiguate", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3675, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3816, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_30disambiguate(__pyx_self, __pyx_v_ifst, __pyx_v_delta, __pyx_v_nstate, __pyx_v_subsequential_label, __pyx_v_weight);
 
-  /* "fstlib/cext/pywrapfst.pyx":3675
+  /* "fstlib/cext/pywrapfst.pyx":3816
  * 
  * 
  * cpdef MutableFst disambiguate(Fst ifst,             # <<<<<<<<<<<<<<
  *                               float delta=fst.kDelta,
- *                               int64 nstate=fst.kNoStateId,
+ *                               int64_t nstate=fst.kNoStateId,
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_30disambiguate(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64 __pyx_v_nstate, int64 __pyx_v_subsequential_label, PyObject *__pyx_v_weight) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_30disambiguate(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64_t __pyx_v_nstate, int64_t __pyx_v_subsequential_label, PyObject *__pyx_v_weight) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_disambiguate __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("disambiguate", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 4;
   __pyx_t_2.delta = __pyx_v_delta;
   __pyx_t_2.nstate = __pyx_v_nstate;
   __pyx_t_2.subsequential_label = __pyx_v_subsequential_label;
   __pyx_t_2.weight = __pyx_v_weight;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_disambiguate(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3675, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_disambiguate(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3816, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -39443,135 +40015,134 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3718
+/* "fstlib/cext/pywrapfst.pyx":3859
  * 
  * 
- * cpdef MutableFst epsnormalize(Fst ifst, bool eps_norm_output=False):             # <<<<<<<<<<<<<<
+ * cpdef MutableFst epsnormalize(Fst ifst, eps_norm_type="input"):             # <<<<<<<<<<<<<<
  *   """
- *   epsnormalize(ifst, eps_norm_output=False)
+ *   epsnormalize(ifst, eps_norm_type="input")
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_33epsnormalize(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_epsnormalize(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_epsnormalize *__pyx_optional_args) {
-  bool __pyx_v_eps_norm_output = ((bool)0);
+  PyObject *__pyx_v_eps_norm_type = ((PyObject *)__pyx_n_u_input);
   std::unique_ptr<fst::script::VectorFstClass>  __pyx_v__tfst;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  enum fst::EpsNormalizeType __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  std::string __pyx_t_1;
+  enum fst::EpsNormalizeType __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("epsnormalize", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
-      __pyx_v_eps_norm_output = __pyx_optional_args->eps_norm_output;
+      __pyx_v_eps_norm_type = __pyx_optional_args->eps_norm_type;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3739
+  /* "fstlib/cext/pywrapfst.pyx":3881
  *   """
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))             # <<<<<<<<<<<<<<
  *   fst.EpsNormalize(
  *       deref(ifst._fst),
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 3739, __pyx_L1_error)
+    __PYX_ERR(0, 3881, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->arc_type(__pyx_v_ifst, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":3741
+  /* "fstlib/cext/pywrapfst.pyx":3883
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   fst.EpsNormalize(
  *       deref(ifst._fst),             # <<<<<<<<<<<<<<
  *       _tfst.get(),
- *       fst.EPS_NORM_OUTPUT if eps_norm_output else fst.EPS_NORM_INPUT)
+ *     _get_eps_norm_type(tostring(eps_norm_type)))
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3741, __pyx_L1_error)
+    __PYX_ERR(0, 3883, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3743
+  /* "fstlib/cext/pywrapfst.pyx":3885
  *       deref(ifst._fst),
  *       _tfst.get(),
- *       fst.EPS_NORM_OUTPUT if eps_norm_output else fst.EPS_NORM_INPUT)             # <<<<<<<<<<<<<<
+ *     _get_eps_norm_type(tostring(eps_norm_type)))             # <<<<<<<<<<<<<<
  *   return _init_MutableFst(_tfst.release())
  * 
  */
-  if ((__pyx_v_eps_norm_output != 0)) {
-    __pyx_t_1 = fst::EPS_NORM_OUTPUT;
-  } else {
-    __pyx_t_1 = fst::EPS_NORM_INPUT;
-  }
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_eps_norm_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3885, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_eps_norm_type(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3885, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":3740
+  /* "fstlib/cext/pywrapfst.pyx":3882
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   fst.EpsNormalize(             # <<<<<<<<<<<<<<
  *       deref(ifst._fst),
  *       _tfst.get(),
  */
-  fst::script::EpsNormalize((*__pyx_v_ifst->_fst), __pyx_v__tfst.get(), __pyx_t_1);
+  fst::script::EpsNormalize((*__pyx_v_ifst->_fst), __pyx_v__tfst.get(), __pyx_t_2);
 
-  /* "fstlib/cext/pywrapfst.pyx":3744
+  /* "fstlib/cext/pywrapfst.pyx":3886
  *       _tfst.get(),
- *       fst.EPS_NORM_OUTPUT if eps_norm_output else fst.EPS_NORM_INPUT)
+ *     _get_eps_norm_type(tostring(eps_norm_type)))
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3744, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_2);
-  __pyx_t_2 = 0;
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3886, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_3);
+  __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3718
+  /* "fstlib/cext/pywrapfst.pyx":3859
  * 
  * 
- * cpdef MutableFst epsnormalize(Fst ifst, bool eps_norm_output=False):             # <<<<<<<<<<<<<<
+ * cpdef MutableFst epsnormalize(Fst ifst, eps_norm_type="input"):             # <<<<<<<<<<<<<<
  *   """
- *   epsnormalize(ifst, eps_norm_output=False)
+ *   epsnormalize(ifst, eps_norm_type="input")
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.epsnormalize", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_33epsnormalize(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6fstlib_4cext_9pywrapfst_32epsnormalize[] = "\n  epsnormalize(ifst, eps_norm_output=False)\n\n  Constructively epsilon-normalizes an FST.\n\n  This operation creates an equivalent FST that is epsilon-normalized. An\n  acceptor is epsilon-normalized if it it is epsilon-removed (cf. `rmepsilon`).\n  A transducer is input epsilon-normalized if, in addition, along any path, all\n  arcs with epsilon input labels follow all arcs with non-epsilon input labels.\n  Output epsilon-normalized is defined similarly. The input FST must be\n  functional.\n\n  Args:\n    ifst: The input FST.\n    eps_norm_output: Should the FST be output epsilon-normalized?\n\n  Returns:\n    An equivalent epsilon-normalized FST.\n  ";
+static char __pyx_doc_6fstlib_4cext_9pywrapfst_32epsnormalize[] = "\n  epsnormalize(ifst, eps_norm_type=\"input\")\n\n  Constructively epsilon-normalizes an FST.\n\n  This operation creates an equivalent FST that is epsilon-normalized. An\n  acceptor is epsilon-normalized if it it is epsilon-removed (cf. `rmepsilon`).\n  A transducer is input epsilon-normalized if, in addition, along any path, all\n  arcs with epsilon input labels follow all arcs with non-epsilon input labels.\n  Output epsilon-normalized is defined similarly. The input FST must be\n  functional.\n\n  Args:\n    ifst: The input FST.\n    eps_norm_type: A string matching a known epsilon normalization type; one of:\n          \"input\", \"output\".\n\n  Returns:\n    An equivalent epsilon-normalized FST.\n  ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_33epsnormalize(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst = 0;
-  bool __pyx_v_eps_norm_output;
+  PyObject *__pyx_v_eps_norm_type = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("epsnormalize (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ifst,&__pyx_n_s_eps_norm_output,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ifst,&__pyx_n_s_eps_norm_type,0};
     PyObject* values[2] = {0,0};
+    values[1] = ((PyObject *)__pyx_n_u_input);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
@@ -39583,70 +40154,66 @@
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_eps_norm_output);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_eps_norm_type);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "epsnormalize") < 0)) __PYX_ERR(0, 3718, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "epsnormalize") < 0)) __PYX_ERR(0, 3859, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
-    if (values[1]) {
-      __pyx_v_eps_norm_output = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_eps_norm_output == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3718, __pyx_L3_error)
-    } else {
-      __pyx_v_eps_norm_output = ((bool)0);
-    }
+    __pyx_v_eps_norm_type = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("epsnormalize", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3718, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("epsnormalize", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3859, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.epsnormalize", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3718, __pyx_L1_error)
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_32epsnormalize(__pyx_self, __pyx_v_ifst, __pyx_v_eps_norm_output);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3859, __pyx_L1_error)
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_32epsnormalize(__pyx_self, __pyx_v_ifst, __pyx_v_eps_norm_type);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_32epsnormalize(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, bool __pyx_v_eps_norm_output) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_32epsnormalize(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, PyObject *__pyx_v_eps_norm_type) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_epsnormalize __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("epsnormalize", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
-  __pyx_t_2.eps_norm_output = __pyx_v_eps_norm_output;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_epsnormalize(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3718, __pyx_L1_error)
+  __pyx_t_2.eps_norm_type = __pyx_v_eps_norm_type;
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_epsnormalize(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3859, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -39655,56 +40222,56 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3747
+/* "fstlib/cext/pywrapfst.pyx":3889
  * 
  * 
  * cpdef bool equal(Fst ifst1, Fst ifst2, float delta=fst.kDelta):             # <<<<<<<<<<<<<<
  *   """
  *   equal(ifst1, ifst2, delta=0.0009765625)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_35equal(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_equal(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_equal *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__38;
+  float __pyx_v_delta = __pyx_k__36;
   bool __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("equal", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_delta = __pyx_optional_args->delta;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3765
+  /* "fstlib/cext/pywrapfst.pyx":3907
  *     True if the FSTs satisfy the above condition, else False.
  *   """
  *   return fst.Equal(deref(ifst1._fst), deref(ifst2._fst), delta)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3765, __pyx_L1_error)
+    __PYX_ERR(0, 3907, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3765, __pyx_L1_error)
+    __PYX_ERR(0, 3907, __pyx_L1_error)
   }
   __pyx_r = fst::script::Equal((*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst), __pyx_v_delta);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3747
+  /* "fstlib/cext/pywrapfst.pyx":3889
  * 
  * 
  * cpdef bool equal(Fst ifst1, Fst ifst2, float delta=fst.kDelta):             # <<<<<<<<<<<<<<
  *   """
  *   equal(ifst1, ifst2, delta=0.0009765625)
  */
 
@@ -39751,54 +40318,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("equal", 0, 2, 3, 1); __PYX_ERR(0, 3747, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("equal", 0, 2, 3, 1); __PYX_ERR(0, 3889, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_delta);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "equal") < 0)) __PYX_ERR(0, 3747, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "equal") < 0)) __PYX_ERR(0, 3889, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
     if (values[2]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3747, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3889, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__38;
+      __pyx_v_delta = __pyx_k__36;
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("equal", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3747, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("equal", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3889, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.equal", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3747, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3747, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3889, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3889, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_34equal(__pyx_self, __pyx_v_ifst1, __pyx_v_ifst2, __pyx_v_delta);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -39816,15 +40383,15 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("equal", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.delta = __pyx_v_delta;
   __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_equal(__pyx_v_ifst1, __pyx_v_ifst2, 0, &__pyx_t_2); 
-  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3747, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3889, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -39833,56 +40400,56 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3768
+/* "fstlib/cext/pywrapfst.pyx":3910
  * 
  * 
  * cpdef bool equivalent(Fst ifst1, Fst ifst2, float delta=fst.kDelta):             # <<<<<<<<<<<<<<
  *   """
  *   equivalent(ifst1, ifst2, delta=0.0009765625)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_37equivalent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_equivalent(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_equivalent *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__39;
+  float __pyx_v_delta = __pyx_k__37;
   bool __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("equivalent", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_delta = __pyx_optional_args->delta;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3786
+  /* "fstlib/cext/pywrapfst.pyx":3928
  *     True if the FSTs satisfy the above condition, else False.
  *   """
  *   return fst.Equivalent(deref(ifst1._fst), deref(ifst2._fst), delta)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3786, __pyx_L1_error)
+    __PYX_ERR(0, 3928, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3786, __pyx_L1_error)
+    __PYX_ERR(0, 3928, __pyx_L1_error)
   }
   __pyx_r = fst::script::Equivalent((*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst), __pyx_v_delta);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3768
+  /* "fstlib/cext/pywrapfst.pyx":3910
  * 
  * 
  * cpdef bool equivalent(Fst ifst1, Fst ifst2, float delta=fst.kDelta):             # <<<<<<<<<<<<<<
  *   """
  *   equivalent(ifst1, ifst2, delta=0.0009765625)
  */
 
@@ -39929,54 +40496,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("equivalent", 0, 2, 3, 1); __PYX_ERR(0, 3768, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("equivalent", 0, 2, 3, 1); __PYX_ERR(0, 3910, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_delta);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "equivalent") < 0)) __PYX_ERR(0, 3768, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "equivalent") < 0)) __PYX_ERR(0, 3910, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
     if (values[2]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3768, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3910, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__39;
+      __pyx_v_delta = __pyx_k__37;
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("equivalent", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3768, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("equivalent", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3910, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.equivalent", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3768, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3768, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3910, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3910, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_36equivalent(__pyx_self, __pyx_v_ifst1, __pyx_v_ifst2, __pyx_v_delta);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -39994,15 +40561,15 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("equivalent", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.delta = __pyx_v_delta;
   __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_equivalent(__pyx_v_ifst1, __pyx_v_ifst2, 0, &__pyx_t_2); 
-  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3768, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3910, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -40011,27 +40578,27 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3789
+/* "fstlib/cext/pywrapfst.pyx":3931
  * 
  * 
  * cpdef MutableFst intersect(Fst ifst1,             # <<<<<<<<<<<<<<
  *                            Fst ifst2,
  *                            compose_filter="auto",
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_39intersect(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_intersect(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_intersect *__pyx_optional_args) {
   PyObject *__pyx_v_compose_filter = ((PyObject *)__pyx_n_u_auto);
 
-  /* "fstlib/cext/pywrapfst.pyx":3792
+  /* "fstlib/cext/pywrapfst.pyx":3934
  *                            Fst ifst2,
  *                            compose_filter="auto",
  *                            bool connect=True):             # <<<<<<<<<<<<<<
  *   """
  *   intersect(ifst1, ifst2, compose_filter="auto", connect=True)
  */
   bool __pyx_v_connect = ((bool)1);
@@ -40051,78 +40618,78 @@
       __pyx_v_compose_filter = __pyx_optional_args->compose_filter;
       if (__pyx_optional_args->__pyx_n > 1) {
         __pyx_v_connect = __pyx_optional_args->connect;
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3815
+  /* "fstlib/cext/pywrapfst.pyx":3957
  *   """
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst1.arc_type()))             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.ComposeOptions] _opts
  *   _opts.reset(
  */
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 3815, __pyx_L1_error)
+    __PYX_ERR(0, 3957, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst1->__pyx_vtab)->arc_type(__pyx_v_ifst1, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":3819
+  /* "fstlib/cext/pywrapfst.pyx":3961
  *   _opts.reset(
  *       new fst.ComposeOptions(connect,
  *                             _get_compose_filter(tostring(compose_filter))))             # <<<<<<<<<<<<<<
  *   fst.Intersect(deref(ifst1._fst), deref(ifst2._fst), _tfst.get(), deref(_opts))
  *   return _init_MutableFst(_tfst.release())
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_compose_filter); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3819, __pyx_L1_error)
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_compose_filter(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3819, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_compose_filter); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3961, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_compose_filter(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3961, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":3817
+  /* "fstlib/cext/pywrapfst.pyx":3959
  *   _tfst.reset(new fst.VectorFstClass(ifst1.arc_type()))
  *   cdef unique_ptr[fst.ComposeOptions] _opts
  *   _opts.reset(             # <<<<<<<<<<<<<<
  *       new fst.ComposeOptions(connect,
  *                             _get_compose_filter(tostring(compose_filter))))
  */
   __pyx_v__opts.reset(new fst::ComposeOptions(__pyx_v_connect, __pyx_t_2));
 
-  /* "fstlib/cext/pywrapfst.pyx":3820
+  /* "fstlib/cext/pywrapfst.pyx":3962
  *       new fst.ComposeOptions(connect,
  *                             _get_compose_filter(tostring(compose_filter))))
  *   fst.Intersect(deref(ifst1._fst), deref(ifst2._fst), _tfst.get(), deref(_opts))             # <<<<<<<<<<<<<<
  *   return _init_MutableFst(_tfst.release())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3820, __pyx_L1_error)
+    __PYX_ERR(0, 3962, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3820, __pyx_L1_error)
+    __PYX_ERR(0, 3962, __pyx_L1_error)
   }
   fst::script::Intersect((*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst), __pyx_v__tfst.get(), (*__pyx_v__opts));
 
-  /* "fstlib/cext/pywrapfst.pyx":3821
+  /* "fstlib/cext/pywrapfst.pyx":3963
  *                             _get_compose_filter(tostring(compose_filter))))
  *   fst.Intersect(deref(ifst1._fst), deref(ifst2._fst), _tfst.get(), deref(_opts))
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3821, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3963, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3789
+  /* "fstlib/cext/pywrapfst.pyx":3931
  * 
  * 
  * cpdef MutableFst intersect(Fst ifst1,             # <<<<<<<<<<<<<<
  *                            Fst ifst2,
  *                            compose_filter="auto",
  */
 
@@ -40175,15 +40742,15 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("intersect", 0, 2, 4, 1); __PYX_ERR(0, 3789, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("intersect", 0, 2, 4, 1); __PYX_ERR(0, 3931, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_compose_filter);
           if (value) { values[2] = value; kw_args--; }
         }
@@ -40191,15 +40758,15 @@
         case  3:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_connect);
           if (value) { values[3] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "intersect") < 0)) __PYX_ERR(0, 3789, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "intersect") < 0)) __PYX_ERR(0, 3931, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
@@ -40209,40 +40776,40 @@
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
     __pyx_v_compose_filter = values[2];
     if (values[3]) {
-      __pyx_v_connect = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_connect == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3792, __pyx_L3_error)
+      __pyx_v_connect = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_connect == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3934, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":3792
+      /* "fstlib/cext/pywrapfst.pyx":3934
  *                            Fst ifst2,
  *                            compose_filter="auto",
  *                            bool connect=True):             # <<<<<<<<<<<<<<
  *   """
  *   intersect(ifst1, ifst2, compose_filter="auto", connect=True)
  */
       __pyx_v_connect = ((bool)1);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("intersect", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3789, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("intersect", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3931, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.intersect", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3789, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3790, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3931, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3932, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_38intersect(__pyx_self, __pyx_v_ifst1, __pyx_v_ifst2, __pyx_v_compose_filter, __pyx_v_connect);
 
-  /* "fstlib/cext/pywrapfst.pyx":3789
+  /* "fstlib/cext/pywrapfst.pyx":3931
  * 
  * 
  * cpdef MutableFst intersect(Fst ifst1,             # <<<<<<<<<<<<<<
  *                            Fst ifst2,
  *                            compose_filter="auto",
  */
 
@@ -40264,15 +40831,15 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("intersect", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 2;
   __pyx_t_2.compose_filter = __pyx_v_compose_filter;
   __pyx_t_2.connect = __pyx_v_connect;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_intersect(__pyx_v_ifst1, __pyx_v_ifst2, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3789, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_intersect(__pyx_v_ifst1, __pyx_v_ifst2, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3931, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -40281,56 +40848,56 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3824
+/* "fstlib/cext/pywrapfst.pyx":3966
  * 
  * 
  * cpdef bool isomorphic(Fst ifst1, Fst ifst2, float delta=fst.kDelta):             # <<<<<<<<<<<<<<
  *   """
  *   isomorphic(ifst1, ifst2, delta=0.0009765625)
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_41isomorphic(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_isomorphic(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_isomorphic *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__40;
+  float __pyx_v_delta = __pyx_k__38;
   bool __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("isomorphic", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_delta = __pyx_optional_args->delta;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3845
+  /* "fstlib/cext/pywrapfst.pyx":3987
  *     True if the two transducers satisfy the above condition, else False.
  *   """
  *   return fst.Isomorphic(deref(ifst1._fst), deref(ifst2._fst), delta)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3845, __pyx_L1_error)
+    __PYX_ERR(0, 3987, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3845, __pyx_L1_error)
+    __PYX_ERR(0, 3987, __pyx_L1_error)
   }
   __pyx_r = fst::script::Isomorphic((*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst), __pyx_v_delta);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3824
+  /* "fstlib/cext/pywrapfst.pyx":3966
  * 
  * 
  * cpdef bool isomorphic(Fst ifst1, Fst ifst2, float delta=fst.kDelta):             # <<<<<<<<<<<<<<
  *   """
  *   isomorphic(ifst1, ifst2, delta=0.0009765625)
  */
 
@@ -40377,54 +40944,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("isomorphic", 0, 2, 3, 1); __PYX_ERR(0, 3824, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("isomorphic", 0, 2, 3, 1); __PYX_ERR(0, 3966, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_delta);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "isomorphic") < 0)) __PYX_ERR(0, 3824, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "isomorphic") < 0)) __PYX_ERR(0, 3966, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
     if (values[2]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3824, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3966, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__40;
+      __pyx_v_delta = __pyx_k__38;
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("isomorphic", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3824, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("isomorphic", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3966, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.isomorphic", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3824, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3824, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3966, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3966, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_40isomorphic(__pyx_self, __pyx_v_ifst1, __pyx_v_ifst2, __pyx_v_delta);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -40442,15 +41009,15 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("isomorphic", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.delta = __pyx_v_delta;
   __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_isomorphic(__pyx_v_ifst1, __pyx_v_ifst2, 0, &__pyx_t_2); 
-  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3824, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3966, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -40459,30 +41026,30 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3848
+/* "fstlib/cext/pywrapfst.pyx":3990
  * 
  * 
  * cpdef MutableFst prune(Fst ifst,             # <<<<<<<<<<<<<<
  *                        float delta=fst.kDelta,
- *                        int64 nstate=fst.kNoStateId,
+ *                        int64_t nstate=fst.kNoStateId,
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_43prune(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_prune(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_prune *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__41;
-  int64 __pyx_v_nstate = __pyx_k__42;
+  float __pyx_v_delta = __pyx_k__39;
+  int64_t __pyx_v_nstate = __pyx_k__40;
 
-  /* "fstlib/cext/pywrapfst.pyx":3851
+  /* "fstlib/cext/pywrapfst.pyx":3993
  *                        float delta=fst.kDelta,
- *                        int64 nstate=fst.kNoStateId,
+ *                        int64_t nstate=fst.kNoStateId,
  *                        weight=None):             # <<<<<<<<<<<<<<
  *   """
  *   prune(ifst, delta=0.0009765625, nstate=NO_STATE_ID, weight=None)
  */
   PyObject *__pyx_v_weight = ((PyObject *)Py_None);
   std::unique_ptr<fst::script::VectorFstClass>  __pyx_v__tfst;
   fst::script::WeightClass __pyx_v__weight;
@@ -40502,82 +41069,82 @@
         if (__pyx_optional_args->__pyx_n > 2) {
           __pyx_v_weight = __pyx_optional_args->weight;
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3873
+  /* "fstlib/cext/pywrapfst.pyx":4015
  *   """
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))             # <<<<<<<<<<<<<<
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),
  *                                                           weight)
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 3873, __pyx_L1_error)
+    __PYX_ERR(0, 4015, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->arc_type(__pyx_v_ifst, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":3874
+  /* "fstlib/cext/pywrapfst.pyx":4016
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),             # <<<<<<<<<<<<<<
  *                                                           weight)
  *   fst.Prune(deref(ifst._fst), _tfst.get(), _weight, nstate, delta)
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "weight_type");
-    __PYX_ERR(0, 3874, __pyx_L1_error)
+    __PYX_ERR(0, 4016, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3875
+  /* "fstlib/cext/pywrapfst.pyx":4017
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),
  *                                                           weight)             # <<<<<<<<<<<<<<
  *   fst.Prune(deref(ifst._fst), _tfst.get(), _weight, nstate, delta)
  *   return _init_MutableFst(_tfst.release())
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3874, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4016, __pyx_L1_error)
   __pyx_v__weight = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":3876
+  /* "fstlib/cext/pywrapfst.pyx":4018
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),
  *                                                           weight)
  *   fst.Prune(deref(ifst._fst), _tfst.get(), _weight, nstate, delta)             # <<<<<<<<<<<<<<
  *   return _init_MutableFst(_tfst.release())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3876, __pyx_L1_error)
+    __PYX_ERR(0, 4018, __pyx_L1_error)
   }
   fst::script::Prune((*__pyx_v_ifst->_fst), __pyx_v__tfst.get(), __pyx_v__weight, __pyx_v_nstate, __pyx_v_delta);
 
-  /* "fstlib/cext/pywrapfst.pyx":3877
+  /* "fstlib/cext/pywrapfst.pyx":4019
  *                                                           weight)
  *   fst.Prune(deref(ifst._fst), _tfst.get(), _weight, nstate, delta)
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3877, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4019, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_2);
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3848
+  /* "fstlib/cext/pywrapfst.pyx":3990
  * 
  * 
  * cpdef MutableFst prune(Fst ifst,             # <<<<<<<<<<<<<<
  *                        float delta=fst.kDelta,
- *                        int64 nstate=fst.kNoStateId,
+ *                        int64_t nstate=fst.kNoStateId,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.prune", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
@@ -40589,29 +41156,29 @@
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_43prune(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_42prune[] = "\n  prune(ifst, delta=0.0009765625, nstate=NO_STATE_ID, weight=None)\n\n  Constructively removes paths with weights below a certain threshold.\n\n  This operation deletes states and arcs in the input FST that do not belong\n  to a successful path whose weight is no more (w.r.t the natural semiring\n  order) than the threshold t \\otimes-times the weight of the shortest path in\n  the input FST. Weights must be commutative and have the path property.\n\n  Args:\n    ifst: The input FST.\n    delta: Comparison/quantization delta.\n    nstate: State number threshold.\n    weight: A Weight or weight string indicating the desired weight threshold\n        below which paths are pruned; if omitted, no paths are pruned.\n\n  Returns:\n    A pruned FST.\n  ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_43prune(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst = 0;
   float __pyx_v_delta;
-  int64 __pyx_v_nstate;
+  int64_t __pyx_v_nstate;
   PyObject *__pyx_v_weight = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("prune (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ifst,&__pyx_n_s_delta,&__pyx_n_s_nstate,&__pyx_n_s_weight,0};
     PyObject* values[4] = {0,0,0,0};
 
-    /* "fstlib/cext/pywrapfst.pyx":3851
+    /* "fstlib/cext/pywrapfst.pyx":3993
  *                        float delta=fst.kDelta,
- *                        int64 nstate=fst.kNoStateId,
+ *                        int64_t nstate=fst.kNoStateId,
  *                        weight=None):             # <<<<<<<<<<<<<<
  *   """
  *   prune(ifst, delta=0.0009765625, nstate=NO_STATE_ID, weight=None)
  */
     values[3] = ((PyObject *)Py_None);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
@@ -40649,15 +41216,15 @@
         case  3:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weight);
           if (value) { values[3] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "prune") < 0)) __PYX_ERR(0, 3848, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "prune") < 0)) __PYX_ERR(0, 3990, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
@@ -40666,68 +41233,68 @@
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     if (values[1]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3849, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3991, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__41;
+      __pyx_v_delta = __pyx_k__39;
     }
     if (values[2]) {
-      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[2]); if (unlikely((__pyx_v_nstate == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3850, __pyx_L3_error)
+      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[2]); if (unlikely((__pyx_v_nstate == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3992, __pyx_L3_error)
     } else {
-      __pyx_v_nstate = __pyx_k__42;
+      __pyx_v_nstate = __pyx_k__40;
     }
     __pyx_v_weight = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("prune", 0, 1, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3848, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("prune", 0, 1, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3990, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.prune", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3848, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3990, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_42prune(__pyx_self, __pyx_v_ifst, __pyx_v_delta, __pyx_v_nstate, __pyx_v_weight);
 
-  /* "fstlib/cext/pywrapfst.pyx":3848
+  /* "fstlib/cext/pywrapfst.pyx":3990
  * 
  * 
  * cpdef MutableFst prune(Fst ifst,             # <<<<<<<<<<<<<<
  *                        float delta=fst.kDelta,
- *                        int64 nstate=fst.kNoStateId,
+ *                        int64_t nstate=fst.kNoStateId,
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_42prune(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64 __pyx_v_nstate, PyObject *__pyx_v_weight) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_42prune(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64_t __pyx_v_nstate, PyObject *__pyx_v_weight) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_prune __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("prune", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 3;
   __pyx_t_2.delta = __pyx_v_delta;
   __pyx_t_2.nstate = __pyx_v_nstate;
   __pyx_t_2.weight = __pyx_v_weight;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_prune(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3848, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_prune(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3990, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -40736,75 +41303,69 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3880
+/* "fstlib/cext/pywrapfst.pyx":4022
  * 
  * 
  * cpdef MutableFst push(Fst ifst,             # <<<<<<<<<<<<<<
  *                       float delta=fst.kDelta,
  *                       bool push_weights=False,
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_45push(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_push(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_push *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__43;
+  float __pyx_v_delta = __pyx_k__41;
 
-  /* "fstlib/cext/pywrapfst.pyx":3882
+  /* "fstlib/cext/pywrapfst.pyx":4024
  * cpdef MutableFst push(Fst ifst,
  *                       float delta=fst.kDelta,
  *                       bool push_weights=False,             # <<<<<<<<<<<<<<
  *                       bool push_labels=False,
  *                       bool remove_common_affix=False,
  */
   bool __pyx_v_push_weights = ((bool)0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3883
+  /* "fstlib/cext/pywrapfst.pyx":4025
  *                       float delta=fst.kDelta,
  *                       bool push_weights=False,
  *                       bool push_labels=False,             # <<<<<<<<<<<<<<
  *                       bool remove_common_affix=False,
  *                       bool remove_total_weight=False,
  */
   bool __pyx_v_push_labels = ((bool)0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3884
+  /* "fstlib/cext/pywrapfst.pyx":4026
  *                       bool push_weights=False,
  *                       bool push_labels=False,
  *                       bool remove_common_affix=False,             # <<<<<<<<<<<<<<
  *                       bool remove_total_weight=False,
- *                       bool to_final=False):
+ *                       reweight_type="to_initial"):
  */
   bool __pyx_v_remove_common_affix = ((bool)0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3885
+  /* "fstlib/cext/pywrapfst.pyx":4027
  *                       bool push_labels=False,
  *                       bool remove_common_affix=False,
  *                       bool remove_total_weight=False,             # <<<<<<<<<<<<<<
- *                       bool to_final=False):
+ *                       reweight_type="to_initial"):
  *   """
  */
   bool __pyx_v_remove_total_weight = ((bool)0);
-
-  /* "fstlib/cext/pywrapfst.pyx":3886
- *                       bool remove_common_affix=False,
- *                       bool remove_total_weight=False,
- *                       bool to_final=False):             # <<<<<<<<<<<<<<
- *   """
- *   push(ifst, delta=0.0009765625, push_weights=False, push_labels=False,
- */
-  bool __pyx_v_to_final = ((bool)0);
+  PyObject *__pyx_v_reweight_type = ((PyObject *)__pyx_n_u_to_initial);
   std::unique_ptr<fst::script::VectorFstClass>  __pyx_v__tfst;
-  uint8 __pyx_v_flags;
+  uint8_t __pyx_v_flags;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  std::string __pyx_t_1;
+  enum fst::ReweightType __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("push", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_delta = __pyx_optional_args->delta;
@@ -40813,119 +41374,130 @@
         if (__pyx_optional_args->__pyx_n > 2) {
           __pyx_v_push_labels = __pyx_optional_args->push_labels;
           if (__pyx_optional_args->__pyx_n > 3) {
             __pyx_v_remove_common_affix = __pyx_optional_args->remove_common_affix;
             if (__pyx_optional_args->__pyx_n > 4) {
               __pyx_v_remove_total_weight = __pyx_optional_args->remove_total_weight;
               if (__pyx_optional_args->__pyx_n > 5) {
-                __pyx_v_to_final = __pyx_optional_args->to_final;
+                __pyx_v_reweight_type = __pyx_optional_args->reweight_type;
               }
             }
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3923
+  /* "fstlib/cext/pywrapfst.pyx":4066
  *   """
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))             # <<<<<<<<<<<<<<
- *   cdef uint8 flags = fst.GetPushFlags(push_weights,
+ *   cdef uint8_t flags = fst.GetPushFlags(push_weights,
  *                                       push_labels,
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 3923, __pyx_L1_error)
+    __PYX_ERR(0, 4066, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->arc_type(__pyx_v_ifst, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":3924
+  /* "fstlib/cext/pywrapfst.pyx":4067
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
- *   cdef uint8 flags = fst.GetPushFlags(push_weights,             # <<<<<<<<<<<<<<
+ *   cdef uint8_t flags = fst.GetPushFlags(push_weights,             # <<<<<<<<<<<<<<
  *                                       push_labels,
  *                                       remove_common_affix,
  */
   __pyx_v_flags = fst::script::GetPushFlags(__pyx_v_push_weights, __pyx_v_push_labels, __pyx_v_remove_common_affix, __pyx_v_remove_total_weight);
 
-  /* "fstlib/cext/pywrapfst.pyx":3928
+  /* "fstlib/cext/pywrapfst.pyx":4071
  *                                       remove_common_affix,
  *                                       remove_total_weight)
  *   fst.Push(deref(ifst._fst),             # <<<<<<<<<<<<<<
  *            _tfst.get(),
  *            flags,
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3928, __pyx_L1_error)
+    __PYX_ERR(0, 4071, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3932
+  /* "fstlib/cext/pywrapfst.pyx":4074
+ *            _tfst.get(),
  *            flags,
- *            fst.GetReweightType(to_final),
- *            delta)             # <<<<<<<<<<<<<<
+ *            _get_reweight_type(tostring(reweight_type)),             # <<<<<<<<<<<<<<
+ *            delta)
  *   return _init_MutableFst(_tfst.release())
- * 
  */
-  fst::script::Push((*__pyx_v_ifst->_fst), __pyx_v__tfst.get(), __pyx_v_flags, fst::script::GetReweightType(__pyx_v_to_final), __pyx_v_delta);
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_reweight_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4074, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_reweight_type(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4074, __pyx_L1_error)
+
+  /* "fstlib/cext/pywrapfst.pyx":4071
+ *                                       remove_common_affix,
+ *                                       remove_total_weight)
+ *   fst.Push(deref(ifst._fst),             # <<<<<<<<<<<<<<
+ *            _tfst.get(),
+ *            flags,
+ */
+  fst::script::Push((*__pyx_v_ifst->_fst), __pyx_v__tfst.get(), __pyx_v_flags, __pyx_t_2, __pyx_v_delta);
 
-  /* "fstlib/cext/pywrapfst.pyx":3933
- *            fst.GetReweightType(to_final),
+  /* "fstlib/cext/pywrapfst.pyx":4076
+ *            _get_reweight_type(tostring(reweight_type)),
  *            delta)
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3933, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_1);
-  __pyx_t_1 = 0;
+  __pyx_t_3 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4076, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_3);
+  __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3880
+  /* "fstlib/cext/pywrapfst.pyx":4022
  * 
  * 
  * cpdef MutableFst push(Fst ifst,             # <<<<<<<<<<<<<<
  *                       float delta=fst.kDelta,
  *                       bool push_weights=False,
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_3);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.push", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_45push(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6fstlib_4cext_9pywrapfst_44push[] = "\n  push(ifst, delta=0.0009765625, push_weights=False, push_labels=False,\n       remove_common_affix=False, remove_total_weight=False, to_final=False)\n\n  Constructively pushes weights/labels towards initial or final states.\n\n  This operation produces an equivalent transducer by pushing the weights\n  and/or the labels towards the initial state or toward the final states.\n\n  When pushing weights towards the initial state, the sum of the weight of the\n  outgoing transitions and final weight at any non-initial state is equal to 1\n  in the resulting machine. When pushing weights towards the final states, the\n  sum of the weight of the incoming transitions at any state is equal to 1.\n  Weights need to be left distributive when pushing towards the initial state\n  and right distributive when pushing towards the final states.\n\n  Pushing labels towards the initial state consists in minimizing at every\n  state the length of the longest common prefix of the output labels of the\n  outgoing paths. Pushing labels towards the final states consists in\n  minimizing at every state the length of the longest common suffix of the\n  output labels of the incoming paths.\n\n  Args:\n    ifst: The input FST.\n    delta: Comparison/quantization delta.\n    push_weights: Should weights be pushed?\n    push_labels: Should labels be pushed?\n    remove_common_affix: If pushing labels, should common prefix/suffix be\n        removed?\n    remove_total_weight: If pushing weights, should total weight be removed?\n    to_final: Push towards final states?\n\n  Returns:\n    An equivalent pushed FST.\n  ";
+static char __pyx_doc_6fstlib_4cext_9pywrapfst_44push[] = "\n  push(ifst, delta=0.0009765625, push_weights=False, push_labels=False,\n       remove_common_affix=False, remove_total_weight=False, reweight_type=\"to_initial\")\n\n  Constructively pushes weights/labels towards initial or final states.\n\n  This operation produces an equivalent transducer by pushing the weights\n  and/or the labels towards the initial state or toward the final states.\n\n  When pushing weights towards the initial state, the sum of the weight of the\n  outgoing transitions and final weight at any non-initial state is equal to 1\n  in the resulting machine. When pushing weights towards the final states, the\n  sum of the weight of the incoming transitions at any state is equal to 1.\n  Weights need to be left distributive when pushing towards the initial state\n  and right distributive when pushing towards the final states.\n\n  Pushing labels towards the initial state consists in minimizing at every\n  state the length of the longest common prefix of the output labels of the\n  outgoing paths. Pushing labels towards the final states consists in\n  minimizing at every state the length of the longest common suffix of the\n  output labels of the incoming paths.\n\n  Args:\n    ifst: The input FST.\n    delta: Comparison/quantization delta.\n    push_weights: Should weights be pushed?\n    push_labels: Should labels be pushed?\n    remove_common_affix: If pushing labels, should common prefix/suffix be\n        removed?\n    remove_total_weight: If pushing weights, should total weight be removed?\n    reweight_type: Push towards initial or final states?: a string matching a\n        known reweight type: one of \"to_initial\", \"to_final\"\n\n  Returns:\n    An equivalent pushed FST.\n  ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_45push(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst = 0;
   float __pyx_v_delta;
   bool __pyx_v_push_weights;
   bool __pyx_v_push_labels;
   bool __pyx_v_remove_common_affix;
   bool __pyx_v_remove_total_weight;
-  bool __pyx_v_to_final;
+  PyObject *__pyx_v_reweight_type = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("push (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ifst,&__pyx_n_s_delta,&__pyx_n_s_push_weights,&__pyx_n_s_push_labels,&__pyx_n_s_remove_common_affix,&__pyx_n_s_remove_total_weight,&__pyx_n_s_to_final,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ifst,&__pyx_n_s_delta,&__pyx_n_s_push_weights,&__pyx_n_s_push_labels,&__pyx_n_s_remove_common_affix,&__pyx_n_s_remove_total_weight,&__pyx_n_s_reweight_type,0};
     PyObject* values[7] = {0,0,0,0,0,0,0};
+    values[6] = ((PyObject *)__pyx_n_u_to_initial);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
@@ -40977,20 +41549,20 @@
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_remove_total_weight);
           if (value) { values[5] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_to_final);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_reweight_type);
           if (value) { values[6] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "push") < 0)) __PYX_ERR(0, 3880, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "push") < 0)) __PYX_ERR(0, 4022, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
@@ -41005,96 +41577,84 @@
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     if (values[1]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3881, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 4023, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__43;
+      __pyx_v_delta = __pyx_k__41;
     }
     if (values[2]) {
-      __pyx_v_push_weights = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_push_weights == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3882, __pyx_L3_error)
+      __pyx_v_push_weights = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_push_weights == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4024, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":3882
+      /* "fstlib/cext/pywrapfst.pyx":4024
  * cpdef MutableFst push(Fst ifst,
  *                       float delta=fst.kDelta,
  *                       bool push_weights=False,             # <<<<<<<<<<<<<<
  *                       bool push_labels=False,
  *                       bool remove_common_affix=False,
  */
       __pyx_v_push_weights = ((bool)0);
     }
     if (values[3]) {
-      __pyx_v_push_labels = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_push_labels == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3883, __pyx_L3_error)
+      __pyx_v_push_labels = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_push_labels == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4025, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":3883
+      /* "fstlib/cext/pywrapfst.pyx":4025
  *                       float delta=fst.kDelta,
  *                       bool push_weights=False,
  *                       bool push_labels=False,             # <<<<<<<<<<<<<<
  *                       bool remove_common_affix=False,
  *                       bool remove_total_weight=False,
  */
       __pyx_v_push_labels = ((bool)0);
     }
     if (values[4]) {
-      __pyx_v_remove_common_affix = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_remove_common_affix == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3884, __pyx_L3_error)
+      __pyx_v_remove_common_affix = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_remove_common_affix == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4026, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":3884
+      /* "fstlib/cext/pywrapfst.pyx":4026
  *                       bool push_weights=False,
  *                       bool push_labels=False,
  *                       bool remove_common_affix=False,             # <<<<<<<<<<<<<<
  *                       bool remove_total_weight=False,
- *                       bool to_final=False):
+ *                       reweight_type="to_initial"):
  */
       __pyx_v_remove_common_affix = ((bool)0);
     }
     if (values[5]) {
-      __pyx_v_remove_total_weight = __Pyx_PyObject_IsTrue(values[5]); if (unlikely((__pyx_v_remove_total_weight == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3885, __pyx_L3_error)
+      __pyx_v_remove_total_weight = __Pyx_PyObject_IsTrue(values[5]); if (unlikely((__pyx_v_remove_total_weight == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4027, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":3885
+      /* "fstlib/cext/pywrapfst.pyx":4027
  *                       bool push_labels=False,
  *                       bool remove_common_affix=False,
  *                       bool remove_total_weight=False,             # <<<<<<<<<<<<<<
- *                       bool to_final=False):
+ *                       reweight_type="to_initial"):
  *   """
  */
       __pyx_v_remove_total_weight = ((bool)0);
     }
-    if (values[6]) {
-      __pyx_v_to_final = __Pyx_PyObject_IsTrue(values[6]); if (unlikely((__pyx_v_to_final == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3886, __pyx_L3_error)
-    } else {
-
-      /* "fstlib/cext/pywrapfst.pyx":3886
- *                       bool remove_common_affix=False,
- *                       bool remove_total_weight=False,
- *                       bool to_final=False):             # <<<<<<<<<<<<<<
- *   """
- *   push(ifst, delta=0.0009765625, push_weights=False, push_labels=False,
- */
-      __pyx_v_to_final = ((bool)0);
-    }
+    __pyx_v_reweight_type = values[6];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("push", 0, 1, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3880, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("push", 0, 1, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4022, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.push", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3880, __pyx_L1_error)
-  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_44push(__pyx_self, __pyx_v_ifst, __pyx_v_delta, __pyx_v_push_weights, __pyx_v_push_labels, __pyx_v_remove_common_affix, __pyx_v_remove_total_weight, __pyx_v_to_final);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4022, __pyx_L1_error)
+  __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_44push(__pyx_self, __pyx_v_ifst, __pyx_v_delta, __pyx_v_push_weights, __pyx_v_push_labels, __pyx_v_remove_common_affix, __pyx_v_remove_total_weight, __pyx_v_reweight_type);
 
-  /* "fstlib/cext/pywrapfst.pyx":3880
+  /* "fstlib/cext/pywrapfst.pyx":4022
  * 
  * 
  * cpdef MutableFst push(Fst ifst,             # <<<<<<<<<<<<<<
  *                       float delta=fst.kDelta,
  *                       bool push_weights=False,
  */
 
@@ -41103,15 +41663,15 @@
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_44push(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, bool __pyx_v_push_weights, bool __pyx_v_push_labels, bool __pyx_v_remove_common_affix, bool __pyx_v_remove_total_weight, bool __pyx_v_to_final) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_44push(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, bool __pyx_v_push_weights, bool __pyx_v_push_labels, bool __pyx_v_remove_common_affix, bool __pyx_v_remove_total_weight, PyObject *__pyx_v_reweight_type) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_push __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
@@ -41119,16 +41679,16 @@
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 6;
   __pyx_t_2.delta = __pyx_v_delta;
   __pyx_t_2.push_weights = __pyx_v_push_weights;
   __pyx_t_2.push_labels = __pyx_v_push_labels;
   __pyx_t_2.remove_common_affix = __pyx_v_remove_common_affix;
   __pyx_t_2.remove_total_weight = __pyx_v_remove_total_weight;
-  __pyx_t_2.to_final = __pyx_v_to_final;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_push(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3880, __pyx_L1_error)
+  __pyx_t_2.reweight_type = __pyx_v_reweight_type;
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_push(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4022, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -41137,29 +41697,29 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3936
+/* "fstlib/cext/pywrapfst.pyx":4079
  * 
  * 
  * cpdef bool randequivalent(Fst ifst1,             # <<<<<<<<<<<<<<
  *                           Fst ifst2,
- *                           int32 npath=1,
+ *                           int32_t npath=1,
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_47randequivalent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static bool __pyx_f_6fstlib_4cext_9pywrapfst_randequivalent(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_randequivalent *__pyx_optional_args) {
-  int32 __pyx_v_npath = ((int32)1);
-  float __pyx_v_delta = __pyx_k__44;
+  int32_t __pyx_v_npath = ((int32_t)1);
+  float __pyx_v_delta = __pyx_k__42;
   PyObject *__pyx_v_select = ((PyObject *)__pyx_n_u_uniform);
-  int32 __pyx_v_max_length = __pyx_k__45;
-  uint64 __pyx_v_seed = ((uint64)0);
+  int32_t __pyx_v_max_length = __pyx_k__43;
+  uint64_t __pyx_v_seed = ((uint64_t)0);
   fst::script::RandArcSelection __pyx_v__select;
   std::unique_ptr<fst::RandGenOptions<fst::script::RandArcSelection> >  __pyx_v__opts;
   bool __pyx_r;
   __Pyx_RefNannyDeclarations
   std::string __pyx_t_1;
   fst::script::RandArcSelection __pyx_t_2;
   int __pyx_t_3;
@@ -41181,102 +41741,102 @@
             }
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3969
+  /* "fstlib/cext/pywrapfst.pyx":4112
  *     True if the two transducers satisfy the above condition, else False.
  *   """
  *   cdef fst.RandArcSelection _select = _get_rand_arc_selection(tostring(select))             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.RandGenOptions[fst.RandArcSelection]] _opts
  *   # The three trailing options will be ignored by RandEquivalent.
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_select); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3969, __pyx_L1_error)
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_rand_arc_selection(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3969, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_select); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4112, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_rand_arc_selection(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4112, __pyx_L1_error)
   __pyx_v__select = __pyx_t_2;
 
-  /* "fstlib/cext/pywrapfst.pyx":3972
+  /* "fstlib/cext/pywrapfst.pyx":4115
  *   cdef unique_ptr[fst.RandGenOptions[fst.RandArcSelection]] _opts
  *   # The three trailing options will be ignored by RandEquivalent.
  *   _opts.reset(             # <<<<<<<<<<<<<<
  *        new fst.RandGenOptions[fst.RandArcSelection](_select,
  *                                                     max_length,
  */
   __pyx_v__opts.reset(new fst::RandGenOptions<fst::script::RandArcSelection> (__pyx_v__select, __pyx_v_max_length, 1, 0, 0));
 
-  /* "fstlib/cext/pywrapfst.pyx":3978
+  /* "fstlib/cext/pywrapfst.pyx":4121
  *                                                     False,
  *                                                     False))
  *   if seed == 0:             # <<<<<<<<<<<<<<
  *     seed = time(NULL)
  *   return fst.RandEquivalent(deref(ifst1._fst),
  */
   __pyx_t_3 = ((__pyx_v_seed == 0) != 0);
   if (__pyx_t_3) {
 
-    /* "fstlib/cext/pywrapfst.pyx":3979
+    /* "fstlib/cext/pywrapfst.pyx":4122
  *                                                     False))
  *   if seed == 0:
  *     seed = time(NULL)             # <<<<<<<<<<<<<<
  *   return fst.RandEquivalent(deref(ifst1._fst),
  *                             deref(ifst2._fst),
  */
     __pyx_v_seed = time(NULL);
 
-    /* "fstlib/cext/pywrapfst.pyx":3978
+    /* "fstlib/cext/pywrapfst.pyx":4121
  *                                                     False,
  *                                                     False))
  *   if seed == 0:             # <<<<<<<<<<<<<<
  *     seed = time(NULL)
  *   return fst.RandEquivalent(deref(ifst1._fst),
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3980
+  /* "fstlib/cext/pywrapfst.pyx":4123
  *   if seed == 0:
  *     seed = time(NULL)
  *   return fst.RandEquivalent(deref(ifst1._fst),             # <<<<<<<<<<<<<<
  *                             deref(ifst2._fst),
  *                             npath,
  */
   if (unlikely(((PyObject *)__pyx_v_ifst1) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3980, __pyx_L1_error)
+    __PYX_ERR(0, 4123, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3981
+  /* "fstlib/cext/pywrapfst.pyx":4124
  *     seed = time(NULL)
  *   return fst.RandEquivalent(deref(ifst1._fst),
  *                             deref(ifst2._fst),             # <<<<<<<<<<<<<<
  *                             npath,
  *                             deref(_opts),
  */
   if (unlikely(((PyObject *)__pyx_v_ifst2) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 3981, __pyx_L1_error)
+    __PYX_ERR(0, 4124, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":3980
+  /* "fstlib/cext/pywrapfst.pyx":4123
  *   if seed == 0:
  *     seed = time(NULL)
  *   return fst.RandEquivalent(deref(ifst1._fst),             # <<<<<<<<<<<<<<
  *                             deref(ifst2._fst),
  *                             npath,
  */
   __pyx_r = fst::script::RandEquivalent((*__pyx_v_ifst1->_fst), (*__pyx_v_ifst2->_fst), __pyx_v_npath, (*__pyx_v__opts), __pyx_v_delta, __pyx_v_seed);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3936
+  /* "fstlib/cext/pywrapfst.pyx":4079
  * 
  * 
  * cpdef bool randequivalent(Fst ifst1,             # <<<<<<<<<<<<<<
  *                           Fst ifst2,
- *                           int32 npath=1,
+ *                           int32_t npath=1,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.randequivalent", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
@@ -41286,19 +41846,19 @@
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_47randequivalent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_46randequivalent[] = "\n  randequivalent(ifst1, ifst2, npath=1, delta=0.0009765625, select=\"uniform\",\n                 max_length=2147483647, seed=0)\n\n  Are two acceptors stochastically equivalent?\n\n  This operation tests whether two FSTs are equivalent by randomly generating\n  paths alternatively in each of the two FSTs. For each randomly generated path,\n  the algorithm computes for each of the two FSTs the sum of the weights of all\n  the successful paths sharing the same input and output labels as the randomly\n  generated path and checks that these two values are within `delta`.\n\n  Args:\n    ifst1: The first input FST.\n    ifst2: The second input FST.\n    npath: The number of random paths to generate.\n    delta: Comparison/quantization delta.\n    seed: An optional seed value for random path generation; if zero, the\n        current time and process ID is used.\n    select: A string matching a known random arc selection type; one of:\n        \"uniform\", \"log_prob\", \"fast_log_prob\".\n    max_length: The maximum length of each random path.\n\n  Returns:\n    True if the two transducers satisfy the above condition, else False.\n  ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_47randequivalent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1 = 0;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2 = 0;
-  int32 __pyx_v_npath;
+  int32_t __pyx_v_npath;
   float __pyx_v_delta;
   PyObject *__pyx_v_select = 0;
-  int32 __pyx_v_max_length;
-  uint64 __pyx_v_seed;
+  int32_t __pyx_v_max_length;
+  uint64_t __pyx_v_seed;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("randequivalent (wrapper)", 0);
   {
@@ -41331,15 +41891,15 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst1)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("randequivalent", 0, 2, 7, 1); __PYX_ERR(0, 3936, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("randequivalent", 0, 2, 7, 1); __PYX_ERR(0, 4079, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_npath);
           if (value) { values[2] = value; kw_args--; }
         }
@@ -41365,15 +41925,15 @@
         case  6:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_seed);
           if (value) { values[6] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "randequivalent") < 0)) __PYX_ERR(0, 3936, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "randequivalent") < 0)) __PYX_ERR(0, 4079, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
@@ -41388,57 +41948,57 @@
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst1 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_ifst2 = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
     if (values[2]) {
-      __pyx_v_npath = __Pyx_PyInt_As_int32_t(values[2]); if (unlikely((__pyx_v_npath == ((int32)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3938, __pyx_L3_error)
+      __pyx_v_npath = __Pyx_PyInt_As_int32_t(values[2]); if (unlikely((__pyx_v_npath == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4081, __pyx_L3_error)
     } else {
-      __pyx_v_npath = ((int32)1);
+      __pyx_v_npath = ((int32_t)1);
     }
     if (values[3]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 3939, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 4082, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__44;
+      __pyx_v_delta = __pyx_k__42;
     }
     __pyx_v_select = values[4];
     if (values[5]) {
-      __pyx_v_max_length = __Pyx_PyInt_As_int32_t(values[5]); if (unlikely((__pyx_v_max_length == ((int32)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3941, __pyx_L3_error)
+      __pyx_v_max_length = __Pyx_PyInt_As_int32_t(values[5]); if (unlikely((__pyx_v_max_length == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4084, __pyx_L3_error)
     } else {
-      __pyx_v_max_length = __pyx_k__45;
+      __pyx_v_max_length = __pyx_k__43;
     }
     if (values[6]) {
-      __pyx_v_seed = __Pyx_PyInt_As_uint64_t(values[6]); if (unlikely((__pyx_v_seed == ((uint64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3942, __pyx_L3_error)
+      __pyx_v_seed = __Pyx_PyInt_As_uint64_t(values[6]); if (unlikely((__pyx_v_seed == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4085, __pyx_L3_error)
     } else {
-      __pyx_v_seed = ((uint64)0);
+      __pyx_v_seed = ((uint64_t)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("randequivalent", 0, 2, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3936, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("randequivalent", 0, 2, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4079, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.randequivalent", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 3936, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 3937, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst1), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst1", 0))) __PYX_ERR(0, 4079, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst2), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst2", 0))) __PYX_ERR(0, 4080, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_46randequivalent(__pyx_self, __pyx_v_ifst1, __pyx_v_ifst2, __pyx_v_npath, __pyx_v_delta, __pyx_v_select, __pyx_v_max_length, __pyx_v_seed);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_46randequivalent(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, int32 __pyx_v_npath, float __pyx_v_delta, PyObject *__pyx_v_select, int32 __pyx_v_max_length, uint64 __pyx_v_seed) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_46randequivalent(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst1, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst2, int32_t __pyx_v_npath, float __pyx_v_delta, PyObject *__pyx_v_select, int32_t __pyx_v_max_length, uint64_t __pyx_v_seed) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   bool __pyx_t_1;
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_randequivalent __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -41447,16 +42007,16 @@
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 5;
   __pyx_t_2.npath = __pyx_v_npath;
   __pyx_t_2.delta = __pyx_v_delta;
   __pyx_t_2.select = __pyx_v_select;
   __pyx_t_2.max_length = __pyx_v_max_length;
   __pyx_t_2.seed = __pyx_v_seed;
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_randequivalent(__pyx_v_ifst1, __pyx_v_ifst2, 0, &__pyx_t_2); if (unlikely(__pyx_t_1 == ((bool)-1) && PyErr_Occurred())) __PYX_ERR(0, 3936, __pyx_L1_error)
-  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3936, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_randequivalent(__pyx_v_ifst1, __pyx_v_ifst2, 0, &__pyx_t_2); if (unlikely(__pyx_t_1 == ((bool)-1) && PyErr_Occurred())) __PYX_ERR(0, 4079, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4079, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -41465,46 +42025,46 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":3988
+/* "fstlib/cext/pywrapfst.pyx":4131
  * 
  * 
  * cpdef MutableFst randgen(Fst ifst,             # <<<<<<<<<<<<<<
- *                          int32 npath=1,
+ *                          int32_t npath=1,
  *                          select="uniform",
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_49randgen(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_randgen(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_randgen *__pyx_optional_args) {
-  int32 __pyx_v_npath = ((int32)1);
+  int32_t __pyx_v_npath = ((int32_t)1);
   PyObject *__pyx_v_select = ((PyObject *)__pyx_n_u_uniform);
-  int32 __pyx_v_max_length = __pyx_k__46;
+  int32_t __pyx_v_max_length = __pyx_k__44;
 
-  /* "fstlib/cext/pywrapfst.pyx":3992
+  /* "fstlib/cext/pywrapfst.pyx":4135
  *                          select="uniform",
- *                          int32 max_length=INT32_MAX,
+ *                          int32_t max_length=numeric_limits[int32_t].max(),
  *                          bool weighted=False,             # <<<<<<<<<<<<<<
  *                          bool remove_total_weight=False,
- *                          uint64 seed=0):
+ *                          uint64_t seed=0):
  */
   bool __pyx_v_weighted = ((bool)0);
 
-  /* "fstlib/cext/pywrapfst.pyx":3993
- *                          int32 max_length=INT32_MAX,
+  /* "fstlib/cext/pywrapfst.pyx":4136
+ *                          int32_t max_length=numeric_limits[int32_t].max(),
  *                          bool weighted=False,
  *                          bool remove_total_weight=False,             # <<<<<<<<<<<<<<
- *                          uint64 seed=0):
+ *                          uint64_t seed=0):
  *   """
  */
   bool __pyx_v_remove_total_weight = ((bool)0);
-  uint64 __pyx_v_seed = ((uint64)0);
+  uint64_t __pyx_v_seed = ((uint64_t)0);
   fst::script::RandArcSelection __pyx_v__select;
   std::unique_ptr<fst::RandGenOptions<fst::script::RandArcSelection> >  __pyx_v__opts;
   std::unique_ptr<fst::script::VectorFstClass>  __pyx_v__tfst;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   std::string __pyx_t_1;
   fst::script::RandArcSelection __pyx_t_2;
@@ -41531,107 +42091,107 @@
             }
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4024
+  /* "fstlib/cext/pywrapfst.pyx":4167
  *     An FST containing one or more random paths.
  *   """
  *   cdef fst.RandArcSelection _select = _get_rand_arc_selection(tostring(select))             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.RandGenOptions[fst.RandArcSelection]] _opts
  *   _opts.reset(
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_select); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4024, __pyx_L1_error)
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_rand_arc_selection(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4024, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_select); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4167, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst__get_rand_arc_selection(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4167, __pyx_L1_error)
   __pyx_v__select = __pyx_t_2;
 
-  /* "fstlib/cext/pywrapfst.pyx":4026
+  /* "fstlib/cext/pywrapfst.pyx":4169
  *   cdef fst.RandArcSelection _select = _get_rand_arc_selection(tostring(select))
  *   cdef unique_ptr[fst.RandGenOptions[fst.RandArcSelection]] _opts
  *   _opts.reset(             # <<<<<<<<<<<<<<
  *       new fst.RandGenOptions[fst.RandArcSelection](_select,
  *                                                    max_length,
  */
   __pyx_v__opts.reset(new fst::RandGenOptions<fst::script::RandArcSelection> (__pyx_v__select, __pyx_v_max_length, __pyx_v_npath, __pyx_v_weighted, __pyx_v_remove_total_weight));
 
-  /* "fstlib/cext/pywrapfst.pyx":4033
+  /* "fstlib/cext/pywrapfst.pyx":4176
  *                                                    remove_total_weight))
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))             # <<<<<<<<<<<<<<
  *   if seed == 0:
  *     seed = time(NULL)
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 4033, __pyx_L1_error)
+    __PYX_ERR(0, 4176, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->arc_type(__pyx_v_ifst, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":4034
+  /* "fstlib/cext/pywrapfst.pyx":4177
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   if seed == 0:             # <<<<<<<<<<<<<<
  *     seed = time(NULL)
  *   fst.RandGen(deref(ifst._fst), _tfst.get(), deref(_opts), seed)
  */
   __pyx_t_3 = ((__pyx_v_seed == 0) != 0);
   if (__pyx_t_3) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4035
+    /* "fstlib/cext/pywrapfst.pyx":4178
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   if seed == 0:
  *     seed = time(NULL)             # <<<<<<<<<<<<<<
  *   fst.RandGen(deref(ifst._fst), _tfst.get(), deref(_opts), seed)
  *   return _init_MutableFst(_tfst.release())
  */
     __pyx_v_seed = time(NULL);
 
-    /* "fstlib/cext/pywrapfst.pyx":4034
+    /* "fstlib/cext/pywrapfst.pyx":4177
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   if seed == 0:             # <<<<<<<<<<<<<<
  *     seed = time(NULL)
  *   fst.RandGen(deref(ifst._fst), _tfst.get(), deref(_opts), seed)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4036
+  /* "fstlib/cext/pywrapfst.pyx":4179
  *   if seed == 0:
  *     seed = time(NULL)
  *   fst.RandGen(deref(ifst._fst), _tfst.get(), deref(_opts), seed)             # <<<<<<<<<<<<<<
  *   return _init_MutableFst(_tfst.release())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 4036, __pyx_L1_error)
+    __PYX_ERR(0, 4179, __pyx_L1_error)
   }
   fst::script::RandGen((*__pyx_v_ifst->_fst), __pyx_v__tfst.get(), (*__pyx_v__opts), __pyx_v_seed);
 
-  /* "fstlib/cext/pywrapfst.pyx":4037
+  /* "fstlib/cext/pywrapfst.pyx":4180
  *     seed = time(NULL)
  *   fst.RandGen(deref(ifst._fst), _tfst.get(), deref(_opts), seed)
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_4 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4037, __pyx_L1_error)
+  __pyx_t_4 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4180, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_4);
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3988
+  /* "fstlib/cext/pywrapfst.pyx":4131
  * 
  * 
  * cpdef MutableFst randgen(Fst ifst,             # <<<<<<<<<<<<<<
- *                          int32 npath=1,
+ *                          int32_t npath=1,
  *                          select="uniform",
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.randgen", __pyx_clineno, __pyx_lineno, __pyx_filename);
@@ -41643,20 +42203,20 @@
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_49randgen(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_48randgen[] = "\n  randgen(ifst, npath=1, seed=0, select=\"uniform\", max_length=2147483647,\n          weighted=False, remove_total_weight=False)\n\n  Randomly generate successful paths in an FST.\n\n  This operation randomly generates a set of successful paths in the input FST.\n  This relies on a mechanism for selecting arcs, specified using the `select`\n  argument. The default selector, \"uniform\", randomly selects a transition\n  using a uniform distribution. The \"log_prob\" selector randomly selects a\n  transition w.r.t. the weights treated as negative log probabilities after\n  normalizing for the total weight leaving the state. In all cases, finality is\n  treated as a transition to a super-final state.\n\n  Args:\n    ifst: The input FST.\n    npath: The number of random paths to generate.\n    seed: An optional seed value for random path generation; if zero, the\n        current time and process ID is used.\n    select: A string matching a known random arc selection type; one of:\n        \"uniform\", \"log_prob\", \"fast_log_prob\".\n    max_length: The maximum length of each random path.\n    weighted: Should the output be weighted by path count?\n    remove_total_weight: Should the total weight be removed (ignored when\n        `weighted` is False)?\n\n  Returns:\n    An FST containing one or more random paths.\n  ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_49randgen(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst = 0;
-  int32 __pyx_v_npath;
+  int32_t __pyx_v_npath;
   PyObject *__pyx_v_select = 0;
-  int32 __pyx_v_max_length;
+  int32_t __pyx_v_max_length;
   bool __pyx_v_weighted;
   bool __pyx_v_remove_total_weight;
-  uint64 __pyx_v_seed;
+  uint64_t __pyx_v_seed;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("randgen (wrapper)", 0);
   {
@@ -41723,15 +42283,15 @@
         case  6:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_seed);
           if (value) { values[6] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "randgen") < 0)) __PYX_ERR(0, 3988, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "randgen") < 0)) __PYX_ERR(0, 4131, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
@@ -41746,85 +42306,85 @@
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     if (values[1]) {
-      __pyx_v_npath = __Pyx_PyInt_As_int32_t(values[1]); if (unlikely((__pyx_v_npath == ((int32)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3989, __pyx_L3_error)
+      __pyx_v_npath = __Pyx_PyInt_As_int32_t(values[1]); if (unlikely((__pyx_v_npath == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4132, __pyx_L3_error)
     } else {
-      __pyx_v_npath = ((int32)1);
+      __pyx_v_npath = ((int32_t)1);
     }
     __pyx_v_select = values[2];
     if (values[3]) {
-      __pyx_v_max_length = __Pyx_PyInt_As_int32_t(values[3]); if (unlikely((__pyx_v_max_length == ((int32)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3991, __pyx_L3_error)
+      __pyx_v_max_length = __Pyx_PyInt_As_int32_t(values[3]); if (unlikely((__pyx_v_max_length == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4134, __pyx_L3_error)
     } else {
-      __pyx_v_max_length = __pyx_k__46;
+      __pyx_v_max_length = __pyx_k__44;
     }
     if (values[4]) {
-      __pyx_v_weighted = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_weighted == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3992, __pyx_L3_error)
+      __pyx_v_weighted = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_weighted == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4135, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":3992
+      /* "fstlib/cext/pywrapfst.pyx":4135
  *                          select="uniform",
- *                          int32 max_length=INT32_MAX,
+ *                          int32_t max_length=numeric_limits[int32_t].max(),
  *                          bool weighted=False,             # <<<<<<<<<<<<<<
  *                          bool remove_total_weight=False,
- *                          uint64 seed=0):
+ *                          uint64_t seed=0):
  */
       __pyx_v_weighted = ((bool)0);
     }
     if (values[5]) {
-      __pyx_v_remove_total_weight = __Pyx_PyObject_IsTrue(values[5]); if (unlikely((__pyx_v_remove_total_weight == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3993, __pyx_L3_error)
+      __pyx_v_remove_total_weight = __Pyx_PyObject_IsTrue(values[5]); if (unlikely((__pyx_v_remove_total_weight == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4136, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":3993
- *                          int32 max_length=INT32_MAX,
+      /* "fstlib/cext/pywrapfst.pyx":4136
+ *                          int32_t max_length=numeric_limits[int32_t].max(),
  *                          bool weighted=False,
  *                          bool remove_total_weight=False,             # <<<<<<<<<<<<<<
- *                          uint64 seed=0):
+ *                          uint64_t seed=0):
  *   """
  */
       __pyx_v_remove_total_weight = ((bool)0);
     }
     if (values[6]) {
-      __pyx_v_seed = __Pyx_PyInt_As_uint64_t(values[6]); if (unlikely((__pyx_v_seed == ((uint64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3994, __pyx_L3_error)
+      __pyx_v_seed = __Pyx_PyInt_As_uint64_t(values[6]); if (unlikely((__pyx_v_seed == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4137, __pyx_L3_error)
     } else {
-      __pyx_v_seed = ((uint64)0);
+      __pyx_v_seed = ((uint64_t)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("randgen", 0, 1, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 3988, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("randgen", 0, 1, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4131, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.randgen", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 3988, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4131, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_48randgen(__pyx_self, __pyx_v_ifst, __pyx_v_npath, __pyx_v_select, __pyx_v_max_length, __pyx_v_weighted, __pyx_v_remove_total_weight, __pyx_v_seed);
 
-  /* "fstlib/cext/pywrapfst.pyx":3988
+  /* "fstlib/cext/pywrapfst.pyx":4131
  * 
  * 
  * cpdef MutableFst randgen(Fst ifst,             # <<<<<<<<<<<<<<
- *                          int32 npath=1,
+ *                          int32_t npath=1,
  *                          select="uniform",
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_48randgen(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, int32 __pyx_v_npath, PyObject *__pyx_v_select, int32 __pyx_v_max_length, bool __pyx_v_weighted, bool __pyx_v_remove_total_weight, uint64 __pyx_v_seed) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_48randgen(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, int32_t __pyx_v_npath, PyObject *__pyx_v_select, int32_t __pyx_v_max_length, bool __pyx_v_weighted, bool __pyx_v_remove_total_weight, uint64_t __pyx_v_seed) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_randgen __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
@@ -41833,15 +42393,15 @@
   __pyx_t_2.__pyx_n = 6;
   __pyx_t_2.npath = __pyx_v_npath;
   __pyx_t_2.select = __pyx_v_select;
   __pyx_t_2.max_length = __pyx_v_max_length;
   __pyx_t_2.remove_total_weight = __pyx_v_weighted;
   __pyx_t_2.weighted = __pyx_v_remove_total_weight;
   __pyx_t_2.seed = __pyx_v_seed;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_randgen(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3988, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_randgen(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4131, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -41850,37 +42410,37 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4040
+/* "fstlib/cext/pywrapfst.pyx":4183
  * 
  * 
  * cpdef MutableFst replace(pairs,             # <<<<<<<<<<<<<<
  *                          call_arc_labeling="input",
  *                          return_arc_labeling="neither",
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_51replace(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_replace(PyObject *__pyx_v_pairs, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_replace *__pyx_optional_args) {
   PyObject *__pyx_v_call_arc_labeling = ((PyObject *)__pyx_n_u_input);
   PyObject *__pyx_v_return_arc_labeling = ((PyObject *)__pyx_n_u_neither);
 
-  /* "fstlib/cext/pywrapfst.pyx":4043
+  /* "fstlib/cext/pywrapfst.pyx":4186
  *                          call_arc_labeling="input",
  *                          return_arc_labeling="neither",
  *                          bool epsilon_on_replace=False,             # <<<<<<<<<<<<<<
- *                          int64 return_label=0):
+ *                          int64_t return_label=0):
  *   """
  */
   bool __pyx_v_epsilon_on_replace = ((bool)0);
-  int64 __pyx_v_return_label = ((int64)0);
-  int64 __pyx_v__label;
+  int64_t __pyx_v_return_label = ((int64_t)0);
+  int64_t __pyx_v__label;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v__pfst = 0;
   std::vector<__pyx_t_10cpywrapfst_LabelFstClassPair>  __pyx_v__pairs;
   std::unique_ptr<fst::script::VectorFstClass>  __pyx_v__tfst;
   enum fst::ReplaceLabelType __pyx_v__cal;
   enum fst::ReplaceLabelType __pyx_v__ral;
   std::unique_ptr<fst::script::ReplaceOptions>  __pyx_v__opts;
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_r = NULL;
@@ -41889,15 +42449,15 @@
   Py_ssize_t __pyx_t_2;
   PyObject *(*__pyx_t_3)(PyObject *);
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   PyObject *(*__pyx_t_8)(PyObject *);
-  int64 __pyx_t_9;
+  int64_t __pyx_t_9;
   __pyx_t_10cpywrapfst_LabelFstClassPair __pyx_t_10;
   std::string __pyx_t_11;
   enum fst::ReplaceLabelType __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("replace", 0);
@@ -41912,227 +42472,227 @@
             __pyx_v_return_label = __pyx_optional_args->return_label;
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4084
+  /* "fstlib/cext/pywrapfst.pyx":4227
  *   cdef Fst _pfst
  *   cdef vector[fst.LabelFstClassPair] _pairs
  *   for (_label, _pfst) in pairs:             # <<<<<<<<<<<<<<
  *       _pairs.push_back(fst.LabelFstClassPair(_label, _pfst._fst.get()))
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  */
   if (likely(PyList_CheckExact(__pyx_v_pairs)) || PyTuple_CheckExact(__pyx_v_pairs)) {
     __pyx_t_1 = __pyx_v_pairs; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
     __pyx_t_3 = NULL;
   } else {
-    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_pairs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4084, __pyx_L1_error)
+    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_pairs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4227, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4084, __pyx_L1_error)
+    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4227, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_3)) {
       if (likely(PyList_CheckExact(__pyx_t_1))) {
         if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 4084, __pyx_L1_error)
+        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 4227, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4084, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4227, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       } else {
         if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 4084, __pyx_L1_error)
+        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 4227, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4084, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4227, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       }
     } else {
       __pyx_t_4 = __pyx_t_3(__pyx_t_1);
       if (unlikely(!__pyx_t_4)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 4084, __pyx_L1_error)
+          else __PYX_ERR(0, 4227, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_4);
     }
     if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
       PyObject* sequence = __pyx_t_4;
       Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
       if (unlikely(size != 2)) {
         if (size > 2) __Pyx_RaiseTooManyValuesError(2);
         else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-        __PYX_ERR(0, 4084, __pyx_L1_error)
+        __PYX_ERR(0, 4227, __pyx_L1_error)
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
       if (likely(PyTuple_CheckExact(sequence))) {
         __pyx_t_5 = PyTuple_GET_ITEM(sequence, 0); 
         __pyx_t_6 = PyTuple_GET_ITEM(sequence, 1); 
       } else {
         __pyx_t_5 = PyList_GET_ITEM(sequence, 0); 
         __pyx_t_6 = PyList_GET_ITEM(sequence, 1); 
       }
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_6);
       #else
-      __pyx_t_5 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4084, __pyx_L1_error)
+      __pyx_t_5 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4227, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4084, __pyx_L1_error)
+      __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4227, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       #endif
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     } else {
       Py_ssize_t index = -1;
-      __pyx_t_7 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4084, __pyx_L1_error)
+      __pyx_t_7 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4227, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __pyx_t_8 = Py_TYPE(__pyx_t_7)->tp_iternext;
       index = 0; __pyx_t_5 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_5)) goto __pyx_L5_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_5);
       index = 1; __pyx_t_6 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_6)) goto __pyx_L5_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_6);
-      if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_7), 2) < 0) __PYX_ERR(0, 4084, __pyx_L1_error)
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_7), 2) < 0) __PYX_ERR(0, 4227, __pyx_L1_error)
       __pyx_t_8 = NULL;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       goto __pyx_L6_unpacking_done;
       __pyx_L5_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __pyx_t_8 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-      __PYX_ERR(0, 4084, __pyx_L1_error)
+      __PYX_ERR(0, 4227, __pyx_L1_error)
       __pyx_L6_unpacking_done:;
     }
-    __pyx_t_9 = __Pyx_PyInt_As_int64_t(__pyx_t_5); if (unlikely((__pyx_t_9 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4084, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_As_int64_t(__pyx_t_5); if (unlikely((__pyx_t_9 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4227, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst))))) __PYX_ERR(0, 4084, __pyx_L1_error)
+    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst))))) __PYX_ERR(0, 4227, __pyx_L1_error)
     __pyx_v__label = __pyx_t_9;
     __Pyx_XDECREF_SET(__pyx_v__pfst, ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_6));
     __pyx_t_6 = 0;
 
-    /* "fstlib/cext/pywrapfst.pyx":4085
+    /* "fstlib/cext/pywrapfst.pyx":4228
  *   cdef vector[fst.LabelFstClassPair] _pairs
  *   for (_label, _pfst) in pairs:
  *       _pairs.push_back(fst.LabelFstClassPair(_label, _pfst._fst.get()))             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(_pairs[0].second.ArcType()))
  */
     if (unlikely(((PyObject *)__pyx_v__pfst) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-      __PYX_ERR(0, 4085, __pyx_L1_error)
+      __PYX_ERR(0, 4228, __pyx_L1_error)
     }
     try {
       __pyx_t_10 = __pyx_t_10cpywrapfst_LabelFstClassPair(__pyx_v__label, __pyx_v__pfst->_fst.get());
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 4085, __pyx_L1_error)
+      __PYX_ERR(0, 4228, __pyx_L1_error)
     }
     try {
       __pyx_v__pairs.push_back(__pyx_t_10);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 4085, __pyx_L1_error)
+      __PYX_ERR(0, 4228, __pyx_L1_error)
     }
 
-    /* "fstlib/cext/pywrapfst.pyx":4084
+    /* "fstlib/cext/pywrapfst.pyx":4227
  *   cdef Fst _pfst
  *   cdef vector[fst.LabelFstClassPair] _pairs
  *   for (_label, _pfst) in pairs:             # <<<<<<<<<<<<<<
  *       _pairs.push_back(fst.LabelFstClassPair(_label, _pfst._fst.get()))
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4087
+  /* "fstlib/cext/pywrapfst.pyx":4230
  *       _pairs.push_back(fst.LabelFstClassPair(_label, _pfst._fst.get()))
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(_pairs[0].second.ArcType()))             # <<<<<<<<<<<<<<
  *   cdef fst.ReplaceLabelType _cal = _get_replace_label_type(
  *       tostring(call_arc_labeling),
  */
   __pyx_v__tfst.reset(new fst::script::VectorFstClass((__pyx_v__pairs[0]).second->ArcType()));
 
-  /* "fstlib/cext/pywrapfst.pyx":4089
+  /* "fstlib/cext/pywrapfst.pyx":4232
  *   _tfst.reset(new fst.VectorFstClass(_pairs[0].second.ArcType()))
  *   cdef fst.ReplaceLabelType _cal = _get_replace_label_type(
  *       tostring(call_arc_labeling),             # <<<<<<<<<<<<<<
  *       epsilon_on_replace)
  *   cdef fst.ReplaceLabelType _ral = _get_replace_label_type(
  */
-  __pyx_t_11 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_call_arc_labeling); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4089, __pyx_L1_error)
+  __pyx_t_11 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_call_arc_labeling); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4232, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":4088
+  /* "fstlib/cext/pywrapfst.pyx":4231
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(_pairs[0].second.ArcType()))
  *   cdef fst.ReplaceLabelType _cal = _get_replace_label_type(             # <<<<<<<<<<<<<<
  *       tostring(call_arc_labeling),
  *       epsilon_on_replace)
  */
-  __pyx_t_12 = __pyx_f_6fstlib_4cext_9pywrapfst__get_replace_label_type(__pyx_t_11, __pyx_v_epsilon_on_replace); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4088, __pyx_L1_error)
+  __pyx_t_12 = __pyx_f_6fstlib_4cext_9pywrapfst__get_replace_label_type(__pyx_t_11, __pyx_v_epsilon_on_replace); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4231, __pyx_L1_error)
   __pyx_v__cal = __pyx_t_12;
 
-  /* "fstlib/cext/pywrapfst.pyx":4092
+  /* "fstlib/cext/pywrapfst.pyx":4235
  *       epsilon_on_replace)
  *   cdef fst.ReplaceLabelType _ral = _get_replace_label_type(
  *       tostring(return_arc_labeling),             # <<<<<<<<<<<<<<
  *       epsilon_on_replace)
  *   cdef unique_ptr[fst.ReplaceOptions] _opts
  */
-  __pyx_t_11 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_return_arc_labeling); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4092, __pyx_L1_error)
+  __pyx_t_11 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_return_arc_labeling); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4235, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":4091
+  /* "fstlib/cext/pywrapfst.pyx":4234
  *       tostring(call_arc_labeling),
  *       epsilon_on_replace)
  *   cdef fst.ReplaceLabelType _ral = _get_replace_label_type(             # <<<<<<<<<<<<<<
  *       tostring(return_arc_labeling),
  *       epsilon_on_replace)
  */
-  __pyx_t_12 = __pyx_f_6fstlib_4cext_9pywrapfst__get_replace_label_type(__pyx_t_11, __pyx_v_epsilon_on_replace); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4091, __pyx_L1_error)
+  __pyx_t_12 = __pyx_f_6fstlib_4cext_9pywrapfst__get_replace_label_type(__pyx_t_11, __pyx_v_epsilon_on_replace); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4234, __pyx_L1_error)
   __pyx_v__ral = __pyx_t_12;
 
-  /* "fstlib/cext/pywrapfst.pyx":4095
+  /* "fstlib/cext/pywrapfst.pyx":4238
  *       epsilon_on_replace)
  *   cdef unique_ptr[fst.ReplaceOptions] _opts
  *   _opts.reset(new fst.ReplaceOptions(_pairs[0].first, _cal, _ral, return_label))             # <<<<<<<<<<<<<<
  *   fst.Replace(_pairs, _tfst.get(), deref(_opts))
  *   return _init_MutableFst(_tfst.release())
  */
   __pyx_v__opts.reset(new fst::script::ReplaceOptions((__pyx_v__pairs[0]).first, __pyx_v__cal, __pyx_v__ral, __pyx_v_return_label));
 
-  /* "fstlib/cext/pywrapfst.pyx":4096
+  /* "fstlib/cext/pywrapfst.pyx":4239
  *   cdef unique_ptr[fst.ReplaceOptions] _opts
  *   _opts.reset(new fst.ReplaceOptions(_pairs[0].first, _cal, _ral, return_label))
  *   fst.Replace(_pairs, _tfst.get(), deref(_opts))             # <<<<<<<<<<<<<<
  *   return _init_MutableFst(_tfst.release())
  * 
  */
   fst::script::Replace(__pyx_v__pairs, __pyx_v__tfst.get(), (*__pyx_v__opts));
 
-  /* "fstlib/cext/pywrapfst.pyx":4097
+  /* "fstlib/cext/pywrapfst.pyx":4240
  *   _opts.reset(new fst.ReplaceOptions(_pairs[0].first, _cal, _ral, return_label))
  *   fst.Replace(_pairs, _tfst.get(), deref(_opts))
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4097, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4040
+  /* "fstlib/cext/pywrapfst.pyx":4183
  * 
  * 
  * cpdef MutableFst replace(pairs,             # <<<<<<<<<<<<<<
  *                          call_arc_labeling="input",
  *                          return_arc_labeling="neither",
  */
 
@@ -42156,15 +42716,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_51replace(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_50replace[] = "\n  replace(pairs, call_arc_labeling=\"input\", return_arc_labeling=\"neither\",\n          epsilon_on_replace=False, return_label=0)\n\n  Recursively replaces arcs in the FST with other FST(s).\n\n  This operation performs the dynamic replacement of arcs in one FST with\n  another FST, allowing the definition of FSTs analogous to RTNs. It takes as\n  input a set of pairs of a set of pairs formed by a non-terminal label and\n  its corresponding FST, and a label identifying the root FST in that set.\n  The resulting FST is obtained by taking the root FST and recursively replacing\n  each arc having a nonterminal as output label by its corresponding FST. More\n  precisely, an arc from state s to state d with (nonterminal) output label n in\n  this FST is replaced by redirecting this \"call\" arc to the initial state of a\n  copy F of the FST for n, and adding \"return\" arcs from each final state of F\n  to d. Optional arguments control how the call and return arcs are labeled; by\n  default, the only non-epsilon label is placed on the call arc.\n\n  Args:\n\n    pairs: An iterable of (nonterminal label, FST) pairs, where the former is an\n        unsigned integer and the latter is an Fst instance.\n    call_arc_labeling: A string indicating which call arc labels should be\n        non-epsilon. One of: \"input\" (default), \"output\", \"both\", \"neither\".\n        This value is set to \"neither\" if epsilon_on_replace is True.\n    return_arc_labeling: A string indicating which return arc labels should be\n        non-epsilon. One of: \"input\", \"output\", \"both\", \"neither\" (default).\n        This value is set to \"neither\" if epsilon_on_replace is True.\n    epsilon_on_replace: Should call and return arcs be epsilon arcs? If True,\n        this effectively overrides call_arc_labeling and return_arc_labeling,\n        setting both to \"neither\".\n    return_label: The integer label for return arcs.\n\n  Returns:\n    An FST resulting from expanding the input"" RTN.\n  ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_51replace(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_pairs = 0;
   PyObject *__pyx_v_call_arc_labeling = 0;
   PyObject *__pyx_v_return_arc_labeling = 0;
   bool __pyx_v_epsilon_on_replace;
-  int64 __pyx_v_return_label;
+  int64_t __pyx_v_return_label;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("replace (wrapper)", 0);
   {
@@ -42216,15 +42776,15 @@
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_return_label);
           if (value) { values[4] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "replace") < 0)) __PYX_ERR(0, 4040, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "replace") < 0)) __PYX_ERR(0, 4183, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
@@ -42237,71 +42797,71 @@
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_pairs = values[0];
     __pyx_v_call_arc_labeling = values[1];
     __pyx_v_return_arc_labeling = values[2];
     if (values[3]) {
-      __pyx_v_epsilon_on_replace = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_epsilon_on_replace == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4043, __pyx_L3_error)
+      __pyx_v_epsilon_on_replace = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_epsilon_on_replace == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4186, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":4043
+      /* "fstlib/cext/pywrapfst.pyx":4186
  *                          call_arc_labeling="input",
  *                          return_arc_labeling="neither",
  *                          bool epsilon_on_replace=False,             # <<<<<<<<<<<<<<
- *                          int64 return_label=0):
+ *                          int64_t return_label=0):
  *   """
  */
       __pyx_v_epsilon_on_replace = ((bool)0);
     }
     if (values[4]) {
-      __pyx_v_return_label = __Pyx_PyInt_As_int64_t(values[4]); if (unlikely((__pyx_v_return_label == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4044, __pyx_L3_error)
+      __pyx_v_return_label = __Pyx_PyInt_As_int64_t(values[4]); if (unlikely((__pyx_v_return_label == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4187, __pyx_L3_error)
     } else {
-      __pyx_v_return_label = ((int64)0);
+      __pyx_v_return_label = ((int64_t)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("replace", 0, 1, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4040, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("replace", 0, 1, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4183, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.replace", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_50replace(__pyx_self, __pyx_v_pairs, __pyx_v_call_arc_labeling, __pyx_v_return_arc_labeling, __pyx_v_epsilon_on_replace, __pyx_v_return_label);
 
-  /* "fstlib/cext/pywrapfst.pyx":4040
+  /* "fstlib/cext/pywrapfst.pyx":4183
  * 
  * 
  * cpdef MutableFst replace(pairs,             # <<<<<<<<<<<<<<
  *                          call_arc_labeling="input",
  *                          return_arc_labeling="neither",
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_50replace(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_pairs, PyObject *__pyx_v_call_arc_labeling, PyObject *__pyx_v_return_arc_labeling, bool __pyx_v_epsilon_on_replace, int64 __pyx_v_return_label) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_50replace(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_pairs, PyObject *__pyx_v_call_arc_labeling, PyObject *__pyx_v_return_arc_labeling, bool __pyx_v_epsilon_on_replace, int64_t __pyx_v_return_label) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_replace __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("replace", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 4;
   __pyx_t_2.call_arc_labeling = __pyx_v_call_arc_labeling;
   __pyx_t_2.return_arc_labeling = __pyx_v_return_arc_labeling;
   __pyx_t_2.epsilon_on_replace = __pyx_v_epsilon_on_replace;
   __pyx_t_2.return_label = __pyx_v_return_label;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_replace(__pyx_v_pairs, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4040, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_replace(__pyx_v_pairs, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -42310,15 +42870,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4100
+/* "fstlib/cext/pywrapfst.pyx":4243
  * 
  * 
  * cpdef MutableFst reverse(Fst ifst, bool require_superinitial=True):             # <<<<<<<<<<<<<<
  *   """
  *   reverse(ifst, require_superinitial=True)
  */
 
@@ -42335,55 +42895,55 @@
   __Pyx_RefNannySetupContext("reverse", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_require_superinitial = __pyx_optional_args->require_superinitial;
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4120
+  /* "fstlib/cext/pywrapfst.pyx":4263
  *   """
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))             # <<<<<<<<<<<<<<
  *   fst.Reverse(deref(ifst._fst), _tfst.get(), require_superinitial)
  *   return _init_MutableFst(_tfst.release())
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 4120, __pyx_L1_error)
+    __PYX_ERR(0, 4263, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->arc_type(__pyx_v_ifst, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":4121
+  /* "fstlib/cext/pywrapfst.pyx":4264
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   fst.Reverse(deref(ifst._fst), _tfst.get(), require_superinitial)             # <<<<<<<<<<<<<<
  *   return _init_MutableFst(_tfst.release())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 4121, __pyx_L1_error)
+    __PYX_ERR(0, 4264, __pyx_L1_error)
   }
   fst::script::Reverse((*__pyx_v_ifst->_fst), __pyx_v__tfst.get(), __pyx_v_require_superinitial);
 
-  /* "fstlib/cext/pywrapfst.pyx":4122
+  /* "fstlib/cext/pywrapfst.pyx":4265
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   fst.Reverse(deref(ifst._fst), _tfst.get(), require_superinitial)
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4122, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4265, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4100
+  /* "fstlib/cext/pywrapfst.pyx":4243
  * 
  * 
  * cpdef MutableFst reverse(Fst ifst, bool require_superinitial=True):             # <<<<<<<<<<<<<<
  *   """
  *   reverse(ifst, require_superinitial=True)
  */
 
@@ -42433,41 +42993,41 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_require_superinitial);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "reverse") < 0)) __PYX_ERR(0, 4100, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "reverse") < 0)) __PYX_ERR(0, 4243, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     if (values[1]) {
-      __pyx_v_require_superinitial = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_require_superinitial == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4100, __pyx_L3_error)
+      __pyx_v_require_superinitial = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_require_superinitial == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4243, __pyx_L3_error)
     } else {
       __pyx_v_require_superinitial = ((bool)1);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("reverse", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4100, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("reverse", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4243, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.reverse", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4100, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4243, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_52reverse(__pyx_self, __pyx_v_ifst, __pyx_v_require_superinitial);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -42483,15 +43043,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("reverse", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.require_superinitial = __pyx_v_require_superinitial;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_reverse(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4100, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_reverse(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4243, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -42500,29 +43060,29 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4128
+/* "fstlib/cext/pywrapfst.pyx":4271
  * 
  * 
  * cdef void _shortestdistance(Fst ifst,             # <<<<<<<<<<<<<<
  *                             vector[fst.WeightClass] *distance,
  *                             float delta=fst.kShortestDelta,
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst__shortestdistance(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, std::vector<fst::script::WeightClass>  *__pyx_v_distance, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst__shortestdistance *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__47;
-  int64 __pyx_v_nstate = __pyx_k__48;
+  float __pyx_v_delta = __pyx_k__45;
+  int64_t __pyx_v_nstate = __pyx_k__46;
   PyObject *__pyx_v_queue_type = ((PyObject *)__pyx_n_u_auto);
 
-  /* "fstlib/cext/pywrapfst.pyx":4133
- *                             int64 nstate=fst.kNoStateId,
+  /* "fstlib/cext/pywrapfst.pyx":4276
+ *                             int64_t nstate=fst.kNoStateId,
  *                             queue_type="auto",
  *                             bool reverse=False) except *:             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.ShortestDistanceOptions] _opts
  *   if reverse:
  */
   bool __pyx_v_reverse = ((bool)0);
   std::unique_ptr<fst::script::ShortestDistanceOptions>  __pyx_v__opts;
@@ -42545,91 +43105,91 @@
             __pyx_v_reverse = __pyx_optional_args->reverse;
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4135
+  /* "fstlib/cext/pywrapfst.pyx":4278
  *                             bool reverse=False) except *:
  *   cdef unique_ptr[fst.ShortestDistanceOptions] _opts
  *   if reverse:             # <<<<<<<<<<<<<<
  *     # Only the simpler signature supports shortest distance to final states;
  *     # `nstate` and `queue_type` arguments are ignored.
  */
   __pyx_t_1 = (__pyx_v_reverse != 0);
   if (__pyx_t_1) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4138
+    /* "fstlib/cext/pywrapfst.pyx":4281
  *     # Only the simpler signature supports shortest distance to final states;
  *     # `nstate` and `queue_type` arguments are ignored.
  *     fst.ShortestDistance(deref(ifst._fst), distance, True, delta)             # <<<<<<<<<<<<<<
  *   else:
  *     _opts.reset(
  */
     if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-      __PYX_ERR(0, 4138, __pyx_L1_error)
+      __PYX_ERR(0, 4281, __pyx_L1_error)
     }
     fst::script::ShortestDistance((*__pyx_v_ifst->_fst), __pyx_v_distance, 1, __pyx_v_delta);
 
-    /* "fstlib/cext/pywrapfst.pyx":4135
+    /* "fstlib/cext/pywrapfst.pyx":4278
  *                             bool reverse=False) except *:
  *   cdef unique_ptr[fst.ShortestDistanceOptions] _opts
  *   if reverse:             # <<<<<<<<<<<<<<
  *     # Only the simpler signature supports shortest distance to final states;
  *     # `nstate` and `queue_type` arguments are ignored.
  */
     goto __pyx_L3;
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4140
+  /* "fstlib/cext/pywrapfst.pyx":4283
  *     fst.ShortestDistance(deref(ifst._fst), distance, True, delta)
  *   else:
  *     _opts.reset(             # <<<<<<<<<<<<<<
  *         new fst.ShortestDistanceOptions(_get_queue_type(tostring(queue_type)),
  *                                         fst.ArcFilterType.ANY_ARC_FILTER,
  */
   /*else*/ {
 
-    /* "fstlib/cext/pywrapfst.pyx":4141
+    /* "fstlib/cext/pywrapfst.pyx":4284
  *   else:
  *     _opts.reset(
  *         new fst.ShortestDistanceOptions(_get_queue_type(tostring(queue_type)),             # <<<<<<<<<<<<<<
  *                                         fst.ArcFilterType.ANY_ARC_FILTER,
  *                                         nstate,
  */
-    __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_queue_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4141, __pyx_L1_error)
-    __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst__get_queue_type(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4141, __pyx_L1_error)
+    __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_queue_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4284, __pyx_L1_error)
+    __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst__get_queue_type(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4284, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":4140
+    /* "fstlib/cext/pywrapfst.pyx":4283
  *     fst.ShortestDistance(deref(ifst._fst), distance, True, delta)
  *   else:
  *     _opts.reset(             # <<<<<<<<<<<<<<
  *         new fst.ShortestDistanceOptions(_get_queue_type(tostring(queue_type)),
  *                                         fst.ArcFilterType.ANY_ARC_FILTER,
  */
     __pyx_v__opts.reset(new fst::script::ShortestDistanceOptions(__pyx_t_3, fst::script::ArcFilterType::ANY, __pyx_v_nstate, __pyx_v_delta));
 
-    /* "fstlib/cext/pywrapfst.pyx":4145
+    /* "fstlib/cext/pywrapfst.pyx":4288
  *                                         nstate,
  *                                         delta))
  *     fst.ShortestDistance(deref(ifst._fst), distance, deref(_opts))             # <<<<<<<<<<<<<<
  * 
  * 
  */
     if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-      __PYX_ERR(0, 4145, __pyx_L1_error)
+      __PYX_ERR(0, 4288, __pyx_L1_error)
     }
     fst::script::ShortestDistance((*__pyx_v_ifst->_fst), __pyx_v_distance, (*__pyx_v__opts));
   }
   __pyx_L3:;
 
-  /* "fstlib/cext/pywrapfst.pyx":4128
+  /* "fstlib/cext/pywrapfst.pyx":4271
  * 
  * 
  * cdef void _shortestdistance(Fst ifst,             # <<<<<<<<<<<<<<
  *                             vector[fst.WeightClass] *distance,
  *                             float delta=fst.kShortestDelta,
  */
 
@@ -42637,30 +43197,30 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst._shortestdistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4148
+/* "fstlib/cext/pywrapfst.pyx":4291
  * 
  * 
  * def shortestdistance(Fst ifst,             # <<<<<<<<<<<<<<
  *                      float delta=fst.kShortestDelta,
- *                      int64 nstate=fst.kNoStateId,
+ *                      int64_t nstate=fst.kNoStateId,
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_55shortestdistance(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_54shortestdistance[] = "\n  shortestdistance(ifst, delta=1e-6, nstate=NO_STATE_ID,\n                   queue_type=\"auto\", reverse=False)\n\n  Compute the shortest distance from the initial or final state.\n\n  This operation computes the shortest distance from the initial state (when\n  `reverse` is False) or from every state to the final state (when `reverse` is\n  True). The shortest distance from p to q is the \\otimes-sum of the weights of\n  all the paths between p and q. The weights must be right (if `reverse` is\n  False) or left (if `reverse` is True) distributive, and k-closed (i.e., 1\n  \\otimes x \\otimes x^2 \\otimes ... \\otimes x^{k + 1} = 1 \\otimes x \\otimes x^2\n  \\otimes ... \\otimes x^k; e.g., TropicalWeight).\n\n  Args:\n    ifst: The input FST.\n    delta: Comparison/quantization delta.\n    nstate: State number threshold (ignored if `reverse` is True).\n    queue_type: A string matching a known queue type; one of: \"auto\", \"fifo\",\n        \"lifo\", \"shortest\", \"state\", \"top\" (ignored if `reverse` is True).\n    reverse: Should the reverse distance (from each state to the final state)\n        be computed?\n\n  Returns:\n    A list of Weight objects representing the shortest distance for each state.\n  ";
 static PyMethodDef __pyx_mdef_6fstlib_4cext_9pywrapfst_55shortestdistance = {"shortestdistance", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6fstlib_4cext_9pywrapfst_55shortestdistance, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6fstlib_4cext_9pywrapfst_54shortestdistance};
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_55shortestdistance(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst = 0;
   float __pyx_v_delta;
-  int64 __pyx_v_nstate;
+  int64_t __pyx_v_nstate;
   PyObject *__pyx_v_queue_type = 0;
   bool __pyx_v_reverse;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
@@ -42713,15 +43273,15 @@
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_reverse);
           if (value) { values[4] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "shortestdistance") < 0)) __PYX_ERR(0, 4148, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "shortestdistance") < 0)) __PYX_ERR(0, 4291, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
@@ -42732,67 +43292,67 @@
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     if (values[1]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 4149, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 4292, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__49;
+      __pyx_v_delta = __pyx_k__47;
     }
     if (values[2]) {
-      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[2]); if (unlikely((__pyx_v_nstate == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4150, __pyx_L3_error)
+      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[2]); if (unlikely((__pyx_v_nstate == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4293, __pyx_L3_error)
     } else {
-      __pyx_v_nstate = __pyx_k__50;
+      __pyx_v_nstate = __pyx_k__48;
     }
     __pyx_v_queue_type = values[3];
     if (values[4]) {
-      __pyx_v_reverse = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_reverse == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4152, __pyx_L3_error)
+      __pyx_v_reverse = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_reverse == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4295, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":4152
- *                      int64 nstate=fst.kNoStateId,
+      /* "fstlib/cext/pywrapfst.pyx":4295
+ *                      int64_t nstate=fst.kNoStateId,
  *                      queue_type="auto",
  *                      bool reverse=False):             # <<<<<<<<<<<<<<
  *   """
  *   shortestdistance(ifst, delta=1e-6, nstate=NO_STATE_ID,
  */
       __pyx_v_reverse = ((bool)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("shortestdistance", 0, 1, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4148, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("shortestdistance", 0, 1, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4291, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.shortestdistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4148, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4291, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_54shortestdistance(__pyx_self, __pyx_v_ifst, __pyx_v_delta, __pyx_v_nstate, __pyx_v_queue_type, __pyx_v_reverse);
 
-  /* "fstlib/cext/pywrapfst.pyx":4148
+  /* "fstlib/cext/pywrapfst.pyx":4291
  * 
  * 
  * def shortestdistance(Fst ifst,             # <<<<<<<<<<<<<<
  *                      float delta=fst.kShortestDelta,
- *                      int64 nstate=fst.kNoStateId,
+ *                      int64_t nstate=fst.kNoStateId,
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_54shortestdistance(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64 __pyx_v_nstate, PyObject *__pyx_v_queue_type, bool __pyx_v_reverse) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_54shortestdistance(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int64_t __pyx_v_nstate, PyObject *__pyx_v_queue_type, bool __pyx_v_reverse) {
   std::vector<fst::script::WeightClass>  __pyx_v__distance;
   fst::script::WeightClass __pyx_7genexpr__pyx_v_weight;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst__shortestdistance __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   std::vector<fst::script::WeightClass> ::iterator __pyx_t_3;
@@ -42801,102 +43361,102 @@
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("shortestdistance", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4180
+  /* "fstlib/cext/pywrapfst.pyx":4323
  *   """
  *   cdef vector[fst.WeightClass] _distance
  *   _shortestdistance(ifst, addr(_distance), delta, nstate, queue_type, reverse)             # <<<<<<<<<<<<<<
  *   return [Weight(ifst._fst.get().WeightType(), weight.ToString())
  *           for weight in _distance]
  */
   __pyx_t_1.__pyx_n = 4;
   __pyx_t_1.delta = __pyx_v_delta;
   __pyx_t_1.nstate = __pyx_v_nstate;
   __pyx_t_1.queue_type = __pyx_v_queue_type;
   __pyx_t_1.reverse = __pyx_v_reverse;
-  __pyx_f_6fstlib_4cext_9pywrapfst__shortestdistance(__pyx_v_ifst, (&__pyx_v__distance), &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4180, __pyx_L1_error)
+  __pyx_f_6fstlib_4cext_9pywrapfst__shortestdistance(__pyx_v_ifst, (&__pyx_v__distance), &__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4323, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":4181
+  /* "fstlib/cext/pywrapfst.pyx":4324
  *   cdef vector[fst.WeightClass] _distance
  *   _shortestdistance(ifst, addr(_distance), delta, nstate, queue_type, reverse)
  *   return [Weight(ifst._fst.get().WeightType(), weight.ToString())             # <<<<<<<<<<<<<<
  *           for weight in _distance]
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   { /* enter inner scope */
-    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4181, __pyx_L1_error)
+    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4324, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
 
-    /* "fstlib/cext/pywrapfst.pyx":4182
+    /* "fstlib/cext/pywrapfst.pyx":4325
  *   _shortestdistance(ifst, addr(_distance), delta, nstate, queue_type, reverse)
  *   return [Weight(ifst._fst.get().WeightType(), weight.ToString())
  *           for weight in _distance]             # <<<<<<<<<<<<<<
  * 
  * 
  */
     __pyx_t_3 = __pyx_v__distance.begin();
     for (;;) {
       if (!(__pyx_t_3 != __pyx_v__distance.end())) break;
       __pyx_t_4 = *__pyx_t_3;
       ++__pyx_t_3;
       __pyx_7genexpr__pyx_v_weight = __pyx_t_4;
 
-      /* "fstlib/cext/pywrapfst.pyx":4181
+      /* "fstlib/cext/pywrapfst.pyx":4324
  *   cdef vector[fst.WeightClass] _distance
  *   _shortestdistance(ifst, addr(_distance), delta, nstate, queue_type, reverse)
  *   return [Weight(ifst._fst.get().WeightType(), weight.ToString())             # <<<<<<<<<<<<<<
  *           for weight in _distance]
  * 
  */
       if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
         PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-        __PYX_ERR(0, 4181, __pyx_L1_error)
+        __PYX_ERR(0, 4324, __pyx_L1_error)
       }
-      __pyx_t_5 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_ifst->_fst.get()->WeightType()); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4181, __pyx_L1_error)
+      __pyx_t_5 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v_ifst->_fst.get()->WeightType()); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4324, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_7genexpr__pyx_v_weight.ToString()); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4181, __pyx_L1_error)
+      __pyx_t_6 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_7genexpr__pyx_v_weight.ToString()); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4324, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4181, __pyx_L1_error)
+      __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4324, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_GIVEREF(__pyx_t_5);
       PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
       __pyx_t_5 = 0;
       __pyx_t_6 = 0;
-      __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_t_7, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4181, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight), __pyx_t_7, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4324, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_6))) __PYX_ERR(0, 4181, __pyx_L1_error)
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_6))) __PYX_ERR(0, 4324, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-      /* "fstlib/cext/pywrapfst.pyx":4182
+      /* "fstlib/cext/pywrapfst.pyx":4325
  *   _shortestdistance(ifst, addr(_distance), delta, nstate, queue_type, reverse)
  *   return [Weight(ifst._fst.get().WeightType(), weight.ToString())
  *           for weight in _distance]             # <<<<<<<<<<<<<<
  * 
  * 
  */
     }
   } /* exit inner scope */
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4148
+  /* "fstlib/cext/pywrapfst.pyx":4291
  * 
  * 
  * def shortestdistance(Fst ifst,             # <<<<<<<<<<<<<<
  *                      float delta=fst.kShortestDelta,
- *                      int64 nstate=fst.kNoStateId,
+ *                      int64_t nstate=fst.kNoStateId,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
@@ -42905,39 +43465,39 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4185
+/* "fstlib/cext/pywrapfst.pyx":4328
  * 
  * 
  * cpdef MutableFst shortestpath(Fst ifst,             # <<<<<<<<<<<<<<
  *                               float delta=fst.kShortestDelta,
- *                               int32 nshortest=1,
+ *                               int32_t nshortest=1,
  */
 
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_57shortestpath(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *__pyx_f_6fstlib_4cext_9pywrapfst_shortestpath(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_shortestpath *__pyx_optional_args) {
-  float __pyx_v_delta = __pyx_k__51;
-  int32 __pyx_v_nshortest = ((int32)1);
-  int64 __pyx_v_nstate = __pyx_k__52;
+  float __pyx_v_delta = __pyx_k__49;
+  int32_t __pyx_v_nshortest = ((int32_t)1);
+  int64_t __pyx_v_nstate = __pyx_k__50;
   PyObject *__pyx_v_queue_type = ((PyObject *)__pyx_n_u_auto);
 
-  /* "fstlib/cext/pywrapfst.pyx":4190
- *                               int64 nstate=fst.kNoStateId,
+  /* "fstlib/cext/pywrapfst.pyx":4333
+ *                               int64_t nstate=fst.kNoStateId,
  *                               queue_type="auto",
  *                               bool unique=False,             # <<<<<<<<<<<<<<
  *                               weight=None):
  *   """
  */
   bool __pyx_v_unique = ((bool)0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4191
+  /* "fstlib/cext/pywrapfst.pyx":4334
  *                               queue_type="auto",
  *                               bool unique=False,
  *                               weight=None):             # <<<<<<<<<<<<<<
  *   """
  *   shortestpath(ifst, delta=1e-6, nshortest=1, nstate=NO_STATE_ID,
  */
   PyObject *__pyx_v_weight = ((PyObject *)Py_None);
@@ -42971,101 +43531,101 @@
             }
           }
         }
       }
     }
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4223
+  /* "fstlib/cext/pywrapfst.pyx":4366
  *   """
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))             # <<<<<<<<<<<<<<
  *   # Threshold is set to semiring Zero (no pruning) if no weight is specified.
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 4223, __pyx_L1_error)
+    __PYX_ERR(0, 4366, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->arc_type(__pyx_v_ifst, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":4225
+  /* "fstlib/cext/pywrapfst.pyx":4368
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   # Threshold is set to semiring Zero (no pruning) if no weight is specified.
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),             # <<<<<<<<<<<<<<
  *                                                           weight)
  *   cdef unique_ptr[fst.ShortestPathOptions] _opts
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "weight_type");
-    __PYX_ERR(0, 4225, __pyx_L1_error)
+    __PYX_ERR(0, 4368, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4226
+  /* "fstlib/cext/pywrapfst.pyx":4369
  *   # Threshold is set to semiring Zero (no pruning) if no weight is specified.
  *   cdef fst.WeightClass _weight = _get_WeightClass_or_zero(ifst.weight_type(),
  *                                                           weight)             # <<<<<<<<<<<<<<
  *   cdef unique_ptr[fst.ShortestPathOptions] _opts
  *   _opts.reset(
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4225, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst__get_WeightClass_or_zero(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->weight_type(__pyx_v_ifst, 0), __pyx_v_weight); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4368, __pyx_L1_error)
   __pyx_v__weight = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":4229
+  /* "fstlib/cext/pywrapfst.pyx":4372
  *   cdef unique_ptr[fst.ShortestPathOptions] _opts
  *   _opts.reset(
  *       new fst.ShortestPathOptions(_get_queue_type(tostring(queue_type)),             # <<<<<<<<<<<<<<
  *                                   nshortest,
  *                                   unique,
  */
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_queue_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4229, __pyx_L1_error)
-  __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst__get_queue_type(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4229, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_queue_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4372, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst__get_queue_type(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4372, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":4228
+  /* "fstlib/cext/pywrapfst.pyx":4371
  *                                                           weight)
  *   cdef unique_ptr[fst.ShortestPathOptions] _opts
  *   _opts.reset(             # <<<<<<<<<<<<<<
  *       new fst.ShortestPathOptions(_get_queue_type(tostring(queue_type)),
  *                                   nshortest,
  */
   __pyx_v__opts.reset(new fst::script::ShortestPathOptions(__pyx_t_3, __pyx_v_nshortest, __pyx_v_unique, __pyx_v_delta, __pyx_v__weight, __pyx_v_nstate));
 
-  /* "fstlib/cext/pywrapfst.pyx":4235
+  /* "fstlib/cext/pywrapfst.pyx":4378
  *                                   _weight,
  *                                   nstate))
  *   fst.ShortestPath(deref(ifst._fst), _tfst.get(), deref(_opts))             # <<<<<<<<<<<<<<
  *   return _init_MutableFst(_tfst.release())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 4235, __pyx_L1_error)
+    __PYX_ERR(0, 4378, __pyx_L1_error)
   }
   fst::script::ShortestPath((*__pyx_v_ifst->_fst), __pyx_v__tfst.get(), (*__pyx_v__opts));
 
-  /* "fstlib/cext/pywrapfst.pyx":4236
+  /* "fstlib/cext/pywrapfst.pyx":4379
  *                                   nstate))
  *   fst.ShortestPath(deref(ifst._fst), _tfst.get(), deref(_opts))
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_4 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4236, __pyx_L1_error)
+  __pyx_t_4 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4379, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_4);
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4185
+  /* "fstlib/cext/pywrapfst.pyx":4328
  * 
  * 
  * cpdef MutableFst shortestpath(Fst ifst,             # <<<<<<<<<<<<<<
  *                               float delta=fst.kShortestDelta,
- *                               int32 nshortest=1,
+ *                               int32_t nshortest=1,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.shortestpath", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
@@ -43077,31 +43637,31 @@
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_57shortestpath(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6fstlib_4cext_9pywrapfst_56shortestpath[] = "\n  shortestpath(ifst, delta=1e-6, nshortest=1, nstate=NO_STATE_ID,\n               queue_type=\"auto\", unique=False, weight=None)\n\n  Construct an FST containing the shortest path(s) in the input FST.\n\n  This operation produces an FST containing the n-shortest paths in the input\n  FST. The n-shortest paths are the n-lowest weight paths w.r.t. the natural\n  semiring order. The single path that can be read from the ith of at most n\n  transitions leaving the initial state of the resulting FST is the ith\n  shortest path. The weights need to be right distributive and have the path\n  property. They also need to be left distributive as well for n-shortest with\n  n > 1 (e.g., TropicalWeight).\n\n  Args:\n    ifst: The input FST.\n    delta: Comparison/quantization delta.\n    nshortest: The number of paths to return.\n    nstate: State number threshold.\n    queue_type: A string matching a known queue type; one of: \"auto\", \"fifo\",\n        \"lifo\", \"shortest\", \"state\", \"top\".\n    unique: Should the resulting FST only contain distinct paths? (Requires\n        the input FST to be an acceptor; epsilons are treated as if they are\n        regular symbols.)\n    weight: A Weight or weight string indicating the desired weight threshold\n        below which paths are pruned; if omitted, no paths are pruned.\n\n  Returns:\n    An FST containing the n-shortest paths.\n  ";
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_57shortestpath(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst = 0;
   float __pyx_v_delta;
-  int32 __pyx_v_nshortest;
-  int64 __pyx_v_nstate;
+  int32_t __pyx_v_nshortest;
+  int64_t __pyx_v_nstate;
   PyObject *__pyx_v_queue_type = 0;
   bool __pyx_v_unique;
   PyObject *__pyx_v_weight = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("shortestpath (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ifst,&__pyx_n_s_delta,&__pyx_n_s_nshortest,&__pyx_n_s_nstate,&__pyx_n_s_queue_type,&__pyx_n_s_unique,&__pyx_n_s_weight,0};
     PyObject* values[7] = {0,0,0,0,0,0,0};
     values[4] = ((PyObject *)__pyx_n_u_auto);
 
-    /* "fstlib/cext/pywrapfst.pyx":4191
+    /* "fstlib/cext/pywrapfst.pyx":4334
  *                               queue_type="auto",
  *                               bool unique=False,
  *                               weight=None):             # <<<<<<<<<<<<<<
  *   """
  *   shortestpath(ifst, delta=1e-6, nshortest=1, nstate=NO_STATE_ID,
  */
     values[6] = ((PyObject *)Py_None);
@@ -43165,15 +43725,15 @@
         case  6:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weight);
           if (value) { values[6] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "shortestpath") < 0)) __PYX_ERR(0, 4185, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "shortestpath") < 0)) __PYX_ERR(0, 4328, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
@@ -43188,73 +43748,73 @@
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     if (values[1]) {
-      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 4186, __pyx_L3_error)
+      __pyx_v_delta = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_delta == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 4329, __pyx_L3_error)
     } else {
-      __pyx_v_delta = __pyx_k__51;
+      __pyx_v_delta = __pyx_k__49;
     }
     if (values[2]) {
-      __pyx_v_nshortest = __Pyx_PyInt_As_int32_t(values[2]); if (unlikely((__pyx_v_nshortest == ((int32)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4187, __pyx_L3_error)
+      __pyx_v_nshortest = __Pyx_PyInt_As_int32_t(values[2]); if (unlikely((__pyx_v_nshortest == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4330, __pyx_L3_error)
     } else {
-      __pyx_v_nshortest = ((int32)1);
+      __pyx_v_nshortest = ((int32_t)1);
     }
     if (values[3]) {
-      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[3]); if (unlikely((__pyx_v_nstate == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4188, __pyx_L3_error)
+      __pyx_v_nstate = __Pyx_PyInt_As_int64_t(values[3]); if (unlikely((__pyx_v_nstate == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4331, __pyx_L3_error)
     } else {
-      __pyx_v_nstate = __pyx_k__52;
+      __pyx_v_nstate = __pyx_k__50;
     }
     __pyx_v_queue_type = values[4];
     if (values[5]) {
-      __pyx_v_unique = __Pyx_PyObject_IsTrue(values[5]); if (unlikely((__pyx_v_unique == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4190, __pyx_L3_error)
+      __pyx_v_unique = __Pyx_PyObject_IsTrue(values[5]); if (unlikely((__pyx_v_unique == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4333, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":4190
- *                               int64 nstate=fst.kNoStateId,
+      /* "fstlib/cext/pywrapfst.pyx":4333
+ *                               int64_t nstate=fst.kNoStateId,
  *                               queue_type="auto",
  *                               bool unique=False,             # <<<<<<<<<<<<<<
  *                               weight=None):
  *   """
  */
       __pyx_v_unique = ((bool)0);
     }
     __pyx_v_weight = values[6];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("shortestpath", 0, 1, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4185, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("shortestpath", 0, 1, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4328, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.shortestpath", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4185, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4328, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_56shortestpath(__pyx_self, __pyx_v_ifst, __pyx_v_delta, __pyx_v_nshortest, __pyx_v_nstate, __pyx_v_queue_type, __pyx_v_unique, __pyx_v_weight);
 
-  /* "fstlib/cext/pywrapfst.pyx":4185
+  /* "fstlib/cext/pywrapfst.pyx":4328
  * 
  * 
  * cpdef MutableFst shortestpath(Fst ifst,             # <<<<<<<<<<<<<<
  *                               float delta=fst.kShortestDelta,
- *                               int32 nshortest=1,
+ *                               int32_t nshortest=1,
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_56shortestpath(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int32 __pyx_v_nshortest, int64 __pyx_v_nstate, PyObject *__pyx_v_queue_type, bool __pyx_v_unique, PyObject *__pyx_v_weight) {
+static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_56shortestpath(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *__pyx_v_ifst, float __pyx_v_delta, int32_t __pyx_v_nshortest, int64_t __pyx_v_nstate, PyObject *__pyx_v_queue_type, bool __pyx_v_unique, PyObject *__pyx_v_weight) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_shortestpath __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
@@ -43263,15 +43823,15 @@
   __pyx_t_2.__pyx_n = 6;
   __pyx_t_2.delta = __pyx_v_delta;
   __pyx_t_2.nshortest = __pyx_v_nshortest;
   __pyx_t_2.nstate = __pyx_v_nstate;
   __pyx_t_2.queue_type = __pyx_v_queue_type;
   __pyx_t_2.unique = __pyx_v_unique;
   __pyx_t_2.weight = __pyx_v_weight;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_shortestpath(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4185, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_shortestpath(__pyx_v_ifst, 0, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4328, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -43280,15 +43840,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4239
+/* "fstlib/cext/pywrapfst.pyx":4382
  * 
  * 
  * cpdef Fst statemap(Fst ifst, map_type):             # <<<<<<<<<<<<<<
  *   """
  *   state_map(ifst, map_type)
  */
 
@@ -43299,34 +43859,34 @@
   PyObject *__pyx_t_1 = NULL;
   struct __pyx_opt_args_6fstlib_4cext_9pywrapfst__map __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("statemap", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4262
+  /* "fstlib/cext/pywrapfst.pyx":4405
  *     FstArgError: Unknown map type.
  *   """
  *   return _map(ifst, fst.kDelta, map_type, 1., None)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __pyx_t_2.__pyx_n = 4;
   __pyx_t_2.delta = fst::kDelta;
   __pyx_t_2.map_type = __pyx_v_map_type;
   __pyx_t_2.power = 1.;
   __pyx_t_2.weight = Py_None;
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__map(__pyx_v_ifst, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4262, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__map(__pyx_v_ifst, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4405, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4239
+  /* "fstlib/cext/pywrapfst.pyx":4382
  * 
  * 
  * cpdef Fst statemap(Fst ifst, map_type):             # <<<<<<<<<<<<<<
  *   """
  *   state_map(ifst, map_type)
  */
 
@@ -43372,38 +43932,38 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_map_type)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("statemap", 1, 2, 2, 1); __PYX_ERR(0, 4239, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("statemap", 1, 2, 2, 1); __PYX_ERR(0, 4382, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "statemap") < 0)) __PYX_ERR(0, 4239, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "statemap") < 0)) __PYX_ERR(0, 4382, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[0]);
     __pyx_v_map_type = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("statemap", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4239, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("statemap", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4382, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.statemap", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4239, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4382, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_58statemap(__pyx_self, __pyx_v_ifst, __pyx_v_map_type);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -43416,15 +43976,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("statemap", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_statemap(__pyx_v_ifst, __pyx_v_map_type, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4239, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_statemap(__pyx_v_ifst, __pyx_v_map_type, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4382, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -43433,15 +43993,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4265
+/* "fstlib/cext/pywrapfst.pyx":4408
  * 
  * 
  * cpdef MutableFst synchronize(Fst ifst):             # <<<<<<<<<<<<<<
  *   """
  *   synchronize(ifst)
  */
 
@@ -43452,55 +44012,55 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("synchronize", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4285
+  /* "fstlib/cext/pywrapfst.pyx":4428
  *   """
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))             # <<<<<<<<<<<<<<
  *   fst.Synchronize(deref(ifst._fst), _tfst.get())
  *   return _init_MutableFst(_tfst.release())
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "arc_type");
-    __PYX_ERR(0, 4285, __pyx_L1_error)
+    __PYX_ERR(0, 4428, __pyx_L1_error)
   }
   __pyx_v__tfst.reset(new fst::script::VectorFstClass(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst->__pyx_vtab)->arc_type(__pyx_v_ifst, 0)));
 
-  /* "fstlib/cext/pywrapfst.pyx":4286
+  /* "fstlib/cext/pywrapfst.pyx":4429
  *   cdef unique_ptr[fst.VectorFstClass] _tfst
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   fst.Synchronize(deref(ifst._fst), _tfst.get())             # <<<<<<<<<<<<<<
  *   return _init_MutableFst(_tfst.release())
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 4286, __pyx_L1_error)
+    __PYX_ERR(0, 4429, __pyx_L1_error)
   }
   fst::script::Synchronize((*__pyx_v_ifst->_fst), __pyx_v__tfst.get());
 
-  /* "fstlib/cext/pywrapfst.pyx":4287
+  /* "fstlib/cext/pywrapfst.pyx":4430
  *   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
  *   fst.Synchronize(deref(ifst._fst), _tfst.get())
  *   return _init_MutableFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4287, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_MutableFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4430, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4265
+  /* "fstlib/cext/pywrapfst.pyx":4408
  * 
  * 
  * cpdef MutableFst synchronize(Fst ifst):             # <<<<<<<<<<<<<<
  *   """
  *   synchronize(ifst)
  */
 
@@ -43521,15 +44081,15 @@
 static PyObject *__pyx_pw_6fstlib_4cext_9pywrapfst_61synchronize(PyObject *__pyx_self, PyObject *__pyx_v_ifst) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("synchronize (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4265, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4408, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_60synchronize(__pyx_self, ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_ifst));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -43542,15 +44102,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("synchronize", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_synchronize(__pyx_v_ifst, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4265, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_synchronize(__pyx_v_ifst, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4408, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -43559,15 +44119,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4344
+/* "fstlib/cext/pywrapfst.pyx":4487
  *   """
  * 
  *   def __cinit__(self,             # <<<<<<<<<<<<<<
  *                 str fst_type="vector",
  *                 str arc_type="standard",
  */
 
@@ -43592,33 +44152,33 @@
   __Pyx_RefNannySetupContext("__cinit__ (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_fst_type,&__pyx_n_s_arc_type,&__pyx_n_s_isymbols,&__pyx_n_s_osymbols,&__pyx_n_s_ssymbols,&__pyx_n_s_acceptor,&__pyx_n_s_keep_isymbols,&__pyx_n_s_keep_osymbols,&__pyx_n_s_keep_state_numbering,&__pyx_n_s_allow_negative_labels,0};
     PyObject* values[10] = {0,0,0,0,0,0,0,0,0,0};
     values[0] = ((PyObject*)__pyx_n_u_vector);
     values[1] = ((PyObject*)__pyx_n_u_standard);
 
-    /* "fstlib/cext/pywrapfst.pyx":4347
+    /* "fstlib/cext/pywrapfst.pyx":4490
  *                 str fst_type="vector",
  *                 str arc_type="standard",
  *                 SymbolTable isymbols=None,             # <<<<<<<<<<<<<<
  *                 SymbolTable osymbols=None,
  *                 SymbolTable ssymbols=None,
  */
     values[2] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)Py_None);
 
-    /* "fstlib/cext/pywrapfst.pyx":4348
+    /* "fstlib/cext/pywrapfst.pyx":4491
  *                 str arc_type="standard",
  *                 SymbolTable isymbols=None,
  *                 SymbolTable osymbols=None,             # <<<<<<<<<<<<<<
  *                 SymbolTable ssymbols=None,
  *                 bool acceptor=False,
  */
     values[3] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)Py_None);
 
-    /* "fstlib/cext/pywrapfst.pyx":4349
+    /* "fstlib/cext/pywrapfst.pyx":4492
  *                 SymbolTable isymbols=None,
  *                 SymbolTable osymbols=None,
  *                 SymbolTable ssymbols=None,             # <<<<<<<<<<<<<<
  *                 bool acceptor=False,
  *                 bool keep_isymbols=False,
  */
     values[4] = (PyObject *)((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)Py_None);
@@ -43708,15 +44268,15 @@
         case  9:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_allow_negative_labels);
           if (value) { values[9] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(0, 4344, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(0, 4487, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
         CYTHON_FALLTHROUGH;
         case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
         CYTHON_FALLTHROUGH;
@@ -43742,95 +44302,95 @@
     }
     __pyx_v_fst_type = ((PyObject*)values[0]);
     __pyx_v_arc_type = ((PyObject*)values[1]);
     __pyx_v_isymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)values[2]);
     __pyx_v_osymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)values[3]);
     __pyx_v_ssymbols = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *)values[4]);
     if (values[5]) {
-      __pyx_v_acceptor = __Pyx_PyObject_IsTrue(values[5]); if (unlikely((__pyx_v_acceptor == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4350, __pyx_L3_error)
+      __pyx_v_acceptor = __Pyx_PyObject_IsTrue(values[5]); if (unlikely((__pyx_v_acceptor == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4493, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":4350
+      /* "fstlib/cext/pywrapfst.pyx":4493
  *                 SymbolTable osymbols=None,
  *                 SymbolTable ssymbols=None,
  *                 bool acceptor=False,             # <<<<<<<<<<<<<<
  *                 bool keep_isymbols=False,
  *                 bool keep_osymbols=False,
  */
       __pyx_v_acceptor = ((bool)0);
     }
     if (values[6]) {
-      __pyx_v_keep_isymbols = __Pyx_PyObject_IsTrue(values[6]); if (unlikely((__pyx_v_keep_isymbols == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4351, __pyx_L3_error)
+      __pyx_v_keep_isymbols = __Pyx_PyObject_IsTrue(values[6]); if (unlikely((__pyx_v_keep_isymbols == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4494, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":4351
+      /* "fstlib/cext/pywrapfst.pyx":4494
  *                 SymbolTable ssymbols=None,
  *                 bool acceptor=False,
  *                 bool keep_isymbols=False,             # <<<<<<<<<<<<<<
  *                 bool keep_osymbols=False,
  *                 bool keep_state_numbering=False,
  */
       __pyx_v_keep_isymbols = ((bool)0);
     }
     if (values[7]) {
-      __pyx_v_keep_osymbols = __Pyx_PyObject_IsTrue(values[7]); if (unlikely((__pyx_v_keep_osymbols == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4352, __pyx_L3_error)
+      __pyx_v_keep_osymbols = __Pyx_PyObject_IsTrue(values[7]); if (unlikely((__pyx_v_keep_osymbols == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4495, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":4352
+      /* "fstlib/cext/pywrapfst.pyx":4495
  *                 bool acceptor=False,
  *                 bool keep_isymbols=False,
  *                 bool keep_osymbols=False,             # <<<<<<<<<<<<<<
  *                 bool keep_state_numbering=False,
  *                 bool allow_negative_labels=False):
  */
       __pyx_v_keep_osymbols = ((bool)0);
     }
     if (values[8]) {
-      __pyx_v_keep_state_numbering = __Pyx_PyObject_IsTrue(values[8]); if (unlikely((__pyx_v_keep_state_numbering == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4353, __pyx_L3_error)
+      __pyx_v_keep_state_numbering = __Pyx_PyObject_IsTrue(values[8]); if (unlikely((__pyx_v_keep_state_numbering == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4496, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":4353
+      /* "fstlib/cext/pywrapfst.pyx":4496
  *                 bool keep_isymbols=False,
  *                 bool keep_osymbols=False,
  *                 bool keep_state_numbering=False,             # <<<<<<<<<<<<<<
  *                 bool allow_negative_labels=False):
  *     self._sstrm.reset(new stringstream())
  */
       __pyx_v_keep_state_numbering = ((bool)0);
     }
     if (values[9]) {
-      __pyx_v_allow_negative_labels = __Pyx_PyObject_IsTrue(values[9]); if (unlikely((__pyx_v_allow_negative_labels == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4354, __pyx_L3_error)
+      __pyx_v_allow_negative_labels = __Pyx_PyObject_IsTrue(values[9]); if (unlikely((__pyx_v_allow_negative_labels == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4497, __pyx_L3_error)
     } else {
 
-      /* "fstlib/cext/pywrapfst.pyx":4354
+      /* "fstlib/cext/pywrapfst.pyx":4497
  *                 bool keep_osymbols=False,
  *                 bool keep_state_numbering=False,
  *                 bool allow_negative_labels=False):             # <<<<<<<<<<<<<<
  *     self._sstrm.reset(new stringstream())
  *     self._fst_type = tostring(fst_type)
  */
       __pyx_v_allow_negative_labels = ((bool)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 0, 10, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4344, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 0, 10, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4487, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Compiler.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_fst_type), (&PyUnicode_Type), 1, "fst_type", 1))) __PYX_ERR(0, 4345, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arc_type), (&PyUnicode_Type), 1, "arc_type", 1))) __PYX_ERR(0, 4346, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_isymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, 1, "isymbols", 0))) __PYX_ERR(0, 4347, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_osymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, 1, "osymbols", 0))) __PYX_ERR(0, 4348, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ssymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, 1, "ssymbols", 0))) __PYX_ERR(0, 4349, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_fst_type), (&PyUnicode_Type), 1, "fst_type", 1))) __PYX_ERR(0, 4488, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arc_type), (&PyUnicode_Type), 1, "arc_type", 1))) __PYX_ERR(0, 4489, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_isymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, 1, "isymbols", 0))) __PYX_ERR(0, 4490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_osymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, 1, "osymbols", 0))) __PYX_ERR(0, 4491, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ssymbols), __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, 1, "ssymbols", 0))) __PYX_ERR(0, 4492, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_8Compiler___cinit__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *)__pyx_v_self), __pyx_v_fst_type, __pyx_v_arc_type, __pyx_v_isymbols, __pyx_v_osymbols, __pyx_v_ssymbols, __pyx_v_acceptor, __pyx_v_keep_isymbols, __pyx_v_keep_osymbols, __pyx_v_keep_state_numbering, __pyx_v_allow_negative_labels);
 
-  /* "fstlib/cext/pywrapfst.pyx":4344
+  /* "fstlib/cext/pywrapfst.pyx":4487
  *   """
  * 
  *   def __cinit__(self,             # <<<<<<<<<<<<<<
  *                 str fst_type="vector",
  *                 str arc_type="standard",
  */
 
@@ -43851,274 +44411,274 @@
   int __pyx_t_3;
   fst::SymbolTable const *__pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__cinit__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4355
+  /* "fstlib/cext/pywrapfst.pyx":4498
  *                 bool keep_state_numbering=False,
  *                 bool allow_negative_labels=False):
  *     self._sstrm.reset(new stringstream())             # <<<<<<<<<<<<<<
  *     self._fst_type = tostring(fst_type)
  *     self._arc_type = tostring(arc_type)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_sstrm");
-    __PYX_ERR(0, 4355, __pyx_L1_error)
+    __PYX_ERR(0, 4498, __pyx_L1_error)
   }
   __pyx_v_self->_sstrm.reset(new std::stringstream());
 
-  /* "fstlib/cext/pywrapfst.pyx":4356
+  /* "fstlib/cext/pywrapfst.pyx":4499
  *                 bool allow_negative_labels=False):
  *     self._sstrm.reset(new stringstream())
  *     self._fst_type = tostring(fst_type)             # <<<<<<<<<<<<<<
  *     self._arc_type = tostring(arc_type)
  *     self._isymbols = NULL
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_fst_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4356, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_fst_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4499, __pyx_L1_error)
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst_type");
-    __PYX_ERR(0, 4356, __pyx_L1_error)
+    __PYX_ERR(0, 4499, __pyx_L1_error)
   }
   __pyx_v_self->_fst_type = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":4357
+  /* "fstlib/cext/pywrapfst.pyx":4500
  *     self._sstrm.reset(new stringstream())
  *     self._fst_type = tostring(fst_type)
  *     self._arc_type = tostring(arc_type)             # <<<<<<<<<<<<<<
  *     self._isymbols = NULL
  *     if isymbols is not None:
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_arc_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4357, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_arc_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4500, __pyx_L1_error)
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc_type");
-    __PYX_ERR(0, 4357, __pyx_L1_error)
+    __PYX_ERR(0, 4500, __pyx_L1_error)
   }
   __pyx_v_self->_arc_type = __pyx_t_1;
 
-  /* "fstlib/cext/pywrapfst.pyx":4358
+  /* "fstlib/cext/pywrapfst.pyx":4501
  *     self._fst_type = tostring(fst_type)
  *     self._arc_type = tostring(arc_type)
  *     self._isymbols = NULL             # <<<<<<<<<<<<<<
  *     if isymbols is not None:
  *       self._isymbols = isymbols._raw_ptr_or_raise()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_isymbols");
-    __PYX_ERR(0, 4358, __pyx_L1_error)
+    __PYX_ERR(0, 4501, __pyx_L1_error)
   }
   __pyx_v_self->_isymbols = NULL;
 
-  /* "fstlib/cext/pywrapfst.pyx":4359
+  /* "fstlib/cext/pywrapfst.pyx":4502
  *     self._arc_type = tostring(arc_type)
  *     self._isymbols = NULL
  *     if isymbols is not None:             # <<<<<<<<<<<<<<
  *       self._isymbols = isymbols._raw_ptr_or_raise()
  *     self._osymbols = NULL
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_isymbols) != Py_None);
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4360
+    /* "fstlib/cext/pywrapfst.pyx":4503
  *     self._isymbols = NULL
  *     if isymbols is not None:
  *       self._isymbols = isymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     self._osymbols = NULL
  *     if osymbols is not None:
  */
     if (unlikely(((PyObject *)__pyx_v_isymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 4360, __pyx_L1_error)
+      __PYX_ERR(0, 4503, __pyx_L1_error)
     }
-    __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_v_isymbols->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.__pyx_base._raw_ptr_or_raise(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_isymbols)); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4360, __pyx_L1_error)
+    __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_v_isymbols->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.__pyx_base._raw_ptr_or_raise(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_isymbols)); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4503, __pyx_L1_error)
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_isymbols");
-      __PYX_ERR(0, 4360, __pyx_L1_error)
+      __PYX_ERR(0, 4503, __pyx_L1_error)
     }
     __pyx_v_self->_isymbols = __pyx_t_4;
 
-    /* "fstlib/cext/pywrapfst.pyx":4359
+    /* "fstlib/cext/pywrapfst.pyx":4502
  *     self._arc_type = tostring(arc_type)
  *     self._isymbols = NULL
  *     if isymbols is not None:             # <<<<<<<<<<<<<<
  *       self._isymbols = isymbols._raw_ptr_or_raise()
  *     self._osymbols = NULL
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4361
+  /* "fstlib/cext/pywrapfst.pyx":4504
  *     if isymbols is not None:
  *       self._isymbols = isymbols._raw_ptr_or_raise()
  *     self._osymbols = NULL             # <<<<<<<<<<<<<<
  *     if osymbols is not None:
  *       self._osymbols = osymbols._raw_ptr_or_raise()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_osymbols");
-    __PYX_ERR(0, 4361, __pyx_L1_error)
+    __PYX_ERR(0, 4504, __pyx_L1_error)
   }
   __pyx_v_self->_osymbols = NULL;
 
-  /* "fstlib/cext/pywrapfst.pyx":4362
+  /* "fstlib/cext/pywrapfst.pyx":4505
  *       self._isymbols = isymbols._raw_ptr_or_raise()
  *     self._osymbols = NULL
  *     if osymbols is not None:             # <<<<<<<<<<<<<<
  *       self._osymbols = osymbols._raw_ptr_or_raise()
  *     self._ssymbols = NULL
  */
   __pyx_t_3 = (((PyObject *)__pyx_v_osymbols) != Py_None);
   __pyx_t_2 = (__pyx_t_3 != 0);
   if (__pyx_t_2) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4363
+    /* "fstlib/cext/pywrapfst.pyx":4506
  *     self._osymbols = NULL
  *     if osymbols is not None:
  *       self._osymbols = osymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     self._ssymbols = NULL
  *     if ssymbols is not None:
  */
     if (unlikely(((PyObject *)__pyx_v_osymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 4363, __pyx_L1_error)
+      __PYX_ERR(0, 4506, __pyx_L1_error)
     }
-    __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_v_osymbols->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.__pyx_base._raw_ptr_or_raise(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_osymbols)); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4363, __pyx_L1_error)
+    __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_v_osymbols->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.__pyx_base._raw_ptr_or_raise(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_osymbols)); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4506, __pyx_L1_error)
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_osymbols");
-      __PYX_ERR(0, 4363, __pyx_L1_error)
+      __PYX_ERR(0, 4506, __pyx_L1_error)
     }
     __pyx_v_self->_osymbols = __pyx_t_4;
 
-    /* "fstlib/cext/pywrapfst.pyx":4362
+    /* "fstlib/cext/pywrapfst.pyx":4505
  *       self._isymbols = isymbols._raw_ptr_or_raise()
  *     self._osymbols = NULL
  *     if osymbols is not None:             # <<<<<<<<<<<<<<
  *       self._osymbols = osymbols._raw_ptr_or_raise()
  *     self._ssymbols = NULL
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4364
+  /* "fstlib/cext/pywrapfst.pyx":4507
  *     if osymbols is not None:
  *       self._osymbols = osymbols._raw_ptr_or_raise()
  *     self._ssymbols = NULL             # <<<<<<<<<<<<<<
  *     if ssymbols is not None:
  *       self._ssymbols = ssymbols._raw_ptr_or_raise()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_ssymbols");
-    __PYX_ERR(0, 4364, __pyx_L1_error)
+    __PYX_ERR(0, 4507, __pyx_L1_error)
   }
   __pyx_v_self->_ssymbols = NULL;
 
-  /* "fstlib/cext/pywrapfst.pyx":4365
+  /* "fstlib/cext/pywrapfst.pyx":4508
  *       self._osymbols = osymbols._raw_ptr_or_raise()
  *     self._ssymbols = NULL
  *     if ssymbols is not None:             # <<<<<<<<<<<<<<
  *       self._ssymbols = ssymbols._raw_ptr_or_raise()
  *     self._acceptor = acceptor
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_ssymbols) != Py_None);
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4366
+    /* "fstlib/cext/pywrapfst.pyx":4509
  *     self._ssymbols = NULL
  *     if ssymbols is not None:
  *       self._ssymbols = ssymbols._raw_ptr_or_raise()             # <<<<<<<<<<<<<<
  *     self._acceptor = acceptor
  *     self._keep_isymbols = keep_isymbols
  */
     if (unlikely(((PyObject *)__pyx_v_ssymbols) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_raw_ptr_or_raise");
-      __PYX_ERR(0, 4366, __pyx_L1_error)
+      __PYX_ERR(0, 4509, __pyx_L1_error)
     }
-    __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_v_ssymbols->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.__pyx_base._raw_ptr_or_raise(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_ssymbols)); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4366, __pyx_L1_error)
+    __pyx_t_4 = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_SymbolTable *)__pyx_v_ssymbols->__pyx_base.__pyx_base.__pyx_vtab)->__pyx_base.__pyx_base._raw_ptr_or_raise(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *)__pyx_v_ssymbols)); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4509, __pyx_L1_error)
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_ssymbols");
-      __PYX_ERR(0, 4366, __pyx_L1_error)
+      __PYX_ERR(0, 4509, __pyx_L1_error)
     }
     __pyx_v_self->_ssymbols = __pyx_t_4;
 
-    /* "fstlib/cext/pywrapfst.pyx":4365
+    /* "fstlib/cext/pywrapfst.pyx":4508
  *       self._osymbols = osymbols._raw_ptr_or_raise()
  *     self._ssymbols = NULL
  *     if ssymbols is not None:             # <<<<<<<<<<<<<<
  *       self._ssymbols = ssymbols._raw_ptr_or_raise()
  *     self._acceptor = acceptor
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4367
+  /* "fstlib/cext/pywrapfst.pyx":4510
  *     if ssymbols is not None:
  *       self._ssymbols = ssymbols._raw_ptr_or_raise()
  *     self._acceptor = acceptor             # <<<<<<<<<<<<<<
  *     self._keep_isymbols = keep_isymbols
  *     self._keep_osymbols = keep_osymbols
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_acceptor");
-    __PYX_ERR(0, 4367, __pyx_L1_error)
+    __PYX_ERR(0, 4510, __pyx_L1_error)
   }
   __pyx_v_self->_acceptor = __pyx_v_acceptor;
 
-  /* "fstlib/cext/pywrapfst.pyx":4368
+  /* "fstlib/cext/pywrapfst.pyx":4511
  *       self._ssymbols = ssymbols._raw_ptr_or_raise()
  *     self._acceptor = acceptor
  *     self._keep_isymbols = keep_isymbols             # <<<<<<<<<<<<<<
  *     self._keep_osymbols = keep_osymbols
  *     self._keep_state_numbering = keep_state_numbering
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_keep_isymbols");
-    __PYX_ERR(0, 4368, __pyx_L1_error)
+    __PYX_ERR(0, 4511, __pyx_L1_error)
   }
   __pyx_v_self->_keep_isymbols = __pyx_v_keep_isymbols;
 
-  /* "fstlib/cext/pywrapfst.pyx":4369
+  /* "fstlib/cext/pywrapfst.pyx":4512
  *     self._acceptor = acceptor
  *     self._keep_isymbols = keep_isymbols
  *     self._keep_osymbols = keep_osymbols             # <<<<<<<<<<<<<<
  *     self._keep_state_numbering = keep_state_numbering
  *     self._allow_negative_labels = allow_negative_labels
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_keep_osymbols");
-    __PYX_ERR(0, 4369, __pyx_L1_error)
+    __PYX_ERR(0, 4512, __pyx_L1_error)
   }
   __pyx_v_self->_keep_osymbols = __pyx_v_keep_osymbols;
 
-  /* "fstlib/cext/pywrapfst.pyx":4370
+  /* "fstlib/cext/pywrapfst.pyx":4513
  *     self._keep_isymbols = keep_isymbols
  *     self._keep_osymbols = keep_osymbols
  *     self._keep_state_numbering = keep_state_numbering             # <<<<<<<<<<<<<<
  *     self._allow_negative_labels = allow_negative_labels
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_keep_state_numbering");
-    __PYX_ERR(0, 4370, __pyx_L1_error)
+    __PYX_ERR(0, 4513, __pyx_L1_error)
   }
   __pyx_v_self->_keep_state_numbering = __pyx_v_keep_state_numbering;
 
-  /* "fstlib/cext/pywrapfst.pyx":4371
+  /* "fstlib/cext/pywrapfst.pyx":4514
  *     self._keep_osymbols = keep_osymbols
  *     self._keep_state_numbering = keep_state_numbering
  *     self._allow_negative_labels = allow_negative_labels             # <<<<<<<<<<<<<<
  * 
  *   cpdef Fst compile(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_allow_negative_labels");
-    __PYX_ERR(0, 4371, __pyx_L1_error)
+    __PYX_ERR(0, 4514, __pyx_L1_error)
   }
   __pyx_v_self->_allow_negative_labels = __pyx_v_allow_negative_labels;
 
-  /* "fstlib/cext/pywrapfst.pyx":4344
+  /* "fstlib/cext/pywrapfst.pyx":4487
  *   """
  * 
  *   def __cinit__(self,             # <<<<<<<<<<<<<<
  *                 str fst_type="vector",
  *                 str arc_type="standard",
  */
 
@@ -44129,15 +44689,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Compiler.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4373
+/* "fstlib/cext/pywrapfst.pyx":4516
  *     self._allow_negative_labels = allow_negative_labels
  * 
  *   cpdef Fst compile(self):             # <<<<<<<<<<<<<<
  *     """
  *     compile()
  */
 
@@ -44160,15 +44720,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_compile); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4373, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_compile); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4516, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_8Compiler_3compile)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -44177,18 +44737,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4373, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4516, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst))))) __PYX_ERR(0, 4373, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst))))) __PYX_ERR(0, 4516, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -44199,230 +44759,230 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4388
+  /* "fstlib/cext/pywrapfst.pyx":4531
  *     """
  *     cdef unique_ptr[fst.FstClass] _tfst
- *     _tfst = fst.CompileFstInternal(deref(self._sstrm),             # <<<<<<<<<<<<<<
- *                                    b"<pywrapfst>",
- *                                    self._fst_type,
+ *     _tfst = fst.CompileInternal(deref(self._sstrm),             # <<<<<<<<<<<<<<
+ *                                 b"<pywrapfst>",
+ *                                 self._fst_type,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_sstrm");
-    __PYX_ERR(0, 4388, __pyx_L1_error)
+    __PYX_ERR(0, 4531, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4390
- *     _tfst = fst.CompileFstInternal(deref(self._sstrm),
- *                                    b"<pywrapfst>",
- *                                    self._fst_type,             # <<<<<<<<<<<<<<
- *                                    self._arc_type,
- *                                    self._isymbols,
+  /* "fstlib/cext/pywrapfst.pyx":4533
+ *     _tfst = fst.CompileInternal(deref(self._sstrm),
+ *                                 b"<pywrapfst>",
+ *                                 self._fst_type,             # <<<<<<<<<<<<<<
+ *                                 self._arc_type,
+ *                                 self._isymbols,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst_type");
-    __PYX_ERR(0, 4390, __pyx_L1_error)
+    __PYX_ERR(0, 4533, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4391
- *                                    b"<pywrapfst>",
- *                                    self._fst_type,
- *                                    self._arc_type,             # <<<<<<<<<<<<<<
- *                                    self._isymbols,
- *                                    self._osymbols,
+  /* "fstlib/cext/pywrapfst.pyx":4534
+ *                                 b"<pywrapfst>",
+ *                                 self._fst_type,
+ *                                 self._arc_type,             # <<<<<<<<<<<<<<
+ *                                 self._isymbols,
+ *                                 self._osymbols,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_arc_type");
-    __PYX_ERR(0, 4391, __pyx_L1_error)
+    __PYX_ERR(0, 4534, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4392
- *                                    self._fst_type,
- *                                    self._arc_type,
- *                                    self._isymbols,             # <<<<<<<<<<<<<<
- *                                    self._osymbols,
- *                                    self._ssymbols,
+  /* "fstlib/cext/pywrapfst.pyx":4535
+ *                                 self._fst_type,
+ *                                 self._arc_type,
+ *                                 self._isymbols,             # <<<<<<<<<<<<<<
+ *                                 self._osymbols,
+ *                                 self._ssymbols,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_isymbols");
-    __PYX_ERR(0, 4392, __pyx_L1_error)
+    __PYX_ERR(0, 4535, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4393
- *                                    self._arc_type,
- *                                    self._isymbols,
- *                                    self._osymbols,             # <<<<<<<<<<<<<<
- *                                    self._ssymbols,
- *                                    self._acceptor,
+  /* "fstlib/cext/pywrapfst.pyx":4536
+ *                                 self._arc_type,
+ *                                 self._isymbols,
+ *                                 self._osymbols,             # <<<<<<<<<<<<<<
+ *                                 self._ssymbols,
+ *                                 self._acceptor,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_osymbols");
-    __PYX_ERR(0, 4393, __pyx_L1_error)
+    __PYX_ERR(0, 4536, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4394
- *                                    self._isymbols,
- *                                    self._osymbols,
- *                                    self._ssymbols,             # <<<<<<<<<<<<<<
- *                                    self._acceptor,
- *                                    self._keep_isymbols,
+  /* "fstlib/cext/pywrapfst.pyx":4537
+ *                                 self._isymbols,
+ *                                 self._osymbols,
+ *                                 self._ssymbols,             # <<<<<<<<<<<<<<
+ *                                 self._acceptor,
+ *                                 self._keep_isymbols,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_ssymbols");
-    __PYX_ERR(0, 4394, __pyx_L1_error)
+    __PYX_ERR(0, 4537, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4395
- *                                    self._osymbols,
- *                                    self._ssymbols,
- *                                    self._acceptor,             # <<<<<<<<<<<<<<
- *                                    self._keep_isymbols,
- *                                    self._keep_osymbols,
+  /* "fstlib/cext/pywrapfst.pyx":4538
+ *                                 self._osymbols,
+ *                                 self._ssymbols,
+ *                                 self._acceptor,             # <<<<<<<<<<<<<<
+ *                                 self._keep_isymbols,
+ *                                 self._keep_osymbols,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_acceptor");
-    __PYX_ERR(0, 4395, __pyx_L1_error)
+    __PYX_ERR(0, 4538, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4396
- *                                    self._ssymbols,
- *                                    self._acceptor,
- *                                    self._keep_isymbols,             # <<<<<<<<<<<<<<
- *                                    self._keep_osymbols,
- *                                    self._keep_state_numbering,
+  /* "fstlib/cext/pywrapfst.pyx":4539
+ *                                 self._ssymbols,
+ *                                 self._acceptor,
+ *                                 self._keep_isymbols,             # <<<<<<<<<<<<<<
+ *                                 self._keep_osymbols,
+ *                                 self._keep_state_numbering,
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_keep_isymbols");
-    __PYX_ERR(0, 4396, __pyx_L1_error)
+    __PYX_ERR(0, 4539, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4397
- *                                    self._acceptor,
- *                                    self._keep_isymbols,
- *                                    self._keep_osymbols,             # <<<<<<<<<<<<<<
- *                                    self._keep_state_numbering,
- *                                    self._allow_negative_labels)
+  /* "fstlib/cext/pywrapfst.pyx":4540
+ *                                 self._acceptor,
+ *                                 self._keep_isymbols,
+ *                                 self._keep_osymbols,             # <<<<<<<<<<<<<<
+ *                                 self._keep_state_numbering,
+ *                                 self._allow_negative_labels)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_keep_osymbols");
-    __PYX_ERR(0, 4397, __pyx_L1_error)
+    __PYX_ERR(0, 4540, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4398
- *                                    self._keep_isymbols,
- *                                    self._keep_osymbols,
- *                                    self._keep_state_numbering,             # <<<<<<<<<<<<<<
- *                                    self._allow_negative_labels)
+  /* "fstlib/cext/pywrapfst.pyx":4541
+ *                                 self._keep_isymbols,
+ *                                 self._keep_osymbols,
+ *                                 self._keep_state_numbering,             # <<<<<<<<<<<<<<
+ *                                 self._allow_negative_labels)
  *     self._sstrm.reset(new stringstream())
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_keep_state_numbering");
-    __PYX_ERR(0, 4398, __pyx_L1_error)
+    __PYX_ERR(0, 4541, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4399
- *                                    self._keep_osymbols,
- *                                    self._keep_state_numbering,
- *                                    self._allow_negative_labels)             # <<<<<<<<<<<<<<
+  /* "fstlib/cext/pywrapfst.pyx":4542
+ *                                 self._keep_osymbols,
+ *                                 self._keep_state_numbering,
+ *                                 self._allow_negative_labels)             # <<<<<<<<<<<<<<
  *     self._sstrm.reset(new stringstream())
  *     if _tfst.get() == NULL:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_allow_negative_labels");
-    __PYX_ERR(0, 4399, __pyx_L1_error)
+    __PYX_ERR(0, 4542, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4388
+  /* "fstlib/cext/pywrapfst.pyx":4531
  *     """
  *     cdef unique_ptr[fst.FstClass] _tfst
- *     _tfst = fst.CompileFstInternal(deref(self._sstrm),             # <<<<<<<<<<<<<<
- *                                    b"<pywrapfst>",
- *                                    self._fst_type,
- */
-  __pyx_v__tfst = fst::script::CompileFstInternal((*__pyx_v_self->_sstrm), __pyx_k_pywrapfst, __pyx_v_self->_fst_type, __pyx_v_self->_arc_type, __pyx_v_self->_isymbols, __pyx_v_self->_osymbols, __pyx_v_self->_ssymbols, __pyx_v_self->_acceptor, __pyx_v_self->_keep_isymbols, __pyx_v_self->_keep_osymbols, __pyx_v_self->_keep_state_numbering, __pyx_v_self->_allow_negative_labels);
-
-  /* "fstlib/cext/pywrapfst.pyx":4400
- *                                    self._keep_state_numbering,
- *                                    self._allow_negative_labels)
+ *     _tfst = fst.CompileInternal(deref(self._sstrm),             # <<<<<<<<<<<<<<
+ *                                 b"<pywrapfst>",
+ *                                 self._fst_type,
+ */
+  __pyx_v__tfst = fst::script::CompileInternal((*__pyx_v_self->_sstrm), __pyx_k_pywrapfst, __pyx_v_self->_fst_type, __pyx_v_self->_arc_type, __pyx_v_self->_isymbols, __pyx_v_self->_osymbols, __pyx_v_self->_ssymbols, __pyx_v_self->_acceptor, __pyx_v_self->_keep_isymbols, __pyx_v_self->_keep_osymbols, __pyx_v_self->_keep_state_numbering, __pyx_v_self->_allow_negative_labels);
+
+  /* "fstlib/cext/pywrapfst.pyx":4543
+ *                                 self._keep_state_numbering,
+ *                                 self._allow_negative_labels)
  *     self._sstrm.reset(new stringstream())             # <<<<<<<<<<<<<<
  *     if _tfst.get() == NULL:
  *       raise FstOpError("Compilation failed")
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_sstrm");
-    __PYX_ERR(0, 4400, __pyx_L1_error)
+    __PYX_ERR(0, 4543, __pyx_L1_error)
   }
   __pyx_v_self->_sstrm.reset(new std::stringstream());
 
-  /* "fstlib/cext/pywrapfst.pyx":4401
- *                                    self._allow_negative_labels)
+  /* "fstlib/cext/pywrapfst.pyx":4544
+ *                                 self._allow_negative_labels)
  *     self._sstrm.reset(new stringstream())
  *     if _tfst.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstOpError("Compilation failed")
  *     return _init_XFst(_tfst.release())
  */
   __pyx_t_5 = ((__pyx_v__tfst.get() == NULL) != 0);
   if (unlikely(__pyx_t_5)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4402
+    /* "fstlib/cext/pywrapfst.pyx":4545
  *     self._sstrm.reset(new stringstream())
  *     if _tfst.get() == NULL:
  *       raise FstOpError("Compilation failed")             # <<<<<<<<<<<<<<
  *     return _init_XFst(_tfst.release())
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4402, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4545, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_kp_u_Compilation_failed) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_Compilation_failed);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4402, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4545, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 4402, __pyx_L1_error)
+    __PYX_ERR(0, 4545, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":4401
- *                                    self._allow_negative_labels)
+    /* "fstlib/cext/pywrapfst.pyx":4544
+ *                                 self._allow_negative_labels)
  *     self._sstrm.reset(new stringstream())
  *     if _tfst.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstOpError("Compilation failed")
  *     return _init_XFst(_tfst.release())
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4403
+  /* "fstlib/cext/pywrapfst.pyx":4546
  *     if _tfst.get() == NULL:
  *       raise FstOpError("Compilation failed")
  *     return _init_XFst(_tfst.release())             # <<<<<<<<<<<<<<
  * 
  *   cpdef void write(self, expression):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4403, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(__pyx_v__tfst.release())); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4373
+  /* "fstlib/cext/pywrapfst.pyx":4516
  *     self._allow_negative_labels = allow_negative_labels
  * 
  *   cpdef Fst compile(self):             # <<<<<<<<<<<<<<
  *     """
  *     compile()
  */
 
@@ -44459,15 +45019,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("compile", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_8Compiler_compile(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4373, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_8Compiler_compile(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4516, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -44476,15 +45036,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4405
+/* "fstlib/cext/pywrapfst.pyx":4548
  *     return _init_XFst(_tfst.release())
  * 
  *   cpdef void write(self, expression):             # <<<<<<<<<<<<<<
  *     """
  *     write(expression)
  */
 
@@ -44508,15 +45068,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4405, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4548, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_8Compiler_5write)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -44524,15 +45084,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_expression) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_expression);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4405, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4548, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -44544,25 +45104,25 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4421
+  /* "fstlib/cext/pywrapfst.pyx":4564
  *       expression: A string expression to add to compiler string buffer.
  *     """
  *     cdef string _line = tostring(expression)             # <<<<<<<<<<<<<<
  *     if not _line.empty() and _line.back() != b'\n':
  *       _line.append(b'\n')
  */
-  __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_expression); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4421, __pyx_L1_error)
+  __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_expression); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4564, __pyx_L1_error)
   __pyx_v__line = __pyx_t_5;
 
-  /* "fstlib/cext/pywrapfst.pyx":4422
+  /* "fstlib/cext/pywrapfst.pyx":4565
  *     """
  *     cdef string _line = tostring(expression)
  *     if not _line.empty() and _line.back() != b'\n':             # <<<<<<<<<<<<<<
  *       _line.append(b'\n')
  *     deref(self._sstrm) << _line
  */
   __pyx_t_7 = ((!(__pyx_v__line.empty() != 0)) != 0);
@@ -44572,51 +45132,51 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_7 = ((__pyx_v__line.back() != '\n') != 0);
   __pyx_t_6 = __pyx_t_7;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_6) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4423
+    /* "fstlib/cext/pywrapfst.pyx":4566
  *     cdef string _line = tostring(expression)
  *     if not _line.empty() and _line.back() != b'\n':
  *       _line.append(b'\n')             # <<<<<<<<<<<<<<
  *     deref(self._sstrm) << _line
  * 
  */
     try {
       __pyx_v__line.append(((char const *)"\n"));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 4423, __pyx_L1_error)
+      __PYX_ERR(0, 4566, __pyx_L1_error)
     }
 
-    /* "fstlib/cext/pywrapfst.pyx":4422
+    /* "fstlib/cext/pywrapfst.pyx":4565
  *     """
  *     cdef string _line = tostring(expression)
  *     if not _line.empty() and _line.back() != b'\n':             # <<<<<<<<<<<<<<
  *       _line.append(b'\n')
  *     deref(self._sstrm) << _line
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4424
+  /* "fstlib/cext/pywrapfst.pyx":4567
  *     if not _line.empty() and _line.back() != b'\n':
  *       _line.append(b'\n')
  *     deref(self._sstrm) << _line             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_sstrm");
-    __PYX_ERR(0, 4424, __pyx_L1_error)
+    __PYX_ERR(0, 4567, __pyx_L1_error)
   }
   (void)(((*__pyx_v_self->_sstrm) << __pyx_v__line));
 
-  /* "fstlib/cext/pywrapfst.pyx":4405
+  /* "fstlib/cext/pywrapfst.pyx":4548
  *     return _init_XFst(_tfst.release())
  * 
  *   cpdef void write(self, expression):             # <<<<<<<<<<<<<<
  *     """
  *     write(expression)
  */
 
@@ -44651,15 +45211,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("write", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_8Compiler_write(__pyx_v_self, __pyx_v_expression, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_8Compiler_write(__pyx_v_self, __pyx_v_expression, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4548, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -44702,15 +45262,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__53, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__51, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -44758,15 +45318,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__54, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__52, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -44781,15 +45341,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.Compiler.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4446
+/* "fstlib/cext/pywrapfst.pyx":4589
  *   """
  * 
  *   def __init__(self):             # <<<<<<<<<<<<<<
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  */
 
@@ -44815,40 +45375,40 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4447
+  /* "fstlib/cext/pywrapfst.pyx":4590
  * 
  *   def __init__(self):
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")             # <<<<<<<<<<<<<<
  * 
  *   def __repr__(self):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4447, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4590, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4447, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4590, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_2, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4447, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_2, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4590, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Cannot_construct, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4447, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Cannot_construct, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4590, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_NotImplementedError, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4447, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_NotImplementedError, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4590, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(0, 4447, __pyx_L1_error)
+  __PYX_ERR(0, 4590, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":4446
+  /* "fstlib/cext/pywrapfst.pyx":4589
  *   """
  * 
  *   def __init__(self):             # <<<<<<<<<<<<<<
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  */
 
@@ -44858,15 +45418,15 @@
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.FarReader.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4449
+/* "fstlib/cext/pywrapfst.pyx":4592
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<{self.far_type()} FarReader at 0x{id(self):x}>"
  * 
  */
 
@@ -44892,67 +45452,67 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4450
+  /* "fstlib/cext/pywrapfst.pyx":4593
  * 
  *   def __repr__(self):
  *     return f"<{self.far_type()} FarReader at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
  *   @classmethod
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4450, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u__2);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__2);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u__2);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "far_type");
-    __PYX_ERR(0, 4450, __pyx_L1_error)
+    __PYX_ERR(0, 4593, __pyx_L1_error)
   }
-  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *)__pyx_v_self->__pyx_vtab)->far_type(__pyx_v_self, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4450, __pyx_L1_error)
+  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *)__pyx_v_self->__pyx_vtab)->far_type(__pyx_v_self, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
   __pyx_t_4 = 0;
   __Pyx_INCREF(__pyx_kp_u_FarReader_at_0x);
   __pyx_t_2 += 16;
   __Pyx_GIVEREF(__pyx_kp_u_FarReader_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_FarReader_at_0x);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4450, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4450, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4450, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4449
+  /* "fstlib/cext/pywrapfst.pyx":4592
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<{self.far_type()} FarReader at 0x{id(self):x}>"
  * 
  */
 
@@ -44965,15 +45525,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4453
+/* "fstlib/cext/pywrapfst.pyx":4596
  * 
  *   @classmethod
  *   def open(cls, *sources):             # <<<<<<<<<<<<<<
  *     """
  *     FarReader.open(*sources)
  */
 
@@ -45012,84 +45572,84 @@
   int __pyx_t_7;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("open", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4471
+  /* "fstlib/cext/pywrapfst.pyx":4614
  *       FstIOError: Read failed.
  *     """
  *     cdef vector[string] _sources = [path_tostring(source) for source in sources]             # <<<<<<<<<<<<<<
  *     cdef unique_ptr[fst.FarReaderClass] _tfar
  *     _tfar = fst.FarReaderClass.Open(_sources)
  */
   { /* enter inner scope */
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4471, __pyx_L5_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4614, __pyx_L5_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_2 = __pyx_v_sources; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
     for (;;) {
       if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 4471, __pyx_L5_error)
+      __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_4); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 4614, __pyx_L5_error)
       #else
-      __pyx_t_4 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4471, __pyx_L5_error)
+      __pyx_t_4 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4614, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_4);
       #endif
       __Pyx_XDECREF_SET(__pyx_8genexpr1__pyx_v_source, __pyx_t_4);
       __pyx_t_4 = 0;
-      __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_8genexpr1__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4471, __pyx_L5_error)
-      __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4471, __pyx_L5_error)
+      __pyx_t_5 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_8genexpr1__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4614, __pyx_L5_error)
+      __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4614, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_4);
-      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 4471, __pyx_L5_error)
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 4614, __pyx_L5_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_source); __pyx_8genexpr1__pyx_v_source = 0;
     goto __pyx_L8_exit_scope;
     __pyx_L5_error:;
     __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_source); __pyx_8genexpr1__pyx_v_source = 0;
     goto __pyx_L1_error;
     __pyx_L8_exit_scope:;
   } /* exit inner scope */
-  __pyx_t_6 = __pyx_convert_vector_from_py_std_3a__3a_string(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4471, __pyx_L1_error)
+  __pyx_t_6 = __pyx_convert_vector_from_py_std_3a__3a_string(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4614, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v__sources = __pyx_t_6;
 
-  /* "fstlib/cext/pywrapfst.pyx":4473
+  /* "fstlib/cext/pywrapfst.pyx":4616
  *     cdef vector[string] _sources = [path_tostring(source) for source in sources]
  *     cdef unique_ptr[fst.FarReaderClass] _tfar
  *     _tfar = fst.FarReaderClass.Open(_sources)             # <<<<<<<<<<<<<<
  *     if _tfar.get() == NULL:
  *       raise FstIOError(f"Read failed: {sources!r}")
  */
   __pyx_v__tfar = fst::script::FarReaderClass::Open(__pyx_v__sources);
 
-  /* "fstlib/cext/pywrapfst.pyx":4474
+  /* "fstlib/cext/pywrapfst.pyx":4617
  *     cdef unique_ptr[fst.FarReaderClass] _tfar
  *     _tfar = fst.FarReaderClass.Open(_sources)
  *     if _tfar.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Read failed: {sources!r}")
  *     cdef FarReader reader = FarReader.__new__(FarReader)
  */
   __pyx_t_7 = ((__pyx_v__tfar.get() == NULL) != 0);
   if (unlikely(__pyx_t_7)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4475
+    /* "fstlib/cext/pywrapfst.pyx":4618
  *     _tfar = fst.FarReaderClass.Open(_sources)
  *     if _tfar.get() == NULL:
  *       raise FstIOError(f"Read failed: {sources!r}")             # <<<<<<<<<<<<<<
  *     cdef FarReader reader = FarReader.__new__(FarReader)
  *     reader._reader = move(_tfar)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4475, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4618, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_sources), __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4475, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_sources), __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4618, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_8 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_failed, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4475, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Read_failed, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4618, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -45097,68 +45657,68 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_8) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_8);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4475, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4618, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 4475, __pyx_L1_error)
+    __PYX_ERR(0, 4618, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":4474
+    /* "fstlib/cext/pywrapfst.pyx":4617
  *     cdef unique_ptr[fst.FarReaderClass] _tfar
  *     _tfar = fst.FarReaderClass.Open(_sources)
  *     if _tfar.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Read failed: {sources!r}")
  *     cdef FarReader reader = FarReader.__new__(FarReader)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4476
+  /* "fstlib/cext/pywrapfst.pyx":4619
  *     if _tfar.get() == NULL:
  *       raise FstIOError(f"Read failed: {sources!r}")
  *     cdef FarReader reader = FarReader.__new__(FarReader)             # <<<<<<<<<<<<<<
  *     reader._reader = move(_tfar)
  *     return reader
  */
-  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_FarReader(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4476, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_FarReader(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4619, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_v_reader = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4477
+  /* "fstlib/cext/pywrapfst.pyx":4620
  *       raise FstIOError(f"Read failed: {sources!r}")
  *     cdef FarReader reader = FarReader.__new__(FarReader)
  *     reader._reader = move(_tfar)             # <<<<<<<<<<<<<<
  *     return reader
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_reader) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reader");
-    __PYX_ERR(0, 4477, __pyx_L1_error)
+    __PYX_ERR(0, 4620, __pyx_L1_error)
   }
-  __pyx_v_reader->_reader = fst::move<std::unique_ptr<fst::script::FarReaderClass> >(__pyx_v__tfar);
+  __pyx_v_reader->_reader = cython_std::move<std::unique_ptr<fst::script::FarReaderClass> >(__pyx_v__tfar);
 
-  /* "fstlib/cext/pywrapfst.pyx":4478
+  /* "fstlib/cext/pywrapfst.pyx":4621
  *     cdef FarReader reader = FarReader.__new__(FarReader)
  *     reader._reader = move(_tfar)
  *     return reader             # <<<<<<<<<<<<<<
  * 
  *   cpdef string arc_type(self):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_reader));
   __pyx_r = ((PyObject *)__pyx_v_reader);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4453
+  /* "fstlib/cext/pywrapfst.pyx":4596
  * 
  *   @classmethod
  *   def open(cls, *sources):             # <<<<<<<<<<<<<<
  *     """
  *     FarReader.open(*sources)
  */
 
@@ -45174,15 +45734,15 @@
   __Pyx_XDECREF((PyObject *)__pyx_v_reader);
   __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_source);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4480
+/* "fstlib/cext/pywrapfst.pyx":4623
  *     return reader
  * 
  *   cpdef string arc_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     arc_type(self)
  */
 
@@ -45204,15 +45764,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_arc_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4480, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_arc_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4623, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarReader_7arc_type)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -45220,18 +45780,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4480, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4623, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4480, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4623, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -45242,29 +45802,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4486
+  /* "fstlib/cext/pywrapfst.pyx":4629
  *     Returns a string indicating the arc type.
  *     """
  *     return self._reader.get().ArcType()             # <<<<<<<<<<<<<<
  * 
  *   cpdef bool done(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reader");
-    __PYX_ERR(0, 4486, __pyx_L1_error)
+    __PYX_ERR(0, 4629, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_reader.get()->ArcType();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4480
+  /* "fstlib/cext/pywrapfst.pyx":4623
  *     return reader
  * 
  *   cpdef string arc_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     arc_type(self)
  */
 
@@ -45300,15 +45860,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("arc_type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_arc_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4480, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_arc_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4623, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -45317,15 +45877,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4488
+/* "fstlib/cext/pywrapfst.pyx":4631
  *     return self._reader.get().ArcType()
  * 
  *   cpdef bool done(self):             # <<<<<<<<<<<<<<
  *     """
  *     done(self)
  */
 
@@ -45347,15 +45907,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_done); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4488, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_done); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4631, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarReader_9done)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -45363,18 +45923,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4488, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4631, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4488, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4631, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -45385,29 +45945,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4497
+  /* "fstlib/cext/pywrapfst.pyx":4640
  *       True if the iterator is exhausted, False otherwise.
  *     """
  *     return self._reader.get().Done()             # <<<<<<<<<<<<<<
  * 
  *   cpdef bool error(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reader");
-    __PYX_ERR(0, 4497, __pyx_L1_error)
+    __PYX_ERR(0, 4640, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_reader.get()->Done();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4488
+  /* "fstlib/cext/pywrapfst.pyx":4631
  *     return self._reader.get().ArcType()
  * 
  *   cpdef bool done(self):             # <<<<<<<<<<<<<<
  *     """
  *     done(self)
  */
 
@@ -45443,15 +46003,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("done", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_done(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4488, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_done(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4631, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -45460,15 +46020,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4499
+/* "fstlib/cext/pywrapfst.pyx":4642
  *     return self._reader.get().Done()
  * 
  *   cpdef bool error(self):             # <<<<<<<<<<<<<<
  *     """
  *     error(self)
  */
 
@@ -45490,15 +46050,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_error); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4499, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_error); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4642, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarReader_11error)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -45506,18 +46066,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4499, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4499, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4642, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -45528,29 +46088,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4508
+  /* "fstlib/cext/pywrapfst.pyx":4651
  *       True if the FarReader is in an errorful state, False otherwise.
  *     """
  *     return self._reader.get().Error()             # <<<<<<<<<<<<<<
  * 
  *   cpdef string far_type(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reader");
-    __PYX_ERR(0, 4508, __pyx_L1_error)
+    __PYX_ERR(0, 4651, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_reader.get()->Error();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4499
+  /* "fstlib/cext/pywrapfst.pyx":4642
  *     return self._reader.get().Done()
  * 
  *   cpdef bool error(self):             # <<<<<<<<<<<<<<
  *     """
  *     error(self)
  */
 
@@ -45586,15 +46146,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("error", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_error(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4499, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_error(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4642, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -45603,15 +46163,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4510
+/* "fstlib/cext/pywrapfst.pyx":4653
  *     return self._reader.get().Error()
  * 
  *   cpdef string far_type(self):             # <<<<<<<<<<<<<<
  *     return fst.GetFarTypeString(self._reader.get().Type())
  * 
  */
 
@@ -45633,15 +46193,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_far_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4510, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_far_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4653, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarReader_13far_type)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -45649,18 +46209,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4510, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4653, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4510, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4653, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -45671,29 +46231,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4511
+  /* "fstlib/cext/pywrapfst.pyx":4654
  * 
  *   cpdef string far_type(self):
  *     return fst.GetFarTypeString(self._reader.get().Type())             # <<<<<<<<<<<<<<
  * 
  *   cpdef bool find(self, key):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reader");
-    __PYX_ERR(0, 4511, __pyx_L1_error)
+    __PYX_ERR(0, 4654, __pyx_L1_error)
   }
   __pyx_r = fst::GetFarTypeString(__pyx_v_self->_reader.get()->Type());
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4510
+  /* "fstlib/cext/pywrapfst.pyx":4653
  *     return self._reader.get().Error()
  * 
  *   cpdef string far_type(self):             # <<<<<<<<<<<<<<
  *     return fst.GetFarTypeString(self._reader.get().Type())
  * 
  */
 
@@ -45728,15 +46288,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("far_type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_far_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4510, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_far_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4653, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -45745,15 +46305,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4513
+/* "fstlib/cext/pywrapfst.pyx":4656
  *     return fst.GetFarTypeString(self._reader.get().Type())
  * 
  *   cpdef bool find(self, key):             # <<<<<<<<<<<<<<
  *     """
  *     find(self, key)
  */
 
@@ -45776,15 +46336,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_find); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4513, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_find); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4656, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarReader_15find)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -45792,18 +46352,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_key) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_key);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4513, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4656, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4513, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4656, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -45814,30 +46374,30 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4526
+  /* "fstlib/cext/pywrapfst.pyx":4669
  *       True if the key was found, False otherwise.
  *     """
  *     return self._reader.get().Find(tostring(key))             # <<<<<<<<<<<<<<
  * 
  *   cpdef Fst get_fst(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reader");
-    __PYX_ERR(0, 4526, __pyx_L1_error)
+    __PYX_ERR(0, 4669, __pyx_L1_error)
   }
-  __pyx_t_6 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_key); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4526, __pyx_L1_error)
+  __pyx_t_6 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_key); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4669, __pyx_L1_error)
   __pyx_r = __pyx_v_self->_reader.get()->Find(__pyx_t_6);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4513
+  /* "fstlib/cext/pywrapfst.pyx":4656
  *     return fst.GetFarTypeString(self._reader.get().Type())
  * 
  *   cpdef bool find(self, key):             # <<<<<<<<<<<<<<
  *     """
  *     find(self, key)
  */
 
@@ -45873,15 +46433,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("find", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_find(__pyx_v_self, __pyx_v_key, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4513, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_find(__pyx_v_self, __pyx_v_key, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4656, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -45890,15 +46450,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4528
+/* "fstlib/cext/pywrapfst.pyx":4671
  *     return self._reader.get().Find(tostring(key))
  * 
  *   cpdef Fst get_fst(self):             # <<<<<<<<<<<<<<
  *     """
  *     get_fst(self)
  */
 
@@ -45919,15 +46479,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_fst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4528, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_fst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4671, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarReader_17get_fst)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -45936,18 +46496,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4528, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4671, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst))))) __PYX_ERR(0, 4528, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst))))) __PYX_ERR(0, 4671, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -45958,33 +46518,33 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4537
+  /* "fstlib/cext/pywrapfst.pyx":4680
  *       A copy of the FST at the current position.
  *     """
  *     return _init_XFst(new fst.FstClass(deref(self._reader.get().GetFstClass())))             # <<<<<<<<<<<<<<
  * 
  *   cpdef string get_key(self):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reader");
-    __PYX_ERR(0, 4537, __pyx_L1_error)
+    __PYX_ERR(0, 4680, __pyx_L1_error)
   }
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(new fst::script::FstClass((*__pyx_v_self->_reader.get()->GetFstClass())))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4537, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst__init_XFst(new fst::script::FstClass((*__pyx_v_self->_reader.get()->GetFstClass())))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4680, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4528
+  /* "fstlib/cext/pywrapfst.pyx":4671
  *     return self._reader.get().Find(tostring(key))
  * 
  *   cpdef Fst get_fst(self):             # <<<<<<<<<<<<<<
  *     """
  *     get_fst(self)
  */
 
@@ -46021,15 +46581,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_fst", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_get_fst(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4528, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_get_fst(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4671, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -46038,15 +46598,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4539
+/* "fstlib/cext/pywrapfst.pyx":4682
  *     return _init_XFst(new fst.FstClass(deref(self._reader.get().GetFstClass())))
  * 
  *   cpdef string get_key(self):             # <<<<<<<<<<<<<<
  *     """
  *     get_key(self)
  */
 
@@ -46068,15 +46628,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4539, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4682, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarReader_19get_key)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -46084,18 +46644,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4539, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4682, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4539, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4682, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -46106,29 +46666,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4548
+  /* "fstlib/cext/pywrapfst.pyx":4691
  *       The string key at the current position.
  *     """
  *     return self._reader.get().GetKey()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void next(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reader");
-    __PYX_ERR(0, 4548, __pyx_L1_error)
+    __PYX_ERR(0, 4691, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_reader.get()->GetKey();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4539
+  /* "fstlib/cext/pywrapfst.pyx":4682
  *     return _init_XFst(new fst.FstClass(deref(self._reader.get().GetFstClass())))
  * 
  *   cpdef string get_key(self):             # <<<<<<<<<<<<<<
  *     """
  *     get_key(self)
  */
 
@@ -46164,15 +46724,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_key", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_get_key(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4539, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_get_key(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4682, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -46181,15 +46741,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4550
+/* "fstlib/cext/pywrapfst.pyx":4693
  *     return self._reader.get().GetKey()
  * 
  *   cpdef void next(self):             # <<<<<<<<<<<<<<
  *     """
  *     next(self)
  */
 
@@ -46209,15 +46769,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_next); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4550, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_next); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4693, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarReader_21next)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -46225,15 +46785,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4550, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4693, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -46245,28 +46805,28 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4556
+  /* "fstlib/cext/pywrapfst.pyx":4699
  *     Advances the iterator.
  *     """
  *     self._reader.get().Next()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void reset(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reader");
-    __PYX_ERR(0, 4556, __pyx_L1_error)
+    __PYX_ERR(0, 4699, __pyx_L1_error)
   }
   __pyx_v_self->_reader.get()->Next();
 
-  /* "fstlib/cext/pywrapfst.pyx":4550
+  /* "fstlib/cext/pywrapfst.pyx":4693
  *     return self._reader.get().GetKey()
  * 
  *   cpdef void next(self):             # <<<<<<<<<<<<<<
  *     """
  *     next(self)
  */
 
@@ -46301,15 +46861,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("next", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_next(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4550, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_next(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4693, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -46318,15 +46878,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4558
+/* "fstlib/cext/pywrapfst.pyx":4701
  *     self._reader.get().Next()
  * 
  *   cpdef void reset(self):             # <<<<<<<<<<<<<<
  *     """
  *     reset(self)
  */
 
@@ -46346,15 +46906,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4558, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4701, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarReader_23reset)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -46362,15 +46922,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4558, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4701, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -46382,28 +46942,28 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4564
+  /* "fstlib/cext/pywrapfst.pyx":4707
  *     Resets the iterator to the initial position.
  *     """
  *     self._reader.get().Reset()             # <<<<<<<<<<<<<<
  * 
  *   def __getitem__(self, key):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reader");
-    __PYX_ERR(0, 4564, __pyx_L1_error)
+    __PYX_ERR(0, 4707, __pyx_L1_error)
   }
   __pyx_v_self->_reader.get()->Reset();
 
-  /* "fstlib/cext/pywrapfst.pyx":4558
+  /* "fstlib/cext/pywrapfst.pyx":4701
  *     self._reader.get().Next()
  * 
  *   cpdef void reset(self):             # <<<<<<<<<<<<<<
  *     """
  *     reset(self)
  */
 
@@ -46438,15 +46998,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("reset", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_reset(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4558, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_reset(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4701, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -46455,15 +47015,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4566
+/* "fstlib/cext/pywrapfst.pyx":4709
  *     self._reader.get().Reset()
  * 
  *   def __getitem__(self, key):             # <<<<<<<<<<<<<<
  *     if self._reader.get().Find(tostring(key)):
  *       return self.get_fst()
  */
 
@@ -46487,72 +47047,72 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__getitem__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4567
+  /* "fstlib/cext/pywrapfst.pyx":4710
  * 
  *   def __getitem__(self, key):
  *     if self._reader.get().Find(tostring(key)):             # <<<<<<<<<<<<<<
  *       return self.get_fst()
  *     else:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_reader");
-    __PYX_ERR(0, 4567, __pyx_L1_error)
+    __PYX_ERR(0, 4710, __pyx_L1_error)
   }
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_key); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4567, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_key); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4710, __pyx_L1_error)
   __pyx_t_2 = (__pyx_v_self->_reader.get()->Find(__pyx_t_1) != 0);
   if (likely(__pyx_t_2)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4568
+    /* "fstlib/cext/pywrapfst.pyx":4711
  *   def __getitem__(self, key):
  *     if self._reader.get().Find(tostring(key)):
  *       return self.get_fst()             # <<<<<<<<<<<<<<
  *     else:
  *       raise KeyError(key)
  */
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get_fst");
-      __PYX_ERR(0, 4568, __pyx_L1_error)
+      __PYX_ERR(0, 4711, __pyx_L1_error)
     }
-    __pyx_t_3 = ((PyObject *)((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *)__pyx_v_self->__pyx_vtab)->get_fst(__pyx_v_self, 0)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4568, __pyx_L1_error)
+    __pyx_t_3 = ((PyObject *)((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *)__pyx_v_self->__pyx_vtab)->get_fst(__pyx_v_self, 0)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4711, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "fstlib/cext/pywrapfst.pyx":4567
+    /* "fstlib/cext/pywrapfst.pyx":4710
  * 
  *   def __getitem__(self, key):
  *     if self._reader.get().Find(tostring(key)):             # <<<<<<<<<<<<<<
  *       return self.get_fst()
  *     else:
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4570
+  /* "fstlib/cext/pywrapfst.pyx":4713
  *       return self.get_fst()
  *     else:
  *       raise KeyError(key)             # <<<<<<<<<<<<<<
  * 
  *   def __next__(self):
  */
   /*else*/ {
-    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_KeyError, __pyx_v_key); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4570, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_KeyError, __pyx_v_key); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4713, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 4570, __pyx_L1_error)
+    __PYX_ERR(0, 4713, __pyx_L1_error)
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4566
+  /* "fstlib/cext/pywrapfst.pyx":4709
  *     self._reader.get().Reset()
  * 
  *   def __getitem__(self, key):             # <<<<<<<<<<<<<<
  *     if self._reader.get().Find(tostring(key)):
  *       return self.get_fst()
  */
 
@@ -46563,15 +47123,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4572
+/* "fstlib/cext/pywrapfst.pyx":4715
  *       raise KeyError(key)
  * 
  *   def __next__(self):             # <<<<<<<<<<<<<<
  *     if self.done():
  *       raise StopIteration
  */
 
@@ -46597,112 +47157,112 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__next__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4573
+  /* "fstlib/cext/pywrapfst.pyx":4716
  * 
  *   def __next__(self):
  *     if self.done():             # <<<<<<<<<<<<<<
  *       raise StopIteration
  *     cdef string _key = self.get_key()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "done");
-    __PYX_ERR(0, 4573, __pyx_L1_error)
+    __PYX_ERR(0, 4716, __pyx_L1_error)
   }
   __pyx_t_1 = (((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *)__pyx_v_self->__pyx_vtab)->done(__pyx_v_self, 0) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4574
+    /* "fstlib/cext/pywrapfst.pyx":4717
  *   def __next__(self):
  *     if self.done():
  *       raise StopIteration             # <<<<<<<<<<<<<<
  *     cdef string _key = self.get_key()
  *     cdef Fst _fst = self.get_fst()
  */
     __Pyx_Raise(__pyx_builtin_StopIteration, 0, 0, 0);
-    __PYX_ERR(0, 4574, __pyx_L1_error)
+    __PYX_ERR(0, 4717, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":4573
+    /* "fstlib/cext/pywrapfst.pyx":4716
  * 
  *   def __next__(self):
  *     if self.done():             # <<<<<<<<<<<<<<
  *       raise StopIteration
  *     cdef string _key = self.get_key()
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4575
+  /* "fstlib/cext/pywrapfst.pyx":4718
  *     if self.done():
  *       raise StopIteration
  *     cdef string _key = self.get_key()             # <<<<<<<<<<<<<<
  *     cdef Fst _fst = self.get_fst()
  *     self.next()
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get_key");
-    __PYX_ERR(0, 4575, __pyx_L1_error)
+    __PYX_ERR(0, 4718, __pyx_L1_error)
   }
   __pyx_v__key = ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *)__pyx_v_self->__pyx_vtab)->get_key(__pyx_v_self, 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4576
+  /* "fstlib/cext/pywrapfst.pyx":4719
  *       raise StopIteration
  *     cdef string _key = self.get_key()
  *     cdef Fst _fst = self.get_fst()             # <<<<<<<<<<<<<<
  *     self.next()
  *     return (_key, _fst)
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get_fst");
-    __PYX_ERR(0, 4576, __pyx_L1_error)
+    __PYX_ERR(0, 4719, __pyx_L1_error)
   }
-  __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *)__pyx_v_self->__pyx_vtab)->get_fst(__pyx_v_self, 0)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4576, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *)__pyx_v_self->__pyx_vtab)->get_fst(__pyx_v_self, 0)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4719, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v__fst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4577
+  /* "fstlib/cext/pywrapfst.pyx":4720
  *     cdef string _key = self.get_key()
  *     cdef Fst _fst = self.get_fst()
  *     self.next()             # <<<<<<<<<<<<<<
  *     return (_key, _fst)
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "next");
-    __PYX_ERR(0, 4577, __pyx_L1_error)
+    __PYX_ERR(0, 4720, __pyx_L1_error)
   }
   ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarReader *)__pyx_v_self->__pyx_vtab)->next(__pyx_v_self, 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4578
+  /* "fstlib/cext/pywrapfst.pyx":4721
  *     cdef Fst _fst = self.get_fst()
  *     self.next()
  *     return (_key, _fst)             # <<<<<<<<<<<<<<
  * 
  *   # This just registers this class as a possible iterator.
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v__key); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4578, __pyx_L1_error)
+  __pyx_t_2 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_v__key); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4721, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4578, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4721, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
   __Pyx_INCREF(((PyObject *)__pyx_v__fst));
   __Pyx_GIVEREF(((PyObject *)__pyx_v__fst));
   PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_v__fst));
   __pyx_t_2 = 0;
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4572
+  /* "fstlib/cext/pywrapfst.pyx":4715
  *       raise KeyError(key)
  * 
  *   def __next__(self):             # <<<<<<<<<<<<<<
  *     if self.done():
  *       raise StopIteration
  */
 
@@ -46715,15 +47275,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v__fst);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4581
+/* "fstlib/cext/pywrapfst.pyx":4724
  * 
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
 
@@ -46741,27 +47301,27 @@
 }
 
 static PyObject *__pyx_pf_6fstlib_4cext_9pywrapfst_9FarReader_28__iter__(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__iter__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4582
+  /* "fstlib/cext/pywrapfst.pyx":4725
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):
  *     return self             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4581
+  /* "fstlib/cext/pywrapfst.pyx":4724
  * 
  *   # This just registers this class as a possible iterator.
  *   def __iter__(self):             # <<<<<<<<<<<<<<
  *     return self
  * 
  */
 
@@ -46802,15 +47362,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._reader cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._reader cannot be converted to a Python object for pickling")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__55, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__53, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -46858,15 +47418,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._reader cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._reader cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__56, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__54, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -46881,15 +47441,15 @@
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.FarReader.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4605
+/* "fstlib/cext/pywrapfst.pyx":4748
  *   """
  * 
  *   def __init__(self):             # <<<<<<<<<<<<<<
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  */
 
@@ -46915,40 +47475,40 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4606
+  /* "fstlib/cext/pywrapfst.pyx":4749
  * 
  *   def __init__(self):
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")             # <<<<<<<<<<<<<<
  * 
  *   def __repr__(self):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4606, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_class); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4749, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4606, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4749, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_2, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4606, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_2, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4749, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Cannot_construct, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4606, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Cannot_construct, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4749, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_NotImplementedError, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4606, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_NotImplementedError, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4749, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(0, 4606, __pyx_L1_error)
+  __PYX_ERR(0, 4749, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":4605
+  /* "fstlib/cext/pywrapfst.pyx":4748
  *   """
  * 
  *   def __init__(self):             # <<<<<<<<<<<<<<
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  */
 
@@ -46958,15 +47518,15 @@
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.FarWriter.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4608
+/* "fstlib/cext/pywrapfst.pyx":4751
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<{self.far_type()} FarWriter at 0x{id(self):x}>"
  * 
  */
 
@@ -46992,67 +47552,67 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4609
+  /* "fstlib/cext/pywrapfst.pyx":4752
  * 
  *   def __repr__(self):
  *     return f"<{self.far_type()} FarWriter at 0x{id(self):x}>"             # <<<<<<<<<<<<<<
  * 
  *   @classmethod
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4609, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4752, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
   __Pyx_INCREF(__pyx_kp_u__2);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__2);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u__2);
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "far_type");
-    __PYX_ERR(0, 4609, __pyx_L1_error)
+    __PYX_ERR(0, 4752, __pyx_L1_error)
   }
-  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarWriter *)__pyx_v_self->__pyx_vtab)->far_type(__pyx_v_self, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4609, __pyx_L1_error)
+  __pyx_t_4 = __pyx_convert_PyUnicode_string_to_py_std__in_string(((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarWriter *)__pyx_v_self->__pyx_vtab)->far_type(__pyx_v_self, 0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4752, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
   __pyx_t_4 = 0;
   __Pyx_INCREF(__pyx_kp_u_FarWriter_at_0x);
   __pyx_t_2 += 16;
   __Pyx_GIVEREF(__pyx_kp_u_FarWriter_at_0x);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_FarWriter_at_0x);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4609, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4752, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4609, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Format(__pyx_t_4, __pyx_n_u_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4752, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_INCREF(__pyx_kp_u__3);
   __pyx_t_2 += 1;
   __Pyx_GIVEREF(__pyx_kp_u__3);
   PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u__3);
-  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4609, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4752, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4608
+  /* "fstlib/cext/pywrapfst.pyx":4751
  *     raise NotImplementedError(f"Cannot construct {self.__class__.__name__}")
  * 
  *   def __repr__(self):             # <<<<<<<<<<<<<<
  *     return f"<{self.far_type()} FarWriter at 0x{id(self):x}>"
  * 
  */
 
@@ -47065,15 +47625,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4612
+/* "fstlib/cext/pywrapfst.pyx":4755
  * 
  *   @classmethod
  *   def create(cls, source, arc_type="standard", far_type="default"):             # <<<<<<<<<<<<<<
  *     """
  *     FarWriter.
  */
 
@@ -47123,15 +47683,15 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_far_type);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "create") < 0)) __PYX_ERR(0, 4612, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "create") < 0)) __PYX_ERR(0, 4755, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -47142,15 +47702,15 @@
     }
     __pyx_v_source = values[0];
     __pyx_v_arc_type = values[1];
     __pyx_v_far_type = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("create", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4612, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("create", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4755, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.FarWriter.create", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_9FarWriter_4create(((PyTypeObject*)__pyx_v_cls), __pyx_v_source, __pyx_v_arc_type, __pyx_v_far_type);
 
@@ -47174,73 +47734,73 @@
   PyObject *__pyx_t_8 = NULL;
   PyObject *__pyx_t_9 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("create", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4635
+  /* "fstlib/cext/pywrapfst.pyx":4778
  *     cdef unique_ptr[fst.FarWriterClass] _tfar
  *     _tfar = fst.FarWriterClass.Create(
  *         path_tostring(source),             # <<<<<<<<<<<<<<
  *         tostring(arc_type),
  *         _get_far_type(tostring(far_type)))
  */
-  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4635, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_6fstlib_4cext_9pywrapfst_path_tostring(__pyx_v_source); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4778, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":4636
+  /* "fstlib/cext/pywrapfst.pyx":4779
  *     _tfar = fst.FarWriterClass.Create(
  *         path_tostring(source),
  *         tostring(arc_type),             # <<<<<<<<<<<<<<
  *         _get_far_type(tostring(far_type)))
  *     if _tfar.get() == NULL:
  */
-  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_arc_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4636, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_arc_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4779, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":4637
+  /* "fstlib/cext/pywrapfst.pyx":4780
  *         path_tostring(source),
  *         tostring(arc_type),
  *         _get_far_type(tostring(far_type)))             # <<<<<<<<<<<<<<
  *     if _tfar.get() == NULL:
  *       raise FstIOError(f"Open failed: {source!r}")
  */
-  __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_far_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4637, __pyx_L1_error)
-  __pyx_t_4 = __pyx_f_6fstlib_4cext_9pywrapfst__get_far_type(__pyx_t_3); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4637, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_far_type); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4780, __pyx_L1_error)
+  __pyx_t_4 = __pyx_f_6fstlib_4cext_9pywrapfst__get_far_type(__pyx_t_3); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4780, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":4634
+  /* "fstlib/cext/pywrapfst.pyx":4777
  *     """
  *     cdef unique_ptr[fst.FarWriterClass] _tfar
  *     _tfar = fst.FarWriterClass.Create(             # <<<<<<<<<<<<<<
  *         path_tostring(source),
  *         tostring(arc_type),
  */
   __pyx_v__tfar = fst::script::FarWriterClass::Create(__pyx_t_1, __pyx_t_2, __pyx_t_4);
 
-  /* "fstlib/cext/pywrapfst.pyx":4638
+  /* "fstlib/cext/pywrapfst.pyx":4781
  *         tostring(arc_type),
  *         _get_far_type(tostring(far_type)))
  *     if _tfar.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Open failed: {source!r}")
  *     cdef FarWriter writer = FarWriter.__new__(FarWriter)
  */
   __pyx_t_5 = ((__pyx_v__tfar.get() == NULL) != 0);
   if (unlikely(__pyx_t_5)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4639
+    /* "fstlib/cext/pywrapfst.pyx":4782
  *         _get_far_type(tostring(far_type)))
  *     if _tfar.get() == NULL:
  *       raise FstIOError(f"Open failed: {source!r}")             # <<<<<<<<<<<<<<
  *     cdef FarWriter writer = FarWriter.__new__(FarWriter)
  *     writer._writer = move(_tfar)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4639, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_FstIOError); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4782, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4639, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_source), __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4782, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_9 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Open_failed, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 4639, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Open_failed, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 4782, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_t_8 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
       __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
       if (likely(__pyx_t_8)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
@@ -47248,68 +47808,68 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_7, function);
       }
     }
     __pyx_t_6 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_8, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4639, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4782, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 4639, __pyx_L1_error)
+    __PYX_ERR(0, 4782, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":4638
+    /* "fstlib/cext/pywrapfst.pyx":4781
  *         tostring(arc_type),
  *         _get_far_type(tostring(far_type)))
  *     if _tfar.get() == NULL:             # <<<<<<<<<<<<<<
  *       raise FstIOError(f"Open failed: {source!r}")
  *     cdef FarWriter writer = FarWriter.__new__(FarWriter)
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4640
+  /* "fstlib/cext/pywrapfst.pyx":4783
  *     if _tfar.get() == NULL:
  *       raise FstIOError(f"Open failed: {source!r}")
  *     cdef FarWriter writer = FarWriter.__new__(FarWriter)             # <<<<<<<<<<<<<<
  *     writer._writer = move(_tfar)
  *     return writer
  */
-  __pyx_t_6 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_FarWriter(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4640, __pyx_L1_error)
+  __pyx_t_6 = ((PyObject *)__pyx_tp_new_6fstlib_4cext_9pywrapfst_FarWriter(((PyTypeObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4783, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_6));
   __pyx_v_writer = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *)__pyx_t_6);
   __pyx_t_6 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4641
+  /* "fstlib/cext/pywrapfst.pyx":4784
  *       raise FstIOError(f"Open failed: {source!r}")
  *     cdef FarWriter writer = FarWriter.__new__(FarWriter)
  *     writer._writer = move(_tfar)             # <<<<<<<<<<<<<<
  *     return writer
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_writer) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_writer");
-    __PYX_ERR(0, 4641, __pyx_L1_error)
+    __PYX_ERR(0, 4784, __pyx_L1_error)
   }
-  __pyx_v_writer->_writer = fst::move<std::unique_ptr<fst::script::FarWriterClass> >(__pyx_v__tfar);
+  __pyx_v_writer->_writer = cython_std::move<std::unique_ptr<fst::script::FarWriterClass> >(__pyx_v__tfar);
 
-  /* "fstlib/cext/pywrapfst.pyx":4642
+  /* "fstlib/cext/pywrapfst.pyx":4785
  *     cdef FarWriter writer = FarWriter.__new__(FarWriter)
  *     writer._writer = move(_tfar)
  *     return writer             # <<<<<<<<<<<<<<
  * 
  *   # NB: Invoking this method may be dangerous: calling any other method on the
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_writer));
   __pyx_r = ((PyObject *)__pyx_v_writer);
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4612
+  /* "fstlib/cext/pywrapfst.pyx":4755
  * 
  *   @classmethod
  *   def create(cls, source, arc_type="standard", far_type="default"):             # <<<<<<<<<<<<<<
  *     """
  *     FarWriter.
  */
 
@@ -47324,43 +47884,43 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v_writer);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4646
+/* "fstlib/cext/pywrapfst.pyx":4789
  *   # NB: Invoking this method may be dangerous: calling any other method on the
  *   # instance after this is invoked may result in a null dereference.
  *   cdef void close(self):             # <<<<<<<<<<<<<<
  *     self._writer.reset()
  * 
  */
 
 static void __pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_close(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *__pyx_v_self) {
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("close", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4647
+  /* "fstlib/cext/pywrapfst.pyx":4790
  *   # instance after this is invoked may result in a null dereference.
  *   cdef void close(self):
  *     self._writer.reset()             # <<<<<<<<<<<<<<
  * 
  *   cpdef void add(self, key, Fst ifst) except *:
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_writer");
-    __PYX_ERR(0, 4647, __pyx_L1_error)
+    __PYX_ERR(0, 4790, __pyx_L1_error)
   }
   __pyx_v_self->_writer.reset();
 
-  /* "fstlib/cext/pywrapfst.pyx":4646
+  /* "fstlib/cext/pywrapfst.pyx":4789
  *   # NB: Invoking this method may be dangerous: calling any other method on the
  *   # instance after this is invoked may result in a null dereference.
  *   cdef void close(self):             # <<<<<<<<<<<<<<
  *     self._writer.reset()
  * 
  */
 
@@ -47368,15 +47928,15 @@
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("fstlib.cext.pywrapfst.FarWriter.close", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4649
+/* "fstlib/cext/pywrapfst.pyx":4792
  *     self._writer.reset()
  * 
  *   cpdef void add(self, key, Fst ifst) except *:             # <<<<<<<<<<<<<<
  *     """
  *     add(self, key, ifst)
  */
 
@@ -47400,15 +47960,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4649, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4792, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarWriter_7add)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         __pyx_t_5 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -47419,40 +47979,40 @@
             __Pyx_DECREF_SET(__pyx_t_3, function);
             __pyx_t_5 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_key, ((PyObject *)__pyx_v_ifst)};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4649, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4792, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_key, ((PyObject *)__pyx_v_ifst)};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4649, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4792, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         {
-          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4649, __pyx_L1_error)
+          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4792, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           if (__pyx_t_4) {
             __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
           }
           __Pyx_INCREF(__pyx_v_key);
           __Pyx_GIVEREF(__pyx_v_key);
           PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_key);
           __Pyx_INCREF(((PyObject *)__pyx_v_ifst));
           __Pyx_GIVEREF(((PyObject *)__pyx_v_ifst));
           PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, ((PyObject *)__pyx_v_ifst));
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4649, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4792, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
@@ -47466,71 +48026,71 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4667
+  /* "fstlib/cext/pywrapfst.pyx":4810
  *     # Failure here results from passing an FST with a different arc type than
  *     # used by the FAR was initialized to use.
  *     if not self._writer.get().Add(tostring(key), deref(ifst._fst)):             # <<<<<<<<<<<<<<
  *       raise FstOpError("Incompatible or invalid arc type")
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_writer");
-    __PYX_ERR(0, 4667, __pyx_L1_error)
+    __PYX_ERR(0, 4810, __pyx_L1_error)
   }
-  __pyx_t_7 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_key); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4667, __pyx_L1_error)
+  __pyx_t_7 = __pyx_f_6fstlib_4cext_9pywrapfst_tostring(__pyx_v_key); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4810, __pyx_L1_error)
   if (unlikely(((PyObject *)__pyx_v_ifst) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_fst");
-    __PYX_ERR(0, 4667, __pyx_L1_error)
+    __PYX_ERR(0, 4810, __pyx_L1_error)
   }
   __pyx_t_8 = ((!(__pyx_v_self->_writer.get()->Add(__pyx_t_7, (*__pyx_v_ifst->_fst)) != 0)) != 0);
   if (unlikely(__pyx_t_8)) {
 
-    /* "fstlib/cext/pywrapfst.pyx":4668
+    /* "fstlib/cext/pywrapfst.pyx":4811
  *     # used by the FAR was initialized to use.
  *     if not self._writer.get().Add(tostring(key), deref(ifst._fst)):
  *       raise FstOpError("Incompatible or invalid arc type")             # <<<<<<<<<<<<<<
  * 
  *   cpdef string arc_type(self):
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4668, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstOpError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4811, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_kp_u_Incompatible_or_invalid_arc_type) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_Incompatible_or_invalid_arc_type);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4668, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4811, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 4668, __pyx_L1_error)
+    __PYX_ERR(0, 4811, __pyx_L1_error)
 
-    /* "fstlib/cext/pywrapfst.pyx":4667
+    /* "fstlib/cext/pywrapfst.pyx":4810
  *     # Failure here results from passing an FST with a different arc type than
  *     # used by the FAR was initialized to use.
  *     if not self._writer.get().Add(tostring(key), deref(ifst._fst)):             # <<<<<<<<<<<<<<
  *       raise FstOpError("Incompatible or invalid arc type")
  * 
  */
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4649
+  /* "fstlib/cext/pywrapfst.pyx":4792
  *     self._writer.reset()
  * 
  *   cpdef void add(self, key, Fst ifst) except *:             # <<<<<<<<<<<<<<
  *     """
  *     add(self, key, ifst)
  */
 
@@ -47578,38 +48138,38 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_key)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ifst)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("add", 1, 2, 2, 1); __PYX_ERR(0, 4649, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("add", 1, 2, 2, 1); __PYX_ERR(0, 4792, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add") < 0)) __PYX_ERR(0, 4649, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add") < 0)) __PYX_ERR(0, 4792, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_key = values[0];
     __pyx_v_ifst = ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("add", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4649, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("add", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 4792, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("fstlib.cext.pywrapfst.FarWriter.add", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4649, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ifst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "ifst", 0))) __PYX_ERR(0, 4792, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_9FarWriter_6add(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *)__pyx_v_self), __pyx_v_key, __pyx_v_ifst);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -47622,16 +48182,16 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_add(__pyx_v_self, __pyx_v_key, __pyx_v_ifst, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4649, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4649, __pyx_L1_error)
+  __pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_add(__pyx_v_self, __pyx_v_key, __pyx_v_ifst, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4792, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4792, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -47640,15 +48200,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4670
+/* "fstlib/cext/pywrapfst.pyx":4813
  *       raise FstOpError("Incompatible or invalid arc type")
  * 
  *   cpdef string arc_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     arc_type(self)
  */
 
@@ -47670,15 +48230,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_arc_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4670, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_arc_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4813, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarWriter_9arc_type)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -47686,18 +48246,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4670, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4813, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4670, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4813, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -47708,29 +48268,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4676
+  /* "fstlib/cext/pywrapfst.pyx":4819
  *     Returns a string indicating the arc type.
  *     """
  *     return self._writer.get().ArcType()             # <<<<<<<<<<<<<<
  * 
  *   cpdef bool error(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_writer");
-    __PYX_ERR(0, 4676, __pyx_L1_error)
+    __PYX_ERR(0, 4819, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_writer.get()->ArcType();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4670
+  /* "fstlib/cext/pywrapfst.pyx":4813
  *       raise FstOpError("Incompatible or invalid arc type")
  * 
  *   cpdef string arc_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     arc_type(self)
  */
 
@@ -47766,15 +48326,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("arc_type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_arc_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4670, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_arc_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4813, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -47783,15 +48343,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4678
+/* "fstlib/cext/pywrapfst.pyx":4821
  *     return self._writer.get().ArcType()
  * 
  *   cpdef bool error(self):             # <<<<<<<<<<<<<<
  *     """
  *     error(self)
  */
 
@@ -47813,15 +48373,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_error); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4678, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_error); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4821, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarWriter_11error)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -47829,18 +48389,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4678, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4821, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4678, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 4821, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -47851,29 +48411,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4687
+  /* "fstlib/cext/pywrapfst.pyx":4830
  *       True if the FarWriter is in an errorful state, False otherwise.
  *     """
  *     return self._writer.get().Error()             # <<<<<<<<<<<<<<
  * 
  *   cpdef string far_type(self):
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_writer");
-    __PYX_ERR(0, 4687, __pyx_L1_error)
+    __PYX_ERR(0, 4830, __pyx_L1_error)
   }
   __pyx_r = __pyx_v_self->_writer.get()->Error();
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4678
+  /* "fstlib/cext/pywrapfst.pyx":4821
  *     return self._writer.get().ArcType()
  * 
  *   cpdef bool error(self):             # <<<<<<<<<<<<<<
  *     """
  *     error(self)
  */
 
@@ -47909,15 +48469,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("error", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_error(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4678, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_error(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4821, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -47926,15 +48486,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4689
+/* "fstlib/cext/pywrapfst.pyx":4832
  *     return self._writer.get().Error()
  * 
  *   cpdef string far_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     far_type(self)
  */
 
@@ -47956,15 +48516,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_far_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4689, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_far_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4832, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_6fstlib_4cext_9pywrapfst_9FarWriter_13far_type)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -47972,18 +48532,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4689, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4832, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4689, __pyx_L1_error)
+        __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4832, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -47994,29 +48554,29 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "fstlib/cext/pywrapfst.pyx":4695
+  /* "fstlib/cext/pywrapfst.pyx":4838
  *     Returns a string indicating the FAR type.
  *     """
  *     return fst.GetFarTypeString(self._writer.get().Type())             # <<<<<<<<<<<<<<
  * 
  *   # Dictionary-like assignment.
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "_writer");
-    __PYX_ERR(0, 4695, __pyx_L1_error)
+    __PYX_ERR(0, 4838, __pyx_L1_error)
   }
   __pyx_r = fst::GetFarTypeString(__pyx_v_self->_writer.get()->Type());
   goto __pyx_L0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4689
+  /* "fstlib/cext/pywrapfst.pyx":4832
  *     return self._writer.get().Error()
  * 
  *   cpdef string far_type(self):             # <<<<<<<<<<<<<<
  *     """
  *     far_type(self)
  */
 
@@ -48052,15 +48612,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("far_type", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_far_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4689, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_PyUnicode_string_to_py_std__in_string(__pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_far_type(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4832, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -48069,15 +48629,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "fstlib/cext/pywrapfst.pyx":4698
+/* "fstlib/cext/pywrapfst.pyx":4841
  * 
  *   # Dictionary-like assignment.
  *   def __setitem__(self, key, Fst fst):             # <<<<<<<<<<<<<<
  *     self.add(key, fst)
  * 
  */
 
@@ -48086,15 +48646,15 @@
 static int __pyx_pw_6fstlib_4cext_9pywrapfst_9FarWriter_15__setitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_key, PyObject *__pyx_v_fst) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__setitem__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_fst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "fst", 0))) __PYX_ERR(0, 4698, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_fst), __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, 1, "fst", 0))) __PYX_ERR(0, 4841, __pyx_L1_error)
   __pyx_r = __pyx_pf_6fstlib_4cext_9pywrapfst_9FarWriter_14__setitem__(((struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *)__pyx_v_self), ((PyObject *)__pyx_v_key), ((struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *)__pyx_v_fst));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -48106,28 +48666,28 @@
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__setitem__", 0);
 
-  /* "fstlib/cext/pywrapfst.pyx":4699
+  /* "fstlib/cext/pywrapfst.pyx":4842
  *   # Dictionary-like assignment.
  *   def __setitem__(self, key, Fst fst):
  *     self.add(key, fst)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(((PyObject *)__pyx_v_self) == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "add");
-    __PYX_ERR(0, 4699, __pyx_L1_error)
+    __PYX_ERR(0, 4842, __pyx_L1_error)
   }
-  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarWriter *)__pyx_v_self->__pyx_vtab)->add(__pyx_v_self, __pyx_v_key, __pyx_v_fst, 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4699, __pyx_L1_error)
+  ((struct __pyx_vtabstruct_6fstlib_4cext_9pywrapfst_FarWriter *)__pyx_v_self->__pyx_vtab)->add(__pyx_v_self, __pyx_v_key, __pyx_v_fst, 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4842, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":4698
+  /* "fstlib/cext/pywrapfst.pyx":4841
  * 
  *   # Dictionary-like assignment.
  *   def __setitem__(self, key, Fst fst):             # <<<<<<<<<<<<<<
  *     self.add(key, fst)
  * 
  */
 
@@ -48172,15 +48732,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._writer cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._writer cannot be converted to a Python object for pickling")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__57, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__55, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -48228,15 +48788,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._writer cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._writer cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__58, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__56, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -48567,37 +49127,37 @@
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "vector.from_py":45
  * 
- * @cname("__pyx_convert_vector_from_py_int64")
- * cdef vector[X] __pyx_convert_vector_from_py_int64(object o) except *:             # <<<<<<<<<<<<<<
+ * @cname("__pyx_convert_vector_from_py_int64_t")
+ * cdef vector[X] __pyx_convert_vector_from_py_int64_t(object o) except *:             # <<<<<<<<<<<<<<
  *     cdef vector[X] v
  *     for item in o:
  */
 
-static std::vector<int64>  __pyx_convert_vector_from_py_int64(PyObject *__pyx_v_o) {
-  std::vector<int64>  __pyx_v_v;
+static std::vector<int64_t>  __pyx_convert_vector_from_py_int64_t(PyObject *__pyx_v_o) {
+  std::vector<int64_t>  __pyx_v_v;
   PyObject *__pyx_v_item = NULL;
-  std::vector<int64>  __pyx_r;
+  std::vector<int64_t>  __pyx_r;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   Py_ssize_t __pyx_t_2;
   PyObject *(*__pyx_t_3)(PyObject *);
   PyObject *__pyx_t_4 = NULL;
-  int64 __pyx_t_5;
+  int64_t __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__pyx_convert_vector_from_py_int64", 0);
+  __Pyx_RefNannySetupContext("__pyx_convert_vector_from_py_int64_t", 0);
 
   /* "vector.from_py":47
- * cdef vector[X] __pyx_convert_vector_from_py_int64(object o) except *:
+ * cdef vector[X] __pyx_convert_vector_from_py_int64_t(object o) except *:
  *     cdef vector[X] v
  *     for item in o:             # <<<<<<<<<<<<<<
  *         v.push_back(<X>item)
  *     return v
  */
   if (likely(PyList_CheckExact(__pyx_v_o)) || PyTuple_CheckExact(__pyx_v_o)) {
     __pyx_t_1 = __pyx_v_o; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
@@ -48644,19 +49204,19 @@
     /* "vector.from_py":48
  *     cdef vector[X] v
  *     for item in o:
  *         v.push_back(<X>item)             # <<<<<<<<<<<<<<
  *     return v
  * 
  */
-    __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_v_item); if (unlikely((__pyx_t_5 == ((int64)-1)) && PyErr_Occurred())) __PYX_ERR(1, 48, __pyx_L1_error)
-    __pyx_v_v.push_back(((int64)__pyx_t_5));
+    __pyx_t_5 = __Pyx_PyInt_As_int64_t(__pyx_v_item); if (unlikely((__pyx_t_5 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(1, 48, __pyx_L1_error)
+    __pyx_v_v.push_back(((int64_t)__pyx_t_5));
 
     /* "vector.from_py":47
- * cdef vector[X] __pyx_convert_vector_from_py_int64(object o) except *:
+ * cdef vector[X] __pyx_convert_vector_from_py_int64_t(object o) except *:
  *     cdef vector[X] v
  *     for item in o:             # <<<<<<<<<<<<<<
  *         v.push_back(<X>item)
  *     return v
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
@@ -48669,25 +49229,25 @@
  * 
  */
   __pyx_r = __pyx_v_v;
   goto __pyx_L0;
 
   /* "vector.from_py":45
  * 
- * @cname("__pyx_convert_vector_from_py_int64")
- * cdef vector[X] __pyx_convert_vector_from_py_int64(object o) except *:             # <<<<<<<<<<<<<<
+ * @cname("__pyx_convert_vector_from_py_int64_t")
+ * cdef vector[X] __pyx_convert_vector_from_py_int64_t(object o) except *:             # <<<<<<<<<<<<<<
  *     cdef vector[X] v
  *     for item in o:
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("vector.from_py.__pyx_convert_vector_from_py_int64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("vector.from_py.__pyx_convert_vector_from_py_int64_t", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_pretend_to_initialize(&__pyx_r);
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_item);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
@@ -51340,16 +51900,19 @@
   {&__pyx_kp_u_ArcIterator_at_0x, __pyx_k_ArcIterator_at_0x, sizeof(__pyx_k_ArcIterator_at_0x), 0, 1, 0, 0},
   {&__pyx_n_s_ArcMapType, __pyx_k_ArcMapType, sizeof(__pyx_k_ArcMapType), 0, 0, 1, 1},
   {&__pyx_kp_u_Arc_at_0x, __pyx_k_Arc_at_0x, sizeof(__pyx_k_Arc_at_0x), 0, 1, 0, 0},
   {&__pyx_n_s_BINARY_PROPERTIES, __pyx_k_BINARY_PROPERTIES, sizeof(__pyx_k_BINARY_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_n_s_COACCESSIBLE, __pyx_k_COACCESSIBLE, sizeof(__pyx_k_COACCESSIBLE), 0, 0, 1, 1},
   {&__pyx_n_s_COPY_PROPERTIES, __pyx_k_COPY_PROPERTIES, sizeof(__pyx_k_COPY_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_n_s_CYCLIC, __pyx_k_CYCLIC, sizeof(__pyx_k_CYCLIC), 0, 0, 1, 1},
+  {&__pyx_kp_u_Can_t_get_value_from_an_exhauste, __pyx_k_Can_t_get_value_from_an_exhauste, sizeof(__pyx_k_Can_t_get_value_from_an_exhauste), 0, 1, 0, 0},
+  {&__pyx_kp_u_Can_t_set_value_on_an_exhausted, __pyx_k_Can_t_set_value_on_an_exhausted, sizeof(__pyx_k_Can_t_set_value_on_an_exhausted), 0, 1, 0, 0},
   {&__pyx_kp_u_Cannot_construct, __pyx_k_Cannot_construct, sizeof(__pyx_k_Cannot_construct), 0, 1, 0, 0},
   {&__pyx_kp_u_Cannot_topsort_cyclic_FST, __pyx_k_Cannot_topsort_cyclic_FST, sizeof(__pyx_k_Cannot_topsort_cyclic_FST), 0, 1, 0, 0},
+  {&__pyx_n_s_ClosureType, __pyx_k_ClosureType, sizeof(__pyx_k_ClosureType), 0, 0, 1, 1},
   {&__pyx_kp_u_Compilation_failed, __pyx_k_Compilation_failed, sizeof(__pyx_k_Compilation_failed), 0, 1, 0, 0},
   {&__pyx_n_s_Compiler, __pyx_k_Compiler, sizeof(__pyx_k_Compiler), 0, 0, 1, 1},
   {&__pyx_n_s_ComposeFilter, __pyx_k_ComposeFilter, sizeof(__pyx_k_ComposeFilter), 0, 0, 1, 1},
   {&__pyx_kp_u_Conversion_to, __pyx_k_Conversion_to, sizeof(__pyx_k_Conversion_to), 0, 1, 0, 0},
   {&__pyx_n_s_DELETE_ARC_PROPERTIES, __pyx_k_DELETE_ARC_PROPERTIES, sizeof(__pyx_k_DELETE_ARC_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_n_s_DELETE_STATE_PROPERTIES, __pyx_k_DELETE_STATE_PROPERTIES, sizeof(__pyx_k_DELETE_STATE_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_n_s_DeterminizeType, __pyx_k_DeterminizeType, sizeof(__pyx_k_DeterminizeType), 0, 0, 1, 1},
@@ -51361,14 +51924,15 @@
   {&__pyx_n_s_EPSILONS, __pyx_k_EPSILONS, sizeof(__pyx_k_EPSILONS), 0, 0, 1, 1},
   {&__pyx_n_s_ERROR, __pyx_k_ERROR, sizeof(__pyx_k_ERROR), 0, 0, 1, 1},
   {&__pyx_n_s_EXPANDED, __pyx_k_EXPANDED, sizeof(__pyx_k_EXPANDED), 0, 0, 1, 1},
   {&__pyx_n_s_EXTRINSIC_PROPERTIES, __pyx_k_EXTRINSIC_PROPERTIES, sizeof(__pyx_k_EXTRINSIC_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_n_s_EncodeMapper, __pyx_k_EncodeMapper, sizeof(__pyx_k_EncodeMapper), 0, 0, 1, 1},
   {&__pyx_n_s_EncodeMapperSymbolTableView, __pyx_k_EncodeMapperSymbolTableView, sizeof(__pyx_k_EncodeMapperSymbolTableView), 0, 0, 1, 1},
   {&__pyx_kp_u_EncodeMapper_at_0x, __pyx_k_EncodeMapper_at_0x, sizeof(__pyx_k_EncodeMapper_at_0x), 0, 1, 0, 0},
+  {&__pyx_n_s_EpsNormalizeType, __pyx_k_EpsNormalizeType, sizeof(__pyx_k_EpsNormalizeType), 0, 0, 1, 1},
   {&__pyx_kp_u_Expected, __pyx_k_Expected, sizeof(__pyx_k_Expected), 0, 1, 0, 0},
   {&__pyx_n_s_FST_PROPERTIES, __pyx_k_FST_PROPERTIES, sizeof(__pyx_k_FST_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_n_s_FarReader, __pyx_k_FarReader, sizeof(__pyx_k_FarReader), 0, 0, 1, 1},
   {&__pyx_kp_u_FarReader_at_0x, __pyx_k_FarReader_at_0x, sizeof(__pyx_k_FarReader_at_0x), 0, 1, 0, 0},
   {&__pyx_n_s_FarType, __pyx_k_FarType, sizeof(__pyx_k_FarType), 0, 0, 1, 1},
   {&__pyx_n_s_FarWriter, __pyx_k_FarWriter, sizeof(__pyx_k_FarWriter), 0, 0, 1, 1},
   {&__pyx_kp_u_FarWriter_at_0x, __pyx_k_FarWriter_at_0x, sizeof(__pyx_k_FarWriter_at_0x), 0, 1, 0, 0},
@@ -51394,14 +51958,15 @@
   {&__pyx_n_s_I_LABEL_SORTED, __pyx_k_I_LABEL_SORTED, sizeof(__pyx_k_I_LABEL_SORTED), 0, 0, 1, 1},
   {&__pyx_kp_u_Incompatible_or_invalid_arc_type, __pyx_k_Incompatible_or_invalid_arc_type, sizeof(__pyx_k_Incompatible_or_invalid_arc_type), 0, 1, 0, 0},
   {&__pyx_kp_u_Incompatible_or_invalid_weight, __pyx_k_Incompatible_or_invalid_weight, sizeof(__pyx_k_Incompatible_or_invalid_weight), 0, 1, 0, 0},
   {&__pyx_kp_u_Incompatible_or_invalid_weight_t, __pyx_k_Incompatible_or_invalid_weight_t, sizeof(__pyx_k_Incompatible_or_invalid_weight_t), 0, 1, 0, 0},
   {&__pyx_n_s_IndexError, __pyx_k_IndexError, sizeof(__pyx_k_IndexError), 0, 0, 1, 1},
   {&__pyx_kp_u_Invalid_weight, __pyx_k_Invalid_weight, sizeof(__pyx_k_Invalid_weight), 0, 1, 0, 0},
   {&__pyx_n_s_KeyError, __pyx_k_KeyError, sizeof(__pyx_k_KeyError), 0, 0, 1, 1},
+  {&__pyx_kp_u_Literal_star_plus, __pyx_k_Literal_star_plus, sizeof(__pyx_k_Literal_star_plus), 0, 1, 0, 0},
   {&__pyx_n_s_MUTABLE, __pyx_k_MUTABLE, sizeof(__pyx_k_MUTABLE), 0, 0, 1, 1},
   {&__pyx_n_s_MutableArcIterator, __pyx_k_MutableArcIterator, sizeof(__pyx_k_MutableArcIterator), 0, 0, 1, 1},
   {&__pyx_n_s_MutableArcIterator___iter, __pyx_k_MutableArcIterator___iter, sizeof(__pyx_k_MutableArcIterator___iter), 0, 0, 1, 1},
   {&__pyx_kp_u_MutableArcIterator_at_0x, __pyx_k_MutableArcIterator_at_0x, sizeof(__pyx_k_MutableArcIterator_at_0x), 0, 1, 0, 0},
   {&__pyx_n_s_MutableFst, __pyx_k_MutableFst, sizeof(__pyx_k_MutableFst), 0, 0, 1, 1},
   {&__pyx_n_s_MutableFstSymbolTableView, __pyx_k_MutableFstSymbolTableView, sizeof(__pyx_k_MutableFstSymbolTableView), 0, 0, 1, 1},
   {&__pyx_n_s_MutableSymbolTable, __pyx_k_MutableSymbolTable, sizeof(__pyx_k_MutableSymbolTable), 0, 0, 1, 1},
@@ -51439,14 +52004,15 @@
   {&__pyx_n_s_QueueType, __pyx_k_QueueType, sizeof(__pyx_k_QueueType), 0, 0, 1, 1},
   {&__pyx_n_s_RM_SUPERFINAL_PROPERTIES, __pyx_k_RM_SUPERFINAL_PROPERTIES, sizeof(__pyx_k_RM_SUPERFINAL_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_n_s_RandArcSelection, __pyx_k_RandArcSelection, sizeof(__pyx_k_RandArcSelection), 0, 0, 1, 1},
   {&__pyx_kp_u_Read_failed, __pyx_k_Read_failed, sizeof(__pyx_k_Read_failed), 0, 1, 0, 0},
   {&__pyx_kp_u_Read_from_FST_failed, __pyx_k_Read_from_FST_failed, sizeof(__pyx_k_Read_from_FST_failed), 0, 1, 0, 0},
   {&__pyx_kp_u_Read_from_string_failed, __pyx_k_Read_from_string_failed, sizeof(__pyx_k_Read_from_string_failed), 0, 1, 0, 0},
   {&__pyx_n_s_ReplaceLabelType, __pyx_k_ReplaceLabelType, sizeof(__pyx_k_ReplaceLabelType), 0, 0, 1, 1},
+  {&__pyx_n_s_ReweightType, __pyx_k_ReweightType, sizeof(__pyx_k_ReweightType), 0, 0, 1, 1},
   {&__pyx_n_s_RuntimeError, __pyx_k_RuntimeError, sizeof(__pyx_k_RuntimeError), 0, 0, 1, 1},
   {&__pyx_n_s_SET_ARC_PROPERTIES, __pyx_k_SET_ARC_PROPERTIES, sizeof(__pyx_k_SET_ARC_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_n_s_SET_FINAL_PROPERTIES, __pyx_k_SET_FINAL_PROPERTIES, sizeof(__pyx_k_SET_FINAL_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_n_s_SET_START_PROPERTIES, __pyx_k_SET_START_PROPERTIES, sizeof(__pyx_k_SET_START_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_n_s_STATE_SORT_PROPERTIES, __pyx_k_STATE_SORT_PROPERTIES, sizeof(__pyx_k_STATE_SORT_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_n_s_STRING, __pyx_k_STRING, sizeof(__pyx_k_STRING), 0, 0, 1, 1},
   {&__pyx_n_s_SortType, __pyx_k_SortType, sizeof(__pyx_k_SortType), 0, 0, 1, 1},
@@ -51459,42 +52025,44 @@
   {&__pyx_n_s_SymbolTableIterator, __pyx_k_SymbolTableIterator, sizeof(__pyx_k_SymbolTableIterator), 0, 0, 1, 1},
   {&__pyx_kp_u_SymbolTableIterator_at_0x, __pyx_k_SymbolTableIterator_at_0x, sizeof(__pyx_k_SymbolTableIterator_at_0x), 0, 1, 0, 0},
   {&__pyx_n_s_SymbolTableView, __pyx_k_SymbolTableView, sizeof(__pyx_k_SymbolTableView), 0, 0, 1, 1},
   {&__pyx_n_s_SymbolTable_2, __pyx_k_SymbolTable_2, sizeof(__pyx_k_SymbolTable_2), 0, 0, 1, 1},
   {&__pyx_kp_u_SymbolTable_no_longer_exists, __pyx_k_SymbolTable_no_longer_exists, sizeof(__pyx_k_SymbolTable_no_longer_exists), 0, 1, 0, 0},
   {&__pyx_n_s_TOP_SORTED, __pyx_k_TOP_SORTED, sizeof(__pyx_k_TOP_SORTED), 0, 0, 1, 1},
   {&__pyx_n_s_TRINARY_PROPERTIES, __pyx_k_TRINARY_PROPERTIES, sizeof(__pyx_k_TRINARY_PROPERTIES), 0, 0, 1, 1},
-  {&__pyx_kp_u_Tsvg, __pyx_k_Tsvg, sizeof(__pyx_k_Tsvg), 0, 1, 0, 0},
+  {&__pyx_kp_u_Tsvg_cairo, __pyx_k_Tsvg_cairo, sizeof(__pyx_k_Tsvg_cairo), 0, 1, 0, 0},
   {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
   {&__pyx_n_s_UNWEIGHTED, __pyx_k_UNWEIGHTED, sizeof(__pyx_k_UNWEIGHTED), 0, 0, 1, 1},
   {&__pyx_n_s_UNWEIGHTED_CYCLES, __pyx_k_UNWEIGHTED_CYCLES, sizeof(__pyx_k_UNWEIGHTED_CYCLES), 0, 0, 1, 1},
   {&__pyx_kp_u_Unknown_FAR_type, __pyx_k_Unknown_FAR_type, sizeof(__pyx_k_Unknown_FAR_type), 0, 1, 0, 0},
   {&__pyx_kp_u_Unknown_arc_type, __pyx_k_Unknown_arc_type, sizeof(__pyx_k_Unknown_arc_type), 0, 1, 0, 0},
   {&__pyx_kp_u_Unknown_compose_filter_type, __pyx_k_Unknown_compose_filter_type, sizeof(__pyx_k_Unknown_compose_filter_type), 0, 1, 0, 0},
   {&__pyx_kp_u_Unknown_determinization_type, __pyx_k_Unknown_determinization_type, sizeof(__pyx_k_Unknown_determinization_type), 0, 1, 0, 0},
+  {&__pyx_kp_u_Unknown_epsilon_normalization_ty, __pyx_k_Unknown_epsilon_normalization_ty, sizeof(__pyx_k_Unknown_epsilon_normalization_ty), 0, 1, 0, 0},
   {&__pyx_kp_u_Unknown_map_type, __pyx_k_Unknown_map_type, sizeof(__pyx_k_Unknown_map_type), 0, 1, 0, 0},
   {&__pyx_kp_u_Unknown_projection_type, __pyx_k_Unknown_projection_type, sizeof(__pyx_k_Unknown_projection_type), 0, 1, 0, 0},
   {&__pyx_kp_u_Unknown_queue_type, __pyx_k_Unknown_queue_type, sizeof(__pyx_k_Unknown_queue_type), 0, 1, 0, 0},
   {&__pyx_kp_u_Unknown_random_arc_selection_typ, __pyx_k_Unknown_random_arc_selection_typ, sizeof(__pyx_k_Unknown_random_arc_selection_typ), 0, 1, 0, 0},
   {&__pyx_kp_u_Unknown_replace_label_type, __pyx_k_Unknown_replace_label_type, sizeof(__pyx_k_Unknown_replace_label_type), 0, 1, 0, 0},
+  {&__pyx_kp_u_Unknown_reweight_type, __pyx_k_Unknown_reweight_type, sizeof(__pyx_k_Unknown_reweight_type), 0, 1, 0, 0},
   {&__pyx_kp_u_Unknown_sort_type, __pyx_k_Unknown_sort_type, sizeof(__pyx_k_Unknown_sort_type), 0, 1, 0, 0},
   {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
   {&__pyx_n_s_VectorFst, __pyx_k_VectorFst, sizeof(__pyx_k_VectorFst), 0, 0, 1, 1},
   {&__pyx_n_s_WEIGHTED, __pyx_k_WEIGHTED, sizeof(__pyx_k_WEIGHTED), 0, 0, 1, 1},
   {&__pyx_n_s_WEIGHTED_CYCLES, __pyx_k_WEIGHTED_CYCLES, sizeof(__pyx_k_WEIGHTED_CYCLES), 0, 0, 1, 1},
   {&__pyx_n_s_WEIGHT_INVARIANT_PROPERTIES, __pyx_k_WEIGHT_INVARIANT_PROPERTIES, sizeof(__pyx_k_WEIGHT_INVARIANT_PROPERTIES), 0, 0, 1, 1},
   {&__pyx_kp_u_Weight, __pyx_k_Weight, sizeof(__pyx_k_Weight), 0, 1, 0, 0},
   {&__pyx_n_s_WeightLike, __pyx_k_WeightLike, sizeof(__pyx_k_WeightLike), 0, 0, 1, 1},
   {&__pyx_n_s_Weight_2, __pyx_k_Weight_2, sizeof(__pyx_k_Weight_2), 0, 0, 1, 1},
   {&__pyx_kp_u_Weight_type_not_found, __pyx_k_Weight_type_not_found, sizeof(__pyx_k_Weight_type_not_found), 0, 1, 0, 0},
   {&__pyx_kp_u_Write_failed, __pyx_k_Write_failed, sizeof(__pyx_k_Write_failed), 0, 1, 0, 0},
   {&__pyx_kp_u_Write_to_string_failed, __pyx_k_Write_to_string_failed, sizeof(__pyx_k_Write_to_string_failed), 0, 1, 0, 0},
-  {&__pyx_kp_u__11, __pyx_k__11, sizeof(__pyx_k__11), 0, 1, 0, 0},
   {&__pyx_kp_u__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 1, 0, 0},
   {&__pyx_kp_u__3, __pyx_k__3, sizeof(__pyx_k__3), 0, 1, 0, 0},
+  {&__pyx_kp_u__9, __pyx_k__9, sizeof(__pyx_k__9), 0, 1, 0, 0},
   {&__pyx_n_s_acceptor, __pyx_k_acceptor, sizeof(__pyx_k_acceptor), 0, 0, 1, 1},
   {&__pyx_n_s_add, __pyx_k_add, sizeof(__pyx_k_add), 0, 0, 1, 1},
   {&__pyx_n_s_add_state, __pyx_k_add_state, sizeof(__pyx_k_add_state), 0, 0, 1, 1},
   {&__pyx_n_s_add_states, __pyx_k_add_states, sizeof(__pyx_k_add_states), 0, 0, 1, 1},
   {&__pyx_n_s_add_symbol, __pyx_k_add_symbol, sizeof(__pyx_k_add_symbol), 0, 0, 1, 1},
   {&__pyx_n_s_add_table, __pyx_k_add_table, sizeof(__pyx_k_add_table), 0, 0, 1, 1},
   {&__pyx_n_s_allow_negative_labels, __pyx_k_allow_negative_labels, sizeof(__pyx_k_allow_negative_labels), 0, 0, 1, 1},
@@ -51511,15 +52079,15 @@
   {&__pyx_kp_u_but_received, __pyx_k_but_received, sizeof(__pyx_k_but_received), 0, 1, 0, 0},
   {&__pyx_n_s_call_arc_labeling, __pyx_k_call_arc_labeling, sizeof(__pyx_k_call_arc_labeling), 0, 0, 1, 1},
   {&__pyx_n_s_checksum, __pyx_k_checksum, sizeof(__pyx_k_checksum), 0, 0, 1, 1},
   {&__pyx_n_s_class, __pyx_k_class, sizeof(__pyx_k_class), 0, 0, 1, 1},
   {&__pyx_n_s_class_2, __pyx_k_class_2, sizeof(__pyx_k_class_2), 0, 0, 1, 1},
   {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
   {&__pyx_n_s_close, __pyx_k_close, sizeof(__pyx_k_close), 0, 0, 1, 1},
-  {&__pyx_n_s_closure_plus, __pyx_k_closure_plus, sizeof(__pyx_k_closure_plus), 0, 0, 1, 1},
+  {&__pyx_n_s_closure_type, __pyx_k_closure_type, sizeof(__pyx_k_closure_type), 0, 0, 1, 1},
   {&__pyx_n_s_communicate, __pyx_k_communicate, sizeof(__pyx_k_communicate), 0, 0, 1, 1},
   {&__pyx_n_s_compile, __pyx_k_compile, sizeof(__pyx_k_compile), 0, 0, 1, 1},
   {&__pyx_n_s_compose_filter, __pyx_k_compose_filter, sizeof(__pyx_k_compose_filter), 0, 0, 1, 1},
   {&__pyx_n_s_connect, __pyx_k_connect, sizeof(__pyx_k_connect), 0, 0, 1, 1},
   {&__pyx_kp_u_const_EncodeMapper_SymbolTableV, __pyx_k_const_EncodeMapper_SymbolTableV, sizeof(__pyx_k_const_EncodeMapper_SymbolTableV), 0, 1, 0, 0},
   {&__pyx_kp_u_const_Fst_SymbolTableView, __pyx_k_const_Fst_SymbolTableView, sizeof(__pyx_k_const_Fst_SymbolTableView), 0, 1, 0, 0},
   {&__pyx_n_s_copy, __pyx_k_copy, sizeof(__pyx_k_copy), 0, 0, 1, 1},
@@ -51532,15 +52100,15 @@
   {&__pyx_n_s_doc, __pyx_k_doc, sizeof(__pyx_k_doc), 0, 0, 1, 1},
   {&__pyx_n_s_done, __pyx_k_done, sizeof(__pyx_k_done), 0, 0, 1, 1},
   {&__pyx_n_u_dot, __pyx_k_dot, sizeof(__pyx_k_dot), 0, 1, 0, 1},
   {&__pyx_n_s_draw, __pyx_k_draw, sizeof(__pyx_k_draw), 0, 0, 1, 1},
   {&__pyx_n_s_encode_labels, __pyx_k_encode_labels, sizeof(__pyx_k_encode_labels), 0, 0, 1, 1},
   {&__pyx_n_s_encode_weights, __pyx_k_encode_weights, sizeof(__pyx_k_encode_weights), 0, 0, 1, 1},
   {&__pyx_n_s_enum, __pyx_k_enum, sizeof(__pyx_k_enum), 0, 0, 1, 1},
-  {&__pyx_n_s_eps_norm_output, __pyx_k_eps_norm_output, sizeof(__pyx_k_eps_norm_output), 0, 0, 1, 1},
+  {&__pyx_n_s_eps_norm_type, __pyx_k_eps_norm_type, sizeof(__pyx_k_eps_norm_type), 0, 0, 1, 1},
   {&__pyx_n_s_epsilon_on_replace, __pyx_k_epsilon_on_replace, sizeof(__pyx_k_epsilon_on_replace), 0, 0, 1, 1},
   {&__pyx_n_s_error, __pyx_k_error, sizeof(__pyx_k_error), 0, 0, 1, 1},
   {&__pyx_kp_u_failed, __pyx_k_failed, sizeof(__pyx_k_failed), 0, 1, 0, 0},
   {&__pyx_n_s_far_type, __pyx_k_far_type, sizeof(__pyx_k_far_type), 0, 0, 1, 1},
   {&__pyx_n_s_final, __pyx_k_final, sizeof(__pyx_k_final), 0, 0, 1, 1},
   {&__pyx_n_s_find, __pyx_k_find, sizeof(__pyx_k_find), 0, 0, 1, 1},
   {&__pyx_n_s_flags, __pyx_k_flags, sizeof(__pyx_k_flags), 0, 0, 1, 1},
@@ -51648,14 +52216,15 @@
   {&__pyx_n_s_remove_common_affix, __pyx_k_remove_common_affix, sizeof(__pyx_k_remove_common_affix), 0, 0, 1, 1},
   {&__pyx_n_s_remove_total_weight, __pyx_k_remove_total_weight, sizeof(__pyx_k_remove_total_weight), 0, 0, 1, 1},
   {&__pyx_n_s_require_superinitial, __pyx_k_require_superinitial, sizeof(__pyx_k_require_superinitial), 0, 0, 1, 1},
   {&__pyx_n_s_reset, __pyx_k_reset, sizeof(__pyx_k_reset), 0, 0, 1, 1},
   {&__pyx_n_s_return_arc_labeling, __pyx_k_return_arc_labeling, sizeof(__pyx_k_return_arc_labeling), 0, 0, 1, 1},
   {&__pyx_n_s_return_label, __pyx_k_return_label, sizeof(__pyx_k_return_label), 0, 0, 1, 1},
   {&__pyx_n_s_reverse, __pyx_k_reverse, sizeof(__pyx_k_reverse), 0, 0, 1, 1},
+  {&__pyx_n_s_reweight_type, __pyx_k_reweight_type, sizeof(__pyx_k_reweight_type), 0, 0, 1, 1},
   {&__pyx_n_s_rhs, __pyx_k_rhs, sizeof(__pyx_k_rhs), 0, 0, 1, 1},
   {&__pyx_n_s_seed, __pyx_k_seed, sizeof(__pyx_k_seed), 0, 0, 1, 1},
   {&__pyx_n_s_seek, __pyx_k_seek, sizeof(__pyx_k_seek), 0, 0, 1, 1},
   {&__pyx_n_s_select, __pyx_k_select, sizeof(__pyx_k_select), 0, 0, 1, 1},
   {&__pyx_kp_s_self__aiter_self__fst_cannot_be, __pyx_k_self__aiter_self__fst_cannot_be, sizeof(__pyx_k_self__aiter_self__fst_cannot_be), 0, 0, 1, 0},
   {&__pyx_kp_s_self__aiter_self__mfst_cannot_be, __pyx_k_self__aiter_self__mfst_cannot_be, sizeof(__pyx_k_self__aiter_self__mfst_cannot_be), 0, 0, 1, 0},
   {&__pyx_kp_s_self__arc_cannot_be_converted_to, __pyx_k_self__arc_cannot_be_converted_to, sizeof(__pyx_k_self__arc_cannot_be_converted_to), 0, 0, 1, 0},
@@ -51663,23 +52232,23 @@
   {&__pyx_kp_s_self__reader_cannot_be_converted, __pyx_k_self__reader_cannot_be_converted, sizeof(__pyx_k_self__reader_cannot_be_converted), 0, 0, 1, 0},
   {&__pyx_kp_s_self__siter_cannot_be_converted, __pyx_k_self__siter_cannot_be_converted, sizeof(__pyx_k_self__siter_cannot_be_converted), 0, 0, 1, 0},
   {&__pyx_kp_s_self__weight_cannot_be_converted, __pyx_k_self__weight_cannot_be_converted, sizeof(__pyx_k_self__weight_cannot_be_converted), 0, 0, 1, 0},
   {&__pyx_kp_s_self__writer_cannot_be_converted, __pyx_k_self__writer_cannot_be_converted, sizeof(__pyx_k_self__writer_cannot_be_converted), 0, 0, 1, 0},
   {&__pyx_n_s_send, __pyx_k_send, sizeof(__pyx_k_send), 0, 0, 1, 1},
   {&__pyx_n_s_set_flags, __pyx_k_set_flags, sizeof(__pyx_k_set_flags), 0, 0, 1, 1},
   {&__pyx_n_s_set_name, __pyx_k_set_name, sizeof(__pyx_k_set_name), 0, 0, 1, 1},
-  {&__pyx_n_s_set_value, __pyx_k_set_value, sizeof(__pyx_k_set_value), 0, 0, 1, 1},
   {&__pyx_n_s_setstate, __pyx_k_setstate, sizeof(__pyx_k_setstate), 0, 0, 1, 1},
   {&__pyx_n_s_setstate_cython, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
   {&__pyx_n_s_shortestdistance, __pyx_k_shortestdistance, sizeof(__pyx_k_shortestdistance), 0, 0, 1, 1},
   {&__pyx_n_s_show_weight_one, __pyx_k_show_weight_one, sizeof(__pyx_k_show_weight_one), 0, 0, 1, 1},
   {&__pyx_n_s_sort_type, __pyx_k_sort_type, sizeof(__pyx_k_sort_type), 0, 0, 1, 1},
   {&__pyx_n_s_source, __pyx_k_source, sizeof(__pyx_k_source), 0, 0, 1, 1},
   {&__pyx_n_s_ssymbols, __pyx_k_ssymbols, sizeof(__pyx_k_ssymbols), 0, 0, 1, 1},
   {&__pyx_n_u_standard, __pyx_k_standard, sizeof(__pyx_k_standard), 0, 1, 0, 1},
+  {&__pyx_n_u_star, __pyx_k_star, sizeof(__pyx_k_star), 0, 1, 0, 1},
   {&__pyx_n_s_start, __pyx_k_start, sizeof(__pyx_k_start), 0, 0, 1, 1},
   {&__pyx_n_s_state, __pyx_k_state, sizeof(__pyx_k_state), 0, 0, 1, 1},
   {&__pyx_n_s_states, __pyx_k_states, sizeof(__pyx_k_states), 0, 0, 1, 1},
   {&__pyx_n_s_staticmethod, __pyx_k_staticmethod, sizeof(__pyx_k_staticmethod), 0, 0, 1, 1},
   {&__pyx_n_s_stdin, __pyx_k_stdin, sizeof(__pyx_k_stdin), 0, 0, 1, 1},
   {&__pyx_n_s_stdout, __pyx_k_stdout, sizeof(__pyx_k_stdout), 0, 0, 1, 1},
   {&__pyx_n_s_subprocess, __pyx_k_subprocess, sizeof(__pyx_k_subprocess), 0, 0, 1, 1},
@@ -51688,28 +52257,29 @@
   {&__pyx_n_s_symbols, __pyx_k_symbols, sizeof(__pyx_k_symbols), 0, 0, 1, 1},
   {&__pyx_n_s_sys, __pyx_k_sys, sizeof(__pyx_k_sys), 0, 0, 1, 1},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
   {&__pyx_n_s_test_2, __pyx_k_test_2, sizeof(__pyx_k_test_2), 0, 0, 1, 1},
   {&__pyx_n_s_throw, __pyx_k_throw, sizeof(__pyx_k_throw), 0, 0, 1, 1},
   {&__pyx_n_s_times, __pyx_k_times, sizeof(__pyx_k_times), 0, 0, 1, 1},
   {&__pyx_n_s_title, __pyx_k_title, sizeof(__pyx_k_title), 0, 0, 1, 1},
-  {&__pyx_n_s_to_final, __pyx_k_to_final, sizeof(__pyx_k_to_final), 0, 0, 1, 1},
+  {&__pyx_n_u_to_initial, __pyx_k_to_initial, sizeof(__pyx_k_to_initial), 0, 1, 0, 1},
   {&__pyx_n_s_to_string, __pyx_k_to_string, sizeof(__pyx_k_to_string), 0, 0, 1, 1},
   {&__pyx_n_s_type, __pyx_k_type, sizeof(__pyx_k_type), 0, 0, 1, 1},
   {&__pyx_n_s_typing, __pyx_k_typing, sizeof(__pyx_k_typing), 0, 0, 1, 1},
   {&__pyx_kp_u_typing_Literal_alt_sequence_auto, __pyx_k_typing_Literal_alt_sequence_auto, sizeof(__pyx_k_typing_Literal_alt_sequence_auto), 0, 1, 0, 0},
   {&__pyx_kp_u_typing_Literal_arc_sum_arc_uniqu, __pyx_k_typing_Literal_arc_sum_arc_uniqu, sizeof(__pyx_k_typing_Literal_arc_sum_arc_uniqu), 0, 1, 0, 0},
   {&__pyx_kp_u_typing_Literal_auto_fifo_lifo_sh, __pyx_k_typing_Literal_auto_fifo_lifo_sh, sizeof(__pyx_k_typing_Literal_auto_fifo_lifo_sh), 0, 1, 0, 0},
   {&__pyx_kp_u_typing_Literal_e_f_g, __pyx_k_typing_Literal_e_f_g, sizeof(__pyx_k_typing_Literal_e_f_g), 0, 1, 0, 0},
   {&__pyx_kp_u_typing_Literal_fst_stlist_sttabl, __pyx_k_typing_Literal_fst_stlist_sttabl, sizeof(__pyx_k_typing_Literal_fst_stlist_sttabl), 0, 1, 0, 0},
   {&__pyx_kp_u_typing_Literal_functional_nonfun, __pyx_k_typing_Literal_functional_nonfun, sizeof(__pyx_k_typing_Literal_functional_nonfun), 0, 1, 0, 0},
   {&__pyx_kp_u_typing_Literal_identity_input_ep, __pyx_k_typing_Literal_identity_input_ep, sizeof(__pyx_k_typing_Literal_identity_input_ep), 0, 1, 0, 0},
   {&__pyx_kp_u_typing_Literal_ilabel_olabel, __pyx_k_typing_Literal_ilabel_olabel, sizeof(__pyx_k_typing_Literal_ilabel_olabel), 0, 1, 0, 0},
   {&__pyx_kp_u_typing_Literal_input_output, __pyx_k_typing_Literal_input_output, sizeof(__pyx_k_typing_Literal_input_output), 0, 1, 0, 0},
   {&__pyx_kp_u_typing_Literal_neither_input_out, __pyx_k_typing_Literal_neither_input_out, sizeof(__pyx_k_typing_Literal_neither_input_out), 0, 1, 0, 0},
+  {&__pyx_kp_u_typing_Literal_to_inital_to_fina, __pyx_k_typing_Literal_to_inital_to_fina, sizeof(__pyx_k_typing_Literal_to_inital_to_fina), 0, 1, 0, 0},
   {&__pyx_kp_u_typing_Literal_uniform_log_prob, __pyx_k_typing_Literal_uniform_log_prob, sizeof(__pyx_k_typing_Literal_uniform_log_prob), 0, 1, 0, 0},
   {&__pyx_kp_u_typing_Union_Weight_typing_Union, __pyx_k_typing_Union_Weight_typing_Union, sizeof(__pyx_k_typing_Union_Weight_typing_Union), 0, 1, 0, 0},
   {&__pyx_n_u_uniform, __pyx_k_uniform, sizeof(__pyx_k_uniform), 0, 1, 0, 1},
   {&__pyx_n_s_unique, __pyx_k_unique, sizeof(__pyx_k_unique), 0, 0, 1, 1},
   {&__pyx_n_s_unknown_isymbol, __pyx_k_unknown_isymbol, sizeof(__pyx_k_unknown_isymbol), 0, 0, 1, 1},
   {&__pyx_n_s_unknown_osymbol, __pyx_k_unknown_osymbol, sizeof(__pyx_k_unknown_osymbol), 0, 0, 1, 1},
   {&__pyx_kp_u_unspecified, __pyx_k_unspecified, sizeof(__pyx_k_unspecified), 0, 1, 0, 0},
@@ -51728,24 +52298,24 @@
   {&__pyx_n_s_write_text, __pyx_k_write_text, sizeof(__pyx_k_write_text), 0, 0, 1, 1},
   {&__pyx_n_s_write_to_string, __pyx_k_write_to_string, sizeof(__pyx_k_write_to_string), 0, 0, 1, 1},
   {&__pyx_n_u_x, __pyx_k_x, sizeof(__pyx_k_x), 0, 1, 0, 1},
   {&__pyx_n_s_zero, __pyx_k_zero, sizeof(__pyx_k_zero), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 148, __pyx_L1_error)
-  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(0, 158, __pyx_L1_error)
-  __pyx_builtin_IOError = __Pyx_GetBuiltinName(__pyx_n_s_IOError); if (!__pyx_builtin_IOError) __PYX_ERR(0, 163, __pyx_L1_error)
-  __pyx_builtin_RuntimeError = __Pyx_GetBuiltinName(__pyx_n_s_RuntimeError); if (!__pyx_builtin_RuntimeError) __PYX_ERR(0, 168, __pyx_L1_error)
-  __pyx_builtin_staticmethod = __Pyx_GetBuiltinName(__pyx_n_s_staticmethod); if (!__pyx_builtin_staticmethod) __PYX_ERR(0, 1421, __pyx_L1_error)
-  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 197, __pyx_L1_error)
-  __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(0, 426, __pyx_L1_error)
-  __pyx_builtin_NotImplementedError = __Pyx_GetBuiltinName(__pyx_n_s_NotImplementedError); if (!__pyx_builtin_NotImplementedError) __PYX_ERR(0, 747, __pyx_L1_error)
-  __pyx_builtin_StopIteration = __Pyx_GetBuiltinName(__pyx_n_s_StopIteration); if (!__pyx_builtin_StopIteration) __PYX_ERR(0, 1287, __pyx_L1_error)
-  __pyx_builtin_KeyError = __Pyx_GetBuiltinName(__pyx_n_s_KeyError); if (!__pyx_builtin_KeyError) __PYX_ERR(0, 4570, __pyx_L1_error)
+  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(0, 160, __pyx_L1_error)
+  __pyx_builtin_IOError = __Pyx_GetBuiltinName(__pyx_n_s_IOError); if (!__pyx_builtin_IOError) __PYX_ERR(0, 165, __pyx_L1_error)
+  __pyx_builtin_RuntimeError = __Pyx_GetBuiltinName(__pyx_n_s_RuntimeError); if (!__pyx_builtin_RuntimeError) __PYX_ERR(0, 170, __pyx_L1_error)
+  __pyx_builtin_staticmethod = __Pyx_GetBuiltinName(__pyx_n_s_staticmethod); if (!__pyx_builtin_staticmethod) __PYX_ERR(0, 1482, __pyx_L1_error)
+  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 199, __pyx_L1_error)
+  __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(0, 487, __pyx_L1_error)
+  __pyx_builtin_NotImplementedError = __Pyx_GetBuiltinName(__pyx_n_s_NotImplementedError); if (!__pyx_builtin_NotImplementedError) __PYX_ERR(0, 808, __pyx_L1_error)
+  __pyx_builtin_StopIteration = __Pyx_GetBuiltinName(__pyx_n_s_StopIteration); if (!__pyx_builtin_StopIteration) __PYX_ERR(0, 1348, __pyx_L1_error)
+  __pyx_builtin_KeyError = __Pyx_GetBuiltinName(__pyx_n_s_KeyError); if (!__pyx_builtin_KeyError) __PYX_ERR(0, 4713, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
@@ -51785,232 +52355,218 @@
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._siter cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
   __pyx_tuple__8 = PyTuple_Pack(1, __pyx_kp_s_self__siter_cannot_be_converted); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__8);
   __Pyx_GIVEREF(__pyx_tuple__8);
 
-  /* "fstlib/cext/pywrapfst.pyx":1579
- *   @staticmethod
- *   cdef string _local_render_svg(const string &dot):
- *     proc = subprocess.Popen(("dot", "-Tsvg"),             # <<<<<<<<<<<<<<
- *                             stdin=subprocess.PIPE,
- *                             stdout=subprocess.PIPE)
- */
-  __pyx_tuple__9 = PyTuple_Pack(2, __pyx_n_u_dot, __pyx_kp_u_Tsvg); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 1579, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__9);
-  __Pyx_GIVEREF(__pyx_tuple__9);
-  __pyx_tuple__10 = PyTuple_Pack(1, __pyx_tuple__9); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 1579, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__10);
-  __Pyx_GIVEREF(__pyx_tuple__10);
-
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._arc cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._arc cannot be converted to a Python object for pickling")
  */
-  __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_s_self__arc_cannot_be_converted_to); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__24);
-  __Pyx_GIVEREF(__pyx_tuple__24);
+  __pyx_tuple__22 = PyTuple_Pack(1, __pyx_kp_s_self__arc_cannot_be_converted_to); if (unlikely(!__pyx_tuple__22)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__22);
+  __Pyx_GIVEREF(__pyx_tuple__22);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._arc cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._arc cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__25 = PyTuple_Pack(1, __pyx_kp_s_self__arc_cannot_be_converted_to); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__25);
-  __Pyx_GIVEREF(__pyx_tuple__25);
+  __pyx_tuple__23 = PyTuple_Pack(1, __pyx_kp_s_self__arc_cannot_be_converted_to); if (unlikely(!__pyx_tuple__23)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__23);
+  __Pyx_GIVEREF(__pyx_tuple__23);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._aiter,self._fst cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._aiter,self._fst cannot be converted to a Python object for pickling")
  */
-  __pyx_tuple__26 = PyTuple_Pack(1, __pyx_kp_s_self__aiter_self__fst_cannot_be); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__26);
-  __Pyx_GIVEREF(__pyx_tuple__26);
+  __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_s_self__aiter_self__fst_cannot_be); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__24);
+  __Pyx_GIVEREF(__pyx_tuple__24);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._aiter,self._fst cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._aiter,self._fst cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__27 = PyTuple_Pack(1, __pyx_kp_s_self__aiter_self__fst_cannot_be); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__27);
-  __Pyx_GIVEREF(__pyx_tuple__27);
+  __pyx_tuple__25 = PyTuple_Pack(1, __pyx_kp_s_self__aiter_self__fst_cannot_be); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__25);
+  __Pyx_GIVEREF(__pyx_tuple__25);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._aiter,self._mfst cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._aiter,self._mfst cannot be converted to a Python object for pickling")
  */
-  __pyx_tuple__28 = PyTuple_Pack(1, __pyx_kp_s_self__aiter_self__mfst_cannot_be); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__28);
-  __Pyx_GIVEREF(__pyx_tuple__28);
+  __pyx_tuple__26 = PyTuple_Pack(1, __pyx_kp_s_self__aiter_self__mfst_cannot_be); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__26);
+  __Pyx_GIVEREF(__pyx_tuple__26);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._aiter,self._mfst cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._aiter,self._mfst cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__29 = PyTuple_Pack(1, __pyx_kp_s_self__aiter_self__mfst_cannot_be); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__29);
-  __Pyx_GIVEREF(__pyx_tuple__29);
+  __pyx_tuple__27 = PyTuple_Pack(1, __pyx_kp_s_self__aiter_self__mfst_cannot_be); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__27);
+  __Pyx_GIVEREF(__pyx_tuple__27);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._fst,self._siter cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._fst,self._siter cannot be converted to a Python object for pickling")
  */
-  __pyx_tuple__30 = PyTuple_Pack(1, __pyx_kp_s_self__fst_self__siter_cannot_be); if (unlikely(!__pyx_tuple__30)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__30);
-  __Pyx_GIVEREF(__pyx_tuple__30);
+  __pyx_tuple__28 = PyTuple_Pack(1, __pyx_kp_s_self__fst_self__siter_cannot_be); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__28);
+  __Pyx_GIVEREF(__pyx_tuple__28);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._fst,self._siter cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._fst,self._siter cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__31 = PyTuple_Pack(1, __pyx_kp_s_self__fst_self__siter_cannot_be); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__31);
-  __Pyx_GIVEREF(__pyx_tuple__31);
+  __pyx_tuple__29 = PyTuple_Pack(1, __pyx_kp_s_self__fst_self__siter_cannot_be); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__29);
+  __Pyx_GIVEREF(__pyx_tuple__29);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__53 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__53)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__53);
-  __Pyx_GIVEREF(__pyx_tuple__53);
+  __pyx_tuple__51 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__51)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__51);
+  __Pyx_GIVEREF(__pyx_tuple__51);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__54 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__54)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__54);
-  __Pyx_GIVEREF(__pyx_tuple__54);
+  __pyx_tuple__52 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__52)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__52);
+  __Pyx_GIVEREF(__pyx_tuple__52);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._reader cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._reader cannot be converted to a Python object for pickling")
  */
-  __pyx_tuple__55 = PyTuple_Pack(1, __pyx_kp_s_self__reader_cannot_be_converted); if (unlikely(!__pyx_tuple__55)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__55);
-  __Pyx_GIVEREF(__pyx_tuple__55);
+  __pyx_tuple__53 = PyTuple_Pack(1, __pyx_kp_s_self__reader_cannot_be_converted); if (unlikely(!__pyx_tuple__53)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__53);
+  __Pyx_GIVEREF(__pyx_tuple__53);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._reader cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._reader cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__56 = PyTuple_Pack(1, __pyx_kp_s_self__reader_cannot_be_converted); if (unlikely(!__pyx_tuple__56)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__56);
-  __Pyx_GIVEREF(__pyx_tuple__56);
+  __pyx_tuple__54 = PyTuple_Pack(1, __pyx_kp_s_self__reader_cannot_be_converted); if (unlikely(!__pyx_tuple__54)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__54);
+  __Pyx_GIVEREF(__pyx_tuple__54);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("self._writer cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._writer cannot be converted to a Python object for pickling")
  */
-  __pyx_tuple__57 = PyTuple_Pack(1, __pyx_kp_s_self__writer_cannot_be_converted); if (unlikely(!__pyx_tuple__57)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__57);
-  __Pyx_GIVEREF(__pyx_tuple__57);
+  __pyx_tuple__55 = PyTuple_Pack(1, __pyx_kp_s_self__writer_cannot_be_converted); if (unlikely(!__pyx_tuple__55)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__55);
+  __Pyx_GIVEREF(__pyx_tuple__55);
 
   /* "(tree fragment)":4
  *     raise TypeError("self._writer cannot be converted to a Python object for pickling")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("self._writer cannot be converted to a Python object for pickling")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__58 = PyTuple_Pack(1, __pyx_kp_s_self__writer_cannot_be_converted); if (unlikely(!__pyx_tuple__58)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__58);
-  __Pyx_GIVEREF(__pyx_tuple__58);
+  __pyx_tuple__56 = PyTuple_Pack(1, __pyx_kp_s_self__writer_cannot_be_converted); if (unlikely(!__pyx_tuple__56)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__56);
+  __Pyx_GIVEREF(__pyx_tuple__56);
 
-  /* "fstlib/cext/pywrapfst.pyx":515
+  /* "fstlib/cext/pywrapfst.pyx":576
  * 
  * 
  * def plus(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   plus(lhs, rhs)
  */
-  __pyx_tuple__59 = PyTuple_Pack(3, __pyx_n_s_lhs, __pyx_n_s_rhs, __pyx_n_s_weight_2); if (unlikely(!__pyx_tuple__59)) __PYX_ERR(0, 515, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__59);
-  __Pyx_GIVEREF(__pyx_tuple__59);
-  __pyx_codeobj__60 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__59, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_plus, 515, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__60)) __PYX_ERR(0, 515, __pyx_L1_error)
+  __pyx_tuple__57 = PyTuple_Pack(3, __pyx_n_s_lhs, __pyx_n_s_rhs, __pyx_n_s_weight_2); if (unlikely(!__pyx_tuple__57)) __PYX_ERR(0, 576, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__57);
+  __Pyx_GIVEREF(__pyx_tuple__57);
+  __pyx_codeobj__58 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__57, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_plus, 576, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__58)) __PYX_ERR(0, 576, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":547
+  /* "fstlib/cext/pywrapfst.pyx":608
  * 
  * 
  * def times(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   times(lhs, rhs)
  */
-  __pyx_tuple__61 = PyTuple_Pack(3, __pyx_n_s_lhs, __pyx_n_s_rhs, __pyx_n_s_weight_2); if (unlikely(!__pyx_tuple__61)) __PYX_ERR(0, 547, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__61);
-  __Pyx_GIVEREF(__pyx_tuple__61);
-  __pyx_codeobj__62 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__61, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_times, 547, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__62)) __PYX_ERR(0, 547, __pyx_L1_error)
+  __pyx_tuple__59 = PyTuple_Pack(3, __pyx_n_s_lhs, __pyx_n_s_rhs, __pyx_n_s_weight_2); if (unlikely(!__pyx_tuple__59)) __PYX_ERR(0, 608, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__59);
+  __Pyx_GIVEREF(__pyx_tuple__59);
+  __pyx_codeobj__60 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__59, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_times, 608, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__60)) __PYX_ERR(0, 608, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":579
+  /* "fstlib/cext/pywrapfst.pyx":640
  * 
  * 
  * def divide(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   divide(lhs, rhs)
  */
-  __pyx_tuple__63 = PyTuple_Pack(3, __pyx_n_s_lhs, __pyx_n_s_rhs, __pyx_n_s_weight_2); if (unlikely(!__pyx_tuple__63)) __PYX_ERR(0, 579, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__63);
-  __Pyx_GIVEREF(__pyx_tuple__63);
-  __pyx_codeobj__64 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__63, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_divide, 579, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__64)) __PYX_ERR(0, 579, __pyx_L1_error)
+  __pyx_tuple__61 = PyTuple_Pack(3, __pyx_n_s_lhs, __pyx_n_s_rhs, __pyx_n_s_weight_2); if (unlikely(!__pyx_tuple__61)) __PYX_ERR(0, 640, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__61);
+  __Pyx_GIVEREF(__pyx_tuple__61);
+  __pyx_codeobj__62 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__61, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_divide, 640, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__62)) __PYX_ERR(0, 640, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":612
+  /* "fstlib/cext/pywrapfst.pyx":673
  * 
  * 
  * def power(Weight w, size_t n):             # <<<<<<<<<<<<<<
  *   """
  *   power(lhs, rhs)
  */
-  __pyx_tuple__65 = PyTuple_Pack(3, __pyx_n_s_w, __pyx_n_s_n, __pyx_n_s_weight_2); if (unlikely(!__pyx_tuple__65)) __PYX_ERR(0, 612, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__65);
-  __Pyx_GIVEREF(__pyx_tuple__65);
-  __pyx_codeobj__66 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__65, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_power, 612, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__66)) __PYX_ERR(0, 612, __pyx_L1_error)
+  __pyx_tuple__63 = PyTuple_Pack(3, __pyx_n_s_w, __pyx_n_s_n, __pyx_n_s_weight_2); if (unlikely(!__pyx_tuple__63)) __PYX_ERR(0, 673, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__63);
+  __Pyx_GIVEREF(__pyx_tuple__63);
+  __pyx_codeobj__64 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__63, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_power, 673, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__64)) __PYX_ERR(0, 673, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":1422
+  /* "fstlib/cext/pywrapfst.pyx":1483
  * 
  *   @staticmethod
  *   def read_from_string(state):             # <<<<<<<<<<<<<<
  *     """
  *     read_from_string(state)
  */
-  __pyx_tuple__67 = PyTuple_Pack(1, __pyx_n_s_state); if (unlikely(!__pyx_tuple__67)) __PYX_ERR(0, 1422, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__67);
-  __Pyx_GIVEREF(__pyx_tuple__67);
-  __pyx_codeobj__68 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__67, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_read_from_string, 1422, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__68)) __PYX_ERR(0, 1422, __pyx_L1_error)
+  __pyx_tuple__65 = PyTuple_Pack(1, __pyx_n_s_state); if (unlikely(!__pyx_tuple__65)) __PYX_ERR(0, 1483, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__65);
+  __Pyx_GIVEREF(__pyx_tuple__65);
+  __pyx_codeobj__66 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__65, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_read_from_string, 1483, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__66)) __PYX_ERR(0, 1483, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":4148
+  /* "fstlib/cext/pywrapfst.pyx":4291
  * 
  * 
  * def shortestdistance(Fst ifst,             # <<<<<<<<<<<<<<
  *                      float delta=fst.kShortestDelta,
- *                      int64 nstate=fst.kNoStateId,
+ *                      int64_t nstate=fst.kNoStateId,
  */
-  __pyx_tuple__69 = PyTuple_Pack(7, __pyx_n_s_ifst, __pyx_n_s_delta, __pyx_n_s_nstate, __pyx_n_s_queue_type, __pyx_n_s_reverse, __pyx_n_s_distance, __pyx_n_s_weight); if (unlikely(!__pyx_tuple__69)) __PYX_ERR(0, 4148, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__69);
-  __Pyx_GIVEREF(__pyx_tuple__69);
-  __pyx_codeobj__70 = (PyObject*)__Pyx_PyCode_New(5, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__69, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_shortestdistance, 4148, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__70)) __PYX_ERR(0, 4148, __pyx_L1_error)
+  __pyx_tuple__67 = PyTuple_Pack(7, __pyx_n_s_ifst, __pyx_n_s_delta, __pyx_n_s_nstate, __pyx_n_s_queue_type, __pyx_n_s_reverse, __pyx_n_s_distance, __pyx_n_s_weight); if (unlikely(!__pyx_tuple__67)) __PYX_ERR(0, 4291, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__67);
+  __Pyx_GIVEREF(__pyx_tuple__67);
+  __pyx_codeobj__68 = (PyObject*)__Pyx_PyCode_New(5, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__67, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_fstlib_cext_pywrapfst_pyx, __pyx_n_s_shortestdistance, 4291, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__68)) __PYX_ERR(0, 4291, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
@@ -52120,374 +52676,375 @@
   /*--- Type init code ---*/
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Weight = &__pyx_vtable_6fstlib_4cext_9pywrapfst_Weight;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Weight._check_weight = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *))__pyx_f_6fstlib_4cext_9pywrapfst_6Weight__check_weight;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Weight.copy = (struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_copy;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Weight.to_string = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_to_string;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Weight.type = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_type;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Weight.member = (bool (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_6Weight_member;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_Weight) < 0) __PYX_ERR(0, 405, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_Weight) < 0) __PYX_ERR(0, 466, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst_Weight.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst_Weight.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst_Weight.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst_Weight.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_Weight.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Weight) < 0) __PYX_ERR(0, 405, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Weight_2, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_Weight) < 0) __PYX_ERR(0, 405, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst_Weight) < 0) __PYX_ERR(0, 405, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_Weight.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Weight) < 0) __PYX_ERR(0, 466, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Weight_2, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_Weight) < 0) __PYX_ERR(0, 466, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst_Weight) < 0) __PYX_ERR(0, 466, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_Weight = &__pyx_type_6fstlib_4cext_9pywrapfst_Weight;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst_SymbolTableView = &__pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView._raw = (fst::SymbolTable const *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView__raw;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView._raise_nonexistent = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView__raise_nonexistent;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView._raw_ptr_or_raise = (fst::SymbolTable const *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView__raw_ptr_or_raise;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.available_key = (int64 (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_available_key;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.available_key = (int64_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_available_key;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.checksum = (PyObject *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_checksum;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.copy = (struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTable *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_copy;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.get_nth_key = (int64 (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, Py_ssize_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_get_nth_key;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.get_nth_key = (int64_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, Py_ssize_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_get_nth_key;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.labeled_checksum = (PyObject *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_labeled_checksum;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.member = (bool (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, PyObject *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_member;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.name = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_name;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.num_symbols = (size_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_num_symbols;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.write = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, PyObject *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.write_text = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, PyObject *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write_text;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTableView.write_to_string = (PyObject *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_15SymbolTableView_write_to_string;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTableView) < 0) __PYX_ERR(0, 732, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTableView) < 0) __PYX_ERR(0, 793, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst_SymbolTableView.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTableView.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst_SymbolTableView.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst_SymbolTableView.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTableView.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_SymbolTableView) < 0) __PYX_ERR(0, 732, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_SymbolTableView, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTableView) < 0) __PYX_ERR(0, 732, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTableView.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_SymbolTableView) < 0) __PYX_ERR(0, 793, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_SymbolTableView, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTableView) < 0) __PYX_ERR(0, 793, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView = &__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTableView;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView = &__pyx_vtable_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView.__pyx_base = *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_SymbolTableView;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView.__pyx_base._raw = (fst::SymbolTable const *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *))__pyx_f_6fstlib_4cext_9pywrapfst_28_EncodeMapperSymbolTableView__raw;
   __pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView.tp_base = __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView) < 0) __PYX_ERR(0, 935, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView) < 0) __PYX_ERR(0, 996, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView) < 0) __PYX_ERR(0, 935, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_EncodeMapperSymbolTableView, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView) < 0) __PYX_ERR(0, 935, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView) < 0) __PYX_ERR(0, 996, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_EncodeMapperSymbolTableView, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView) < 0) __PYX_ERR(0, 996, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView = &__pyx_type_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst__FstSymbolTableView = &__pyx_vtable_6fstlib_4cext_9pywrapfst__FstSymbolTableView;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__FstSymbolTableView.__pyx_base = *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_SymbolTableView;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__FstSymbolTableView.__pyx_base._raw = (fst::SymbolTable const *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *))__pyx_f_6fstlib_4cext_9pywrapfst_19_FstSymbolTableView__raw;
   __pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView.tp_base = __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView) < 0) __PYX_ERR(0, 959, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView) < 0) __PYX_ERR(0, 1020, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__FstSymbolTableView) < 0) __PYX_ERR(0, 959, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_FstSymbolTableView, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView) < 0) __PYX_ERR(0, 959, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__FstSymbolTableView) < 0) __PYX_ERR(0, 1020, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_FstSymbolTableView, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView) < 0) __PYX_ERR(0, 1020, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst__FstSymbolTableView = &__pyx_type_6fstlib_4cext_9pywrapfst__FstSymbolTableView;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableSymbolTable = &__pyx_vtable_6fstlib_4cext_9pywrapfst__MutableSymbolTable;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableSymbolTable.__pyx_base = *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_SymbolTableView;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableSymbolTable.__pyx_base._raw = (fst::SymbolTable const *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable__raw;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableSymbolTable._mutable_raw = (fst::SymbolTable *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable__mutable_raw;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableSymbolTable._mutable_raw_ptr_or_raise = (fst::SymbolTable *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable__mutable_raw_ptr_or_raise;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableSymbolTable.add_symbol = (int64 (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableSymbolTable.add_symbol = (int64_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_symbol;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableSymbolTable.add_table = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_add_table;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableSymbolTable.set_name = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *, PyObject *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableSymbolTable_set_name;
   __pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable.tp_base = __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTableView;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable) < 0) __PYX_ERR(0, 982, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable) < 0) __PYX_ERR(0, 1043, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableSymbolTable) < 0) __PYX_ERR(0, 982, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_MutableSymbolTable, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable) < 0) __PYX_ERR(0, 982, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableSymbolTable) < 0) __PYX_ERR(0, 1043, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_MutableSymbolTable, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable) < 0) __PYX_ERR(0, 1043, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst__MutableSymbolTable = &__pyx_type_6fstlib_4cext_9pywrapfst__MutableSymbolTable;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView = &__pyx_vtable_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView.__pyx_base = *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableSymbolTable;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView.__pyx_base._mutable_raw = (fst::SymbolTable *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *))__pyx_f_6fstlib_4cext_9pywrapfst_26_MutableFstSymbolTableView__mutable_raw;
   __pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView.tp_base = __pyx_ptype_6fstlib_4cext_9pywrapfst__MutableSymbolTable;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView) < 0) __PYX_ERR(0, 1054, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView) < 0) __PYX_ERR(0, 1115, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView) < 0) __PYX_ERR(0, 1054, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_MutableFstSymbolTableView, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView) < 0) __PYX_ERR(0, 1054, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView) < 0) __PYX_ERR(0, 1115, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_MutableFstSymbolTableView, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView) < 0) __PYX_ERR(0, 1115, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView = &__pyx_type_6fstlib_4cext_9pywrapfst__MutableFstSymbolTableView;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst_SymbolTable = &__pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTable;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTable.__pyx_base = *__pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableSymbolTable;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_SymbolTable.__pyx_base._mutable_raw = (fst::SymbolTable *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableSymbolTable *))__pyx_f_6fstlib_4cext_9pywrapfst_11SymbolTable__mutable_raw;
   __pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable.tp_base = __pyx_ptype_6fstlib_4cext_9pywrapfst__MutableSymbolTable;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable) < 0) __PYX_ERR(0, 1069, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable) < 0) __PYX_ERR(0, 1130, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_SymbolTable) < 0) __PYX_ERR(0, 1069, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_SymbolTable_2, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable) < 0) __PYX_ERR(0, 1069, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_SymbolTable) < 0) __PYX_ERR(0, 1130, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_SymbolTable_2, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable) < 0) __PYX_ERR(0, 1130, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable = &__pyx_type_6fstlib_4cext_9pywrapfst_SymbolTable;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__SymbolTableIterator) < 0) __PYX_ERR(0, 1265, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__SymbolTableIterator) < 0) __PYX_ERR(0, 1326, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst__SymbolTableIterator.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst__SymbolTableIterator.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst__SymbolTableIterator.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst__SymbolTableIterator.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_SymbolTableIterator, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__SymbolTableIterator) < 0) __PYX_ERR(0, 1265, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst__SymbolTableIterator) < 0) __PYX_ERR(0, 1265, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_SymbolTableIterator, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__SymbolTableIterator) < 0) __PYX_ERR(0, 1326, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst__SymbolTableIterator) < 0) __PYX_ERR(0, 1326, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst__SymbolTableIterator = &__pyx_type_6fstlib_4cext_9pywrapfst__SymbolTableIterator;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst_EncodeMapper = &__pyx_vtable_6fstlib_4cext_9pywrapfst_EncodeMapper;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_EncodeMapper.arc_type = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_arc_type;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_EncodeMapper.weight_type = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_weight_type;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_EncodeMapper.flags = (uint8 (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_flags;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_EncodeMapper.flags = (uint8_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_flags;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_EncodeMapper.write = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, PyObject *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_write;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_EncodeMapper.write_to_string = (PyObject *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_write_to_string;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_EncodeMapper.input_symbols = (struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_input_symbols;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_EncodeMapper.output_symbols = (struct __pyx_obj_6fstlib_4cext_9pywrapfst__EncodeMapperSymbolTableView *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper_output_symbols;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_EncodeMapper._set_input_symbols = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *))__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper__set_input_symbols;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_EncodeMapper._set_output_symbols = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *))__pyx_f_6fstlib_4cext_9pywrapfst_12EncodeMapper__set_output_symbols;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper) < 0) __PYX_ERR(0, 1297, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper) < 0) __PYX_ERR(0, 1358, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
   #if CYTHON_UPDATE_DESCRIPTOR_DOC
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper, "__call__"); if (unlikely(!wrapper)) __PYX_ERR(0, 1297, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper, "__call__"); if (unlikely(!wrapper)) __PYX_ERR(0, 1358, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_6fstlib_4cext_9pywrapfst_12EncodeMapper_4__call__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_6fstlib_4cext_9pywrapfst_12EncodeMapper_4__call__.doc = __pyx_doc_6fstlib_4cext_9pywrapfst_12EncodeMapper_4__call__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_6fstlib_4cext_9pywrapfst_12EncodeMapper_4__call__;
     }
   }
   #endif
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_EncodeMapper) < 0) __PYX_ERR(0, 1297, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_EncodeMapper, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper) < 0) __PYX_ERR(0, 1297, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_EncodeMapper) < 0) __PYX_ERR(0, 1358, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_EncodeMapper, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper) < 0) __PYX_ERR(0, 1358, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper = &__pyx_type_6fstlib_4cext_9pywrapfst_EncodeMapper;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Fst = &__pyx_vtable_6fstlib_4cext_9pywrapfst_Fst;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst._local_render_svg = (std::string (*)(std::string const &))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst__local_render_svg;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.arc_type = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arc_type;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.arcs = (struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arcs;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.arcs = (struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_arcs;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.copy = (struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_copy;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.draw = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_draw *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_draw;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.final = (struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_final;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.final = (struct __pyx_obj_6fstlib_4cext_9pywrapfst_Weight *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_final;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.fst_type = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_fst_type;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.input_symbols = (struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_input_symbols;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.num_arcs = (size_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_arcs;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.num_input_epsilons = (size_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_input_epsilons;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.num_output_epsilons = (size_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_output_epsilons;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.num_arcs = (size_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_arcs;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.num_input_epsilons = (size_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_input_epsilons;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.num_output_epsilons = (size_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int64_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_num_output_epsilons;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.output_symbols = (struct __pyx_obj_6fstlib_4cext_9pywrapfst__FstSymbolTableView *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_output_symbols;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.print = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_3Fst_print *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_print;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.start = (int64 (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_start;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.start = (int64_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_start;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.states = (struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_states;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.verify = (bool (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_verify;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.weight_type = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_weight_type;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.write = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, PyObject *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_write;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Fst.write_to_string = (PyObject *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Fst_write_to_string;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_Fst) < 0) __PYX_ERR(0, 1564, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_Fst) < 0) __PYX_ERR(0, 1626, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst_Fst.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst_Fst.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst_Fst.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst_Fst.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_Fst.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Fst) < 0) __PYX_ERR(0, 1564, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Fst, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_Fst) < 0) __PYX_ERR(0, 1564, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_Fst.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Fst) < 0) __PYX_ERR(0, 1626, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Fst, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_Fst) < 0) __PYX_ERR(0, 1626, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst = &__pyx_type_6fstlib_4cext_9pywrapfst_Fst;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst_MutableFst = &__pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst.__pyx_base = *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_Fst;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._check_mutating_imethod = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__check_mutating_imethod;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._add_arc = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__add_arc;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst.add_state = (int64 (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_state;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._add_arc = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__add_arc;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst.add_state = (int64_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_state;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst.add_states = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, size_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_add_states;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._arcsort = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__arcsort *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__arcsort;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._closure = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__closure *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__closure;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._concat = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__concat;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._connect = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__connect;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._decode = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__decode;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._delete_arcs = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._delete_arcs = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__delete_arcs;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._delete_states = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__delete_states;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._encode = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_EncodeMapper *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__encode;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._invert = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__invert;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._minimize = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__minimize *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__minimize;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst.mutable_arcs = (struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_mutable_arcs;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst.num_states = (int64 (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_num_states;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst.mutable_arcs = (struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_mutable_arcs;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst.num_states = (int64_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst_num_states;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._project = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, PyObject *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__project;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._prune = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__prune *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__prune;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._push = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__push *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__push;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._relabel_pairs = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_pairs *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_pairs;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._relabel_tables = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_tables *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__relabel_tables;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._reserve_arcs = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, size_t))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_arcs;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._reserve_states = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_states;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._reserve_arcs = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, size_t))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_arcs;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._reserve_states = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reserve_states;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._reweight = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, PyObject *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__reweight *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__reweight;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._rmepsilon = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__rmepsilon *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__rmepsilon;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._set_final = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_final;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._set_start = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_start;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._set_final = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t, struct __pyx_opt_args_6fstlib_4cext_9pywrapfst_10MutableFst__set_final *__pyx_optional_args))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_final;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._set_start = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, int64_t))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_start;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._set_input_symbols = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_input_symbols;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._set_output_symbols = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_SymbolTableView *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__set_output_symbols;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_MutableFst._topsort = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_MutableFst *))__pyx_f_6fstlib_4cext_9pywrapfst_10MutableFst__topsort;
   __pyx_type_6fstlib_4cext_9pywrapfst_MutableFst.tp_base = __pyx_ptype_6fstlib_4cext_9pywrapfst_Fst;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_MutableFst) < 0) __PYX_ERR(0, 2029, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_MutableFst) < 0) __PYX_ERR(0, 2093, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst_MutableFst.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst_MutableFst.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst_MutableFst.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst_MutableFst.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_MutableFst.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_MutableFst) < 0) __PYX_ERR(0, 2029, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_MutableFst, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_MutableFst) < 0) __PYX_ERR(0, 2029, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_MutableFst.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_MutableFst) < 0) __PYX_ERR(0, 2093, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_MutableFst, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_MutableFst) < 0) __PYX_ERR(0, 2093, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_MutableFst = &__pyx_type_6fstlib_4cext_9pywrapfst_MutableFst;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst_VectorFst = &__pyx_vtable_6fstlib_4cext_9pywrapfst_VectorFst;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_VectorFst.__pyx_base = *__pyx_vtabptr_6fstlib_4cext_9pywrapfst_MutableFst;
   __pyx_type_6fstlib_4cext_9pywrapfst_VectorFst.tp_base = __pyx_ptype_6fstlib_4cext_9pywrapfst_MutableFst;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_VectorFst) < 0) __PYX_ERR(0, 2891, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_VectorFst) < 0) __PYX_ERR(0, 2958, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst_VectorFst.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst_VectorFst.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst_VectorFst.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst_VectorFst.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_VectorFst.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_VectorFst) < 0) __PYX_ERR(0, 2891, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_VectorFst, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_VectorFst) < 0) __PYX_ERR(0, 2891, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_VectorFst.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_VectorFst) < 0) __PYX_ERR(0, 2958, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_VectorFst, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_VectorFst) < 0) __PYX_ERR(0, 2958, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_VectorFst = &__pyx_type_6fstlib_4cext_9pywrapfst_VectorFst;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Arc = &__pyx_vtable_6fstlib_4cext_9pywrapfst_Arc;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Arc.copy = (struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_3Arc_copy;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_Arc) < 0) __PYX_ERR(0, 3074, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_Arc) < 0) __PYX_ERR(0, 3140, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst_Arc.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst_Arc.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst_Arc.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst_Arc.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_Arc.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Arc) < 0) __PYX_ERR(0, 3074, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Arc, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_Arc) < 0) __PYX_ERR(0, 3074, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst_Arc) < 0) __PYX_ERR(0, 3074, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_Arc.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Arc) < 0) __PYX_ERR(0, 3140, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Arc, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_Arc) < 0) __PYX_ERR(0, 3140, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst_Arc) < 0) __PYX_ERR(0, 3140, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_Arc = &__pyx_type_6fstlib_4cext_9pywrapfst_Arc;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst__ArcIterator = &__pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator.done = (bool (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_done;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator.flags = (uint8 (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_flags;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator.flags = (uint8_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_flags;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator.next = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_next;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator.position = (size_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_position;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator.reset = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_reset;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator.seek = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, size_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_seek;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator.set_flags = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, uint8, uint8, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_set_flags;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator.value = (PyObject *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_value;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator) < 0) __PYX_ERR(0, 3144, __pyx_L1_error)
+  __pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator.set_flags = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *, uint8_t, uint8_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator_set_flags;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst__ArcIterator._value = (struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__ArcIterator *))__pyx_f_6fstlib_4cext_9pywrapfst_12_ArcIterator__value;
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator) < 0) __PYX_ERR(0, 3210, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__ArcIterator) < 0) __PYX_ERR(0, 3144, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_ArcIterator, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator) < 0) __PYX_ERR(0, 3144, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator) < 0) __PYX_ERR(0, 3144, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__ArcIterator) < 0) __PYX_ERR(0, 3210, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_ArcIterator, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator) < 0) __PYX_ERR(0, 3210, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator) < 0) __PYX_ERR(0, 3210, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst__ArcIterator = &__pyx_type_6fstlib_4cext_9pywrapfst__ArcIterator;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableArcIterator = &__pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator.done = (bool (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_done;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator.flags = (uint8 (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_flags;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator.flags = (uint8_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_flags;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator.next = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_next;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator.position = (size_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_position;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator.reset = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_reset;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator.seek = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, size_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_seek;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator.set_flags = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, uint8, uint8, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_flags;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator.set_value = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_value;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator.value = (PyObject *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_value;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator) < 0) __PYX_ERR(0, 3255, __pyx_L1_error)
+  __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator.set_flags = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, uint8_t, uint8_t, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator_set_flags;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator._set_value = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator__set_value;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst__MutableArcIterator._value = (struct __pyx_obj_6fstlib_4cext_9pywrapfst_Arc *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__MutableArcIterator *))__pyx_f_6fstlib_4cext_9pywrapfst_19_MutableArcIterator__value;
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator) < 0) __PYX_ERR(0, 3340, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableArcIterator) < 0) __PYX_ERR(0, 3255, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_MutableArcIterator, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator) < 0) __PYX_ERR(0, 3255, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator) < 0) __PYX_ERR(0, 3255, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__MutableArcIterator) < 0) __PYX_ERR(0, 3340, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_MutableArcIterator, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator) < 0) __PYX_ERR(0, 3340, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator) < 0) __PYX_ERR(0, 3340, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst__MutableArcIterator = &__pyx_type_6fstlib_4cext_9pywrapfst__MutableArcIterator;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst__StateIterator = &__pyx_vtable_6fstlib_4cext_9pywrapfst__StateIterator;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__StateIterator.done = (bool (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_done;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__StateIterator.next = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_next;
   __pyx_vtable_6fstlib_4cext_9pywrapfst__StateIterator.reset = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_reset;
-  __pyx_vtable_6fstlib_4cext_9pywrapfst__StateIterator.value = (int64 (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_value;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__StateIterator) < 0) __PYX_ERR(0, 3383, __pyx_L1_error)
+  __pyx_vtable_6fstlib_4cext_9pywrapfst__StateIterator._value = (int64_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *))__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator__value;
+  __pyx_vtable_6fstlib_4cext_9pywrapfst__StateIterator.value = (int64_t (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst__StateIterator *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_14_StateIterator_value;
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst__StateIterator) < 0) __PYX_ERR(0, 3504, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst__StateIterator.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst__StateIterator.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst__StateIterator.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst__StateIterator.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__StateIterator.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__StateIterator) < 0) __PYX_ERR(0, 3383, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_StateIterator, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__StateIterator) < 0) __PYX_ERR(0, 3383, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst__StateIterator) < 0) __PYX_ERR(0, 3383, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst__StateIterator.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst__StateIterator) < 0) __PYX_ERR(0, 3504, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_StateIterator, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst__StateIterator) < 0) __PYX_ERR(0, 3504, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst__StateIterator) < 0) __PYX_ERR(0, 3504, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst__StateIterator = &__pyx_type_6fstlib_4cext_9pywrapfst__StateIterator;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Compiler = &__pyx_vtable_6fstlib_4cext_9pywrapfst_Compiler;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Compiler.compile = (struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_8Compiler_compile;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_Compiler.write = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_Compiler *, PyObject *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_8Compiler_write;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_Compiler) < 0) __PYX_ERR(0, 4293, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_Compiler) < 0) __PYX_ERR(0, 4436, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst_Compiler.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst_Compiler.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst_Compiler.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst_Compiler.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_Compiler.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Compiler) < 0) __PYX_ERR(0, 4293, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Compiler, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_Compiler) < 0) __PYX_ERR(0, 4293, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst_Compiler) < 0) __PYX_ERR(0, 4293, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_Compiler.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_Compiler) < 0) __PYX_ERR(0, 4436, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Compiler, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_Compiler) < 0) __PYX_ERR(0, 4436, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst_Compiler) < 0) __PYX_ERR(0, 4436, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_Compiler = &__pyx_type_6fstlib_4cext_9pywrapfst_Compiler;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarReader = &__pyx_vtable_6fstlib_4cext_9pywrapfst_FarReader;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarReader.arc_type = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_arc_type;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarReader.done = (bool (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_done;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarReader.error = (bool (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_error;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarReader.far_type = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_far_type;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarReader.find = (bool (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, PyObject *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_find;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarReader.get_fst = (struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *(*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_get_fst;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarReader.get_key = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_get_key;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarReader.next = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_next;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarReader.reset = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarReader *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarReader_reset;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_FarReader) < 0) __PYX_ERR(0, 4430, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_FarReader) < 0) __PYX_ERR(0, 4573, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst_FarReader.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst_FarReader.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst_FarReader.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst_FarReader.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_FarReader.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarReader) < 0) __PYX_ERR(0, 4430, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_FarReader, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_FarReader) < 0) __PYX_ERR(0, 4430, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst_FarReader) < 0) __PYX_ERR(0, 4430, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_FarReader.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarReader) < 0) __PYX_ERR(0, 4573, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_FarReader, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_FarReader) < 0) __PYX_ERR(0, 4573, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst_FarReader) < 0) __PYX_ERR(0, 4573, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader = &__pyx_type_6fstlib_4cext_9pywrapfst_FarReader;
   __pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarWriter = &__pyx_vtable_6fstlib_4cext_9pywrapfst_FarWriter;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarWriter.arc_type = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_arc_type;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarWriter.close = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *))__pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_close;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarWriter.add = (void (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *, PyObject *, struct __pyx_obj_6fstlib_4cext_9pywrapfst_Fst *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_add;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarWriter.error = (bool (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_error;
   __pyx_vtable_6fstlib_4cext_9pywrapfst_FarWriter.far_type = (std::string (*)(struct __pyx_obj_6fstlib_4cext_9pywrapfst_FarWriter *, int __pyx_skip_dispatch))__pyx_f_6fstlib_4cext_9pywrapfst_9FarWriter_far_type;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_FarWriter) < 0) __PYX_ERR(0, 4585, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst_FarWriter) < 0) __PYX_ERR(0, 4728, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst_FarWriter.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst_FarWriter.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst_FarWriter.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst_FarWriter.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_FarWriter.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarWriter) < 0) __PYX_ERR(0, 4585, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_FarWriter, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_FarWriter) < 0) __PYX_ERR(0, 4585, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst_FarWriter) < 0) __PYX_ERR(0, 4585, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6fstlib_4cext_9pywrapfst_FarWriter.tp_dict, __pyx_vtabptr_6fstlib_4cext_9pywrapfst_FarWriter) < 0) __PYX_ERR(0, 4728, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_FarWriter, (PyObject *)&__pyx_type_6fstlib_4cext_9pywrapfst_FarWriter) < 0) __PYX_ERR(0, 4728, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6fstlib_4cext_9pywrapfst_FarWriter) < 0) __PYX_ERR(0, 4728, __pyx_L1_error)
   __pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter = &__pyx_type_6fstlib_4cext_9pywrapfst_FarWriter;
-  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__) < 0) __PYX_ERR(0, 3275, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__) < 0) __PYX_ERR(0, 3360, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__.tp_dictoffset && __pyx_type_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__ = &__pyx_type_6fstlib_4cext_9pywrapfst___pyx_scope_struct____iter__;
@@ -52725,110 +53282,119 @@
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
-  /* "fstlib/cext/pywrapfst.pyx":100
+  /* "fstlib/cext/pywrapfst.pyx":99
  * 
  * # Python imports.
  * import logging             # <<<<<<<<<<<<<<
  * import enum
  * import numbers
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_logging, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_logging, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 99, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_logging, __pyx_t_1) < 0) __PYX_ERR(0, 100, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_logging, __pyx_t_1) < 0) __PYX_ERR(0, 99, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":101
+  /* "fstlib/cext/pywrapfst.pyx":100
  * # Python imports.
  * import logging
  * import enum             # <<<<<<<<<<<<<<
  * import numbers
  * import os
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_enum, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_enum, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_enum, __pyx_t_1) < 0) __PYX_ERR(0, 101, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_enum, __pyx_t_1) < 0) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":102
+  /* "fstlib/cext/pywrapfst.pyx":101
  * import logging
  * import enum
  * import numbers             # <<<<<<<<<<<<<<
  * import os
  * import subprocess
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numbers, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numbers, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_numbers, __pyx_t_1) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_numbers, __pyx_t_1) < 0) __PYX_ERR(0, 101, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":103
+  /* "fstlib/cext/pywrapfst.pyx":102
  * import enum
  * import numbers
  * import os             # <<<<<<<<<<<<<<
  * import subprocess
  * import sys
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_os, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 103, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_os, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_os, __pyx_t_1) < 0) __PYX_ERR(0, 103, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_os, __pyx_t_1) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":104
+  /* "fstlib/cext/pywrapfst.pyx":103
  * import numbers
  * import os
  * import subprocess             # <<<<<<<<<<<<<<
  * import sys
  * 
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_subprocess, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 104, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_subprocess, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 103, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_subprocess, __pyx_t_1) < 0) __PYX_ERR(0, 104, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_subprocess, __pyx_t_1) < 0) __PYX_ERR(0, 103, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":105
+  /* "fstlib/cext/pywrapfst.pyx":104
  * import os
  * import subprocess
  * import sys             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_sys, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 105, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_sys, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 104, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sys, __pyx_t_1) < 0) __PYX_ERR(0, 105, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sys, __pyx_t_1) < 0) __PYX_ERR(0, 104, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":112
+  /* "fstlib/cext/pywrapfst.pyx":111
  * # These defintions only ensure that these are defined to avoid attribute errors,
  * # but don't actually contain the type definitions. Those are in pywrapfst.pyi.
  * import typing             # <<<<<<<<<<<<<<
  * 
  * ArcMapType = """typing.Literal["identity", "input_epsilon", "invert",
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_typing, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 112, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_typing, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_typing, __pyx_t_1) < 0) __PYX_ERR(0, 112, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_typing, __pyx_t_1) < 0) __PYX_ERR(0, 111, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":114
+  /* "fstlib/cext/pywrapfst.pyx":113
  * import typing
  * 
  * ArcMapType = """typing.Literal["identity", "input_epsilon", "invert",             # <<<<<<<<<<<<<<
  *                                "output_epsilon", "plus", "power", "quantize",
  *                                "rmweight", "superfinal", "times", "to_log",
  */
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ArcMapType, __pyx_kp_u_typing_Literal_identity_input_ep) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ArcMapType, __pyx_kp_u_typing_Literal_identity_input_ep) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":119
+  /* "fstlib/cext/pywrapfst.pyx":118
  *                                # NOTE: Both spellings of "to_std"
  *                                "to_log64", "to_std", "to_standard"]"""
+ * ClosureType = """Literal["star", "plus"]"""             # <<<<<<<<<<<<<<
+ * ComposeFilter = """typing.Literal["alt_sequence", "auto", "match", "no_match",
+ *                            "null", "sequence", "trivial"]"""
+ */
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ClosureType, __pyx_kp_u_Literal_star_plus) < 0) __PYX_ERR(0, 118, __pyx_L1_error)
+
+  /* "fstlib/cext/pywrapfst.pyx":119
+ *                                "to_log64", "to_std", "to_standard"]"""
+ * ClosureType = """Literal["star", "plus"]"""
  * ComposeFilter = """typing.Literal["alt_sequence", "auto", "match", "no_match",             # <<<<<<<<<<<<<<
  *                            "null", "sequence", "trivial"]"""
  * DeterminizeType = """typing.Literal["functional", "nonfunctional",
  */
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_ComposeFilter, __pyx_kp_u_typing_Literal_alt_sequence_auto) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
 
   /* "fstlib/cext/pywrapfst.pyx":121
@@ -52840,1988 +53406,2006 @@
  */
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_DeterminizeType, __pyx_kp_u_typing_Literal_functional_nonfun) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
 
   /* "fstlib/cext/pywrapfst.pyx":123
  * DeterminizeType = """typing.Literal["functional", "nonfunctional",
  *                                     "disambiguate"]"""
  * DrawFloatFormat = """typing.Literal["e", "f", "g"]"""             # <<<<<<<<<<<<<<
+ * EpsNormalizeType = """typing.Literal["input", "output"]"""
  * FarType = """typing.Literal[
- *   "fst",
  */
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_DrawFloatFormat, __pyx_kp_u_typing_Literal_e_f_g) < 0) __PYX_ERR(0, 123, __pyx_L1_error)
 
   /* "fstlib/cext/pywrapfst.pyx":124
  *                                     "disambiguate"]"""
  * DrawFloatFormat = """typing.Literal["e", "f", "g"]"""
+ * EpsNormalizeType = """typing.Literal["input", "output"]"""             # <<<<<<<<<<<<<<
+ * FarType = """typing.Literal[
+ *   "fst",
+ */
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_EpsNormalizeType, __pyx_kp_u_typing_Literal_input_output) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
+
+  /* "fstlib/cext/pywrapfst.pyx":125
+ * DrawFloatFormat = """typing.Literal["e", "f", "g"]"""
+ * EpsNormalizeType = """typing.Literal["input", "output"]"""
  * FarType = """typing.Literal[             # <<<<<<<<<<<<<<
  *   "fst",
  *   "stlist",
  */
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FarType, __pyx_kp_u_typing_Literal_fst_stlist_sttabl) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FarType, __pyx_kp_u_typing_Literal_fst_stlist_sttabl) < 0) __PYX_ERR(0, 125, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":130
+  /* "fstlib/cext/pywrapfst.pyx":131
  *   "default"
  * ]"""
  * ProjectType = """typing.Literal["input", "output"]"""             # <<<<<<<<<<<<<<
  * QueueType = """typing.Literal["auto", "fifo", "lifo", "shortest", "state",
  *                               "top"]"""
  */
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ProjectType, __pyx_kp_u_typing_Literal_input_output) < 0) __PYX_ERR(0, 130, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ProjectType, __pyx_kp_u_typing_Literal_input_output) < 0) __PYX_ERR(0, 131, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":131
+  /* "fstlib/cext/pywrapfst.pyx":132
  * ]"""
  * ProjectType = """typing.Literal["input", "output"]"""
  * QueueType = """typing.Literal["auto", "fifo", "lifo", "shortest", "state",             # <<<<<<<<<<<<<<
  *                               "top"]"""
  * RandArcSelection = """typing.Literal["uniform", "log_prob", "fast_log_prob"]"""
  */
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_QueueType, __pyx_kp_u_typing_Literal_auto_fifo_lifo_sh) < 0) __PYX_ERR(0, 131, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_QueueType, __pyx_kp_u_typing_Literal_auto_fifo_lifo_sh) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":133
+  /* "fstlib/cext/pywrapfst.pyx":134
  * QueueType = """typing.Literal["auto", "fifo", "lifo", "shortest", "state",
  *                               "top"]"""
  * RandArcSelection = """typing.Literal["uniform", "log_prob", "fast_log_prob"]"""             # <<<<<<<<<<<<<<
  * ReplaceLabelType = """typing.Literal["neither", "input", "output", "both"]"""
- * SortType = """typing.Literal["ilabel", "olabel"]"""
+ * ReweightType = """typing.Literal["to_inital", "to_final"]"""
  */
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_RandArcSelection, __pyx_kp_u_typing_Literal_uniform_log_prob) < 0) __PYX_ERR(0, 133, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_RandArcSelection, __pyx_kp_u_typing_Literal_uniform_log_prob) < 0) __PYX_ERR(0, 134, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":134
+  /* "fstlib/cext/pywrapfst.pyx":135
  *                               "top"]"""
  * RandArcSelection = """typing.Literal["uniform", "log_prob", "fast_log_prob"]"""
  * ReplaceLabelType = """typing.Literal["neither", "input", "output", "both"]"""             # <<<<<<<<<<<<<<
+ * ReweightType = """typing.Literal["to_inital", "to_final"]"""
  * SortType = """typing.Literal["ilabel", "olabel"]"""
- * StateMapType = """typing.Literal["arc_sum", "arc_unique", "identity"]"""
  */
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ReplaceLabelType, __pyx_kp_u_typing_Literal_neither_input_out) < 0) __PYX_ERR(0, 134, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ReplaceLabelType, __pyx_kp_u_typing_Literal_neither_input_out) < 0) __PYX_ERR(0, 135, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":135
+  /* "fstlib/cext/pywrapfst.pyx":136
  * RandArcSelection = """typing.Literal["uniform", "log_prob", "fast_log_prob"]"""
  * ReplaceLabelType = """typing.Literal["neither", "input", "output", "both"]"""
+ * ReweightType = """typing.Literal["to_inital", "to_final"]"""             # <<<<<<<<<<<<<<
+ * SortType = """typing.Literal["ilabel", "olabel"]"""
+ * StateMapType = """typing.Literal["arc_sum", "arc_unique", "identity"]"""
+ */
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ReweightType, __pyx_kp_u_typing_Literal_to_inital_to_fina) < 0) __PYX_ERR(0, 136, __pyx_L1_error)
+
+  /* "fstlib/cext/pywrapfst.pyx":137
+ * ReplaceLabelType = """typing.Literal["neither", "input", "output", "both"]"""
+ * ReweightType = """typing.Literal["to_inital", "to_final"]"""
  * SortType = """typing.Literal["ilabel", "olabel"]"""             # <<<<<<<<<<<<<<
  * StateMapType = """typing.Literal["arc_sum", "arc_unique", "identity"]"""
  * 
  */
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SortType, __pyx_kp_u_typing_Literal_ilabel_olabel) < 0) __PYX_ERR(0, 135, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SortType, __pyx_kp_u_typing_Literal_ilabel_olabel) < 0) __PYX_ERR(0, 137, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":136
- * ReplaceLabelType = """typing.Literal["neither", "input", "output", "both"]"""
+  /* "fstlib/cext/pywrapfst.pyx":138
+ * ReweightType = """typing.Literal["to_inital", "to_final"]"""
  * SortType = """typing.Literal["ilabel", "olabel"]"""
  * StateMapType = """typing.Literal["arc_sum", "arc_unique", "identity"]"""             # <<<<<<<<<<<<<<
  * 
  * WeightLike = "typing.Union[Weight, typing.Union[str, int, float]]"
  */
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_StateMapType, __pyx_kp_u_typing_Literal_arc_sum_arc_uniqu) < 0) __PYX_ERR(0, 136, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_StateMapType, __pyx_kp_u_typing_Literal_arc_sum_arc_uniqu) < 0) __PYX_ERR(0, 138, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":138
+  /* "fstlib/cext/pywrapfst.pyx":140
  * StateMapType = """typing.Literal["arc_sum", "arc_unique", "identity"]"""
  * 
  * WeightLike = "typing.Union[Weight, typing.Union[str, int, float]]"             # <<<<<<<<<<<<<<
  * 
  * ## Custom exceptions.
  */
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_WeightLike, __pyx_kp_u_typing_Union_Weight_typing_Union) < 0) __PYX_ERR(0, 138, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_WeightLike, __pyx_kp_u_typing_Union_Weight_typing_Union) < 0) __PYX_ERR(0, 140, __pyx_L1_error)
 
-  /* "fstlib/cext/pywrapfst.pyx":143
+  /* "fstlib/cext/pywrapfst.pyx":145
  * 
  * 
  * class FstError(Exception):             # <<<<<<<<<<<<<<
  * 
  *   pass
  */
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 145, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
   __Pyx_GIVEREF(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
   PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
-  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 143, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 145, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_1, __pyx_n_s_FstError, __pyx_n_s_FstError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 143, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_1, __pyx_n_s_FstError, __pyx_n_s_FstError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 145, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_FstError, __pyx_t_1, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 143, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_FstError, __pyx_t_1, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 145, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstError, __pyx_t_4) < 0) __PYX_ERR(0, 143, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstError, __pyx_t_4) < 0) __PYX_ERR(0, 145, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":148
+  /* "fstlib/cext/pywrapfst.pyx":150
  * 
  * 
  * class FstArgError(FstError, ValueError):             # <<<<<<<<<<<<<<
  * 
  *   pass
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_FstError); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_FstError); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 148, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 150, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_INCREF(__pyx_builtin_ValueError);
   __Pyx_GIVEREF(__pyx_builtin_ValueError);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_builtin_ValueError);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_2, __pyx_n_s_FstArgError, __pyx_n_s_FstArgError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 148, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_2, __pyx_n_s_FstArgError, __pyx_n_s_FstArgError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 150, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_FstArgError, __pyx_t_2, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 148, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_FstArgError, __pyx_t_2, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 150, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstArgError, __pyx_t_4) < 0) __PYX_ERR(0, 148, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstArgError, __pyx_t_4) < 0) __PYX_ERR(0, 150, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":153
+  /* "fstlib/cext/pywrapfst.pyx":155
  * 
  * 
  * class FstBadWeightError(FstError, ValueError):             # <<<<<<<<<<<<<<
  * 
  *   pass
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 153, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 155, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 153, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 155, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
   __Pyx_INCREF(__pyx_builtin_ValueError);
   __Pyx_GIVEREF(__pyx_builtin_ValueError);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_builtin_ValueError);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 153, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 155, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_1, __pyx_n_s_FstBadWeightError, __pyx_n_s_FstBadWeightError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 153, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_1, __pyx_n_s_FstBadWeightError, __pyx_n_s_FstBadWeightError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 155, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_FstBadWeightError, __pyx_t_1, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 153, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_FstBadWeightError, __pyx_t_1, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 155, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstBadWeightError, __pyx_t_4) < 0) __PYX_ERR(0, 153, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstBadWeightError, __pyx_t_4) < 0) __PYX_ERR(0, 155, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":158
+  /* "fstlib/cext/pywrapfst.pyx":160
  * 
  * 
  * class FstIndexError(FstError, IndexError):             # <<<<<<<<<<<<<<
  * 
  *   pass
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_FstError); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 158, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_FstError); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 160, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 158, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 160, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_INCREF(__pyx_builtin_IndexError);
   __Pyx_GIVEREF(__pyx_builtin_IndexError);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_builtin_IndexError);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 158, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 160, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_2, __pyx_n_s_FstIndexError, __pyx_n_s_FstIndexError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 158, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_2, __pyx_n_s_FstIndexError, __pyx_n_s_FstIndexError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 160, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_FstIndexError, __pyx_t_2, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 158, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_FstIndexError, __pyx_t_2, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 160, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstIndexError, __pyx_t_4) < 0) __PYX_ERR(0, 158, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstIndexError, __pyx_t_4) < 0) __PYX_ERR(0, 160, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":163
+  /* "fstlib/cext/pywrapfst.pyx":165
  * 
  * 
  * class FstIOError(FstError, IOError):             # <<<<<<<<<<<<<<
  * 
  *   pass
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 163, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FstError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 163, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
   __Pyx_INCREF(__pyx_builtin_IOError);
   __Pyx_GIVEREF(__pyx_builtin_IOError);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_builtin_IOError);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 163, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_1, __pyx_n_s_FstIOError, __pyx_n_s_FstIOError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 163, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_1, __pyx_n_s_FstIOError, __pyx_n_s_FstIOError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_FstIOError, __pyx_t_1, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 163, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_FstIOError, __pyx_t_1, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstIOError, __pyx_t_4) < 0) __PYX_ERR(0, 163, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstIOError, __pyx_t_4) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":168
+  /* "fstlib/cext/pywrapfst.pyx":170
  * 
  * 
  * class FstOpError(FstError, RuntimeError):             # <<<<<<<<<<<<<<
  * 
  *   pass
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_FstError); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_FstError); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 170, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 168, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 170, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_INCREF(__pyx_builtin_RuntimeError);
   __Pyx_GIVEREF(__pyx_builtin_RuntimeError);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_builtin_RuntimeError);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 170, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_2, __pyx_n_s_FstOpError, __pyx_n_s_FstOpError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 168, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_2, __pyx_n_s_FstOpError, __pyx_n_s_FstOpError, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 170, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_FstOpError, __pyx_t_2, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 168, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_FstOpError, __pyx_t_2, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 170, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstOpError, __pyx_t_4) < 0) __PYX_ERR(0, 168, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstOpError, __pyx_t_4) < 0) __PYX_ERR(0, 170, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":462
+  /* "fstlib/cext/pywrapfst.pyx":523
  * 
  *   @classmethod
  *   def zero(cls, weight_type):             # <<<<<<<<<<<<<<
  *     """
  *     Weight.zero(weight_type)
  */
-  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, __pyx_n_s_zero); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 462, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, __pyx_n_s_zero); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 523, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "fstlib/cext/pywrapfst.pyx":461
+  /* "fstlib/cext/pywrapfst.pyx":522
  *   # C++ part out-of-class and then call it from within.
  * 
  *   @classmethod             # <<<<<<<<<<<<<<
  *   def zero(cls, weight_type):
  *     """
  */
-  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 522, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight->tp_dict, __pyx_n_s_zero, __pyx_t_1) < 0) __PYX_ERR(0, 462, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight->tp_dict, __pyx_n_s_zero, __pyx_t_1) < 0) __PYX_ERR(0, 523, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight);
 
-  /* "fstlib/cext/pywrapfst.pyx":471
+  /* "fstlib/cext/pywrapfst.pyx":532
  * 
  *   @classmethod
  *   def one(cls, weight_type):             # <<<<<<<<<<<<<<
  *     """
  *     Weight.one(weight_type)
  */
-  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, __pyx_n_s_one); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 471, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, __pyx_n_s_one); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 532, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
 
-  /* "fstlib/cext/pywrapfst.pyx":470
+  /* "fstlib/cext/pywrapfst.pyx":531
  *     return _zero(weight_type)
  * 
  *   @classmethod             # <<<<<<<<<<<<<<
  *   def one(cls, weight_type):
  *     """
  */
-  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 470, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 531, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight->tp_dict, __pyx_n_s_one, __pyx_t_2) < 0) __PYX_ERR(0, 471, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight->tp_dict, __pyx_n_s_one, __pyx_t_2) < 0) __PYX_ERR(0, 532, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight);
 
-  /* "fstlib/cext/pywrapfst.pyx":480
+  /* "fstlib/cext/pywrapfst.pyx":541
  * 
  *   @classmethod
  *   def no_weight(cls, weight_type):             # <<<<<<<<<<<<<<
  *     """
  *     Weight.no_weight(weight_type)
  */
-  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, __pyx_n_s_no_weight); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 480, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight, __pyx_n_s_no_weight); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 541, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "fstlib/cext/pywrapfst.pyx":479
+  /* "fstlib/cext/pywrapfst.pyx":540
  *     return _one(weight_type)
  * 
  *   @classmethod             # <<<<<<<<<<<<<<
  *   def no_weight(cls, weight_type):
  *     """
  */
-  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 479, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight->tp_dict, __pyx_n_s_no_weight, __pyx_t_1) < 0) __PYX_ERR(0, 480, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight->tp_dict, __pyx_n_s_no_weight, __pyx_t_1) < 0) __PYX_ERR(0, 541, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_Weight);
 
-  /* "fstlib/cext/pywrapfst.pyx":515
+  /* "fstlib/cext/pywrapfst.pyx":576
  * 
  * 
  * def plus(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   plus(lhs, rhs)
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_1plus, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 515, __pyx_L1_error)
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_1plus, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 576, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_plus, __pyx_t_1) < 0) __PYX_ERR(0, 515, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_plus, __pyx_t_1) < 0) __PYX_ERR(0, 576, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":547
+  /* "fstlib/cext/pywrapfst.pyx":608
  * 
  * 
  * def times(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   times(lhs, rhs)
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_3times, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 547, __pyx_L1_error)
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_3times, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 608, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_times, __pyx_t_1) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_times, __pyx_t_1) < 0) __PYX_ERR(0, 608, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":579
+  /* "fstlib/cext/pywrapfst.pyx":640
  * 
  * 
  * def divide(Weight lhs, Weight rhs):             # <<<<<<<<<<<<<<
  *   """
  *   divide(lhs, rhs)
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_5divide, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 579, __pyx_L1_error)
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_5divide, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 640, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_divide, __pyx_t_1) < 0) __PYX_ERR(0, 579, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_divide, __pyx_t_1) < 0) __PYX_ERR(0, 640, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":612
+  /* "fstlib/cext/pywrapfst.pyx":673
  * 
  * 
  * def power(Weight w, size_t n):             # <<<<<<<<<<<<<<
  *   """
  *   power(lhs, rhs)
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_7power, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 612, __pyx_L1_error)
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_7power, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 673, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_power, __pyx_t_1) < 0) __PYX_ERR(0, 612, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_power, __pyx_t_1) < 0) __PYX_ERR(0, 673, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":1011
+  /* "fstlib/cext/pywrapfst.pyx":1072
  *     return mutable_raw
  * 
- *   cpdef int64 add_symbol(self, symbol, int64 key=fst.kNoSymbol) except *:             # <<<<<<<<<<<<<<
+ *   cpdef int64_t add_symbol(self, symbol, int64_t key=fst.kNoSymbol) except *:             # <<<<<<<<<<<<<<
  *     """
  *     add_symbol(self, symbol, key=NO_SYMBOL)
  */
   __pyx_k__6 = fst::kNoSymbol;
   __pyx_k__6 = fst::kNoSymbol;
 
-  /* "fstlib/cext/pywrapfst.pyx":1096
+  /* "fstlib/cext/pywrapfst.pyx":1157
  * 
  *   @classmethod
  *   def read(cls, source):             # <<<<<<<<<<<<<<
  *     """
  *     SymbolTable.read(source)
  */
-  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, __pyx_n_s_read); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1096, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, __pyx_n_s_read); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1157, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
 
-  /* "fstlib/cext/pywrapfst.pyx":1095
+  /* "fstlib/cext/pywrapfst.pyx":1156
  *     return self._smart_table.get()
  * 
  *   @classmethod             # <<<<<<<<<<<<<<
  *   def read(cls, source):
  *     """
  */
-  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1095, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1156, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable->tp_dict, __pyx_n_s_read, __pyx_t_2) < 0) __PYX_ERR(0, 1096, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable->tp_dict, __pyx_n_s_read, __pyx_t_2) < 0) __PYX_ERR(0, 1157, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable);
 
-  /* "fstlib/cext/pywrapfst.pyx":1117
+  /* "fstlib/cext/pywrapfst.pyx":1178
  * 
  *   @classmethod
  *   def read_text(cls, source, bool allow_negative_labels=False):             # <<<<<<<<<<<<<<
  *     """
  *     SymbolTable.read_text(source)
  */
-  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, __pyx_n_s_read_text); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1117, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, __pyx_n_s_read_text); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1178, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "fstlib/cext/pywrapfst.pyx":1116
+  /* "fstlib/cext/pywrapfst.pyx":1177
  *     return _init_SymbolTable(move(_symbols))
  * 
  *   @classmethod             # <<<<<<<<<<<<<<
  *   def read_text(cls, source, bool allow_negative_labels=False):
  *     """
  */
-  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1116, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1177, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable->tp_dict, __pyx_n_s_read_text, __pyx_t_1) < 0) __PYX_ERR(0, 1117, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable->tp_dict, __pyx_n_s_read_text, __pyx_t_1) < 0) __PYX_ERR(0, 1178, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable);
 
-  /* "fstlib/cext/pywrapfst.pyx":1143
+  /* "fstlib/cext/pywrapfst.pyx":1204
  * 
  *   @classmethod
  *   def read_fst(cls, source, bool input_table):             # <<<<<<<<<<<<<<
  *     """
  *     SymbolTable.read_fst(source, input_table)
  */
-  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, __pyx_n_s_read_fst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1143, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable, __pyx_n_s_read_fst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1204, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
 
-  /* "fstlib/cext/pywrapfst.pyx":1142
+  /* "fstlib/cext/pywrapfst.pyx":1203
  *     return _init_SymbolTable(move(_symbols))
  * 
  *   @classmethod             # <<<<<<<<<<<<<<
  *   def read_fst(cls, source, bool input_table):
  *     """
  */
-  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1142, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1203, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable->tp_dict, __pyx_n_s_read_fst, __pyx_t_2) < 0) __PYX_ERR(0, 1143, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable->tp_dict, __pyx_n_s_read_fst, __pyx_t_2) < 0) __PYX_ERR(0, 1204, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_SymbolTable);
 
-  /* "fstlib/cext/pywrapfst.pyx":1400
+  /* "fstlib/cext/pywrapfst.pyx":1461
  * 
  *   @classmethod
  *   def read(cls, source):             # <<<<<<<<<<<<<<
  *     """
  *     EncodeMapper.read(source)
  */
-  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper, __pyx_n_s_read); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1400, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper, __pyx_n_s_read); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1461, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "fstlib/cext/pywrapfst.pyx":1399
+  /* "fstlib/cext/pywrapfst.pyx":1460
  *     return FstProperties(self._mapper.get().Properties(mask.value))
  * 
  *   @classmethod             # <<<<<<<<<<<<<<
  *   def read(cls, source):
  *     """
  */
-  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1399, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1460, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper->tp_dict, __pyx_n_s_read, __pyx_t_1) < 0) __PYX_ERR(0, 1400, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper->tp_dict, __pyx_n_s_read, __pyx_t_1) < 0) __PYX_ERR(0, 1461, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper);
 
-  /* "fstlib/cext/pywrapfst.pyx":1422
+  /* "fstlib/cext/pywrapfst.pyx":1483
  * 
  *   @staticmethod
  *   def read_from_string(state):             # <<<<<<<<<<<<<<
  *     """
  *     read_from_string(state)
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_12EncodeMapper_19read_from_string, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1422, __pyx_L1_error)
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_12EncodeMapper_19read_from_string, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper->tp_dict, __pyx_n_s_read_from_string, __pyx_t_1) < 0) __PYX_ERR(0, 1422, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper->tp_dict, __pyx_n_s_read_from_string, __pyx_t_1) < 0) __PYX_ERR(0, 1483, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper);
 
-  /* "fstlib/cext/pywrapfst.pyx":1421
+  /* "fstlib/cext/pywrapfst.pyx":1482
  *     return _init_EncodeMapper(_mapper.release())
  * 
  *   @staticmethod             # <<<<<<<<<<<<<<
  *   def read_from_string(state):
  *     """
  */
-  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper, __pyx_n_s_read_from_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1422, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper, __pyx_n_s_read_from_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_staticmethod, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1421, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_staticmethod, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper->tp_dict, __pyx_n_s_read_from_string, __pyx_t_2) < 0) __PYX_ERR(0, 1422, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper->tp_dict, __pyx_n_s_read_from_string, __pyx_t_2) < 0) __PYX_ERR(0, 1483, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_EncodeMapper);
 
-  /* "fstlib/cext/pywrapfst.pyx":1918
+  /* "fstlib/cext/pywrapfst.pyx":1982
  * 
  *   @classmethod
  *   def read(cls, source):             # <<<<<<<<<<<<<<
  *     """
  *     read(source)
  */
-  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, __pyx_n_s_read); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1918, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, __pyx_n_s_read); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1982, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "fstlib/cext/pywrapfst.pyx":1917
+  /* "fstlib/cext/pywrapfst.pyx":1981
  *     return FstProperties(self._fst.get().Properties(mask.value, test))
  * 
  *   @classmethod             # <<<<<<<<<<<<<<
  *   def read(cls, source):
  *     """
  */
-  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1917, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1981, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst->tp_dict, __pyx_n_s_read, __pyx_t_1) < 0) __PYX_ERR(0, 1918, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst->tp_dict, __pyx_n_s_read, __pyx_t_1) < 0) __PYX_ERR(0, 1982, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst);
 
-  /* "fstlib/cext/pywrapfst.pyx":1936
+  /* "fstlib/cext/pywrapfst.pyx":2000
  * 
  *   @classmethod
  *   def read_from_string(cls, state):             # <<<<<<<<<<<<<<
  *     """
  *     read_from_string(state)
  */
-  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, __pyx_n_s_read_from_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1936, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst, __pyx_n_s_read_from_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2000, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
 
-  /* "fstlib/cext/pywrapfst.pyx":1935
+  /* "fstlib/cext/pywrapfst.pyx":1999
  *     return _read_Fst(source)
  * 
  *   @classmethod             # <<<<<<<<<<<<<<
  *   def read_from_string(cls, state):
  *     """
  */
-  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1935, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst->tp_dict, __pyx_n_s_read_from_string, __pyx_t_2) < 0) __PYX_ERR(0, 1936, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst->tp_dict, __pyx_n_s_read_from_string, __pyx_t_2) < 0) __PYX_ERR(0, 2000, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_Fst);
 
-  /* "fstlib/cext/pywrapfst.pyx":2309
+  /* "fstlib/cext/pywrapfst.pyx":2373
  * 
  *   cdef void _minimize(self,
  *                       float delta=fst.kShortestDelta,             # <<<<<<<<<<<<<<
  *                       bool allow_nondet=False) except *:
  *     # This runs in-place when the second argument is null.
  */
-  __pyx_k__12 = fst::kShortestDelta;
+  __pyx_k__10 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":2315
+  /* "fstlib/cext/pywrapfst.pyx":2379
  *     self._check_mutating_imethod()
  * 
  *   def minimize(self, float delta=fst.kShortestDelta, bool allow_nondet=False):             # <<<<<<<<<<<<<<
  *     """
  *     minimize(self, delta=1e-6, allow_nondet=False)
  */
-  __pyx_k__13 = fst::kShortestDelta;
+  __pyx_k__11 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":2410
+  /* "fstlib/cext/pywrapfst.pyx":2474
  * 
  *   cdef void _prune(self,
  *                    float delta=fst.kDelta,             # <<<<<<<<<<<<<<
- *                    int64 nstate=fst.kNoStateId,
+ *                    int64_t nstate=fst.kNoStateId,
  *                    weight=None) except *:
  */
-  __pyx_k__14 = fst::kDelta;
+  __pyx_k__12 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":2411
+  /* "fstlib/cext/pywrapfst.pyx":2475
  *   cdef void _prune(self,
  *                    float delta=fst.kDelta,
- *                    int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                    int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
  *                    weight=None) except *:
  *     # Threshold is set to semiring Zero (no pruning) if no weight is specified.
  */
-  __pyx_k__15 = fst::kNoStateId;
+  __pyx_k__13 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":2420
+  /* "fstlib/cext/pywrapfst.pyx":2484
  * 
  *   def prune(self,
  *             float delta=fst.kDelta,             # <<<<<<<<<<<<<<
- *             int64 nstate=fst.kNoStateId,
+ *             int64_t nstate=fst.kNoStateId,
  *             weight=None):
  */
-  __pyx_k__16 = fst::kDelta;
+  __pyx_k__14 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":2421
+  /* "fstlib/cext/pywrapfst.pyx":2485
  *   def prune(self,
  *             float delta=fst.kDelta,
- *             int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *             int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
  *             weight=None):
  *     """
  */
-  __pyx_k__17 = fst::kNoStateId;
+  __pyx_k__15 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":2446
+  /* "fstlib/cext/pywrapfst.pyx":2510
  * 
  *   cdef void _push(self,
  *                   float delta=fst.kShortestDelta,             # <<<<<<<<<<<<<<
  *                   bool remove_total_weight=False,
- *                   bool to_final=False):
+ *                   reweight_type="to_initial"):
  */
-  __pyx_k__18 = fst::kShortestDelta;
+  __pyx_k__16 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":2455
+  /* "fstlib/cext/pywrapfst.pyx":2519
  * 
  *   def push(self,
  *            float delta=fst.kShortestDelta,             # <<<<<<<<<<<<<<
  *            bool remove_total_weight=False,
- *            bool to_final=False):
+ *            reweight_type="to_initial"):
  */
-  __pyx_k__19 = fst::kShortestDelta;
+  __pyx_k__17 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":2686
+  /* "fstlib/cext/pywrapfst.pyx":2753
  *                        bool connect=True,
  *                        weight=None,
- *                        int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                        int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
  *                        float delta=fst.kShortestDelta) except *:
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_zero(self.weight_type(),
  */
-  __pyx_k__20 = fst::kNoStateId;
+  __pyx_k__18 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":2687
+  /* "fstlib/cext/pywrapfst.pyx":2754
  *                        weight=None,
- *                        int64 nstate=fst.kNoStateId,
+ *                        int64_t nstate=fst.kNoStateId,
  *                        float delta=fst.kShortestDelta) except *:             # <<<<<<<<<<<<<<
  *     cdef fst.WeightClass _weight = _get_WeightClass_or_zero(self.weight_type(),
  *                                                             weight)
  */
-  __pyx_k__21 = fst::kShortestDelta;
+  __pyx_k__19 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":2704
+  /* "fstlib/cext/pywrapfst.pyx":2771
  *                 bool connect=True,
  *                 weight=None,
- *                 int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                 int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
  *                 float delta=fst.kShortestDelta):
  *     """
  */
-  __pyx_k__22 = fst::kNoStateId;
+  __pyx_k__20 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":2705
+  /* "fstlib/cext/pywrapfst.pyx":2772
  *                 weight=None,
- *                 int64 nstate=fst.kNoStateId,
+ *                 int64_t nstate=fst.kNoStateId,
  *                 float delta=fst.kShortestDelta):             # <<<<<<<<<<<<<<
  *     """
  *     rmepsilon(self, queue_type="auto", connect=True, weight=None,
  */
-  __pyx_k__23 = fst::kShortestDelta;
+  __pyx_k__21 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":2977
+  /* "fstlib/cext/pywrapfst.pyx":3043
  * 
  * 
  * NO_LABEL = fst.kNoLabel             # <<<<<<<<<<<<<<
  * NO_STATE_ID = fst.kNoStateId
  * NO_SYMBOL = fst.kNoSymbol
  */
-  __pyx_t_2 = __Pyx_PyInt_From_int(fst::kNoLabel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2977, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int(fst::kNoLabel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3043, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_NO_LABEL, __pyx_t_2) < 0) __PYX_ERR(0, 2977, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_NO_LABEL, __pyx_t_2) < 0) __PYX_ERR(0, 3043, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2978
+  /* "fstlib/cext/pywrapfst.pyx":3044
  * 
  * NO_LABEL = fst.kNoLabel
  * NO_STATE_ID = fst.kNoStateId             # <<<<<<<<<<<<<<
  * NO_SYMBOL = fst.kNoSymbol
  * 
  */
-  __pyx_t_2 = __Pyx_PyInt_From_int(fst::kNoStateId); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2978, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int(fst::kNoStateId); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3044, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_NO_STATE_ID, __pyx_t_2) < 0) __PYX_ERR(0, 2978, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_NO_STATE_ID, __pyx_t_2) < 0) __PYX_ERR(0, 3044, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2979
+  /* "fstlib/cext/pywrapfst.pyx":3045
  * NO_LABEL = fst.kNoLabel
  * NO_STATE_ID = fst.kNoStateId
  * NO_SYMBOL = fst.kNoSymbol             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __Pyx_PyInt_From_int64_t(fst::kNoSymbol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2979, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(fst::kNoSymbol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_NO_SYMBOL, __pyx_t_2) < 0) __PYX_ERR(0, 2979, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_NO_SYMBOL, __pyx_t_2) < 0) __PYX_ERR(0, 3045, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2984
+  /* "fstlib/cext/pywrapfst.pyx":3050
  * ## FST properties.
  * 
  * class FstProperties(enum.Flag):             # <<<<<<<<<<<<<<
  *   EXPANDED = fst.kExpanded
  *   MUTABLE = fst.kMutable
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_enum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2984, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_enum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_Flag); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2984, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_Flag); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2984, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2984, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_2, __pyx_n_s_FstProperties, __pyx_n_s_FstProperties, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2984, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_2, __pyx_n_s_FstProperties, __pyx_n_s_FstProperties, (PyObject *) NULL, __pyx_n_s_fstlib_cext_pywrapfst, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
 
-  /* "fstlib/cext/pywrapfst.pyx":2985
+  /* "fstlib/cext/pywrapfst.pyx":3051
  * 
  * class FstProperties(enum.Flag):
  *   EXPANDED = fst.kExpanded             # <<<<<<<<<<<<<<
  *   MUTABLE = fst.kMutable
  *   ERROR = fst.kError
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kExpanded); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2985, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kExpanded); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3051, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_EXPANDED, __pyx_t_4) < 0) __PYX_ERR(0, 2985, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_EXPANDED, __pyx_t_4) < 0) __PYX_ERR(0, 3051, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2986
+  /* "fstlib/cext/pywrapfst.pyx":3052
  * class FstProperties(enum.Flag):
  *   EXPANDED = fst.kExpanded
  *   MUTABLE = fst.kMutable             # <<<<<<<<<<<<<<
  *   ERROR = fst.kError
  *   ACCEPTOR = fst.kAcceptor
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kMutable); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2986, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kMutable); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3052, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_MUTABLE, __pyx_t_4) < 0) __PYX_ERR(0, 2986, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_MUTABLE, __pyx_t_4) < 0) __PYX_ERR(0, 3052, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2987
+  /* "fstlib/cext/pywrapfst.pyx":3053
  *   EXPANDED = fst.kExpanded
  *   MUTABLE = fst.kMutable
  *   ERROR = fst.kError             # <<<<<<<<<<<<<<
  *   ACCEPTOR = fst.kAcceptor
  *   NOT_ACCEPTOR = fst.kNotAcceptor
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2987, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kError); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3053, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ERROR, __pyx_t_4) < 0) __PYX_ERR(0, 2987, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ERROR, __pyx_t_4) < 0) __PYX_ERR(0, 3053, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2988
+  /* "fstlib/cext/pywrapfst.pyx":3054
  *   MUTABLE = fst.kMutable
  *   ERROR = fst.kError
  *   ACCEPTOR = fst.kAcceptor             # <<<<<<<<<<<<<<
  *   NOT_ACCEPTOR = fst.kNotAcceptor
  *   I_DETERMINISTIC = fst.kIDeterministic
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAcceptor); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2988, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAcceptor); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3054, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ACCEPTOR, __pyx_t_4) < 0) __PYX_ERR(0, 2988, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ACCEPTOR, __pyx_t_4) < 0) __PYX_ERR(0, 3054, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2989
+  /* "fstlib/cext/pywrapfst.pyx":3055
  *   ERROR = fst.kError
  *   ACCEPTOR = fst.kAcceptor
  *   NOT_ACCEPTOR = fst.kNotAcceptor             # <<<<<<<<<<<<<<
  *   I_DETERMINISTIC = fst.kIDeterministic
  *   NON_I_DETERMINISTIC = fst.kNonIDeterministic
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotAcceptor); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2989, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotAcceptor); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3055, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_ACCEPTOR, __pyx_t_4) < 0) __PYX_ERR(0, 2989, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_ACCEPTOR, __pyx_t_4) < 0) __PYX_ERR(0, 3055, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2990
+  /* "fstlib/cext/pywrapfst.pyx":3056
  *   ACCEPTOR = fst.kAcceptor
  *   NOT_ACCEPTOR = fst.kNotAcceptor
  *   I_DETERMINISTIC = fst.kIDeterministic             # <<<<<<<<<<<<<<
  *   NON_I_DETERMINISTIC = fst.kNonIDeterministic
  *   O_DETERMINISTIC = fst.kODeterministic
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kIDeterministic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2990, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kIDeterministic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3056, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_I_DETERMINISTIC, __pyx_t_4) < 0) __PYX_ERR(0, 2990, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_I_DETERMINISTIC, __pyx_t_4) < 0) __PYX_ERR(0, 3056, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2991
+  /* "fstlib/cext/pywrapfst.pyx":3057
  *   NOT_ACCEPTOR = fst.kNotAcceptor
  *   I_DETERMINISTIC = fst.kIDeterministic
  *   NON_I_DETERMINISTIC = fst.kNonIDeterministic             # <<<<<<<<<<<<<<
  *   O_DETERMINISTIC = fst.kODeterministic
  *   NON_O_DETERMINISTIC = fst.kNonODeterministic
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNonIDeterministic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2991, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNonIDeterministic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3057, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NON_I_DETERMINISTIC, __pyx_t_4) < 0) __PYX_ERR(0, 2991, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NON_I_DETERMINISTIC, __pyx_t_4) < 0) __PYX_ERR(0, 3057, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2992
+  /* "fstlib/cext/pywrapfst.pyx":3058
  *   I_DETERMINISTIC = fst.kIDeterministic
  *   NON_I_DETERMINISTIC = fst.kNonIDeterministic
  *   O_DETERMINISTIC = fst.kODeterministic             # <<<<<<<<<<<<<<
  *   NON_O_DETERMINISTIC = fst.kNonODeterministic
  *   EPSILONS = fst.kEpsilons
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kODeterministic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2992, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kODeterministic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3058, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_O_DETERMINISTIC, __pyx_t_4) < 0) __PYX_ERR(0, 2992, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_O_DETERMINISTIC, __pyx_t_4) < 0) __PYX_ERR(0, 3058, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2993
+  /* "fstlib/cext/pywrapfst.pyx":3059
  *   NON_I_DETERMINISTIC = fst.kNonIDeterministic
  *   O_DETERMINISTIC = fst.kODeterministic
  *   NON_O_DETERMINISTIC = fst.kNonODeterministic             # <<<<<<<<<<<<<<
  *   EPSILONS = fst.kEpsilons
  *   NO_EPSILONS = fst.kNoEpsilons
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNonODeterministic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2993, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNonODeterministic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3059, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NON_O_DETERMINISTIC, __pyx_t_4) < 0) __PYX_ERR(0, 2993, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NON_O_DETERMINISTIC, __pyx_t_4) < 0) __PYX_ERR(0, 3059, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2994
+  /* "fstlib/cext/pywrapfst.pyx":3060
  *   O_DETERMINISTIC = fst.kODeterministic
  *   NON_O_DETERMINISTIC = fst.kNonODeterministic
  *   EPSILONS = fst.kEpsilons             # <<<<<<<<<<<<<<
  *   NO_EPSILONS = fst.kNoEpsilons
  *   I_EPSILONS = fst.kIEpsilons
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2994, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3060, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 2994, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 3060, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2995
+  /* "fstlib/cext/pywrapfst.pyx":3061
  *   NON_O_DETERMINISTIC = fst.kNonODeterministic
  *   EPSILONS = fst.kEpsilons
  *   NO_EPSILONS = fst.kNoEpsilons             # <<<<<<<<<<<<<<
  *   I_EPSILONS = fst.kIEpsilons
  *   NO_I_EPSILONS = fst.kNoIEpsilons
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNoEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2995, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNoEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3061, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NO_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 2995, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NO_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 3061, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2996
+  /* "fstlib/cext/pywrapfst.pyx":3062
  *   EPSILONS = fst.kEpsilons
  *   NO_EPSILONS = fst.kNoEpsilons
  *   I_EPSILONS = fst.kIEpsilons             # <<<<<<<<<<<<<<
  *   NO_I_EPSILONS = fst.kNoIEpsilons
  *   O_EPSILONS = fst.kOEpsilons
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kIEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2996, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kIEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3062, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_I_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 2996, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_I_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 3062, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2997
+  /* "fstlib/cext/pywrapfst.pyx":3063
  *   NO_EPSILONS = fst.kNoEpsilons
  *   I_EPSILONS = fst.kIEpsilons
  *   NO_I_EPSILONS = fst.kNoIEpsilons             # <<<<<<<<<<<<<<
  *   O_EPSILONS = fst.kOEpsilons
  *   NO_O_EPSILONS = fst.kNoOEpsilons
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNoIEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2997, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNoIEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3063, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NO_I_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 2997, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NO_I_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 3063, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2998
+  /* "fstlib/cext/pywrapfst.pyx":3064
  *   I_EPSILONS = fst.kIEpsilons
  *   NO_I_EPSILONS = fst.kNoIEpsilons
  *   O_EPSILONS = fst.kOEpsilons             # <<<<<<<<<<<<<<
  *   NO_O_EPSILONS = fst.kNoOEpsilons
  *   I_LABEL_SORTED = fst.kILabelSorted
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kOEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2998, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kOEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3064, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_O_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 2998, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_O_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 3064, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2999
+  /* "fstlib/cext/pywrapfst.pyx":3065
  *   NO_I_EPSILONS = fst.kNoIEpsilons
  *   O_EPSILONS = fst.kOEpsilons
  *   NO_O_EPSILONS = fst.kNoOEpsilons             # <<<<<<<<<<<<<<
  *   I_LABEL_SORTED = fst.kILabelSorted
  *   NOT_I_LABEL_SORTED = fst.kNotILabelSorted
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNoOEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2999, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNoOEpsilons); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3065, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NO_O_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 2999, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NO_O_EPSILONS, __pyx_t_4) < 0) __PYX_ERR(0, 3065, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3000
+  /* "fstlib/cext/pywrapfst.pyx":3066
  *   O_EPSILONS = fst.kOEpsilons
  *   NO_O_EPSILONS = fst.kNoOEpsilons
  *   I_LABEL_SORTED = fst.kILabelSorted             # <<<<<<<<<<<<<<
  *   NOT_I_LABEL_SORTED = fst.kNotILabelSorted
  *   O_LABEL_SORTED = fst.kOLabelSorted
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kILabelSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3000, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kILabelSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3066, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_I_LABEL_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3000, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_I_LABEL_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3066, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3001
+  /* "fstlib/cext/pywrapfst.pyx":3067
  *   NO_O_EPSILONS = fst.kNoOEpsilons
  *   I_LABEL_SORTED = fst.kILabelSorted
  *   NOT_I_LABEL_SORTED = fst.kNotILabelSorted             # <<<<<<<<<<<<<<
  *   O_LABEL_SORTED = fst.kOLabelSorted
  *   NOT_O_LABEL_SORTED = fst.kNotOLabelSorted
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotILabelSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3001, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotILabelSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3067, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_I_LABEL_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3001, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_I_LABEL_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3067, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3002
+  /* "fstlib/cext/pywrapfst.pyx":3068
  *   I_LABEL_SORTED = fst.kILabelSorted
  *   NOT_I_LABEL_SORTED = fst.kNotILabelSorted
  *   O_LABEL_SORTED = fst.kOLabelSorted             # <<<<<<<<<<<<<<
  *   NOT_O_LABEL_SORTED = fst.kNotOLabelSorted
  *   WEIGHTED = fst.kWeighted
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kOLabelSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3002, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kOLabelSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3068, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_O_LABEL_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3002, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_O_LABEL_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3068, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3003
+  /* "fstlib/cext/pywrapfst.pyx":3069
  *   NOT_I_LABEL_SORTED = fst.kNotILabelSorted
  *   O_LABEL_SORTED = fst.kOLabelSorted
  *   NOT_O_LABEL_SORTED = fst.kNotOLabelSorted             # <<<<<<<<<<<<<<
  *   WEIGHTED = fst.kWeighted
  *   UNWEIGHTED = fst.kUnweighted
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotOLabelSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3003, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotOLabelSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3069, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_O_LABEL_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3003, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_O_LABEL_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3069, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3004
+  /* "fstlib/cext/pywrapfst.pyx":3070
  *   O_LABEL_SORTED = fst.kOLabelSorted
  *   NOT_O_LABEL_SORTED = fst.kNotOLabelSorted
  *   WEIGHTED = fst.kWeighted             # <<<<<<<<<<<<<<
  *   UNWEIGHTED = fst.kUnweighted
  *   CYCLIC = fst.kCyclic
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kWeighted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3004, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kWeighted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_WEIGHTED, __pyx_t_4) < 0) __PYX_ERR(0, 3004, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_WEIGHTED, __pyx_t_4) < 0) __PYX_ERR(0, 3070, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3005
+  /* "fstlib/cext/pywrapfst.pyx":3071
  *   NOT_O_LABEL_SORTED = fst.kNotOLabelSorted
  *   WEIGHTED = fst.kWeighted
  *   UNWEIGHTED = fst.kUnweighted             # <<<<<<<<<<<<<<
  *   CYCLIC = fst.kCyclic
  *   ACYCLIC = fst.kAcyclic
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kUnweighted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3005, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kUnweighted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3071, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_UNWEIGHTED, __pyx_t_4) < 0) __PYX_ERR(0, 3005, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_UNWEIGHTED, __pyx_t_4) < 0) __PYX_ERR(0, 3071, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3006
+  /* "fstlib/cext/pywrapfst.pyx":3072
  *   WEIGHTED = fst.kWeighted
  *   UNWEIGHTED = fst.kUnweighted
  *   CYCLIC = fst.kCyclic             # <<<<<<<<<<<<<<
  *   ACYCLIC = fst.kAcyclic
  *   INITIAL_CYCLIC = fst.kInitialCyclic
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kCyclic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3006, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kCyclic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3072, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_CYCLIC, __pyx_t_4) < 0) __PYX_ERR(0, 3006, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_CYCLIC, __pyx_t_4) < 0) __PYX_ERR(0, 3072, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3007
+  /* "fstlib/cext/pywrapfst.pyx":3073
  *   UNWEIGHTED = fst.kUnweighted
  *   CYCLIC = fst.kCyclic
  *   ACYCLIC = fst.kAcyclic             # <<<<<<<<<<<<<<
  *   INITIAL_CYCLIC = fst.kInitialCyclic
  *   INITIAL_ACYCLIC = fst.kInitialAcyclic
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAcyclic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3007, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAcyclic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3073, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ACYCLIC, __pyx_t_4) < 0) __PYX_ERR(0, 3007, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ACYCLIC, __pyx_t_4) < 0) __PYX_ERR(0, 3073, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3008
+  /* "fstlib/cext/pywrapfst.pyx":3074
  *   CYCLIC = fst.kCyclic
  *   ACYCLIC = fst.kAcyclic
  *   INITIAL_CYCLIC = fst.kInitialCyclic             # <<<<<<<<<<<<<<
  *   INITIAL_ACYCLIC = fst.kInitialAcyclic
  *   TOP_SORTED = fst.kTopSorted
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kInitialCyclic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3008, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kInitialCyclic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3074, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_INITIAL_CYCLIC, __pyx_t_4) < 0) __PYX_ERR(0, 3008, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_INITIAL_CYCLIC, __pyx_t_4) < 0) __PYX_ERR(0, 3074, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3009
+  /* "fstlib/cext/pywrapfst.pyx":3075
  *   ACYCLIC = fst.kAcyclic
  *   INITIAL_CYCLIC = fst.kInitialCyclic
  *   INITIAL_ACYCLIC = fst.kInitialAcyclic             # <<<<<<<<<<<<<<
  *   TOP_SORTED = fst.kTopSorted
  *   NOT_TOP_SORTED = fst.kNotTopSorted
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kInitialAcyclic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3009, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kInitialAcyclic); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3075, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_INITIAL_ACYCLIC, __pyx_t_4) < 0) __PYX_ERR(0, 3009, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_INITIAL_ACYCLIC, __pyx_t_4) < 0) __PYX_ERR(0, 3075, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3010
+  /* "fstlib/cext/pywrapfst.pyx":3076
  *   INITIAL_CYCLIC = fst.kInitialCyclic
  *   INITIAL_ACYCLIC = fst.kInitialAcyclic
  *   TOP_SORTED = fst.kTopSorted             # <<<<<<<<<<<<<<
  *   NOT_TOP_SORTED = fst.kNotTopSorted
  *   ACCESSIBLE = fst.kAccessible
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kTopSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3010, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kTopSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3076, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_TOP_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3010, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_TOP_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3076, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3011
+  /* "fstlib/cext/pywrapfst.pyx":3077
  *   INITIAL_ACYCLIC = fst.kInitialAcyclic
  *   TOP_SORTED = fst.kTopSorted
  *   NOT_TOP_SORTED = fst.kNotTopSorted             # <<<<<<<<<<<<<<
  *   ACCESSIBLE = fst.kAccessible
  *   NOT_ACCESSIBLE = fst.kNotAccessible
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotTopSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3011, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotTopSorted); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3077, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_TOP_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3011, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_TOP_SORTED, __pyx_t_4) < 0) __PYX_ERR(0, 3077, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3012
+  /* "fstlib/cext/pywrapfst.pyx":3078
  *   TOP_SORTED = fst.kTopSorted
  *   NOT_TOP_SORTED = fst.kNotTopSorted
  *   ACCESSIBLE = fst.kAccessible             # <<<<<<<<<<<<<<
  *   NOT_ACCESSIBLE = fst.kNotAccessible
  *   COACCESSIBLE = fst.kCoAccessible
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAccessible); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3012, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAccessible); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3078, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ACCESSIBLE, __pyx_t_4) < 0) __PYX_ERR(0, 3012, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ACCESSIBLE, __pyx_t_4) < 0) __PYX_ERR(0, 3078, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3013
+  /* "fstlib/cext/pywrapfst.pyx":3079
  *   NOT_TOP_SORTED = fst.kNotTopSorted
  *   ACCESSIBLE = fst.kAccessible
  *   NOT_ACCESSIBLE = fst.kNotAccessible             # <<<<<<<<<<<<<<
  *   COACCESSIBLE = fst.kCoAccessible
  *   NOT_COACCESSIBLE = fst.kNotCoAccessible
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotAccessible); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3013, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotAccessible); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3079, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_ACCESSIBLE, __pyx_t_4) < 0) __PYX_ERR(0, 3013, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_ACCESSIBLE, __pyx_t_4) < 0) __PYX_ERR(0, 3079, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3014
+  /* "fstlib/cext/pywrapfst.pyx":3080
  *   ACCESSIBLE = fst.kAccessible
  *   NOT_ACCESSIBLE = fst.kNotAccessible
  *   COACCESSIBLE = fst.kCoAccessible             # <<<<<<<<<<<<<<
  *   NOT_COACCESSIBLE = fst.kNotCoAccessible
  *   STRING = fst.kString
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kCoAccessible); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3014, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kCoAccessible); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3080, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_COACCESSIBLE, __pyx_t_4) < 0) __PYX_ERR(0, 3014, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_COACCESSIBLE, __pyx_t_4) < 0) __PYX_ERR(0, 3080, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3015
+  /* "fstlib/cext/pywrapfst.pyx":3081
  *   NOT_ACCESSIBLE = fst.kNotAccessible
  *   COACCESSIBLE = fst.kCoAccessible
  *   NOT_COACCESSIBLE = fst.kNotCoAccessible             # <<<<<<<<<<<<<<
  *   STRING = fst.kString
  *   NOT_STRING = fst.kNotString
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotCoAccessible); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3015, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotCoAccessible); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3081, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_COACCESSIBLE, __pyx_t_4) < 0) __PYX_ERR(0, 3015, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_COACCESSIBLE, __pyx_t_4) < 0) __PYX_ERR(0, 3081, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3016
+  /* "fstlib/cext/pywrapfst.pyx":3082
  *   COACCESSIBLE = fst.kCoAccessible
  *   NOT_COACCESSIBLE = fst.kNotCoAccessible
  *   STRING = fst.kString             # <<<<<<<<<<<<<<
  *   NOT_STRING = fst.kNotString
  *   WEIGHTED_CYCLES = fst.kWeightedCycles
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kString); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3016, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kString); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3082, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_STRING, __pyx_t_4) < 0) __PYX_ERR(0, 3016, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_STRING, __pyx_t_4) < 0) __PYX_ERR(0, 3082, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3017
+  /* "fstlib/cext/pywrapfst.pyx":3083
  *   NOT_COACCESSIBLE = fst.kNotCoAccessible
  *   STRING = fst.kString
  *   NOT_STRING = fst.kNotString             # <<<<<<<<<<<<<<
  *   WEIGHTED_CYCLES = fst.kWeightedCycles
  *   UNWEIGHTED_CYCLES = fst.kUnweightedCycles
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotString); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3017, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNotString); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3083, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_STRING, __pyx_t_4) < 0) __PYX_ERR(0, 3017, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NOT_STRING, __pyx_t_4) < 0) __PYX_ERR(0, 3083, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3018
+  /* "fstlib/cext/pywrapfst.pyx":3084
  *   STRING = fst.kString
  *   NOT_STRING = fst.kNotString
  *   WEIGHTED_CYCLES = fst.kWeightedCycles             # <<<<<<<<<<<<<<
  *   UNWEIGHTED_CYCLES = fst.kUnweightedCycles
  *   # TODO(wolfsonkin): Figure out how to keep the composite properties (all the
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kWeightedCycles); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3018, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kWeightedCycles); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3084, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_WEIGHTED_CYCLES, __pyx_t_4) < 0) __PYX_ERR(0, 3018, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_WEIGHTED_CYCLES, __pyx_t_4) < 0) __PYX_ERR(0, 3084, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3019
+  /* "fstlib/cext/pywrapfst.pyx":3085
  *   NOT_STRING = fst.kNotString
  *   WEIGHTED_CYCLES = fst.kWeightedCycles
  *   UNWEIGHTED_CYCLES = fst.kUnweightedCycles             # <<<<<<<<<<<<<<
  *   # TODO(wolfsonkin): Figure out how to keep the composite properties (all the
  *   # below properties) out of the `repr`, but still available as an attribute on
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kUnweightedCycles); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3019, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kUnweightedCycles); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3085, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_UNWEIGHTED_CYCLES, __pyx_t_4) < 0) __PYX_ERR(0, 3019, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_UNWEIGHTED_CYCLES, __pyx_t_4) < 0) __PYX_ERR(0, 3085, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3023
+  /* "fstlib/cext/pywrapfst.pyx":3089
  *   # below properties) out of the `repr`, but still available as an attribute on
  *   # the class. I think this could be done with `property`.
  *   NULL_PROPERTIES = fst.kNullProperties             # <<<<<<<<<<<<<<
  *   COPY_PROPERTIES = fst.kCopyProperties
  *   INTRINSIC_PROPERTIES = fst.kIntrinsicProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNullProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3023, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNullProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3089, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NULL_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3023, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NULL_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3089, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3024
+  /* "fstlib/cext/pywrapfst.pyx":3090
  *   # the class. I think this could be done with `property`.
  *   NULL_PROPERTIES = fst.kNullProperties
  *   COPY_PROPERTIES = fst.kCopyProperties             # <<<<<<<<<<<<<<
  *   INTRINSIC_PROPERTIES = fst.kIntrinsicProperties
  *   EXTRINSIC_PROPERTIES = fst.kExtrinsicProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kCopyProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3024, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kCopyProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3090, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_COPY_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3024, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_COPY_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3090, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3025
+  /* "fstlib/cext/pywrapfst.pyx":3091
  *   NULL_PROPERTIES = fst.kNullProperties
  *   COPY_PROPERTIES = fst.kCopyProperties
  *   INTRINSIC_PROPERTIES = fst.kIntrinsicProperties             # <<<<<<<<<<<<<<
  *   EXTRINSIC_PROPERTIES = fst.kExtrinsicProperties
  *   SET_START_PROPERTIES = fst.kSetStartProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kIntrinsicProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3025, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kIntrinsicProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3091, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_INTRINSIC_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3025, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_INTRINSIC_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3091, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3026
+  /* "fstlib/cext/pywrapfst.pyx":3092
  *   COPY_PROPERTIES = fst.kCopyProperties
  *   INTRINSIC_PROPERTIES = fst.kIntrinsicProperties
  *   EXTRINSIC_PROPERTIES = fst.kExtrinsicProperties             # <<<<<<<<<<<<<<
  *   SET_START_PROPERTIES = fst.kSetStartProperties
  *   SET_FINAL_PROPERTIES = fst.kSetFinalProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kExtrinsicProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3026, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kExtrinsicProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3092, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_EXTRINSIC_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3026, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_EXTRINSIC_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3092, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3027
+  /* "fstlib/cext/pywrapfst.pyx":3093
  *   INTRINSIC_PROPERTIES = fst.kIntrinsicProperties
  *   EXTRINSIC_PROPERTIES = fst.kExtrinsicProperties
  *   SET_START_PROPERTIES = fst.kSetStartProperties             # <<<<<<<<<<<<<<
  *   SET_FINAL_PROPERTIES = fst.kSetFinalProperties
  *   ADD_STATE_PROPERTIES = fst.kAddStateProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kSetStartProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3027, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kSetStartProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3093, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_SET_START_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3027, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_SET_START_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3093, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3028
+  /* "fstlib/cext/pywrapfst.pyx":3094
  *   EXTRINSIC_PROPERTIES = fst.kExtrinsicProperties
  *   SET_START_PROPERTIES = fst.kSetStartProperties
  *   SET_FINAL_PROPERTIES = fst.kSetFinalProperties             # <<<<<<<<<<<<<<
  *   ADD_STATE_PROPERTIES = fst.kAddStateProperties
  *   ADD_ARC_PROPERTIES = fst.kAddArcProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kSetFinalProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3028, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kSetFinalProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3094, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_SET_FINAL_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3028, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_SET_FINAL_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3094, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3029
+  /* "fstlib/cext/pywrapfst.pyx":3095
  *   SET_START_PROPERTIES = fst.kSetStartProperties
  *   SET_FINAL_PROPERTIES = fst.kSetFinalProperties
  *   ADD_STATE_PROPERTIES = fst.kAddStateProperties             # <<<<<<<<<<<<<<
  *   ADD_ARC_PROPERTIES = fst.kAddArcProperties
  *   SET_ARC_PROPERTIES = fst.kSetArcProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAddStateProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3029, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAddStateProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3095, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ADD_STATE_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3029, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ADD_STATE_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3095, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3030
+  /* "fstlib/cext/pywrapfst.pyx":3096
  *   SET_FINAL_PROPERTIES = fst.kSetFinalProperties
  *   ADD_STATE_PROPERTIES = fst.kAddStateProperties
  *   ADD_ARC_PROPERTIES = fst.kAddArcProperties             # <<<<<<<<<<<<<<
  *   SET_ARC_PROPERTIES = fst.kSetArcProperties
  *   DELETE_STATE_PROPERTIES = fst.kDeleteStatesProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAddArcProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3030, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAddArcProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3096, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ADD_ARC_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3030, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ADD_ARC_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3096, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3031
+  /* "fstlib/cext/pywrapfst.pyx":3097
  *   ADD_STATE_PROPERTIES = fst.kAddStateProperties
  *   ADD_ARC_PROPERTIES = fst.kAddArcProperties
  *   SET_ARC_PROPERTIES = fst.kSetArcProperties             # <<<<<<<<<<<<<<
  *   DELETE_STATE_PROPERTIES = fst.kDeleteStatesProperties
  *   DELETE_ARC_PROPERTIES = fst.kDeleteArcsProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kSetArcProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3031, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kSetArcProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3097, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_SET_ARC_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3031, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_SET_ARC_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3097, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3032
+  /* "fstlib/cext/pywrapfst.pyx":3098
  *   ADD_ARC_PROPERTIES = fst.kAddArcProperties
  *   SET_ARC_PROPERTIES = fst.kSetArcProperties
  *   DELETE_STATE_PROPERTIES = fst.kDeleteStatesProperties             # <<<<<<<<<<<<<<
  *   DELETE_ARC_PROPERTIES = fst.kDeleteArcsProperties
  *   STATE_SORT_PROPERTIES = fst.kStateSortProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kDeleteStatesProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3032, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kDeleteStatesProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3098, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_DELETE_STATE_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3032, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_DELETE_STATE_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3098, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3033
+  /* "fstlib/cext/pywrapfst.pyx":3099
  *   SET_ARC_PROPERTIES = fst.kSetArcProperties
  *   DELETE_STATE_PROPERTIES = fst.kDeleteStatesProperties
  *   DELETE_ARC_PROPERTIES = fst.kDeleteArcsProperties             # <<<<<<<<<<<<<<
  *   STATE_SORT_PROPERTIES = fst.kStateSortProperties
  *   ARC_SORT_PROPERTIES = fst.kArcSortProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kDeleteArcsProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3033, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kDeleteArcsProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3099, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_DELETE_ARC_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3033, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_DELETE_ARC_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3099, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3034
+  /* "fstlib/cext/pywrapfst.pyx":3100
  *   DELETE_STATE_PROPERTIES = fst.kDeleteStatesProperties
  *   DELETE_ARC_PROPERTIES = fst.kDeleteArcsProperties
  *   STATE_SORT_PROPERTIES = fst.kStateSortProperties             # <<<<<<<<<<<<<<
  *   ARC_SORT_PROPERTIES = fst.kArcSortProperties
  *   I_LABEL_INVARIANT_PROPERTIES = fst.kILabelInvariantProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kStateSortProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3034, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kStateSortProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_STATE_SORT_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3034, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_STATE_SORT_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3100, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3035
+  /* "fstlib/cext/pywrapfst.pyx":3101
  *   DELETE_ARC_PROPERTIES = fst.kDeleteArcsProperties
  *   STATE_SORT_PROPERTIES = fst.kStateSortProperties
  *   ARC_SORT_PROPERTIES = fst.kArcSortProperties             # <<<<<<<<<<<<<<
  *   I_LABEL_INVARIANT_PROPERTIES = fst.kILabelInvariantProperties
  *   O_LABEL_INVARIANT_PROPERTIES = fst.kOLabelInvariantProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kArcSortProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3035, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kArcSortProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3101, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ARC_SORT_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3035, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ARC_SORT_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3101, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3036
+  /* "fstlib/cext/pywrapfst.pyx":3102
  *   STATE_SORT_PROPERTIES = fst.kStateSortProperties
  *   ARC_SORT_PROPERTIES = fst.kArcSortProperties
  *   I_LABEL_INVARIANT_PROPERTIES = fst.kILabelInvariantProperties             # <<<<<<<<<<<<<<
  *   O_LABEL_INVARIANT_PROPERTIES = fst.kOLabelInvariantProperties
  *   WEIGHT_INVARIANT_PROPERTIES = fst.kWeightInvariantProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kILabelInvariantProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3036, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kILabelInvariantProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_I_LABEL_INVARIANT_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3036, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_I_LABEL_INVARIANT_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3037
+  /* "fstlib/cext/pywrapfst.pyx":3103
  *   ARC_SORT_PROPERTIES = fst.kArcSortProperties
  *   I_LABEL_INVARIANT_PROPERTIES = fst.kILabelInvariantProperties
  *   O_LABEL_INVARIANT_PROPERTIES = fst.kOLabelInvariantProperties             # <<<<<<<<<<<<<<
  *   WEIGHT_INVARIANT_PROPERTIES = fst.kWeightInvariantProperties
  *   ADD_SUPERFINAL_PROPERTIES = fst.kAddSuperFinalProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kOLabelInvariantProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3037, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kOLabelInvariantProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3103, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_O_LABEL_INVARIANT_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3037, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_O_LABEL_INVARIANT_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3103, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3038
+  /* "fstlib/cext/pywrapfst.pyx":3104
  *   I_LABEL_INVARIANT_PROPERTIES = fst.kILabelInvariantProperties
  *   O_LABEL_INVARIANT_PROPERTIES = fst.kOLabelInvariantProperties
  *   WEIGHT_INVARIANT_PROPERTIES = fst.kWeightInvariantProperties             # <<<<<<<<<<<<<<
  *   ADD_SUPERFINAL_PROPERTIES = fst.kAddSuperFinalProperties
  *   RM_SUPERFINAL_PROPERTIES = fst.kRmSuperFinalProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kWeightInvariantProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3038, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kWeightInvariantProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3104, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_WEIGHT_INVARIANT_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3038, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_WEIGHT_INVARIANT_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3104, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3039
+  /* "fstlib/cext/pywrapfst.pyx":3105
  *   O_LABEL_INVARIANT_PROPERTIES = fst.kOLabelInvariantProperties
  *   WEIGHT_INVARIANT_PROPERTIES = fst.kWeightInvariantProperties
  *   ADD_SUPERFINAL_PROPERTIES = fst.kAddSuperFinalProperties             # <<<<<<<<<<<<<<
  *   RM_SUPERFINAL_PROPERTIES = fst.kRmSuperFinalProperties
  *   BINARY_PROPERTIES = fst.kBinaryProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAddSuperFinalProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3039, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kAddSuperFinalProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3105, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ADD_SUPERFINAL_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3039, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_ADD_SUPERFINAL_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3105, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3040
+  /* "fstlib/cext/pywrapfst.pyx":3106
  *   WEIGHT_INVARIANT_PROPERTIES = fst.kWeightInvariantProperties
  *   ADD_SUPERFINAL_PROPERTIES = fst.kAddSuperFinalProperties
  *   RM_SUPERFINAL_PROPERTIES = fst.kRmSuperFinalProperties             # <<<<<<<<<<<<<<
  *   BINARY_PROPERTIES = fst.kBinaryProperties
  *   TRINARY_PROPERTIES = fst.kTrinaryProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kRmSuperFinalProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3040, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kRmSuperFinalProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_RM_SUPERFINAL_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3040, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_RM_SUPERFINAL_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3106, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3041
+  /* "fstlib/cext/pywrapfst.pyx":3107
  *   ADD_SUPERFINAL_PROPERTIES = fst.kAddSuperFinalProperties
  *   RM_SUPERFINAL_PROPERTIES = fst.kRmSuperFinalProperties
  *   BINARY_PROPERTIES = fst.kBinaryProperties             # <<<<<<<<<<<<<<
  *   TRINARY_PROPERTIES = fst.kTrinaryProperties
  *   POS_TRINARY_PROPERTIES = fst.kPosTrinaryProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kBinaryProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3041, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kBinaryProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3107, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_BINARY_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3041, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_BINARY_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3107, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3042
+  /* "fstlib/cext/pywrapfst.pyx":3108
  *   RM_SUPERFINAL_PROPERTIES = fst.kRmSuperFinalProperties
  *   BINARY_PROPERTIES = fst.kBinaryProperties
  *   TRINARY_PROPERTIES = fst.kTrinaryProperties             # <<<<<<<<<<<<<<
  *   POS_TRINARY_PROPERTIES = fst.kPosTrinaryProperties
  *   NEG_TRINARY_PROPERTIES = fst.kNegTrinaryProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kTrinaryProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3042, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kTrinaryProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_TRINARY_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3042, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_TRINARY_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3043
+  /* "fstlib/cext/pywrapfst.pyx":3109
  *   BINARY_PROPERTIES = fst.kBinaryProperties
  *   TRINARY_PROPERTIES = fst.kTrinaryProperties
  *   POS_TRINARY_PROPERTIES = fst.kPosTrinaryProperties             # <<<<<<<<<<<<<<
  *   NEG_TRINARY_PROPERTIES = fst.kNegTrinaryProperties
  *   FST_PROPERTIES = fst.kFstProperties
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kPosTrinaryProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3043, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kPosTrinaryProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_POS_TRINARY_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3043, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_POS_TRINARY_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3044
+  /* "fstlib/cext/pywrapfst.pyx":3110
  *   TRINARY_PROPERTIES = fst.kTrinaryProperties
  *   POS_TRINARY_PROPERTIES = fst.kPosTrinaryProperties
  *   NEG_TRINARY_PROPERTIES = fst.kNegTrinaryProperties             # <<<<<<<<<<<<<<
  *   FST_PROPERTIES = fst.kFstProperties
  * 
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNegTrinaryProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3044, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kNegTrinaryProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NEG_TRINARY_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3044, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_NEG_TRINARY_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3110, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3045
+  /* "fstlib/cext/pywrapfst.pyx":3111
  *   POS_TRINARY_PROPERTIES = fst.kPosTrinaryProperties
  *   NEG_TRINARY_PROPERTIES = fst.kNegTrinaryProperties
  *   FST_PROPERTIES = fst.kFstProperties             # <<<<<<<<<<<<<<
  * 
  * for name, member in FstProperties.__members__.items():
  */
-  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kFstProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3045, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_uint64_t(fst::kFstProperties); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3111, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_FST_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3045, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_FST_PROPERTIES, __pyx_t_4) < 0) __PYX_ERR(0, 3111, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":2984
+  /* "fstlib/cext/pywrapfst.pyx":3050
  * ## FST properties.
  * 
  * class FstProperties(enum.Flag):             # <<<<<<<<<<<<<<
  *   EXPANDED = fst.kExpanded
  *   MUTABLE = fst.kMutable
  */
-  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_FstProperties, __pyx_t_2, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2984, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_FstProperties, __pyx_t_2, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstProperties, __pyx_t_4) < 0) __PYX_ERR(0, 2984, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FstProperties, __pyx_t_4) < 0) __PYX_ERR(0, 3050, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3047
+  /* "fstlib/cext/pywrapfst.pyx":3113
  *   FST_PROPERTIES = fst.kFstProperties
  * 
  * for name, member in FstProperties.__members__.items():             # <<<<<<<<<<<<<<
  *   globals()[name] = member
  * 
  */
   __pyx_t_5 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_FstProperties); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3047, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_FstProperties); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_members); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3047, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_members); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (unlikely(__pyx_t_3 == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-    __PYX_ERR(0, 3047, __pyx_L1_error)
+    __PYX_ERR(0, 3113, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_dict_iterator(__pyx_t_3, 0, __pyx_n_s_items, (&__pyx_t_6), (&__pyx_t_7)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3047, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_dict_iterator(__pyx_t_3, 0, __pyx_n_s_items, (&__pyx_t_6), (&__pyx_t_7)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_XDECREF(__pyx_t_2);
   __pyx_t_2 = __pyx_t_1;
   __pyx_t_1 = 0;
   while (1) {
     __pyx_t_8 = __Pyx_dict_iter_next(__pyx_t_2, __pyx_t_6, &__pyx_t_5, &__pyx_t_1, &__pyx_t_3, NULL, __pyx_t_7);
     if (unlikely(__pyx_t_8 == 0)) break;
-    if (unlikely(__pyx_t_8 == -1)) __PYX_ERR(0, 3047, __pyx_L1_error)
+    if (unlikely(__pyx_t_8 == -1)) __PYX_ERR(0, 3113, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GOTREF(__pyx_t_3);
-    if (PyDict_SetItem(__pyx_d, __pyx_n_s_name_2, __pyx_t_1) < 0) __PYX_ERR(0, 3047, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_d, __pyx_n_s_name_2, __pyx_t_1) < 0) __PYX_ERR(0, 3113, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (PyDict_SetItem(__pyx_d, __pyx_n_s_member, __pyx_t_3) < 0) __PYX_ERR(0, 3047, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_d, __pyx_n_s_member, __pyx_t_3) < 0) __PYX_ERR(0, 3113, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "fstlib/cext/pywrapfst.pyx":3048
+    /* "fstlib/cext/pywrapfst.pyx":3114
  * 
  * for name, member in FstProperties.__members__.items():
  *   globals()[name] = member             # <<<<<<<<<<<<<<
  * 
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_member); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3048, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_member); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3114, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_1 = __Pyx_Globals(); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3048, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_Globals(); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3114, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (unlikely(__pyx_t_1 == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 3048, __pyx_L1_error)
+      __PYX_ERR(0, 3114, __pyx_L1_error)
     }
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_name_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3048, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_name_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3114, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    if (unlikely(PyObject_SetItem(__pyx_t_1, __pyx_t_4, __pyx_t_3) < 0)) __PYX_ERR(0, 3048, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_t_1, __pyx_t_4, __pyx_t_3) < 0)) __PYX_ERR(0, 3114, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3054
+  /* "fstlib/cext/pywrapfst.pyx":3120
  * 
  * 
  * ARC_I_LABEL_VALUE = fst.kArcILabelValue             # <<<<<<<<<<<<<<
  * ARC_O_LABEL_VALUE = fst.kArcOLabelValue
  * ARC_WEIGHT_VALUE = fst.kArcWeightValue
  */
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcILabelValue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3054, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcILabelValue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_I_LABEL_VALUE, __pyx_t_2) < 0) __PYX_ERR(0, 3054, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_I_LABEL_VALUE, __pyx_t_2) < 0) __PYX_ERR(0, 3120, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3055
+  /* "fstlib/cext/pywrapfst.pyx":3121
  * 
  * ARC_I_LABEL_VALUE = fst.kArcILabelValue
  * ARC_O_LABEL_VALUE = fst.kArcOLabelValue             # <<<<<<<<<<<<<<
  * ARC_WEIGHT_VALUE = fst.kArcWeightValue
  * ARC_NEXT_STATE_VALUE = fst.kArcNextStateValue
  */
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcOLabelValue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3055, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcOLabelValue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3121, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_O_LABEL_VALUE, __pyx_t_2) < 0) __PYX_ERR(0, 3055, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_O_LABEL_VALUE, __pyx_t_2) < 0) __PYX_ERR(0, 3121, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3056
+  /* "fstlib/cext/pywrapfst.pyx":3122
  * ARC_I_LABEL_VALUE = fst.kArcILabelValue
  * ARC_O_LABEL_VALUE = fst.kArcOLabelValue
  * ARC_WEIGHT_VALUE = fst.kArcWeightValue             # <<<<<<<<<<<<<<
  * ARC_NEXT_STATE_VALUE = fst.kArcNextStateValue
  * ARC_NO_CACHE = fst.kArcNoCache
  */
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcWeightValue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3056, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcWeightValue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_WEIGHT_VALUE, __pyx_t_2) < 0) __PYX_ERR(0, 3056, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_WEIGHT_VALUE, __pyx_t_2) < 0) __PYX_ERR(0, 3122, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3057
+  /* "fstlib/cext/pywrapfst.pyx":3123
  * ARC_O_LABEL_VALUE = fst.kArcOLabelValue
  * ARC_WEIGHT_VALUE = fst.kArcWeightValue
  * ARC_NEXT_STATE_VALUE = fst.kArcNextStateValue             # <<<<<<<<<<<<<<
  * ARC_NO_CACHE = fst.kArcNoCache
  * ARC_VALUE_FLAGS = fst.kArcValueFlags
  */
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcNextStateValue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3057, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcNextStateValue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3123, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_NEXT_STATE_VALUE, __pyx_t_2) < 0) __PYX_ERR(0, 3057, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_NEXT_STATE_VALUE, __pyx_t_2) < 0) __PYX_ERR(0, 3123, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3058
+  /* "fstlib/cext/pywrapfst.pyx":3124
  * ARC_WEIGHT_VALUE = fst.kArcWeightValue
  * ARC_NEXT_STATE_VALUE = fst.kArcNextStateValue
  * ARC_NO_CACHE = fst.kArcNoCache             # <<<<<<<<<<<<<<
  * ARC_VALUE_FLAGS = fst.kArcValueFlags
  * ARC_FLAGS = fst.kArcFlags
  */
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcNoCache); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3058, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcNoCache); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_NO_CACHE, __pyx_t_2) < 0) __PYX_ERR(0, 3058, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_NO_CACHE, __pyx_t_2) < 0) __PYX_ERR(0, 3124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3059
+  /* "fstlib/cext/pywrapfst.pyx":3125
  * ARC_NEXT_STATE_VALUE = fst.kArcNextStateValue
  * ARC_NO_CACHE = fst.kArcNoCache
  * ARC_VALUE_FLAGS = fst.kArcValueFlags             # <<<<<<<<<<<<<<
  * ARC_FLAGS = fst.kArcFlags
  * 
  */
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcValueFlags); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3059, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcValueFlags); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3125, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_VALUE_FLAGS, __pyx_t_2) < 0) __PYX_ERR(0, 3059, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_VALUE_FLAGS, __pyx_t_2) < 0) __PYX_ERR(0, 3125, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3060
+  /* "fstlib/cext/pywrapfst.pyx":3126
  * ARC_NO_CACHE = fst.kArcNoCache
  * ARC_VALUE_FLAGS = fst.kArcValueFlags
  * ARC_FLAGS = fst.kArcFlags             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcFlags); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3060, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kArcFlags); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3126, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_FLAGS, __pyx_t_2) < 0) __PYX_ERR(0, 3060, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARC_FLAGS, __pyx_t_2) < 0) __PYX_ERR(0, 3126, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3066
+  /* "fstlib/cext/pywrapfst.pyx":3132
  * 
  * 
  * ENCODE_LABELS = fst.kEncodeLabels             # <<<<<<<<<<<<<<
  * ENCODE_WEIGHTS = fst.kEncodeWeights
  * ENCODE_FLAGS = fst.kEncodeFlags
  */
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kEncodeLabels); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3066, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kEncodeLabels); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ENCODE_LABELS, __pyx_t_2) < 0) __PYX_ERR(0, 3066, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ENCODE_LABELS, __pyx_t_2) < 0) __PYX_ERR(0, 3132, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3067
+  /* "fstlib/cext/pywrapfst.pyx":3133
  * 
  * ENCODE_LABELS = fst.kEncodeLabels
  * ENCODE_WEIGHTS = fst.kEncodeWeights             # <<<<<<<<<<<<<<
  * ENCODE_FLAGS = fst.kEncodeFlags
  * 
  */
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kEncodeWeights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3067, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kEncodeWeights); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3133, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ENCODE_WEIGHTS, __pyx_t_2) < 0) __PYX_ERR(0, 3067, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ENCODE_WEIGHTS, __pyx_t_2) < 0) __PYX_ERR(0, 3133, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3068
+  /* "fstlib/cext/pywrapfst.pyx":3134
  * ENCODE_LABELS = fst.kEncodeLabels
  * ENCODE_WEIGHTS = fst.kEncodeWeights
  * ENCODE_FLAGS = fst.kEncodeFlags             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kEncodeFlags); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3068, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t(fst::kEncodeFlags); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3134, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ENCODE_FLAGS, __pyx_t_2) < 0) __PYX_ERR(0, 3068, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ENCODE_FLAGS, __pyx_t_2) < 0) __PYX_ERR(0, 3134, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":3451
+  /* "fstlib/cext/pywrapfst.pyx":3592
  * 
  * cdef Fst _map(Fst ifst,
  *                float delta=fst.kDelta,             # <<<<<<<<<<<<<<
  *                map_type="identity",
  *                double power=1.,
  */
-  __pyx_k__32 = fst::kDelta;
+  __pyx_k__30 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3468
+  /* "fstlib/cext/pywrapfst.pyx":3609
  * 
  * cpdef Fst arcmap(Fst ifst,
  *                  float delta=fst.kDelta,             # <<<<<<<<<<<<<<
  *                  map_type="identity",
  *                  double power=1.,
  */
-  __pyx_k__33 = fst::kDelta;
+  __pyx_k__31 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3467
+  /* "fstlib/cext/pywrapfst.pyx":3608
  * 
  * 
  * cpdef Fst arcmap(Fst ifst,             # <<<<<<<<<<<<<<
  *                  float delta=fst.kDelta,
  *                  map_type="identity",
  */
-  __pyx_k__33 = fst::kDelta;
+  __pyx_k__31 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3577
+  /* "fstlib/cext/pywrapfst.pyx":3718
  * 
  * cpdef MutableFst determinize(Fst ifst,
  *                              float delta=fst.kShortestDelta,             # <<<<<<<<<<<<<<
  *                              det_type="functional",
- *                              int64 nstate=fst.kNoStateId,
+ *                              int64_t nstate=fst.kNoStateId,
  */
-  __pyx_k__34 = fst::kShortestDelta;
+  __pyx_k__32 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3579
+  /* "fstlib/cext/pywrapfst.pyx":3720
  *                              float delta=fst.kShortestDelta,
  *                              det_type="functional",
- *                              int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
- *                              int64 subsequential_label=0,
+ *                              int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                              int64_t subsequential_label=0,
  *                              weight=None,
  */
-  __pyx_k__35 = fst::kNoStateId;
+  __pyx_k__33 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":3577
+  /* "fstlib/cext/pywrapfst.pyx":3718
  * 
  * cpdef MutableFst determinize(Fst ifst,
  *                              float delta=fst.kShortestDelta,             # <<<<<<<<<<<<<<
  *                              det_type="functional",
- *                              int64 nstate=fst.kNoStateId,
+ *                              int64_t nstate=fst.kNoStateId,
  */
-  __pyx_k__34 = fst::kShortestDelta;
+  __pyx_k__32 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3579
+  /* "fstlib/cext/pywrapfst.pyx":3720
  *                              float delta=fst.kShortestDelta,
  *                              det_type="functional",
- *                              int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
- *                              int64 subsequential_label=0,
+ *                              int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                              int64_t subsequential_label=0,
  *                              weight=None,
  */
-  __pyx_k__35 = fst::kNoStateId;
+  __pyx_k__33 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":3676
+  /* "fstlib/cext/pywrapfst.pyx":3817
  * 
  * cpdef MutableFst disambiguate(Fst ifst,
  *                               float delta=fst.kDelta,             # <<<<<<<<<<<<<<
- *                               int64 nstate=fst.kNoStateId,
- *                               int64 subsequential_label=0,
+ *                               int64_t nstate=fst.kNoStateId,
+ *                               int64_t subsequential_label=0,
  */
-  __pyx_k__36 = fst::kDelta;
+  __pyx_k__34 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3677
+  /* "fstlib/cext/pywrapfst.pyx":3818
  * cpdef MutableFst disambiguate(Fst ifst,
  *                               float delta=fst.kDelta,
- *                               int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
- *                               int64 subsequential_label=0,
+ *                               int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                               int64_t subsequential_label=0,
  *                               weight=None):
  */
-  __pyx_k__37 = fst::kNoStateId;
+  __pyx_k__35 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":3676
+  /* "fstlib/cext/pywrapfst.pyx":3817
  * 
  * cpdef MutableFst disambiguate(Fst ifst,
  *                               float delta=fst.kDelta,             # <<<<<<<<<<<<<<
- *                               int64 nstate=fst.kNoStateId,
- *                               int64 subsequential_label=0,
+ *                               int64_t nstate=fst.kNoStateId,
+ *                               int64_t subsequential_label=0,
  */
-  __pyx_k__36 = fst::kDelta;
+  __pyx_k__34 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3677
+  /* "fstlib/cext/pywrapfst.pyx":3818
  * cpdef MutableFst disambiguate(Fst ifst,
  *                               float delta=fst.kDelta,
- *                               int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
- *                               int64 subsequential_label=0,
+ *                               int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                               int64_t subsequential_label=0,
  *                               weight=None):
  */
-  __pyx_k__37 = fst::kNoStateId;
+  __pyx_k__35 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":3747
+  /* "fstlib/cext/pywrapfst.pyx":3889
  * 
  * 
  * cpdef bool equal(Fst ifst1, Fst ifst2, float delta=fst.kDelta):             # <<<<<<<<<<<<<<
  *   """
  *   equal(ifst1, ifst2, delta=0.0009765625)
  */
-  __pyx_k__38 = fst::kDelta;
-  __pyx_k__38 = fst::kDelta;
+  __pyx_k__36 = fst::kDelta;
+  __pyx_k__36 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3768
+  /* "fstlib/cext/pywrapfst.pyx":3910
  * 
  * 
  * cpdef bool equivalent(Fst ifst1, Fst ifst2, float delta=fst.kDelta):             # <<<<<<<<<<<<<<
  *   """
  *   equivalent(ifst1, ifst2, delta=0.0009765625)
  */
-  __pyx_k__39 = fst::kDelta;
-  __pyx_k__39 = fst::kDelta;
+  __pyx_k__37 = fst::kDelta;
+  __pyx_k__37 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3824
+  /* "fstlib/cext/pywrapfst.pyx":3966
  * 
  * 
  * cpdef bool isomorphic(Fst ifst1, Fst ifst2, float delta=fst.kDelta):             # <<<<<<<<<<<<<<
  *   """
  *   isomorphic(ifst1, ifst2, delta=0.0009765625)
  */
-  __pyx_k__40 = fst::kDelta;
-  __pyx_k__40 = fst::kDelta;
+  __pyx_k__38 = fst::kDelta;
+  __pyx_k__38 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3849
+  /* "fstlib/cext/pywrapfst.pyx":3991
  * 
  * cpdef MutableFst prune(Fst ifst,
  *                        float delta=fst.kDelta,             # <<<<<<<<<<<<<<
- *                        int64 nstate=fst.kNoStateId,
+ *                        int64_t nstate=fst.kNoStateId,
  *                        weight=None):
  */
-  __pyx_k__41 = fst::kDelta;
+  __pyx_k__39 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3850
+  /* "fstlib/cext/pywrapfst.pyx":3992
  * cpdef MutableFst prune(Fst ifst,
  *                        float delta=fst.kDelta,
- *                        int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                        int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
  *                        weight=None):
  *   """
  */
-  __pyx_k__42 = fst::kNoStateId;
+  __pyx_k__40 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":3849
+  /* "fstlib/cext/pywrapfst.pyx":3991
  * 
  * cpdef MutableFst prune(Fst ifst,
  *                        float delta=fst.kDelta,             # <<<<<<<<<<<<<<
- *                        int64 nstate=fst.kNoStateId,
+ *                        int64_t nstate=fst.kNoStateId,
  *                        weight=None):
  */
-  __pyx_k__41 = fst::kDelta;
+  __pyx_k__39 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3850
+  /* "fstlib/cext/pywrapfst.pyx":3992
  * cpdef MutableFst prune(Fst ifst,
  *                        float delta=fst.kDelta,
- *                        int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                        int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
  *                        weight=None):
  *   """
  */
-  __pyx_k__42 = fst::kNoStateId;
+  __pyx_k__40 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":3881
+  /* "fstlib/cext/pywrapfst.pyx":4023
  * 
  * cpdef MutableFst push(Fst ifst,
  *                       float delta=fst.kDelta,             # <<<<<<<<<<<<<<
  *                       bool push_weights=False,
  *                       bool push_labels=False,
  */
-  __pyx_k__43 = fst::kDelta;
+  __pyx_k__41 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3880
+  /* "fstlib/cext/pywrapfst.pyx":4022
  * 
  * 
  * cpdef MutableFst push(Fst ifst,             # <<<<<<<<<<<<<<
  *                       float delta=fst.kDelta,
  *                       bool push_weights=False,
  */
-  __pyx_k__43 = fst::kDelta;
+  __pyx_k__41 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3939
+  /* "fstlib/cext/pywrapfst.pyx":4082
  *                           Fst ifst2,
- *                           int32 npath=1,
+ *                           int32_t npath=1,
  *                           float delta=fst.kDelta,             # <<<<<<<<<<<<<<
  *                           select="uniform",
- *                           int32 max_length=INT32_MAX,
+ *                           int32_t max_length=numeric_limits[int32_t].max(),
  */
-  __pyx_k__44 = fst::kDelta;
+  __pyx_k__42 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3941
+  /* "fstlib/cext/pywrapfst.pyx":4084
  *                           float delta=fst.kDelta,
  *                           select="uniform",
- *                           int32 max_length=INT32_MAX,             # <<<<<<<<<<<<<<
- *                           uint64 seed=0) except *:
+ *                           int32_t max_length=numeric_limits[int32_t].max(),             # <<<<<<<<<<<<<<
+ *                           uint64_t seed=0) except *:
  *   """
  */
-  __pyx_k__45 = INT32_MAX;
+  __pyx_k__43 = std::numeric_limits<int32_t> ::max();
 
-  /* "fstlib/cext/pywrapfst.pyx":3939
+  /* "fstlib/cext/pywrapfst.pyx":4082
  *                           Fst ifst2,
- *                           int32 npath=1,
+ *                           int32_t npath=1,
  *                           float delta=fst.kDelta,             # <<<<<<<<<<<<<<
  *                           select="uniform",
- *                           int32 max_length=INT32_MAX,
+ *                           int32_t max_length=numeric_limits[int32_t].max(),
  */
-  __pyx_k__44 = fst::kDelta;
+  __pyx_k__42 = fst::kDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":3941
+  /* "fstlib/cext/pywrapfst.pyx":4084
  *                           float delta=fst.kDelta,
  *                           select="uniform",
- *                           int32 max_length=INT32_MAX,             # <<<<<<<<<<<<<<
- *                           uint64 seed=0) except *:
+ *                           int32_t max_length=numeric_limits[int32_t].max(),             # <<<<<<<<<<<<<<
+ *                           uint64_t seed=0) except *:
  *   """
  */
-  __pyx_k__45 = INT32_MAX;
+  __pyx_k__43 = std::numeric_limits<int32_t> ::max();
 
-  /* "fstlib/cext/pywrapfst.pyx":3991
- *                          int32 npath=1,
+  /* "fstlib/cext/pywrapfst.pyx":4134
+ *                          int32_t npath=1,
  *                          select="uniform",
- *                          int32 max_length=INT32_MAX,             # <<<<<<<<<<<<<<
+ *                          int32_t max_length=numeric_limits[int32_t].max(),             # <<<<<<<<<<<<<<
  *                          bool weighted=False,
  *                          bool remove_total_weight=False,
  */
-  __pyx_k__46 = INT32_MAX;
+  __pyx_k__44 = std::numeric_limits<int32_t> ::max();
 
-  /* "fstlib/cext/pywrapfst.pyx":3988
+  /* "fstlib/cext/pywrapfst.pyx":4131
  * 
  * 
  * cpdef MutableFst randgen(Fst ifst,             # <<<<<<<<<<<<<<
- *                          int32 npath=1,
+ *                          int32_t npath=1,
  *                          select="uniform",
  */
-  __pyx_k__46 = INT32_MAX;
+  __pyx_k__44 = std::numeric_limits<int32_t> ::max();
 
-  /* "fstlib/cext/pywrapfst.pyx":4130
+  /* "fstlib/cext/pywrapfst.pyx":4273
  * cdef void _shortestdistance(Fst ifst,
  *                             vector[fst.WeightClass] *distance,
  *                             float delta=fst.kShortestDelta,             # <<<<<<<<<<<<<<
- *                             int64 nstate=fst.kNoStateId,
+ *                             int64_t nstate=fst.kNoStateId,
  *                             queue_type="auto",
  */
-  __pyx_k__47 = fst::kShortestDelta;
+  __pyx_k__45 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":4131
+  /* "fstlib/cext/pywrapfst.pyx":4274
  *                             vector[fst.WeightClass] *distance,
  *                             float delta=fst.kShortestDelta,
- *                             int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                             int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
  *                             queue_type="auto",
  *                             bool reverse=False) except *:
  */
-  __pyx_k__48 = fst::kNoStateId;
+  __pyx_k__46 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":4149
+  /* "fstlib/cext/pywrapfst.pyx":4292
  * 
  * def shortestdistance(Fst ifst,
  *                      float delta=fst.kShortestDelta,             # <<<<<<<<<<<<<<
- *                      int64 nstate=fst.kNoStateId,
+ *                      int64_t nstate=fst.kNoStateId,
  *                      queue_type="auto",
  */
-  __pyx_k__49 = fst::kShortestDelta;
+  __pyx_k__47 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":4150
+  /* "fstlib/cext/pywrapfst.pyx":4293
  * def shortestdistance(Fst ifst,
  *                      float delta=fst.kShortestDelta,
- *                      int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                      int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
  *                      queue_type="auto",
  *                      bool reverse=False):
  */
-  __pyx_k__50 = fst::kNoStateId;
+  __pyx_k__48 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":4148
+  /* "fstlib/cext/pywrapfst.pyx":4291
  * 
  * 
  * def shortestdistance(Fst ifst,             # <<<<<<<<<<<<<<
  *                      float delta=fst.kShortestDelta,
- *                      int64 nstate=fst.kNoStateId,
+ *                      int64_t nstate=fst.kNoStateId,
  */
-  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_55shortestdistance, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4148, __pyx_L1_error)
+  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_6fstlib_4cext_9pywrapfst_55shortestdistance, NULL, __pyx_n_s_fstlib_cext_pywrapfst); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4291, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shortestdistance, __pyx_t_2) < 0) __PYX_ERR(0, 4148, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shortestdistance, __pyx_t_2) < 0) __PYX_ERR(0, 4291, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "fstlib/cext/pywrapfst.pyx":4186
+  /* "fstlib/cext/pywrapfst.pyx":4329
  * 
  * cpdef MutableFst shortestpath(Fst ifst,
  *                               float delta=fst.kShortestDelta,             # <<<<<<<<<<<<<<
- *                               int32 nshortest=1,
- *                               int64 nstate=fst.kNoStateId,
+ *                               int32_t nshortest=1,
+ *                               int64_t nstate=fst.kNoStateId,
  */
-  __pyx_k__51 = fst::kShortestDelta;
+  __pyx_k__49 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":4188
+  /* "fstlib/cext/pywrapfst.pyx":4331
  *                               float delta=fst.kShortestDelta,
- *                               int32 nshortest=1,
- *                               int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                               int32_t nshortest=1,
+ *                               int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
  *                               queue_type="auto",
  *                               bool unique=False,
  */
-  __pyx_k__52 = fst::kNoStateId;
+  __pyx_k__50 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":4186
+  /* "fstlib/cext/pywrapfst.pyx":4329
  * 
  * cpdef MutableFst shortestpath(Fst ifst,
  *                               float delta=fst.kShortestDelta,             # <<<<<<<<<<<<<<
- *                               int32 nshortest=1,
- *                               int64 nstate=fst.kNoStateId,
+ *                               int32_t nshortest=1,
+ *                               int64_t nstate=fst.kNoStateId,
  */
-  __pyx_k__51 = fst::kShortestDelta;
+  __pyx_k__49 = fst::kShortestDelta;
 
-  /* "fstlib/cext/pywrapfst.pyx":4188
+  /* "fstlib/cext/pywrapfst.pyx":4331
  *                               float delta=fst.kShortestDelta,
- *                               int32 nshortest=1,
- *                               int64 nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
+ *                               int32_t nshortest=1,
+ *                               int64_t nstate=fst.kNoStateId,             # <<<<<<<<<<<<<<
  *                               queue_type="auto",
  *                               bool unique=False,
  */
-  __pyx_k__52 = fst::kNoStateId;
+  __pyx_k__50 = fst::kNoStateId;
 
-  /* "fstlib/cext/pywrapfst.pyx":4453
+  /* "fstlib/cext/pywrapfst.pyx":4596
  * 
  *   @classmethod
  *   def open(cls, *sources):             # <<<<<<<<<<<<<<
  *     """
  *     FarReader.open(*sources)
  */
-  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader, __pyx_n_s_open); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4453, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader, __pyx_n_s_open); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4596, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "fstlib/cext/pywrapfst.pyx":4452
+  /* "fstlib/cext/pywrapfst.pyx":4595
  *     return f"<{self.far_type()} FarReader at 0x{id(self):x}>"
  * 
  *   @classmethod             # <<<<<<<<<<<<<<
  *   def open(cls, *sources):
  *     """
  */
-  __pyx_t_3 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4452, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4595, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader->tp_dict, __pyx_n_s_open, __pyx_t_3) < 0) __PYX_ERR(0, 4453, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader->tp_dict, __pyx_n_s_open, __pyx_t_3) < 0) __PYX_ERR(0, 4596, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_FarReader);
 
-  /* "fstlib/cext/pywrapfst.pyx":4612
+  /* "fstlib/cext/pywrapfst.pyx":4755
  * 
  *   @classmethod
  *   def create(cls, source, arc_type="standard", far_type="default"):             # <<<<<<<<<<<<<<
  *     """
  *     FarWriter.
  */
-  __Pyx_GetNameInClass(__pyx_t_3, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter, __pyx_n_s_create); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4612, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_3, (PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter, __pyx_n_s_create); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4755, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
 
-  /* "fstlib/cext/pywrapfst.pyx":4611
+  /* "fstlib/cext/pywrapfst.pyx":4754
  *     return f"<{self.far_type()} FarWriter at 0x{id(self):x}>"
  * 
  *   @classmethod             # <<<<<<<<<<<<<<
  *   def create(cls, source, arc_type="standard", far_type="default"):
  *     """
  */
-  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4611, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4754, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter->tp_dict, __pyx_n_s_create, __pyx_t_2) < 0) __PYX_ERR(0, 4612, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter->tp_dict, __pyx_n_s_create, __pyx_t_2) < 0) __PYX_ERR(0, 4755, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   PyType_Modified(__pyx_ptype_6fstlib_4cext_9pywrapfst_FarWriter);
 
-  /* "fstlib/cext/pywrapfst.pyx":4703
+  /* "fstlib/cext/pywrapfst.pyx":4846
  * 
  * # Masks fst_error_fatal in-module.
  * fst.FST_FLAGS_fst_error_fatal = False             # <<<<<<<<<<<<<<
  */
   FST_FLAGS_fst_error_fatal = 0;
 
   /* "fstlib/cext/pywrapfst.pyx":1
```

### Comparing `medicc2-0.9.2/fstlib/cext/pywrapfst.pxd` & `medicc2-1.0.0/fstlib/cext/pywrapfst.pxd`

 * *Files 8% similar despite different names*

```diff
@@ -12,26 +12,26 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 # See www.openfst.org for extensive documentation on this weighted
 # finite-state transducer library.
 
+from libc.stdint cimport int32_t
+from libc.stdint cimport int64_t
+from libc.stdint cimport uint8_t
+from libc.stdint cimport uint64_t
 
 from libcpp cimport bool
 from libcpp.memory cimport shared_ptr
 from libcpp.memory cimport unique_ptr
 from libcpp.string cimport string
 from libcpp.utility cimport pair
 from libcpp.vector cimport vector
 
-from cintegral_types cimport int32
-from cintegral_types cimport int64
-from cintegral_types cimport uint8
-from cintegral_types cimport uint64
 from cios cimport ostream
 from cios cimport stringstream
 
 cimport cpywrapfst as fst
 
 
 # Exportable helper functions.
@@ -108,21 +108,21 @@
 
   cdef const fst.SymbolTable *_raw(self)
 
   cdef void _raise_nonexistent(self) except *
 
   cdef const fst.SymbolTable *_raw_ptr_or_raise(self) except *
 
-  cpdef int64 available_key(self) except *
+  cpdef int64_t available_key(self) except *
 
   cpdef bytes checksum(self)
 
   cpdef SymbolTable copy(self)
 
-  cpdef int64 get_nth_key(self, ssize_t pos) except *
+  cpdef int64_t get_nth_key(self, ssize_t pos) except *
 
   cpdef bytes labeled_checksum(self)
 
   cpdef bool member(self, key) except *
 
   cpdef string name(self) except *
 
@@ -153,15 +153,15 @@
 
 cdef class _MutableSymbolTable(SymbolTableView):
 
   cdef fst.SymbolTable *_mutable_raw(self)
 
   cdef fst.SymbolTable *_mutable_raw_ptr_or_raise(self) except *
 
-  cpdef int64 add_symbol(self, symbol, int64 key=?) except *
+  cpdef int64_t add_symbol(self, symbol, int64_t key=?) except *
 
   cpdef void add_table(self, SymbolTableView syms) except *
 
   cpdef void set_name(self, new_name) except *
 
 
 cdef class _MutableFstSymbolTableView(_MutableSymbolTable):
@@ -211,15 +211,15 @@
 
   cdef shared_ptr[fst.EncodeMapperClass] _mapper
 
   cpdef string arc_type(self)
 
   cpdef string weight_type(self)
 
-  cpdef uint8 flags(self)
+  cpdef uint8_t flags(self)
 
   cpdef void write(self, source) except *
 
   cpdef bytes write_to_string(self)
 
   cpdef _EncodeMapperSymbolTableView input_symbols(self)
 
@@ -249,15 +249,15 @@
   cdef shared_ptr[fst.FstClass] _fst
 
   @staticmethod
   cdef string _local_render_svg(const string &)
 
   cpdef string arc_type(self)
 
-  cpdef _ArcIterator arcs(self, int64 state)
+  cpdef _ArcIterator arcs(self, int64_t state)
 
   cpdef Fst copy(self)
 
   cpdef void draw(self,
                   source,
                   SymbolTableView isymbols=?,
                   SymbolTableView osymbols=?,
@@ -266,42 +266,42 @@
                   title=?,
                   double width=?,
                   double height=?,
                   bool portrait=?,
                   bool vertical=?,
                   double ranksep=?,
                   double nodesep=?,
-                  int32 fontsize=?,
-                  int32 precision=?,
+                  int32_t fontsize=?,
+                  int32_t precision=?,
                   float_format=?,
                   bool show_weight_one=?) except *
 
-  cpdef Weight final(self, int64 state)
+  cpdef Weight final(self, int64_t state)
 
   cpdef string fst_type(self)
 
   cpdef _FstSymbolTableView input_symbols(self)
 
-  cpdef size_t num_arcs(self, int64 state) except *
+  cpdef size_t num_arcs(self, int64_t state) except *
 
-  cpdef size_t num_input_epsilons(self, int64 state) except *
+  cpdef size_t num_input_epsilons(self, int64_t state) except *
 
-  cpdef size_t num_output_epsilons(self, int64 state) except *
+  cpdef size_t num_output_epsilons(self, int64_t state) except *
 
   cpdef _FstSymbolTableView output_symbols(self)
 
   cpdef string print(self,
                     SymbolTableView isymbols=?,
                     SymbolTableView osymbols=?,
                     SymbolTableView ssymbols=?,
                     bool acceptor=?,
                     bool show_weight_one=?,
                     missing_sym=?) except *
 
-  cpdef int64 start(self)
+  cpdef int64_t start(self)
 
   cpdef _StateIterator states(self)
 
   cpdef bool verify(self)
 
   cpdef string weight_type(self)
 
@@ -312,81 +312,81 @@
 
 cdef class MutableFst(Fst):
 
   cdef shared_ptr[fst.MutableFstClass] _mfst
 
   cdef void _check_mutating_imethod(self) except *
 
-  cdef void _add_arc(self, int64 state, Arc arc) except *
+  cdef void _add_arc(self, int64_t state, Arc arc) except *
 
-  cpdef int64 add_state(self)
+  cpdef int64_t add_state(self)
 
   cpdef void add_states(self, size_t)
 
   cdef void _arcsort(self, sort_type=?) except *
 
-  cdef void _closure(self, bool closure_plus=?)
+  cdef void _closure(self, closure_type=?)
 
   cdef void _concat(self, Fst fst2) except *
 
   cdef void _connect(self)
 
   cdef void _decode(self, EncodeMapper) except *
 
-  cdef void _delete_arcs(self, int64 state, size_t n=?) except *
+  cdef void _delete_arcs(self, int64_t state, size_t n=?) except *
 
   cdef void _delete_states(self, states=?) except *
 
   cdef void _encode(self, EncodeMapper) except *
 
   cdef void _invert(self)
 
   cdef void _minimize(self, float delta=?, bool allow_nondet=?) except *
 
-  cpdef _MutableArcIterator mutable_arcs(self, int64 state)
+  cpdef _MutableArcIterator mutable_arcs(self, int64_t state)
 
-  cpdef int64 num_states(self)
+  cpdef int64_t num_states(self)
 
   cdef void _project(self, project_type) except *
 
-  cdef void _prune(self, float delta=?, int64 nstate=?, weight=?) except *
+  cdef void _prune(self, float delta=?, int64_t nstate=?, weight=?) except *
 
   cdef void _push(self,
                   float delta=?,
                   bool remove_total_weight=?,
-                  bool to_final=?)
+                  reweight_type=?)
 
   cdef void _relabel_pairs(self, ipairs=?, opairs=?) except *
 
   cdef void _relabel_tables(self,
                             SymbolTableView old_isymbols=?,
                             SymbolTableView new_isymbols=?,
                             unknown_isymbol=?,
                             bool attach_new_isymbols=?,
                             SymbolTableView old_osymbols=?,
                             SymbolTableView new_osymbols=?,
                             unknown_osymbol=?,
                             bool attach_new_osymbols=?) except *
 
-  cdef void _reserve_arcs(self, int64 state, size_t n) except *
+  cdef void _reserve_arcs(self, int64_t state, size_t n) except *
 
-  cdef void _reserve_states(self, int64 n)
+  cdef void _reserve_states(self, int64_t n)
 
-  cdef void _reweight(self, potentials, bool to_final=?) except *
+  cdef void _reweight(self, potentials, reweight_type=?) except *
 
   cdef void _rmepsilon(self,
                        queue_type=?,
                        bool connect=?,
                        weight=?,
-                       int64 nstate=?,
+                       int64_t nstate=?,
                        float delta=?) except *
 
-  cdef void _set_final(self, int64 state, weight=?) except *
+  cdef void _set_final(self, int64_t state, weight=?) except *
 
-  cdef void _set_start(self, int64 state) except *
+  cdef void _set_start(self, int64_t state) except *
 
   cdef void _set_input_symbols(self, SymbolTableView syms) except *
 
   cdef void _set_output_symbols(self, SymbolTableView syms) except *
 
   cdef void _topsort(self)
 
@@ -426,65 +426,67 @@
 cdef class _ArcIterator:
 
   cdef shared_ptr[fst.FstClass] _fst
   cdef unique_ptr[fst.ArcIteratorClass] _aiter
 
   cpdef bool done(self)
 
-  cpdef uint8 flags(self)
+  cpdef uint8_t flags(self)
 
   cpdef void next(self)
 
   cpdef size_t position(self)
 
   cpdef void reset(self)
 
   cpdef void seek(self, size_t a)
 
-  cpdef void set_flags(self, uint8 flags, uint8 mask)
+  cpdef void set_flags(self, uint8_t flags, uint8_t mask)
 
-  cpdef object value(self)
+  cdef Arc _value(self)
 
 
 cdef class _MutableArcIterator:
 
   cdef shared_ptr[fst.MutableFstClass] _mfst
   cdef unique_ptr[fst.MutableArcIteratorClass] _aiter
 
   cpdef bool done(self)
 
-  cpdef uint8 flags(self)
+  cpdef uint8_t flags(self)
 
   cpdef void next(self)
 
   cpdef size_t position(self)
 
   cpdef void reset(self)
 
   cpdef void seek(self, size_t a)
 
-  cpdef void set_flags(self, uint8 flags, uint8 mask)
+  cpdef void set_flags(self, uint8_t flags, uint8_t mask)
 
-  cpdef void set_value(self, Arc arc)
+  cdef void _set_value(self, Arc arc)
 
-  cpdef object value(self)
+  cdef Arc _value(self)
 
 
 cdef class _StateIterator:
 
   cdef shared_ptr[fst.FstClass] _fst
   cdef unique_ptr[fst.StateIteratorClass] _siter
 
   cpdef bool done(self)
 
   cpdef void next(self)
 
   cpdef void reset(self)
 
-  cpdef int64 value(self)
+  cdef int64_t _value(self)
+
+  cpdef int64_t value(self) except *
 
 
 # Constructive operations on Fst.
 
 
 cdef Fst _map(Fst ifst, float delta=?, map_type=?, double power=?, weight=?)
 
@@ -496,91 +498,91 @@
                          bool connect=?)
 
 cpdef Fst convert(Fst ifst, fst_type=?)
 
 cpdef MutableFst determinize(Fst ifst,
                              float delta=?,
                              det_type=?,
-                             int64 nstate=?,
-                             int64 subsequential_label=?,
+                             int64_t nstate=?,
+                             int64_t subsequential_label=?,
                              weight=?,
                              bool increment_subsequential_label=?)
 
 cpdef MutableFst difference(Fst ifst1,
                             Fst ifst2,
                             compose_filter=?,
                             bool connect=?)
 
 cpdef MutableFst disambiguate(Fst ifst,
                               float delta=?,
-                              int64 nstate=?,
-                              int64 subsequential_label=?,
+                              int64_t nstate=?,
+                              int64_t subsequential_label=?,
                               weight=?)
 
-cpdef MutableFst epsnormalize(Fst ifst, bool eps_norm_output=?)
+cpdef MutableFst epsnormalize(Fst ifst, eps_norm_type=?)
 
 cpdef bool equal(Fst ifst1, Fst ifst2, float delta=?)
 
 cpdef bool equivalent(Fst ifst1, Fst ifst2, float delta=?) except *
 
 cpdef MutableFst intersect(Fst ifst1,
                            Fst ifst2,
                            compose_filter=?,
                            bool connect=?)
 
 cpdef bool isomorphic(Fst ifst1, Fst ifst2, float delta=?)
 
 cpdef MutableFst prune(Fst ifst,
                        float delta=?,
-                       int64 nstate=?,
+                       int64_t nstate=?,
                        weight=?)
 
 cpdef MutableFst push(Fst ifst,
                       float delta=?,
                       bool push_weights=?,
                       bool push_labels=?,
                       bool remove_common_affix=?,
                       bool remove_total_weight=?,
-                      bool to_final=?)
+                      reweight_type=?)
 
 cpdef bool randequivalent(Fst ifst1,
                           Fst ifst2,
-                          int32 npath=?,
+                          int32_t npath=?,
                           float delta=?,
                           select=?,
-                          int32 max_length=?,
-                          uint64 seed=?) except *
+                          int32_t max_length=?,
+                          uint64_t seed=?) except *
 
 cpdef MutableFst randgen(Fst ifst,
-                         int32 npath=?,
+                         int32_t npath=?,
                          select=?,
-                         int32 max_length=?,
+                         int32_t max_length=?,
                          bool remove_total_weight=?,
                          bool weighted=?,
-                         uint64 seed=?)
+                         uint64_t seed=?)
 
 cpdef MutableFst replace(pairs,
                          call_arc_labeling=?,
                          return_arc_labeling=?,
                          bool epsilon_on_replace=?,
-                         int64 return_label=?)
+                         int64_t return_label=?)
 
 cpdef MutableFst reverse(Fst ifst, bool require_superinitial=?)
 
 cdef void _shortestdistance(Fst ifst,
                             vector[fst.WeightClass] *,
                             float delta=?,
-                            int64 nstate=?,
+                            int64_t nstate=?,
                             queue_type=?,
                             bool reverse=?) except *
 
 cpdef MutableFst shortestpath(Fst ifst,
                               float delta=?,
-                              int32 nshortest=?,
-                              int64 nstate=?,
+                              int32_t nshortest=?,
+                              int64_t nstate=?,
                               queue_type=?,
                               bool unique=?,
                               weight=?)
 
 cpdef Fst statemap(Fst ifst, map_type)
 
 cpdef MutableFst synchronize(Fst ifst)
```

### Comparing `medicc2-0.9.2/fstlib/cext/pywrapfst.pyx` & `medicc2-1.0.0/fstlib/cext/pywrapfst.pyx`

 * *Files 2% similar despite different names*

```diff
@@ -78,27 +78,26 @@
 
 # Cython operator workarounds.
 from cython.operator cimport address as addr       # &foo
 from cython.operator cimport dereference as deref  # *foo
 from cython.operator cimport preincrement as inc   # ++foo
 
 # C imports.
-from libc.stdint cimport INT32_MAX
-from libc.stdint cimport SIZE_MAX
 from libc.time cimport time
 
 # C++ imports.
 from libcpp cimport bool
 from libcpp.cast cimport static_cast
+from libcpp.limits cimport numeric_limits
 from libcpp.memory cimport static_pointer_cast
+from libcpp.utility cimport move
 
 # Missing C++ imports.
 from cios cimport ofstream
 from cmemory cimport WrapUnique
-from cutility cimport move
 
 # Python imports.
 import logging
 import enum
 import numbers
 import os
 import subprocess
@@ -112,30 +111,33 @@
 import typing
 
 ArcMapType = """typing.Literal["identity", "input_epsilon", "invert",
                                "output_epsilon", "plus", "power", "quantize",
                                "rmweight", "superfinal", "times", "to_log",
                                # NOTE: Both spellings of "to_std"
                                "to_log64", "to_std", "to_standard"]"""
+ClosureType = """Literal["star", "plus"]"""
 ComposeFilter = """typing.Literal["alt_sequence", "auto", "match", "no_match",
                            "null", "sequence", "trivial"]"""
 DeterminizeType = """typing.Literal["functional", "nonfunctional",
                                     "disambiguate"]"""
 DrawFloatFormat = """typing.Literal["e", "f", "g"]"""
+EpsNormalizeType = """typing.Literal["input", "output"]"""
 FarType = """typing.Literal[
   "fst",
   "stlist",
   "sttable",
   "default"
 ]"""
 ProjectType = """typing.Literal["input", "output"]"""
 QueueType = """typing.Literal["auto", "fifo", "lifo", "shortest", "state",
                               "top"]"""
 RandArcSelection = """typing.Literal["uniform", "log_prob", "fast_log_prob"]"""
 ReplaceLabelType = """typing.Literal["neither", "input", "output", "both"]"""
+ReweightType = """typing.Literal["to_inital", "to_final"]"""
 SortType = """typing.Literal["ilabel", "olabel"]"""
 StateMapType = """typing.Literal["arc_sum", "arc_unique", "identity"]"""
 
 WeightLike = "typing.Union[Weight, typing.Union[str, int, float]]"
 
 ## Custom exceptions.
 
@@ -248,14 +250,33 @@
   This function is not visible to Python users.
   """
   cdef fst.FarType _far_type
   if not fst.GetFarType(far_type, addr(_far_type)):
     raise FstArgError(f"Unknown FAR type: {far_type!r}")
   return _far_type
 
+cdef fst.ClosureType _get_closure_type(const string &closure_type) except *:
+  """Matches string with the appropriate ClosureType enum value.
+
+  Args:
+    closure_type: A string matching a known projection type; one of:
+        "star", "plus".
+
+  Returns:
+    A ClosureType enum value.
+
+  Raises:
+    FstArgError: Unknown closure type.
+
+  This function is not visible to Python users.
+  """
+  cdef fst.ClosureType _closure_type
+  if not fst.GetClosureType(closure_type, addr(_closure_type)):
+    raise FstArgError(f"Unknown projection type: {closure_type!r}")
+  return _closure_type
 
 cdef fst.ComposeFilter _get_compose_filter(
     const string &compose_filter) except *:
   """Matches string with the appropriate ComposeFilter enum value.
 
   This function takes a string argument and returns the matching ComposeFilter
   enum value used to initialize ComposeOptions instances. ComposeOptions is used
@@ -296,14 +317,34 @@
   This function is not visible to Python users.
   """
   cdef fst.DeterminizeType _det_type
   if not fst.GetDeterminizeType(det_type, addr(_det_type)):
     raise FstArgError(f"Unknown determinization type: {det_type!r}")
   return _det_type
 
+cdef fst.EpsNormalizeType _get_eps_norm_type(const string &eps_norm_type) except *:
+  """Matches string with the appropriate EpsNormalizeType enum value.
+
+  Args:
+    eps_norm_type: A string matching a known epsilon normalization type; one of:
+        "input", "output".
+
+  Returns:
+    A EpsNormalizeType enum value.
+
+  Raises:
+    FstArgError: Unknown epsilon normalization type.
+
+  This function is not visible to Python users.
+  """
+  cdef fst.EpsNormalizeType _eps_norm_type
+  if not fst.GetEpsNormalizeType(eps_norm_type, addr(_eps_norm_type)):
+    raise FstArgError(f"Unknown epsilon normalization type: {eps_norm_type!r}")
+  return _eps_norm_type
+
 
 cdef fst.ProjectType _get_project_type(const string &project_type) except *:
   """Matches string with the appropriate ProjectType enum value.
 
   Args:
     project_type: A string matching a known projection type; one of:
         "input", "output".
@@ -395,14 +436,34 @@
   if not fst.GetReplaceLabelType(replace_label_type,
                                  epsilon_on_replace,
                                  addr(_replace_label_type)):
     raise FstArgError(f"Unknown replace label type: {replace_label_type!r}")
   return _replace_label_type
 
 
+cdef fst.ReweightType _get_reweight_type(const string &reweight_type) except *:
+  """Matches string with the appropriate ReweightType enum value.
+
+  Args:
+    reweight_type: A string matching a known reweight type; one of:
+        "to_initial", "to_final".
+
+  Returns:
+    A ReweightType enum value.
+
+  Raises:
+    FstArgError: Unknown reweight type.
+
+  This function is not visible to Python users.
+  """
+  cdef fst.ReweightType _reweight_type
+  if not fst.GetReweightType(reweight_type, addr(_reweight_type)):
+    raise FstArgError(f"Unknown reweight type: {reweight_type!r}")
+  return _reweight_type
+
 ## Weight and helpers.
 
 
 cdef class Weight:
 
   """
   Weight(weight_type, weight_string)
@@ -769,15 +830,15 @@
   # fst.SymbolTable is required.
   cdef const_SymbolTable_ptr _raw_ptr_or_raise(self) except *:
     cdef const_SymbolTable_ptr _raw = self._raw()
     if _raw == NULL:
       self._raise_nonexistent()
     return _raw
 
-  cpdef int64 available_key(self) except *:
+  cpdef int64_t available_key(self) except *:
     """
     available_key(self)
 
     Returns an integer indicating the next available key index in the table.
     """
     return self._raw_ptr_or_raise().AvailableKey()
 
@@ -816,15 +877,15 @@
     """
     cdef const_SymbolTable_ptr _raw = self._raw_ptr_or_raise()
     try:
       return _raw.FindIndex(tostring(key))
     except TypeError:
       return _raw.FindSymbol(key)
 
-  cpdef int64 get_nth_key(self, ssize_t pos) except *:
+  cpdef int64_t get_nth_key(self, ssize_t pos) except *:
     """
     get_nth_key(self, pos)
 
     Retrieves the integer index of the n-th key in the table.
 
     Args:
       pos: The n-th key to retrieve.
@@ -1004,15 +1065,15 @@
   # fst.SymbolTable is required.
   cdef SymbolTable_ptr _mutable_raw_ptr_or_raise(self) except *:
     cdef SymbolTable_ptr mutable_raw = self._mutable_raw()
     if mutable_raw == NULL:
       self._raise_nonexistent()
     return mutable_raw
 
-  cpdef int64 add_symbol(self, symbol, int64 key=fst.kNoSymbol) except *:
+  cpdef int64_t add_symbol(self, symbol, int64_t key=fst.kNoSymbol) except *:
     """
     add_symbol(self, symbol, key=NO_SYMBOL)
 
     Adds a symbol to the table and returns the index.
 
     This method adds a symbol to the table. The caller can optionally
     specify a non-negative integer index for the key.
@@ -1281,15 +1342,15 @@
   def __iter__(self):
     return self
 
   # Magic method used to get a Pythonic API out of the C++ API.
   def __next__(self):
     if self._table._raw_ptr_or_raise().end() == deref(self._siter):
       raise StopIteration
-    cdef int64 _label = self._siter.get().Pair().Label()
+    cdef int64_t _label = self._siter.get().Pair().Label()
     cdef string _symbol = self._siter.get().Pair().Symbol()
     inc(deref(self._siter))
     return (_label, _symbol)
 
 
 ## EncodeMapper.
 
@@ -1320,15 +1381,15 @@
   def __repr__(self):
     return f"<EncodeMapper at 0x{id(self):x}>"
 
   def __init__(self,
                arc_type="standard",
                bool encode_labels=False,
                bool encode_weights=False):
-    cdef uint8 _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
+    cdef uint8_t _flags = fst.GetEncodeFlags(encode_labels, encode_weights)
     self._mapper.reset(
         new fst.EncodeMapperClass(tostring(arc_type), _flags, fst.ENCODE))
     if self._mapper.get() == NULL:
       raise FstOpError(f"Unknown arc type: {arc_type!r}")
 
   # Python's equivalent to operator().
 
@@ -1367,15 +1428,15 @@
     """
     weight_type(self)
 
     Returns a string indicating the weight type.
     """
     return self._mapper.get().WeightType()
 
-  cpdef uint8 flags(self):
+  cpdef uint8_t flags(self):
     """
     flags(self)
 
     Returns the mapper's flags.
     """
     return self._mapper.get().Flags()
 
@@ -1408,16 +1469,16 @@
 
     Args:
       source: The string location of the input binary file.
 
     Returns:
       A new EncodeMapper instance.
     """
-    cdef unique_ptr[fst.EncodeMapperClass] _mapper
-    _mapper.reset(fst.EncodeMapperClass.Read(path_tostring(source)))
+    cdef unique_ptr[fst.EncodeMapperClass] _mapper = fst.EncodeMapperClass.Read(
+        path_tostring(source))
     if _mapper.get() == NULL:
       raise FstIOError(f"Read failed: {source!r}")
     return _init_EncodeMapper(_mapper.release())
 
   @staticmethod
   def read_from_string(state):
     """
@@ -1541,16 +1602,17 @@
   result._mapper.reset(mapper)
   return result
 
 
 cpdef EncodeMapper _read_EncodeMapper_from_string(string state):
   cdef stringstream _sstrm
   _sstrm << state
-  cdef unique_ptr[fst.EncodeMapperClass] _mapper
-  _mapper.reset(fst.EncodeMapperClass.ReadStream(_sstrm, b"<pywrapfst>"))
+  cdef unique_ptr[
+      fst.EncodeMapperClass] _mapper = fst.EncodeMapperClass.ReadStream(
+          _sstrm, b"<pywrapfst>")
   if _mapper.get() == NULL:
     raise FstIOError("Read from string failed")
   return _init_EncodeMapper(_mapper.release())
 
 
 ## Fst and MutableFst.
 #
@@ -1572,15 +1634,17 @@
   mutation operations.
   """
 
   # IPython notebook magic to produce an SVG of the FST.
 
   @staticmethod
   cdef string _local_render_svg(const string &dot):
-    proc = subprocess.Popen(("dot", "-Tsvg"),
+    # As suggested in the following, we now use the Cairo renderer:
+    # https://github.com/kylebgorman/pynini/issues/35
+    proc = subprocess.Popen(["dot", "-Tsvg:cairo"],
                             stdin=subprocess.PIPE,
                             stdout=subprocess.PIPE)
     return proc.communicate(dot.encode("utf8"))[0]
 
   def _repr_svg_(self):
     """IPython notebook magic to produce an SVG of the FST using GraphViz.
 
@@ -1633,15 +1697,15 @@
     """
     arc_type(self)
 
     Returns a string indicating the arc type.
     """
     return self._fst.get().ArcType()
 
-  cpdef _ArcIterator arcs(self, int64 state):
+  cpdef _ArcIterator arcs(self, int64_t state):
     """
     arcs(self, state)
 
     Returns an iterator over arcs leaving the specified state.
 
     Args:
       state: The source state ID.
@@ -1668,16 +1732,16 @@
                   title="",
                   double width=8.5,
                   double height=11,
                   bool portrait=False,
                   bool vertical=False,
                   double ranksep=0.4,
                   double nodesep=0.25,
-                  int32 fontsize=14,
-                  int32 precision=5,
+                  int32_t fontsize=14,
+                  int32_t precision=5,
                   float_format="g",
                   bool show_weight_one=False) except *:
     """
     draw(self, source, isymbols=None, osymbols=None, ssymbols=None,
          acceptor=False, title="", width=8.5, height=11, portrait=False,
          vertical=False, ranksep=0.4, nodesep=0.25, fontsize=14,
          precision=5, float_format="g", show_weight_one=False):
@@ -1734,15 +1798,15 @@
              fontsize,
              precision,
              tostring(float_format),
              show_weight_one,
              deref(_fstrm),
              _source)
 
-  cpdef Weight final(self, int64 state):
+  cpdef Weight final(self, int64_t state):
     """
     final(self, state)
 
     Returns the final weight of a state.
 
     Args:
       state: The integer index of a state.
@@ -1773,15 +1837,15 @@
 
     Returns the FST's input symbol table, or None if none is present.
     """
     if self._fst.get().InputSymbols() == NULL:
       return
     return _init_FstSymbolTableView(self._fst, input_side=True)
 
-  cpdef size_t num_arcs(self, int64 state) except *:
+  cpdef size_t num_arcs(self, int64_t state) except *:
     """
     num_arcs(self, state)
 
     Returns the number of arcs leaving a state.
 
     Args:
       state: The integer index of a state.
@@ -1789,19 +1853,19 @@
     Returns:
       The number of arcs leaving that state.
 
     Raises:
       FstIndexError: State index out of range.
     """
     cdef size_t _result = self._fst.get().NumArcs(state)
-    if _result == SIZE_MAX:
+    if _result == numeric_limits[size_t].max():
       raise FstIndexError("State index out of range")
     return _result
 
-  cpdef size_t num_input_epsilons(self, int64 state) except *:
+  cpdef size_t num_input_epsilons(self, int64_t state) except *:
     """
     num_input_epsilons(self, state)
 
     Returns the number of arcs with epsilon input labels leaving a state.
 
     Args:
       state: The integer index of a state.
@@ -1809,19 +1873,19 @@
     Returns:
       The number of epsilon-input-labeled arcs leaving that state.
 
     Raises:
       FstIndexError: State index out of range.
     """
     cdef size_t _result = self._fst.get().NumInputEpsilons(state)
-    if _result == SIZE_MAX:
+    if _result == numeric_limits[size_t].max():
       raise FstIndexError("State index out of range")
     return _result
 
-  cpdef size_t num_output_epsilons(self, int64 state) except *:
+  cpdef size_t num_output_epsilons(self, int64_t state) except *:
     """
     num_output_epsilons(self, state)
 
     Returns the number of arcs with epsilon output labels leaving a state.
 
     Args:
       state: The integer index of a state.
@@ -1829,15 +1893,15 @@
     Returns:
       The number of epsilon-output-labeled arcs leaving that state.
 
     Raises:
       FstIndexError: State index out of range.
     """
     cdef size_t _result = self._fst.get().NumOutputEpsilons(state)
-    if _result == SIZE_MAX:
+    if _result == numeric_limits[size_t].max():
       raise FstIndexError("State index out of range")
     return _result
 
   cpdef _FstSymbolTableView output_symbols(self):
     """
     output_symbols(self)
 
@@ -1946,15 +2010,15 @@
       An FST object.
 
     Raises:
       FstIOError: Read failed.
     """
     return _read_Fst_from_string(state)
 
-  cpdef int64 start(self):
+  cpdef int64_t start(self):
     """
     start(self)
 
     Returns the start state.
     """
     return self._fst.get().Start()
 
@@ -2039,21 +2103,21 @@
   cdef void _check_mutating_imethod(self) except *:
     """Checks whether an operation mutating the FST has produced an error.
 
     This function is not visible to Python users.
     """
     if self._fst.get().Properties(fst.kError, True) == fst.kError:
       raise FstOpError("Operation failed")
-  cdef void _add_arc(self, int64 state, Arc arc) except *:
+  cdef void _add_arc(self, int64_t state, Arc arc) except *:
     if not self._fst.get().ValidStateId(state):
       raise FstIndexError("State index out of range")
     if not self._mfst.get().AddArc(state, deref(arc._arc)):
       raise FstOpError("Incompatible or invalid weight type")
 
-  def add_arc(self, int64 state, Arc arc):
+  def add_arc(self, int64_t state, Arc arc):
     """
     add_arc(self, state, arc)
 
     Adds a new arc to the FST and return self.
 
     Args:
       state: The integer index of the source state.
@@ -2065,15 +2129,15 @@
     Raises:
       FstIndexError: State index out of range.
       FstOpdexError: Incompatible or invalid weight type.
     """
     self._add_arc(state, arc)
     return self
 
-  cpdef int64 add_state(self):
+  cpdef int64_t add_state(self):
     """
     add_state(self)
 
     Adds a new state to the FST and returns the state ID.
 
     Returns:
       The integer index of the new state.
@@ -2115,36 +2179,36 @@
 
     Raises:
       FstArgError: Unknown sort type.
     """
     self._arcsort(sort_type)
     return self
 
-  cdef void _closure(self, bool closure_plus=False):
-    fst.Closure(self._mfst.get(), fst.GetClosureType(closure_plus))
+  cdef void _closure(self, closure_type="star"):
+    fst.Closure(self._mfst.get(), _get_closure_type(tostring(closure_type)))
 
-  def closure(self, bool closure_plus=False):
+  def closure(self, closure_type="star"):
     """
-    closure(self, closure_plus=False)
+    closure(self, closure_type="star")
 
     Computes concatenative closure.
 
     This operation destructively converts the FST to its concatenative closure.
     If A transduces string x to y with weight a, then the closure transduces x
     to y with weight a, xx to yy with weight a \otimes a, xxx to yyy with weight
     a \otimes a \otimes a, and so on. The empty string is also transduced to
-    itself with semiring One if `closure_plus` is False.
+    itself with semiring One if `closure_type` is "star".
 
     Args:
-      closure_plus: If False, do not accept the empty string.
+      closure_type: If "star", do not accept the empty string. If "plus", accept the empty string.
 
     Returns:
       self.
     """
-    self._closure(closure_plus)
+    self._closure(closure_type)
     return self
 
   cdef void _concat(self, Fst fst2) except *:
     fst.Concat(self._mfst.get(), deref(fst2._fst))
     self._check_mutating_imethod()
 
   def concat(self, Fst fst2):
@@ -2202,21 +2266,21 @@
 
     Returns:
       self.
     """
     self._decode(mapper)
     return self
 
-  cdef void _delete_arcs(self, int64 state, size_t n=0) except *:
+  cdef void _delete_arcs(self, int64_t state, size_t n=0) except *:
     if not (self._mfst.get().DeleteArcs(state, n) if n else
             self._mfst.get().DeleteArcs(state)):
       raise FstIndexError("State index out of range")
     self._check_mutating_imethod()
 
-  def delete_arcs(self, int64 state, size_t n=0):
+  def delete_arcs(self, int64_t state, size_t n=0):
     """
     delete_arcs(self, state, n=0)
 
     Deletes arcs leaving a particular state.
 
     Args:
       state: The integer index of a state.
@@ -2232,15 +2296,15 @@
     """
     self._delete_arcs(state, n)
     return self
 
   cdef void _delete_states(self, states=None) except *:
     # Only the former signature has a possible indexing failure.
     if states:
-      if not self._mfst.get().DeleteStates(<const vector[int64]> states):
+      if not self._mfst.get().DeleteStates(<const vector[int64_t]> states):
         raise FstIndexError("State index out of range")
     else:
       self._mfst.get().DeleteStates()
     self._check_mutating_imethod()
 
   def delete_states(self, states=None):
     """
@@ -2337,15 +2401,15 @@
 
     Returns:
       self.
     """
     self._minimize(delta, allow_nondet)
     return self
 
-  cpdef _MutableArcIterator mutable_arcs(self, int64 state):
+  cpdef _MutableArcIterator mutable_arcs(self, int64_t state):
     """
     mutable_arcs(self, state)
 
     Returns a mutable iterator over arcs leaving the specified state.
 
     Args:
       state: The source state ID.
@@ -2371,15 +2435,15 @@
 
     Returns the FST's (mutable) output symbol table, or None if none is present.
     """
     if self._mfst.get().MutableOutputSymbols() == NULL:
       return
     return _init_MutableFstSymbolTableView(self._mfst, input_side=False)
 
-  cpdef int64 num_states(self):
+  cpdef int64_t num_states(self):
     """
     num_states(self)
 
     Returns the number of states.
     """
     return self._mfst.get().NumStates()
 
@@ -2404,25 +2468,25 @@
       self.
     """
     self._project(project_type)
     return self
 
   cdef void _prune(self,
                    float delta=fst.kDelta,
-                   int64 nstate=fst.kNoStateId,
+                   int64_t nstate=fst.kNoStateId,
                    weight=None) except *:
     # Threshold is set to semiring Zero (no pruning) if no weight is specified.
     cdef fst.WeightClass _weight = _get_WeightClass_or_zero(self.weight_type(),
                                                             weight)
     fst.Prune(self._mfst.get(), _weight, nstate, delta)
     self._check_mutating_imethod()
 
   def prune(self,
             float delta=fst.kDelta,
-            int64 nstate=fst.kNoStateId,
+            int64_t nstate=fst.kNoStateId,
             weight=None):
     """
     prune(self, delta=0.0009765625, nstate=NO_STATE_ID, weight=None)
 
     Removes paths with weights below a certain threshold.
 
     This operation deletes states and arcs in the input FST that do not belong
@@ -2441,26 +2505,26 @@
     """
     self._prune(delta, nstate, weight)
     return self
 
   cdef void _push(self,
                   float delta=fst.kShortestDelta,
                   bool remove_total_weight=False,
-                  bool to_final=False):
+                  reweight_type="to_initial"):
     fst.Push(self._mfst.get(),
-             fst.GetReweightType(to_final),
+             _get_reweight_type(tostring(reweight_type)),
              delta,
              remove_total_weight)
 
   def push(self,
            float delta=fst.kShortestDelta,
            bool remove_total_weight=False,
-           bool to_final=False):
+           reweight_type="to_initial"):
     """
-    push(self, delta=1-e6, remove_total_weight=False, to_final=False)
+    push(self, delta=1-e6, remove_total_weight=False, reweight_type="to_initial")
 
     Pushes weights towards the initial or final states.
 
     This operation destructively produces an equivalent transducer by pushing
     the weights towards the initial state or toward the final states. When
     pushing weights towards the initial state, the sum of the weight of the
     outgoing transitions and final weight at any non-initial state is equal to
@@ -2469,20 +2533,21 @@
     one. Weights need to be left distributive when pushing towards the initial
     state and right distributive when pushing towards the final states.
 
     Args:
       delta: Comparison/quantization delta.
       remove_total_weight: If pushing weights, should the total weight be
           removed?
-      to_final: Push towards final states?
+      reweight_type: Push towards initial or final states: a string matching a
+          known reweight type: one of "to_initial", "to_final"
 
     Returns:
       self.
     """
-    self._push(delta, remove_total_weight, to_final)
+    self._push(delta, remove_total_weight, reweight_type)
     return self
 
   cdef void _relabel_pairs(self, ipairs=None, opairs=None) except *:
     cdef vector[fst.LabelPair] _ipairs
     cdef vector[fst.LabelPair] _opairs
     if ipairs:
       for (before, after) in ipairs:
@@ -2600,20 +2665,20 @@
                          attach_new_isymbols,
                          old_osymbols,
                          new_osymbols,
                          unknown_osymbol,
                          attach_new_osymbols)
     return self
 
-  cdef void _reserve_arcs(self, int64 state, size_t n) except *:
+  cdef void _reserve_arcs(self, int64_t state, size_t n) except *:
     if not self._mfst.get().ReserveArcs(state, n):
       raise FstIndexError("State index out of range")
     self._check_mutating_imethod()
 
-  def reserve_arcs(self, int64 state, size_t n):
+  def reserve_arcs(self, int64_t state, size_t n):
     """
     reserve_arcs(self, state, n)
 
     Reserve n arcs at a particular state (best effort).
 
     Args:
       state: The integer index of a state.
@@ -2624,70 +2689,72 @@
 
     Raises:
       FstIndexError: State index out of range.
     """
     self._reserve_arcs(state, n)
     return self
 
-  cdef void _reserve_states(self, int64 n):
+  cdef void _reserve_states(self, int64_t n):
     self._mfst.get().ReserveStates(n)
 
-  def reserve_states(self, int64 n):
+  def reserve_states(self, int64_t n):
     """
     reserve_states(self, n)
 
     Reserve n states (best effort).
 
     Args:
       n: The number of states to reserve.
 
     Returns:
       self.
     """
     self._reserve_states(n)
     return self
 
-  cdef void _reweight(self, potentials, bool to_final=False) except *:
+  cdef void _reweight(self, potentials, reweight_type="to_initial") except *:
     cdef string _weight_type = self.weight_type()
     cdef vector[fst.WeightClass] _potentials
     for weight in potentials:
       _potentials.push_back(_get_WeightClass_or_one(_weight_type, weight))
-    fst.Reweight(self._mfst.get(), _potentials, fst.GetReweightType(to_final))
+    fst.Reweight(self._mfst.get(), _potentials,
+                 _get_reweight_type(tostring(reweight_type)))
     self._check_mutating_imethod()
 
-  def reweight(self, potentials, bool to_final=False):
+  def reweight(self, potentials, reweight_type="to_initial"):
     """
-    reweight(self, potentials, to_final=False)
+    reweight(self, potentials, reweight_type="to_initial")
 
     Reweights an FST using an iterable of potentials.
 
     This operation destructively reweights an FST according to the potentials
     and in the direction specified by the user. An arc of weight w, with an
     origin state of potential p and destination state of potential q, is
     reweighted by p^{-1} \otimes (w \otimes q) when reweighting towards the
     initial state, and by (p \otimes w) \otimes q^{-1} when reweighting towards
     the final states. The weights must be left distributive when reweighting
     towards the initial state and right distributive when reweighting towards
     the final states (e.g., TropicalWeight and LogWeight).
 
     Args:
       potentials: An iterable of Weight or weight strings.
-      to_final: Push towards final states?
+      reweight_type: Push towards initial or final states: a string matching a
+          known reweight type: one of "to_initial", "to_final"
 
     Returns:
       self.
     """
-    self._reweight(potentials, to_final)
+    self._reweight(potentials, reweight_type)
     return self
 
   cdef void _rmepsilon(self,
                        queue_type="auto",
                        bool connect=True,
                        weight=None,
-                       int64 nstate=fst.kNoStateId,
+                       int64_t nstate=fst.kNoStateId,
                        float delta=fst.kShortestDelta) except *:
     cdef fst.WeightClass _weight = _get_WeightClass_or_zero(self.weight_type(),
                                                             weight)
     cdef unique_ptr[fst.RmEpsilonOptions] _opts
     _opts.reset(
         new fst.RmEpsilonOptions(_get_queue_type(tostring(queue_type)),
                                  connect,
@@ -2697,15 +2764,15 @@
     fst.RmEpsilon(self._mfst.get(), deref(_opts))
     self._check_mutating_imethod()
 
   def rmepsilon(self,
                 queue_type="auto",
                 bool connect=True,
                 weight=None,
-                int64 nstate=fst.kNoStateId,
+                int64_t nstate=fst.kNoStateId,
                 float delta=fst.kShortestDelta):
     """
     rmepsilon(self, queue_type="auto", connect=True, weight=None,
               nstate=NO_STATE_ID, delta=1e-6):
 
     Removes epsilon transitions.
 
@@ -2723,24 +2790,24 @@
 
     Returns:
       self.
     """
     self._rmepsilon(queue_type, connect, weight, nstate, delta)
     return self
 
-  cdef void _set_final(self, int64 state, weight=None) except *:
+  cdef void _set_final(self, int64_t state, weight=None) except *:
     if not self._mfst.get().ValidStateId(state):
       raise FstIndexError("State index out of range")
     cdef fst.WeightClass _weight = _get_WeightClass_or_one(self.weight_type(),
                                                           weight)
     if not self._mfst.get().SetFinal(state, _weight):
       raise FstOpError("Incompatible or invalid weight")
     self._check_mutating_imethod()
 
-  def set_final(self, int64 state, weight=None):
+  def set_final(self, int64_t state, weight=None):
     """
     set_final(self, state, weight)
 
     Sets the final weight for a state.
 
     Args:
       state: The integer index of a state.
@@ -2816,19 +2883,19 @@
 
     Returns:
       self.
     """
     self._mfst.get().SetProperties(props.value, mask.value)
     return self
 
-  cdef void _set_start(self, int64 state) except *:
+  cdef void _set_start(self, int64_t state) except *:
     if not self._mfst.get().SetStart(state):
       raise FstIndexError("State index out of range")
 
-  def set_start(self, int64 state):
+  def set_start(self, int64_t state):
     """
     set_start(self, state)
 
     Sets a state to be the initial state state.
 
     Args:
       state: The integer index of a state.
@@ -2950,26 +3017,25 @@
   if tfst.Properties(fst.kMutable, True) == fst.kMutable:
     return _init_MutableFst(static_cast[MutableFstClass_ptr](tfst))
   else:
     return _init_Fst(tfst)
 
 
 cpdef Fst _read_Fst(source):
-  cdef unique_ptr[fst.FstClass] _tfst
-  _tfst.reset(fst.FstClass.Read(path_tostring(source)))
+  cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.Read(path_tostring(source))
   if _tfst.get() == NULL:
     raise FstIOError(f"Read failed: {source!r}")
   return _init_XFst(_tfst.release())
 
 
 cpdef Fst _read_Fst_from_string(string state):
   cdef stringstream _sstrm
   _sstrm << state
-  cdef unique_ptr[fst.FstClass] _tfst
-  _tfst.reset(fst.FstClass.ReadStream(_sstrm, b"<pywrapfst>"))
+  cdef unique_ptr[fst.FstClass] _tfst = fst.FstClass.ReadStream(_sstrm,
+                                                                b"<pywrapfst>")
   if _tfst.get() == NULL:
     raise FstIOError("Read from string failed")
   return _init_XFst(_tfst.release())
 
 
 ## FST constants.
 
@@ -3086,35 +3152,35 @@
     weight: The arc weight.
     nextstate: The destination state for the arc.
   """
 
   def __repr__(self):
     return f"<Arc at 0x{id(self):x}>"
 
-  def __init__(self, int64 ilabel, int64 olabel, weight, int64 nextstate):
+  def __init__(self, int64_t ilabel, int64_t olabel, weight, int64_t nextstate):
     cdef fst.WeightClass _weight = _get_WeightClass_or_one(b"tropical", weight)
     self._arc.reset(new fst.ArcClass(ilabel, olabel, _weight, nextstate))
 
   cpdef Arc copy(self):
     return Arc(self.ilabel, self.olabel, self.weight, self.nextstate)
 
   property ilabel:
 
     def __get__(self):
       return deref(self._arc).ilabel
 
-    def __set__(self, int64 value):
+    def __set__(self, int64_t value):
       deref(self._arc).ilabel = value
 
   property olabel:
 
     def __get__(self):
       return deref(self._arc).olabel
 
-    def __set__(self, int64 value):
+    def __set__(self, int64_t value):
       deref(self._arc).olabel = value
 
   property weight:
 
     def __get__(self):
       cdef Weight _weight = Weight.__new__(Weight)
       _weight._weight.reset(new fst.WeightClass(deref(self._arc).weight))
@@ -3124,15 +3190,15 @@
       deref(self._arc).weight = _get_WeightClass_or_one(b"tropical", weight)
 
   property nextstate:
 
     def __get__(self):
       return deref(self._arc).nextstate
 
-    def __set__(self, int64 value):
+    def __set__(self, int64_t value):
       deref(self._arc).nextstate = value
 
 
 cdef Arc _init_Arc(const fst.ArcClass &arc):
   cdef Weight _weight = Weight.__new__(Weight)
   _weight._weight.reset(new fst.WeightClass(arc.weight))
   return Arc(arc.ilabel, arc.olabel, _weight, arc.nextstate)
@@ -3148,45 +3214,45 @@
 
   This class is used for iterating over the arcs leaving some state of an FST.
   """
 
   def __repr__(self):
     return f"<_ArcIterator at 0x{id(self):x}>"
 
-  def __init__(self, Fst ifst, int64 state):
+  def __init__(self, Fst ifst, int64_t state):
     if not ifst._fst.get().ValidStateId(state):
       raise FstIndexError("State index out of range")
     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
     self._fst = ifst._fst
     self._aiter.reset(new fst.ArcIteratorClass(deref(self._fst), state))
 
   # This just registers this class as a possible iterator.
   def __iter__(self):
     return self
 
   # Magic method used to get a Pythonic API out of the C++ API.
   def __next__(self):
     if self.done():
       raise StopIteration
-    result = self.value()
+    result = self._value()
     self.next()
     return result
 
   cpdef bool done(self):
     """
     done(self)
 
     Indicates whether the iterator is exhausted or not.
 
     Returns:
       True if the iterator is exhausted, False otherwise.
     """
     return self._aiter.get().Done()
 
-  cpdef uint8 flags(self):
+  cpdef uint8_t flags(self):
     """
     flags(self)
 
     Returns the current iterator behavioral flags.
 
     Returns:
       The current iterator behavioral flags as an integer.
@@ -3227,48 +3293,67 @@
     Advance the iterator to a new position.
 
     Args:
       a: The position to seek to.
     """
     self._aiter.get().Seek(a)
 
-  cpdef void set_flags(self, uint8 flags, uint8 mask):
+  cpdef void set_flags(self, uint8_t flags, uint8_t mask):
     """
     set_flags(self, flags, mask)
 
     Sets the current iterator behavioral flags.
 
     Args:
       flags: The properties to be set.
       mask: A mask to be applied to the `flags` argument before setting them.
     """
     self._aiter.get().SetFlags(flags, mask)
 
-  cpdef object value(self):
+  cdef Arc _value(self):
     """
     value(self)
 
-    Returns the current arc.
+    Returns the current arc without checking whether the iterator is exhasuted.
+
+    Returns:
+       The current arc.
     """
     return _init_Arc(self._aiter.get().Value())
 
+  def value(self):
+    """
+    value(self)
+
+    Returns the current arc.
+
+    Returns:
+       The current arc.
+
+    Raises:
+      FstOpError: Can't get value from an exhausted iterator.
+    """
+    if self._aiter.get().Done():
+      raise FstOpError("Can't get value from an exhausted iterator")
+    return self._value()
+
 
 cdef class _MutableArcIterator:
 
   """
   _MutableArcIterator(ifst, state)
 
   This class is used for iterating over the arcs leaving some state of an FST,
   also permitting mutation of the current arc.
   """
 
   def __repr__(self):
     return f"<_MutableArcIterator at 0x{id(self):x}>"
 
-  def __init__(self, MutableFst ifst, int64 state):
+  def __init__(self, MutableFst ifst, int64_t state):
     if not ifst._fst.get().ValidStateId(state):
       raise FstIndexError("State index out of range")
     # Makes copy of the shared_ptr, potentially extending the FST's lifetime.
     self._mfst = ifst._mfst
     self._aiter.reset(new fst.MutableArcIteratorClass(ifst._mfst.get(), state))
 
   # Magic method used to get a Pythonic Iterator API out of the C++ API.
@@ -3277,30 +3362,30 @@
       yield self.value()
       self.next()
 
   # Magic method used to get a Pythonic API out of the C++ API.
   def __next__(self):
     if self.done():
       raise StopIteration
-    result = self.value()
+    result = self._value()
     self.next()
     return result
 
   cpdef bool done(self):
     """
     done(self)
 
     Indicates whether the iterator is exhausted or not.
 
     Returns:
       True if the iterator is exhausted, False otherwise.
     """
     return self._aiter.get().Done()
 
-  cpdef uint8 flags(self):
+  cpdef uint8_t flags(self):
     """
     flags(self)
 
     Returns the current iterator behavioral flags.
 
     Returns:
       The current iterator behavioral flags as an integer.
@@ -3341,45 +3426,81 @@
     Advance the iterator to a new position.
 
     Args:
       a: The position to seek to.
     """
     self._aiter.get().Seek(a)
 
-  cpdef void set_flags(self, uint8 flags, uint8 mask):
+  cpdef void set_flags(self, uint8_t flags, uint8_t mask):
     """
     set_flags(self, flags, mask)
 
     Sets the current iterator behavioral flags.
 
     Args:
       flags: The properties to be set.
       mask: A mask to be applied to the `flags` argument before setting them.
     """
     self._aiter.get().SetFlags(flags, mask)
 
-  cpdef void set_value(self, Arc arc):
+  cdef void _set_value(self, Arc arc):
     """
     set_value(self, arc)
 
-    Replace the current arc with a new arc.
+    Replace the current arc with a new arc without checking whether the iterator
+    is exhausted.
 
     Args:
       arc: The arc to replace the current arc with.
     """
     self._aiter.get().SetValue(deref(arc._arc))
 
-  cpdef object value(self):
+  def set_value(self, Arc arc):
+    """
+    set_value(self, arc)
+
+    Replace the current arc with a new arc.
+
+    Args:
+      arc: The arc to replace the current arc with.
+
+    Raises:
+      FstOpError: Can't set value on an exhausted iterator.
+    """
+    if self._aiter.get().Done():
+      raise FstOpError("Can't set value on an exhausted iterator")
+    self._set_value(arc)
+
+  cdef Arc _value(self):
     """
     value(self)
 
-    Returns the current arc.
+    Returns the current arc, without checking.
+
+    Returns:
+       The current arc.
     """
     return _init_Arc(self._aiter.get().Value())
 
+  def value(self):
+    """
+    value(self)
+
+    Returns the current arc.
+
+    Returns:
+      The current arc.
+
+    Raises:
+      FstOpError: Can't get value from an exhausted iterator.
+    """
+    if self._aiter.get().Done():
+      raise FstOpError("Can't get value from an exhausted iterator")
+    return self._value()
+
 
 ## _StateIterator.
 
 
 cdef class _StateIterator:
 
   """
@@ -3400,15 +3521,15 @@
   def __iter__(self):
     return self
 
   # Magic method used to get a Pythonic API out of the C++ API.
   def __next__(self):
     if self.done():
       raise StopIteration
-    cdef int64 result = self.value()
+    cdef int64_t result = self._value()
     self.next()
     return result
 
   cpdef bool done(self):
     """
     done(self)
 
@@ -3431,22 +3552,42 @@
     """
     reset(self)
 
     Resets the iterator to the initial position.
     """
     self._siter.get().Reset()
 
-  cpdef int64 value(self):
+  cdef int64_t _value(self):
     """
-    value(self)
+    _value(self)
 
-    Returns the current state index.
+    Returns the current state without checking whether the iterator is
+    exhausted.
+
+    Returns:
+       The current state.
     """
     return self._siter.get().Value()
 
+  cpdef int64_t value(self) except *:
+    """
+    value(self)
+
+    Returns the current state.
+
+    Returns:
+       The current state.
+
+    Raises:
+      FstOpError: Can't get value from an exhausted iterator.
+    """
+    if self._siter.get().Done():
+      raise FstOpError("Can't get value from an exhausted iterator")
+    return self._value()
+
 
 ## FST operations.
 
 
 cdef Fst _map(Fst ifst,
                float delta=fst.kDelta,
                map_type="identity",
@@ -3572,16 +3713,16 @@
     raise FstOpError(f"Conversion to {fst_type!r} failed")
   return _init_XFst(_tfst.release())
 
 
 cpdef MutableFst determinize(Fst ifst,
                              float delta=fst.kShortestDelta,
                              det_type="functional",
-                             int64 nstate=fst.kNoStateId,
-                             int64 subsequential_label=0,
+                             int64_t nstate=fst.kNoStateId,
+                             int64_t subsequential_label=0,
                              weight=None,
                              bool increment_subsequential_label=False):
   """
   determinize(ifst, delta=1e-6, det_type="functional",
               nstate=NO_STATE_ID, subsequential_label=0, weight=None,
               incremental_subsequential_label=False)
 
@@ -3670,16 +3811,16 @@
                  _tfst.get(),
                  deref(_opts))
   return _init_MutableFst(_tfst.release())
 
 
 cpdef MutableFst disambiguate(Fst ifst,
                               float delta=fst.kDelta,
-                              int64 nstate=fst.kNoStateId,
-                              int64 subsequential_label=0,
+                              int64_t nstate=fst.kNoStateId,
+                              int64_t subsequential_label=0,
                               weight=None):
   """
   disambiguate(ifst, delta=0.0009765625, nstate=NO_STATE_ID,
                subsequential_label=0, weight=None):
 
   Constructively disambiguates a weighted transducer.
 
@@ -3711,40 +3852,41 @@
                                   _weight,
                                   nstate,
                                   subsequential_label))
   fst.Disambiguate(deref(ifst._fst), _tfst.get(), deref(_opts))
   return _init_MutableFst(_tfst.release())
 
 
-cpdef MutableFst epsnormalize(Fst ifst, bool eps_norm_output=False):
+cpdef MutableFst epsnormalize(Fst ifst, eps_norm_type="input"):
   """
-  epsnormalize(ifst, eps_norm_output=False)
+  epsnormalize(ifst, eps_norm_type="input")
 
   Constructively epsilon-normalizes an FST.
 
   This operation creates an equivalent FST that is epsilon-normalized. An
   acceptor is epsilon-normalized if it it is epsilon-removed (cf. `rmepsilon`).
   A transducer is input epsilon-normalized if, in addition, along any path, all
   arcs with epsilon input labels follow all arcs with non-epsilon input labels.
   Output epsilon-normalized is defined similarly. The input FST must be
   functional.
 
   Args:
     ifst: The input FST.
-    eps_norm_output: Should the FST be output epsilon-normalized?
+    eps_norm_type: A string matching a known epsilon normalization type; one of:
+          "input", "output".
 
   Returns:
     An equivalent epsilon-normalized FST.
   """
   cdef unique_ptr[fst.VectorFstClass] _tfst
   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
   fst.EpsNormalize(
       deref(ifst._fst),
       _tfst.get(),
-      fst.EPS_NORM_OUTPUT if eps_norm_output else fst.EPS_NORM_INPUT)
+    _get_eps_norm_type(tostring(eps_norm_type)))
   return _init_MutableFst(_tfst.release())
 
 
 cpdef bool equal(Fst ifst1, Fst ifst2, float delta=fst.kDelta):
   """
   equal(ifst1, ifst2, delta=0.0009765625)
 
@@ -3843,15 +3985,15 @@
     True if the two transducers satisfy the above condition, else False.
   """
   return fst.Isomorphic(deref(ifst1._fst), deref(ifst2._fst), delta)
 
 
 cpdef MutableFst prune(Fst ifst,
                        float delta=fst.kDelta,
-                       int64 nstate=fst.kNoStateId,
+                       int64_t nstate=fst.kNoStateId,
                        weight=None):
   """
   prune(ifst, delta=0.0009765625, nstate=NO_STATE_ID, weight=None)
 
   Constructively removes paths with weights below a certain threshold.
 
   This operation deletes states and arcs in the input FST that do not belong
@@ -3879,18 +4021,18 @@
 
 cpdef MutableFst push(Fst ifst,
                       float delta=fst.kDelta,
                       bool push_weights=False,
                       bool push_labels=False,
                       bool remove_common_affix=False,
                       bool remove_total_weight=False,
-                      bool to_final=False):
+                      reweight_type="to_initial"):
   """
   push(ifst, delta=0.0009765625, push_weights=False, push_labels=False,
-       remove_common_affix=False, remove_total_weight=False, to_final=False)
+       remove_common_affix=False, remove_total_weight=False, reweight_type="to_initial")
 
   Constructively pushes weights/labels towards initial or final states.
 
   This operation produces an equivalent transducer by pushing the weights
   and/or the labels towards the initial state or toward the final states.
 
   When pushing weights towards the initial state, the sum of the weight of the
@@ -3910,40 +4052,41 @@
     ifst: The input FST.
     delta: Comparison/quantization delta.
     push_weights: Should weights be pushed?
     push_labels: Should labels be pushed?
     remove_common_affix: If pushing labels, should common prefix/suffix be
         removed?
     remove_total_weight: If pushing weights, should total weight be removed?
-    to_final: Push towards final states?
+    reweight_type: Push towards initial or final states?: a string matching a
+        known reweight type: one of "to_initial", "to_final"
 
   Returns:
     An equivalent pushed FST.
   """
   cdef unique_ptr[fst.VectorFstClass] _tfst
   _tfst.reset(new fst.VectorFstClass(ifst.arc_type()))
-  cdef uint8 flags = fst.GetPushFlags(push_weights,
+  cdef uint8_t flags = fst.GetPushFlags(push_weights,
                                       push_labels,
                                       remove_common_affix,
                                       remove_total_weight)
   fst.Push(deref(ifst._fst),
            _tfst.get(),
            flags,
-           fst.GetReweightType(to_final),
+           _get_reweight_type(tostring(reweight_type)),
            delta)
   return _init_MutableFst(_tfst.release())
 
 
 cpdef bool randequivalent(Fst ifst1,
                           Fst ifst2,
-                          int32 npath=1,
+                          int32_t npath=1,
                           float delta=fst.kDelta,
                           select="uniform",
-                          int32 max_length=INT32_MAX,
-                          uint64 seed=0) except *:
+                          int32_t max_length=numeric_limits[int32_t].max(),
+                          uint64_t seed=0) except *:
   """
   randequivalent(ifst1, ifst2, npath=1, delta=0.0009765625, select="uniform",
                  max_length=2147483647, seed=0)
 
   Are two acceptors stochastically equivalent?
 
   This operation tests whether two FSTs are equivalent by randomly generating
@@ -3982,20 +4125,20 @@
                             npath,
                             deref(_opts),
                             delta,
                             seed)
 
 
 cpdef MutableFst randgen(Fst ifst,
-                         int32 npath=1,
+                         int32_t npath=1,
                          select="uniform",
-                         int32 max_length=INT32_MAX,
+                         int32_t max_length=numeric_limits[int32_t].max(),
                          bool weighted=False,
                          bool remove_total_weight=False,
-                         uint64 seed=0):
+                         uint64_t seed=0):
   """
   randgen(ifst, npath=1, seed=0, select="uniform", max_length=2147483647,
           weighted=False, remove_total_weight=False)
 
   Randomly generate successful paths in an FST.
 
   This operation randomly generates a set of successful paths in the input FST.
@@ -4037,15 +4180,15 @@
   return _init_MutableFst(_tfst.release())
 
 
 cpdef MutableFst replace(pairs,
                          call_arc_labeling="input",
                          return_arc_labeling="neither",
                          bool epsilon_on_replace=False,
-                         int64 return_label=0):
+                         int64_t return_label=0):
   """
   replace(pairs, call_arc_labeling="input", return_arc_labeling="neither",
           epsilon_on_replace=False, return_label=0)
 
   Recursively replaces arcs in the FST with other FST(s).
 
   This operation performs the dynamic replacement of arcs in one FST with
@@ -4074,15 +4217,15 @@
         this effectively overrides call_arc_labeling and return_arc_labeling,
         setting both to "neither".
     return_label: The integer label for return arcs.
 
   Returns:
     An FST resulting from expanding the input RTN.
   """
-  cdef int64 _label
+  cdef int64_t _label
   cdef Fst _pfst
   cdef vector[fst.LabelFstClassPair] _pairs
   for (_label, _pfst) in pairs:
       _pairs.push_back(fst.LabelFstClassPair(_label, _pfst._fst.get()))
   cdef unique_ptr[fst.VectorFstClass] _tfst
   _tfst.reset(new fst.VectorFstClass(_pairs[0].second.ArcType()))
   cdef fst.ReplaceLabelType _cal = _get_replace_label_type(
@@ -4124,15 +4267,15 @@
 
 # Pure C++ helper for shortestdistance.
 
 
 cdef void _shortestdistance(Fst ifst,
                             vector[fst.WeightClass] *distance,
                             float delta=fst.kShortestDelta,
-                            int64 nstate=fst.kNoStateId,
+                            int64_t nstate=fst.kNoStateId,
                             queue_type="auto",
                             bool reverse=False) except *:
   cdef unique_ptr[fst.ShortestDistanceOptions] _opts
   if reverse:
     # Only the simpler signature supports shortest distance to final states;
     # `nstate` and `queue_type` arguments are ignored.
     fst.ShortestDistance(deref(ifst._fst), distance, True, delta)
@@ -4143,15 +4286,15 @@
                                         nstate,
                                         delta))
     fst.ShortestDistance(deref(ifst._fst), distance, deref(_opts))
 
 
 def shortestdistance(Fst ifst,
                      float delta=fst.kShortestDelta,
-                     int64 nstate=fst.kNoStateId,
+                     int64_t nstate=fst.kNoStateId,
                      queue_type="auto",
                      bool reverse=False):
   """
   shortestdistance(ifst, delta=1e-6, nstate=NO_STATE_ID,
                    queue_type="auto", reverse=False)
 
   Compute the shortest distance from the initial or final state.
@@ -4180,16 +4323,16 @@
   _shortestdistance(ifst, addr(_distance), delta, nstate, queue_type, reverse)
   return [Weight(ifst._fst.get().WeightType(), weight.ToString())
           for weight in _distance]
 
 
 cpdef MutableFst shortestpath(Fst ifst,
                               float delta=fst.kShortestDelta,
-                              int32 nshortest=1,
-                              int64 nstate=fst.kNoStateId,
+                              int32_t nshortest=1,
+                              int64_t nstate=fst.kNoStateId,
                               queue_type="auto",
                               bool unique=False,
                               weight=None):
   """
   shortestpath(ifst, delta=1e-6, nshortest=1, nstate=NO_STATE_ID,
                queue_type="auto", unique=False, weight=None)
 
@@ -4381,26 +4524,26 @@
     Returns:
       The FST described by the compiler string buffer.
 
     Raises:
       FstOpError: Compilation failed.
     """
     cdef unique_ptr[fst.FstClass] _tfst
-    _tfst = fst.CompileFstInternal(deref(self._sstrm),
-                                   b"<pywrapfst>",
-                                   self._fst_type,
-                                   self._arc_type,
-                                   self._isymbols,
-                                   self._osymbols,
-                                   self._ssymbols,
-                                   self._acceptor,
-                                   self._keep_isymbols,
-                                   self._keep_osymbols,
-                                   self._keep_state_numbering,
-                                   self._allow_negative_labels)
+    _tfst = fst.CompileInternal(deref(self._sstrm),
+                                b"<pywrapfst>",
+                                self._fst_type,
+                                self._arc_type,
+                                self._isymbols,
+                                self._osymbols,
+                                self._ssymbols,
+                                self._acceptor,
+                                self._keep_isymbols,
+                                self._keep_osymbols,
+                                self._keep_state_numbering,
+                                self._allow_negative_labels)
     self._sstrm.reset(new stringstream())
     if _tfst.get() == NULL:
       raise FstOpError("Compilation failed")
     return _init_XFst(_tfst.release())
 
   cpdef void write(self, expression):
     """
```

### Comparing `medicc2-0.9.2/fstlib/core.py` & `medicc2-1.0.0/fstlib/core.py`

 * *Files 3% similar despite different names*

```diff
@@ -2,14 +2,15 @@
 
 import logging
 import math
 import os
 import sys
 import tempfile
 from io import StringIO
+import collections
 
 import numpy as np
 import pandas as pd
 
 import fstlib
 import fstlib.algos
 from fstlib.cext import pywrapfst
@@ -56,15 +57,16 @@
     def __add__(self, other):
         return self.copy().union(other)
 
     def __invert__(self):
         return self.copy().invert()
 
     def add_arc(self, state, arc):
-        """ Arc can be pywrapfst.Arc or 4-tuple (ilabel, olabel, weight, nextstate) """
+        """ Arc can be pywrapfst.Arc or 4-tuple (ilabel, olabel, weight, nextstate).
+         An extended version of pywrapfst.MutableFst.add_arc() that can handle tuples as input."""
         if isinstance(arc, pywrapfst.Arc):
             pass
         else: ## assume tuple / unpackable
             ### adds an arc object expecting the right weight type and trying
             ### to resolve symbolic (non-integer) labels via the symbol table.
             ilabel, olabel, weight, nextstate = arc
             isyms = self.input_symbols()
@@ -91,14 +93,16 @@
                 weight = pywrapfst.Weight(self.weight_type(), weight)
             arc = pywrapfst.Arc(isym, osym, weight, nextstate)
         
         self.fst.add_arc(state, arc)
         return self
 
     def add_arcs(self, state, iterable_of_arcs):
+        """ Add an iterable of arcs or 4-tuples to a state.
+        An extension to pywrapfst.MutableFst."""
         for arc in iterable_of_arcs:
             self.add_arc(state, arc)
         return self
 
     def add_state(self):
         return self.fst.add_state()
 
@@ -108,37 +112,37 @@
         return ids
         
     def arc_type(self):
         return self.fst.arc_type()
 
     def arcs(self, state):
         return self.fst.arcs(state)
-
+    
     def arcsort(self, sort_type='ilabel'):
         self.fst.arcsort(sort_type)
         return self
 
-    def closure(self, closure_plus = False):
-        self.fst.closure(closure_plus)
+    def closure(self, closure_type = "star"):
+        self.fst.closure(closure_type)
         return self
 
     def concat(self, ifst):
         self.fst.concat(ifst.fst)
         return self
 
     def connect(self):
         self.fst.connect()
         return self
 
     def copy(self):
         newfst = self.fst.copy()
         return fstlib.core.Fst(newfst)
 
-    def decode(self, encoder):
-        self.fst.decode(encoder)
+    def decode(self, mapper):
+        self.fst.decode(mapper)
         return self
 
     def delete_arcs(self, state, n=0):
         self.fst.delete_arcs(state, n)
         return self
 
     def delete_states(self, states=None):
@@ -148,16 +152,16 @@
     def draw(self, filename, isymbols=None, osymbols=None, ssymbols=None, acceptor=False, title="", 
           width=8.5, height=11, portrait=False, vertical=False, ranksep=0.4, nodesep=0.25, 
           fontsize=14, precision=5, float_format='g', show_weight_one=False):
         
         self.fst.draw(filename, isymbols, osymbols, ssymbols, acceptor, title, width, height, portrait, 
                 vertical, ranksep, nodesep, fontsize, precision, float_format, show_weight_one)
 
-    def encode(self, encoder):
-        self.fst.encode(encoder)
+    def encode(self, mapper):
+        self.fst.encode(mapper)
         return self
 
     def final(self, state):
         return self.fst.final(state)
 
     def fst_type(self):
         return self.fst.fst_type()
@@ -172,15 +176,15 @@
     def invert(self):
         self.fst.invert()
         return self
 
     def is_final(self, state):
         return self.final(state) != pywrapfst.Weight.zero(self.weight_type())
 
-    def minimize(self, delta=1e-6, allow_nondet=False):
+    def minimize(self, delta=fstlib.SHORTEST_DELTA, allow_nondet=False):
         self.fst.minimize(delta, allow_nondet)
         return self
 
     def mutable_arcs(self, state):
         return self.fst.mutable_arcs(state)
 
     def mutable_input_symbols(self):
@@ -193,38 +197,47 @@
         return self.fst.num_arcs(state)
 
     def num_input_epsilons(self, state):
         return self.fst.num_input_epsilons(state)
 
     def num_output_epsilons(self, state):
         return self.fst.num_output_epsilons(state)
+    
+    def num_paths(self):
+        """ Returns the number of paths of the fst via shortest distance. 
+        An extension to pywrapfst.Fst. """
+        return fstlib.paths.get_number_of_paths_from_fst(self)
 
     def num_states(self):
         return self.fst.num_states()
 
     def output_symbols(self):
         return self.fst.output_symbols()
 
     def paths(self):
-        pdfs = fstlib.algos.PathDepthFirstSearch(self)
-        return pdfs.get_paths()
+        """ Runs a path depth first search and returns a list of paths.
+        An extension to pywrapfst.Fst. """
+        return fstlib.paths.get_paths_from_fst(self)
+
+    def print(self, isymbols=None, osymbols=None, ssymbols=None, acceptor=False, show_weight_one=False, missing_sym=""):
+        return self.fst.print(isymbols, osymbols, ssymbols, acceptor, show_weight_one, missing_sym)
 
-    def project(self, project_type='input'):
+    def project(self, project_type):
         self.fst.project(project_type)
         return self
 
     def properties(self, mask, test):
         return self.fst.properties(mask,test)
 
-    def prune(self, delta=fstlib.DEF_DELTA, nstate=fstlib.NO_STATE_ID, weight=None):
+    def prune(self, delta=fstlib.DELTA, nstate=fstlib.NO_STATE_ID, weight=None):
         self.fst.prune(delta, nstate, weight)
         return self
 
-    def push(self, delta=fstlib.DEF_DELTA, remove_total_weight=False, to_final=False):
-        self.fst.push(delta, remove_total_weight, to_final)
+    def push(self, delta=fstlib.SHORTEST_DELTA, remove_total_weight=False, reweight_type="to_initial"):
+        self.fst.push(delta, remove_total_weight, reweight_type)
         return self
 
     def relabel_pairs(self, ipairs=None, opairs=None):
         self.fst.relabel_pairs(ipairs, opairs)
         return self
 
     def relabel_tables(self, old_isymbols=None, new_isymbols=None, unknown_isymbols="", attach_new_isymbols=True,
@@ -235,23 +248,23 @@
 
     def reserve_arcs(self, state, n):
         return self.fst.reserve_arcs(state, n)
 
     def reserve_states(self, n):
         return self.fst.reserve_states(n)
 
-    def reweight(self, potentials, to_final=False):
-        self.fst.reweight(potentials, to_final)
+    def reweight(self, potentials, reweight_type="to_initial"):
+        self.fst.reweight(potentials, reweight_type)
         return self
 
-    def rmepsilon(self, queue_type='auto', connect=True, weight=None, nstate=fstlib.NO_STATE_ID, delta=1e-6):
+    def rmepsilon(self, queue_type='auto', connect=True, weight=None, nstate=fstlib.NO_STATE_ID, delta=fstlib.SHORTEST_DELTA):
         self.fst.rmepsilon(queue_type, connect, weight, nstate, delta)
         return self
 
-    def set_final(self, state, weight):
+    def set_final(self, state, weight=None):
         self.fst.set_final(state, weight)
         return self
 
     def set_input_symbols(self, syms):
         self.fst.set_input_symbols(syms)
         return self
 
@@ -268,18 +281,17 @@
 
     def start(self):
         return self.fst.start()
 
     def states(self):
         return self.fst.states()
 
-    def text(self):
-        return self.fst.text()
-
     def to_dataframe(self, select='arcs', to_real=False):
+        """ Converts an FST to a pandas DataFrame.
+        An extension to pywrapfst.Fst. """
         if self.input_symbols() is not None:
             isyms = dict([(i, s) for i,s in self.input_symbols()])
         else:
             isyms = None
         if self.output_symbols() is not None:
             osyms = dict([(i, s) for i,s in self.output_symbols()])
         else:
@@ -325,30 +337,41 @@
             dot = fd.read()
         os.unlink(tmpfile)
         src = gv.Source(dot)
         return src
 
     def to_real(self):
         """ Shortcut for a constructive weight map from log to real, mainly
-        for plotting and printing purposes. """
-        return fstlib.weight_map(self, fstlib.algos.map_log_to_real)
+        for plotting and printing purposes. An extension to pywrapfst.Fst."""
+        return fstlib.weight_map(self, fstlib.tools.neglog_to_real)
+
+    def to_svg(self, **kwargs):
+        g = self.to_graphviz(**kwargs)
+        g.format='svg'
+        return g
+
+    def to_png(self, **kwargs):
+        g = self.to_graphviz(**kwargs)
+        g.format = 'png'
+        return g
 
     def topsort(self):
         self.fst.topsort()
         return self
 
     def union(self, ifst):
         self.fst.union(ifst.fst)
         return self
 
     def verify(self):
         return self.fst.verify()
 
     def weight_map(self, func, with_final_states=True):
-        ## maps each arc and final state weight to a new value using the function provided """
+        """ Maps each arc and final state weight to a new value using the function provided.
+         This is an extension to the pywrapfst Fst class. """
         for state in self.states():
             final_weight = self.final(state)
             if final_weight != pywrapfst.Weight.zero(self.weight_type()) and with_final_states: ## final state
                 self.set_final(state, func(final_weight))
             mai = self.mutable_arcs(state)
             for arc in mai:
                 arc.weight = pywrapfst.Weight(self.weight_type(), func(arc.weight))
@@ -368,154 +391,143 @@
     @classmethod
     def read(cls, source):
         ofst = pywrapfst.Fst.read(source)
         return Fst(ofst)
 
     @classmethod
     def read_from_string(cls, state):
-        ofst = pywrapfst.Fst.read(state)
+        ofst = pywrapfst.Fst.read_from_string(state)
         return Fst(ofst)
 
-class Path(list):
-    """ simple extension of list class that includes a final weight """
-    __attributes = ["finalWeight"]
-
-    def __init__(self, *args, **kwargs):
-        super().__init__(*args)
-        self.finalWeight = kwargs.get("finalWeight", 0)
-        valid = [p in self.__attributes for p in kwargs.keys()]
-        if not all(valid):
-            raise FSTError("Unknown attribute in [" + ",".join(kwargs.keys()) + "]. Allowed arguments are: [" + ",".join(self.__attributes) + "].")
+    def __getstate__(self):
+        return self.write_to_string()
 
-    def copy(self):
-        newpath = fstlib.Path(self)
-        newpath.finalWeight = self.finalWeight
-        return newpath
+    def __setstate__(self, state):
+        self.fst = pywrapfst.Fst.read_from_string(state)
 
 class FSTError(Exception):
     def __init__(self, message="<unknown error>"):
         self.message = message
 
     def __str__(self):
         return str(self.message)
 
-## module scope variables
+## function definitions
 _last_seed = None
 
 ## function definitions
-def _generate_seed():
+def generate_seed():
     global _last_seed
     random_data = os.urandom(4) 
     seed = int.from_bytes(random_data, byteorder="big") 
     _last_seed = seed
     return seed
 
-def arcmap(ifst, delta=fstlib.DEF_DELTA, map_type='identity', power=1.0, weight=None):
+def arcmap(ifst, delta=fstlib.DELTA, map_type='identity', power=1.0, weight=None):
     newfst = pywrapfst.arcmap(ifst.fst, delta, map_type, power, weight)
     return Fst(newfst)
 
 def compact_symbol_table(syms):
     return pywrapfst.compact_symbol_table(syms)
 
 def compose(ifst1, ifst2, compose_filter='auto', connect=True):
     newfst = pywrapfst.compose(ifst1.fst, ifst2.fst, compose_filter, connect)
     return Fst(newfst)
 
-def convert(ifst, fst_type=None):
+def convert(ifst, fst_type=""):
     newfst = pywrapfst.convert(ifst.fst, fst_type)
     return Fst(newfst)
 
-def determinize(ifst, delta=1e-6, det_type='functional', nstate=fstlib.NO_STATE_ID, 
+def determinize(ifst, delta=fstlib.SHORTEST_DELTA, det_type='functional', nstate=fstlib.NO_STATE_ID, 
                 subsequential_label=0, weight=None, incremental_subsequential_label=False):
     newfst = pywrapfst.determinize(ifst.fst, delta, det_type, nstate, subsequential_label, weight, incremental_subsequential_label)
     return Fst(newfst)
 
 def difference(ifst1, ifst2, compose_filter='auto', connect=True):
     newfst = pywrapfst.difference(ifst1.fst, ifst2.fst, compose_filter, connect)
     return Fst(newfst)
 
-def disambiguate(ifst, delta=fstlib.DEF_DELTA, nstate=fstlib.NO_STATE_ID, subsequential_label=0, weight=None):
+def disambiguate(ifst, delta=fstlib.DELTA, nstate=fstlib.NO_STATE_ID, subsequential_label=0, weight=None):
     newfst = pywrapfst.disambiguate(ifst.fst, delta, nstate, subsequential_label, weight)
     return Fst(newfst)
 
-def divide(lhs, rhs):
-    return pywrapfst.divide(lhs, rhs)
+# def divide(lhs, rhs):
+#     return pywrapfst.divide(lhs, rhs)
+# commented out to avoid forwarding overhead
 
-
-def epsnormalize(ifst, eps_norm_output=False):
-    newfst = pywrapfst.epsnormalize(ifst.fst, eps_norm_output)
+def epsnormalize(ifst, eps_norm_type="input"):
+    newfst = pywrapfst.epsnormalize(ifst.fst, eps_norm_type)
     return Fst(newfst)
 
-def equal(ifst1, ifst2, delta=fstlib.DEF_DELTA):
+def equal(ifst1, ifst2, delta=fstlib.DELTA):
     return pywrapfst.equal(ifst1.fst, ifst2.fst, delta)
 
-def equivalent(ifst1, ifst2, delta=fstlib.DEF_DELTA):
+def equivalent(ifst1, ifst2, delta=fstlib.DELTA):
     return pywrapfst.equivalent(ifst1.fst, ifst2.fst, delta)
 
 def intersect(ifst1, ifst2, compose_filter='auto', connect=True):
     newfst = pywrapfst.intersect(ifst1.fst, ifst2.fst, compose_filter, connect)
     return Fst(newfst)
 
-def isomorphic(ifst1, ifst2, delta=fstlib.DEF_DELTA):
+def isomorphic(ifst1, ifst2, delta=fstlib.DELTA):
     return pywrapfst.isomorphic(ifst1.fst, ifst2.fst, delta)
 
-def plus(lhs, rhs):
-    return pywrapfst.plus(lhs, rhs)
-
-def power(lhs, rhs):
-    return pywrapfst.power(lhs, rhs)
+# def plus(lhs, rhs):
+#     return pywrapfst.plus(lhs, rhs)
+# commented out to avoid forwarding overhead
+
+# def power(lhs, rhs):
+#     return pywrapfst.power(lhs, rhs)
+# commented out to avoid forwarding overhead
 
-def prune(ifst, delta=fstlib.DEF_DELTA, nstate=fstlib.NO_STATE_ID, weight=None):
+def prune(ifst, delta=fstlib.DELTA, nstate=fstlib.NO_STATE_ID, weight=None):
     newfst = pywrapfst.prune(ifst.fst, delta, nstate, weight)
     return Fst(newfst)
 
-def push(ifst, delta=fstlib.DEF_DELTA, push_weights=True, push_labels=False, 
-         remove_common_affix=False, remove_total_weight=False, to_final=False):
+def push(ifst, delta=fstlib.DELTA, push_weights=False, push_labels=False, 
+         remove_common_affix=False, remove_total_weight=False, reweight_type="to_initial"):
+    newfst = pywrapfst.push(ifst.fst, delta, push_weights, push_labels, remove_common_affix, remove_total_weight, reweight_type)
+    newfst = Fst(newfst)
     if remove_total_weight:
-        logger.warn('remove_total_weight dysfunctional due to bug in pywrapfst. Use destructive method instead.')
-    newfst = pywrapfst.push(ifst.fst, delta, push_weights, push_labels, remove_common_affix, remove_total_weight, to_final)
-    return Fst(newfst)
-
-def randequivalent(ifst1, ifst2, npath=1, delta=fstlib.DEF_DELTA, seed='auto', select='uniform', max_length=fstlib.MAX_INT32):
-    if seed == 'auto':
-        seed = _generate_seed()
-    else:
-        seed = int(seed)
+        logger.warn("'remove_total_weight' is not working in pywrapfst. Use destructive method instead. We're using a workaround here which might or might not do what you expect.")
+        # for state in newfst.states():
+        #     if newfst.is_final(state):
+        #         newfst.set_final(state, fstlib.Weight.one(newfst.weight_type()))
+    return newfst
+
+def randequivalent(ifst1, ifst2, npath=1, delta=fstlib.DELTA, select='uniform', max_length=fstlib.MAX_INT32, seed=None):
+    if seed is None:
+        seed = generate_seed()
     return pywrapfst.randequivalent(ifst1.fst, ifst2.fst, npath, delta, select, max_length, seed)
 
-def randgen(ifst, npath=1, select='uniform', max_length=fstlib.MAX_INT32, remove_total_weight=False, weighted=False, seed='auto', verbose=False):
-    if seed == 'auto':
-        seed = _generate_seed()
-        if verbose:
-            logging.info('Seed = %d' % int(seed))
-    else:
-        seed = int(seed)
-    newfst = pywrapfst.randgen(ifst.fst, npath, select, max_length, remove_total_weight, weighted, seed)
+def randgen(ifst, npath=1, select='uniform', max_length=fstlib.MAX_INT32, weighted=False, remove_total_weight=False, seed=None):
+    if seed is None:
+        seed = generate_seed()
+    newfst = pywrapfst.randgen(ifst.fst, npath, select, max_length, weighted, remove_total_weight, seed)
     return Fst(newfst)
 
 def replace(pairs, call_arc_labeling='input',  return_arc_labeling='neither', 
             epsilon_on_replace=False, return_label=0):
     return pywrapfst.replace(pairs, call_arc_labeling, return_arc_labeling, epsilon_on_replace, return_label)
 
-def reverse(ifst, require_superinitial=False):
+def reverse(ifst, require_superinitial=True):
     newfst = pywrapfst.reverse(ifst.fst, require_superinitial)
     return Fst(newfst)
 
-def shortestdistance(fst, delta=1e-6, nstate=fstlib.NO_STATE_ID, queue_type='auto', reverse=False):
+def shortestdistance(fst, delta=fstlib.SHORTEST_DELTA, nstate=fstlib.NO_STATE_ID, queue_type='auto', reverse=False):
     return pywrapfst.shortestdistance(fst.fst, delta, nstate, queue_type, reverse)
 
-def shortestpath(fst, delta=1e-6, nshortest=1, nstate=fstlib.NO_STATE_ID, queue_type='auto', unique=False, weight=None):
+def shortestpath(fst, delta=fstlib.SHORTEST_DELTA, nshortest=1, nstate=fstlib.NO_STATE_ID, queue_type='auto', unique=False, weight=None):
     newfst = pywrapfst.shortestpath(fst.fst, delta, nshortest, nstate, queue_type, unique, weight)
     return Fst(newfst)
 
 def statemap(ifst, map_type):
     newfst = pywrapfst.statemap(ifst.fst, map_type)
     return Fst(newfst)
 
 def synchronize(ifst):
     newfst = pywrapfst.synchronize(ifst.fst)
     return Fst(newfst)
 
-def times(lhs, rhs):
-    return pywrapfst.times(lhs, rhs)
-
-
+# def times(lhs, rhs):
+#     return pywrapfst.times(lhs, rhs)
+# commented out to avoid forwarding overhead
```

### Comparing `medicc2-0.9.2/fstlib/factory.py` & `medicc2-1.0.0/fstlib/factory.py`

 * *Files 10% similar despite different names*

```diff
@@ -228,15 +228,15 @@
                 prob = float(prob) / count_sum[i]
             if prob > 0:
                 prob = - np.log(prob)
                 myfst.add_arc(i, (key, key, prob, i+1))
         
     return myfst
 
-def create_lattice(symbol_table, length, epsilons=False, arc_type='standard'):
+def create_fixed_length_fsa_from_symbol_table(symbol_table, length, epsilons=False, arc_type='standard'):
     n = length+1
     fst = fstlib.Fst(arc_type=arc_type)
     fst.add_states(n)
     fst.set_start(0)
     fst.set_final(n-1, 0)
     fst.set_input_symbols(symbol_table)
     fst.set_output_symbols(symbol_table)
@@ -244,32 +244,14 @@
         if epsilons:
             fst.add_arcs(i, [(s,s,0,i+1) for _,s in symbol_table])
         else:
             fst.add_arcs(i, [(s,s,0,i+1) for k,s in symbol_table if k != 0])
 
     return fst
 
-def _hexdist(x, y):
-    return abs(int(x, 16) - int(y, 16))
-
-def _hexdist_signed(x, y):
-    return int(x, 16) - int(y, 16)
-    
-def _hex_is_double(x, y):
-    if x=="0" or y=="0": return(False)
-    return (int(x, 16) / float(int(y, 16)) == 2)
-
-def _hex_is_half(x, y):
-    if x=="0" or y=="0": return(False)
-    return (int(x, 16) / float(int(y, 16)) == 0.5)
-
-def _hex_division(x, y):
-    if x=="0" or y=="0": return(False)
-    return (int(x, 16) / float(int(y, 16)))
-    
 class FSTFactoryError(Exception):
     def __init__(self, msg):
         self.message = msg
 
     def __str__(self):
         return self.message
```

### Comparing `medicc2-0.9.2/fstlib/test_fstlib.py` & `medicc2-1.0.0/fstlib/test_fstlib.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/fstlib/tools.py` & `medicc2-1.0.0/fstlib/tools.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,102 +1,67 @@
 import numpy as np
 import pandas as pd
 import functools
 import logging
 import fstlib
 import fstlib.core
 import fstlib.algos
+import fstlib.paths
 
 logger = logging.getLogger(__name__)
 
 class FstToolsError(Exception):
     pass
 
-def paths(infst, tape='input'):
+def strings(infst, delimiter="", to_real=False):
     """ returns all strings from a fsa """
-    algo = fstlib.algos.PathDepthFirstSearch(infst)
-            
-    paths=list()
+    ipaths=list()
+    opaths=list()
     scores=list()
-    for path in algo.get_paths():
-        if tape == 'input':
-            syms = dict([(i,s if isinstance(s, str) else str(s, 'utf-8')) for i,s in infst.input_symbols()])
-            seq = [syms[p.ilabel] if syms is not None else str(p.ilabel) for p in path]
-        elif tape == 'output':
-            syms = dict([(i,s if isinstance(s, str) else str(s, 'utf-8')) for i,s in infst.output_symbols()])
-            seq = [syms[p.olabel] if syms is not None else str(p.olabel) for p in path]
-        elif tape == 'both':
-            isyms = dict([(i,s if isinstance(s, str) else str(s, 'utf-8')) for i,s in infst.input_symbols()])
-            osyms = dict([(i,s if isinstance(s, str) else str(s, 'utf-8')) for i,s in infst.output_symbols()])
-            seq = [(isyms[p.ilabel] if isyms is not None else str(p.ilabel), 
-                    osyms[p.olabel] if osyms is not None else str(p.olabel)) for p in path]
-        else:
-            raise FstToolsError('Unknown tape parameter %s' % tape)
-        score = functools.reduce(fstlib.times, [p.weight for p in path] + [path.finalWeight,])
-        paths.append(seq)
-        scores.append(float(score))
-
-    result = list(zip(paths, scores))
-    return result
 
-def strings(infst, tape='input', delimiter="", to_real=False):
-    """ returns all strings from a fsa """
-    algo = fstlib.algos.PathDepthFirstSearch(infst)
-            
-    paths=list()
-    scores=list()
-    for path in algo.get_paths():
-        if tape == 'input':
-            syms = dict([(i,s if isinstance(s, str) else str(s, 'utf-8')) for i,s in infst.input_symbols()])
-            seq = delimiter.join([syms[p.ilabel] if syms is not None else str(p.ilabel) for p in path])
-        elif tape == 'output':
-            syms = dict([(i,s if isinstance(s, str) else str(s, 'utf-8')) for i,s in infst.output_symbols()])
-            seq = delimiter.join([syms[p.olabel] if syms is not None else str(p.olabel) for p in path])
-        elif tape == 'both':
-            isyms = dict([(i,s if isinstance(s, str) else str(s, 'utf-8')) for i,s in infst.input_symbols()])
-            osyms = dict([(i,s if isinstance(s, str) else str(s, 'utf-8')) for i,s in infst.output_symbols()])
-            seq = delimiter.join(["%s:%s" % 
-                         (isyms[p.ilabel] if isyms is not None else str(p.ilabel), 
-                          osyms[p.olabel] if osyms is not None else str(p.olabel)) for p in path])
-        else:
-            raise FstToolsError('Unknown tape parameter %s' % tape)
+    isyms = dict([(i,s if isinstance(s, str) else str(s, 'utf-8')) for i,s in infst.input_symbols()])
+    osyms = dict([(i,s if isinstance(s, str) else str(s, 'utf-8')) for i,s in infst.output_symbols()])
+    for path in fstlib.paths.get_paths_from_fst(infst):
+        iseq = delimiter.join([isyms[p.ilabel] if isyms is not None else str(p.ilabel) for p in path])
+        oseq = delimiter.join([osyms[p.olabel] if osyms is not None else str(p.olabel) for p in path])
         if infst.arc_type() == fstlib.Semiring.LOG or infst.arc_type() == fstlib.Semiring.TROPICAL:
             score = functools.reduce(fstlib.times, [p.weight for p in path] + [path.finalWeight,])
+            #score = np.sum([float(p.weight) for p in path] + [float(path.finalWeight),])
         else:
             raise FstToolsError('semiring not implemented')
-        paths.append(seq)
+        ipaths.append(iseq)
+        opaths.append(oseq)
         scores.append(float(score))
-    if len(paths)==0:
-        paths.append('[no path]')
-        scores.append(np.inf)
-    digits = int(np.log10(len(paths)))+1
-    result = pd.DataFrame(data=list(zip(paths, scores)), columns=['string','weight'])
+
+    digits = int(np.log10(len(ipaths)))+1
+    result = pd.DataFrame(data=list(zip(ipaths, opaths, scores)), columns=['input', 'output','weight'])
     result.sort_values('weight', inplace=True)
-    result.index=[("path%%.%dd" % digits) % i for i in range(len(paths))]
+    result.index=[("path%%.%dd" % digits) % i for i in range(len(ipaths))]
     if to_real:
         result.weight = np.exp(-result.weight)
 
     return result
 
-def mass_intersect_quick(ifsts, prune_nstate = -1, prune_weight = "", prune_level = 0, determinize=True, minimize=True, rmepsilon=True, delta_det=fstlib.DEF_DELTA, delta_min=fstlib.DEF_DELTA, return_filename=False):
+def mass_intersect_quick(ifsts, prune_nstate = -1, prune_weight = "", prune_level = 0, determinize=True, minimize=True, rmepsilon=True, delta_det=fstlib.SHORTEST_DELTA, delta_min=fstlib.SHORTEST_DELTA, return_filename=False):
     return multicommand(fstlib.core.intersect, ifsts, prune_nstate, prune_weight, prune_level, determinize=determinize, 
                             minimize=minimize,
                           rmepsilon=rmepsilon, sort='olabel', return_filename=return_filename, delta_min=delta_min, 
                           delta_det=delta_det)
 
 def multicommand(func, ifsts, prune_nstate = -1, prune_weight = "", prune_level = 0, determinize=True, minimize=True, rmepsilon=True,
-                    sort=None, repeat=1, delta_det=fstlib.DEF_DELTA, delta_min=fstlib.DEF_DELTA, return_filename=False):
+                    sort=None, repeat=1, delta_det=fstlib.SHORTEST_DELTA, delta_min=fstlib.SHORTEST_DELTA, return_filename=False):
     """ applies a function multiple times to multiple fsts or repeatedly to the same.
     Uses Cyril's "log" strategy to speed up computation. """
         
     logger.info("Multicommand %s" % str(func))
 
     remaining = ifsts[:]
     level = 0
     funcalls = 0
+    ofst = None
     while len(remaining)>1:
         next_level = remaining[:]
         for i in range(len(remaining)//2): ## build pairs
             ind1 = 2*i
             ind2 = 2*i+1
             ifst1 = remaining[ind1]
             ifst2 = remaining[ind2]
@@ -175,8 +140,12 @@
             s = list_of_strings[j][i]
             k = symbols.index(s)
             count_matrix[k,i] += 1
 
     return count_matrix, symbols
 
 
+def neglog_to_real(x):
+    return np.exp(-float(x))
 
+def real_to_neglog(x):
+    return -np.log(float(x))
```

### Comparing `medicc2-0.9.2/medicc/__init__.py` & `medicc2-1.0.0/medicc/__init__.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/ancestors.py` & `medicc2-1.0.0/medicc/ancestors.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/bootstrap.py` & `medicc2-1.0.0/medicc/bootstrap.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/core.py` & `medicc2-1.0.0/medicc/core.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/event_reconstruction.py` & `medicc2-1.0.0/medicc/event_reconstruction.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/factory.py` & `medicc2-1.0.0/medicc/factory.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/io.py` & `medicc2-1.0.0/medicc/io.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/logging_conf.yaml` & `medicc2-1.0.0/medicc/logging_conf.yaml`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/nj.py` & `medicc2-1.0.0/medicc/nj.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/objects/Davoli_2013_TSG_OG_genes.bed` & `medicc2-1.0.0/medicc/objects/Davoli_2013_TSG_OG_genes.bed`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/objects/hg19_chromosome_arms.bed` & `medicc2-1.0.0/medicc/objects/hg19_chromosome_arms.bed`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/objects/hg38_chromosome_arms.bed` & `medicc2-1.0.0/medicc/objects/hg38_chromosome_arms.bed`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/objects/no_wgd_asymm.fst` & `medicc2-1.0.0/medicc/objects/no_wgd_asymm.fst`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/objects/wgd_1_asymm.fst` & `medicc2-1.0.0/medicc/objects/wgd_1_asymm.fst`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/objects/wgd_2_asymm.fst` & `medicc2-1.0.0/medicc/objects/wgd_2_asymm.fst`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/objects/wgd_asymm.fst` & `medicc2-1.0.0/medicc/objects/wgd_asymm.fst`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/objects/wgd_total_cn_1_asymm.fst` & `medicc2-1.0.0/medicc/objects/wgd_total_cn_1_asymm.fst`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/objects/wgd_total_cn_asymm.fst` & `medicc2-1.0.0/medicc/objects/wgd_total_cn_asymm.fst`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/objects/wgd_x2_1_asymm.fst` & `medicc2-1.0.0/medicc/objects/wgd_x2_1_asymm.fst`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/objects/wgd_x2_asymm.fst` & `medicc2-1.0.0/medicc/objects/wgd_x2_asymm.fst`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/plot.py` & `medicc2-1.0.0/medicc/plot.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/sim.py` & `medicc2-1.0.0/medicc/sim.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/stats.py` & `medicc2-1.0.0/medicc/stats.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/test_fsts.py` & `medicc2-1.0.0/medicc/test_fsts.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/test_medicc.py` & `medicc2-1.0.0/medicc/test_medicc.py`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc/tools.py` & `medicc2-1.0.0/medicc/tools.py`

 * *Files 0% similar despite different names*

```diff
@@ -32,15 +32,15 @@
                         name='X'.join(data.loc[clade.name].groupby('chrom').apply(lambda x: ''.join(x))),
                         symbol=label.upper())) 
             except KeyError:
                 pass
 
 
 def fsa_to_string(fsa):
-    fsa_string = fstlib.tools.strings(fsa).string[0]
+    fsa_string = fstlib.tools.strings(fsa)['input'].values[0]
     return fsa_string
 
 def hex2int(x):
     return int(x, 16)
 
 def int2hex(x):
     return hex(x)[2:]
```

### Comparing `medicc2-0.9.2/medicc2` & `medicc2-1.0.0/medicc2`

 * *Files identical despite different names*

### Comparing `medicc2-0.9.2/medicc2.egg-info/PKG-INFO` & `medicc2-1.0.0/medicc2.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: medicc2
-Version: 0.9.2
+Version: 1.0.0
 Summary: Whole-genome doubling-aware copy number phylogenies for cancer evolution
 Home-page: https://bitbucket.org/schwarzlab/medicc2
 Author: Tom L Kaufmann, Marina Petkovic, Roland F Schwarz
 Author-email: tkau93@gmail.com, marina.55kovic@gmail.com, roland.f.schwarz@gmail.com
 License: GPL-3
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: MIT License
@@ -21,30 +21,32 @@
 For more information see the accompanying publication [Whole-genome doubling-aware copy number phylogenies for cancer evolution with MEDICC2](https://genomebiology.biomedcentral.com/articles/10.1186/s13059-022-02794-9).
 
 # Installation
 Install MEDICC2 via conda (recommended), pip or from source. MEDICC2 was developed and tested on unix-built systems (Linux and MacOS). For Windows users we recommended WSL2.
 
 Note that the notebooks and examples are not included when installing from conda or pip. When installing from pip or source, you need to make sure to have a working version of `gcc` and `gxx` installed.
 
-Due to dependencies we recommend using Python version 3.7-3.9.
 
 ## Installation via conda (recommended)
-It is best to use a dedicated conda environment for your MEDICC2 installation with `conda create -n medicc_env python=3.9`.
+It is best to use a dedicated conda environment for your MEDICC2 installation with `conda create -n medicc_env`.
 
 After activating the environment with `conda activate medicc_env` you can install MEDICC2 via `conda install -c bioconda -c conda-forge medicc2`.
 
 ## Installation via pip
-As MEDICC2 relies on OpenFST version 1.8.1 which is not packaged on PyPi you have to first install it using conda with `conda install -c conda-forge openfst=1.8.1`. Next you can install MEDICC2 via `pip install medicc2`.
+As MEDICC2 relies on OpenFST version 1.8.2 which is not packaged on PyPi you have to first install it using conda with `conda install -c conda-forge openfst=1.8.2`. Next you can install MEDICC2 via `pip install medicc2`.
 
 ## Installation from source
 Clone the MEDICC2 repository and its submodules using `git clone --recursive https://bitbucket.org/schwarzlab/medicc2.git`. It is important to use the `--recursive` flag to also download the modified OpenFST submodule.
 
-All dependencies including OpenFST (v1.8.1) should be directly installable via conda. A yaml file with a suggested MEDICC2 conda environment is provided in 'doc/medicc2.yml'. You can create a new conda environment with all requirements using `conda env create -f doc/medicc2.yml -n medicc_env`.
+All dependencies including OpenFST (v1.8.2) should be directly installable via conda. A yaml file with a suggested MEDICC2 conda environment is provided in 'doc/medicc2.yml'. You can create a new conda environment with all requirements using `conda env create -f doc/medicc2.yml -n medicc_env`.
 
-Then, inside the `medicc2` folder, run `pip install .` to install MEDICC2 to your environment. 
+Then, inside the `medicc2` folder, run `pip install .` to install MEDICC2 to your environment.
+
+## Development mode
+If you want to make changes to the MEDICC2 source code, install MEDICC2 as explained above in "Installation from source" but install in editable mode (with `pip install -e .`). Any changes to the local files will now be reflected in your environment.
 
 # Usage
 After installing MEDICC2, you can use MEDICC2 functions in python scripts (through `import medicc`) and from the command line. General usage from the command line is `medicc2 path/to/input/file path/to/output/folder`. Run `medicc2 --help` for information on optional arguments.
 
 Logging settings can be changed using the `medicc/logging_conf.yaml` file with the standard python logging syntax.
 
 ## Command line Flags
```

### Comparing `medicc2-0.9.2/medicc2.egg-info/SOURCES.txt` & `medicc2-1.0.0/medicc2.egg-info/SOURCES.txt`

 * *Files 20% similar despite different names*

```diff
@@ -5,24 +5,23 @@
 setup.py
 fstlib/__init__.py
 fstlib/algos.py
 fstlib/core.py
 fstlib/ext.py
 fstlib/factory.py
 fstlib/logging_conf.yaml
+fstlib/paths.py
 fstlib/test_fstlib.py
 fstlib/tools.py
 fstlib/cext/__init__.py
-fstlib/cext/cintegral_types.pxd
 fstlib/cext/cios.pxd
 fstlib/cext/cmemory.pxd
 fstlib/cext/cops.h
 fstlib/cext/cops.pxd
 fstlib/cext/cpywrapfst.pxd
-fstlib/cext/cutility.pxd
 fstlib/cext/ops.cpp
 fstlib/cext/ops.pyx
 fstlib/cext/pywrapfst.cpp
 fstlib/cext/pywrapfst.pxd
 fstlib/cext/pywrapfst.pyx
 medicc/__init__.py
 medicc/ancestors.py
```

### Comparing `medicc2-0.9.2/setup.py` & `medicc2-1.0.0/setup.py`

 * *Files 4% similar despite different names*

```diff
@@ -9,15 +9,15 @@
 extra_compile_args = ['-std=c++17']
 if sys.platform.startswith("darwin"):
   extra_compile_args.append("-stdlib=libc++")
   extra_compile_args.append("-mmacosx-version-min=10.12")
 
 setup(
     name='medicc2',
-    version='0.9.2',
+    version='1.0.0',
     author='Tom L Kaufmann, Marina Petkovic, Roland F Schwarz',
     author_email='tkau93@gmail.com, marina.55kovic@gmail.com, roland.f.schwarz@gmail.com',
     description='Whole-genome doubling-aware copy number phylogenies for cancer evolution',
     long_description=(Path(__file__).parent / "README.md").read_text(),
     long_description_content_type='text/markdown',
     url='https://bitbucket.org/schwarzlab/medicc2',
     classifiers=[
```

