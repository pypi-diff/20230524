# Comparing `tmp/firebase_push-0.2.2-py3-none-any.whl.zip` & `tmp/firebase_push-0.2.3-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,38 +1,38 @@
-Zip file size: 26567 bytes, number of entries: 36
--rw-r--r--  2.0 unx       43 b- defN 23-May-23 15:01 firebase_push/__init__.py
--rw-r--r--  2.0 unx     3456 b- defN 23-May-23 15:01 firebase_push/admin.py
--rw-r--r--  2.0 unx      185 b- defN 23-May-23 15:01 firebase_push/apps.py
--rw-r--r--  2.0 unx      173 b- defN 23-May-23 15:01 firebase_push/defaults.py
--rw-r--r--  2.0 unx     1465 b- defN 23-May-23 15:01 firebase_push/tasks.py
--rw-r--r--  2.0 unx     1209 b- defN 23-May-23 15:01 firebase_push/utils.py
--rw-r--r--  2.0 unx        0 b- defN 23-May-23 15:01 firebase_push/conf/__init__.py
--rw-r--r--  2.0 unx       60 b- defN 23-May-23 15:01 firebase_push/conf/settings.py
--rw-r--r--  2.0 unx      244 b- defN 23-May-23 15:01 firebase_push/conf/urls.py
--rw-r--r--  2.0 unx        0 b- defN 23-May-23 15:01 firebase_push/management/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-May-23 15:01 firebase_push/management/commands/__init__.py
--rw-r--r--  2.0 unx     1108 b- defN 23-May-23 15:01 firebase_push/management/commands/age_devices.py
--rw-r--r--  2.0 unx     1082 b- defN 23-May-23 15:01 firebase_push/management/commands/cleanup_devices.py
--rw-r--r--  2.0 unx     1495 b- defN 23-May-23 15:01 firebase_push/management/commands/cleanup_history.py
--rw-r--r--  2.0 unx        0 b- defN 23-May-23 15:01 firebase_push/management/commands/test_push.py
--rw-r--r--  2.0 unx      190 b- defN 23-May-23 15:01 firebase_push/message/__init__.py
--rw-r--r--  2.0 unx    14246 b- defN 23-May-23 15:01 firebase_push/message/base.py
--rw-r--r--  2.0 unx     5825 b- defN 23-May-23 15:01 firebase_push/message/localized_message.py
--rw-r--r--  2.0 unx     1333 b- defN 23-May-23 15:01 firebase_push/message/message.py
--rw-r--r--  2.0 unx      573 b- defN 23-May-23 15:01 firebase_push/migrations/0001_initial.py
--rw-r--r--  2.0 unx      421 b- defN 23-May-23 15:01 firebase_push/migrations/0002_default_topic.py
--rw-r--r--  2.0 unx        0 b- defN 23-May-23 15:01 firebase_push/migrations/__init__.py
--rw-r--r--  2.0 unx      160 b- defN 23-May-23 15:01 firebase_push/models/__init__.py
--rw-r--r--  2.0 unx     1252 b- defN 23-May-23 15:01 firebase_push/models/devices.py
--rw-r--r--  2.0 unx     1044 b- defN 23-May-23 15:01 firebase_push/models/history.py
--rw-r--r--  2.0 unx      263 b- defN 23-May-23 15:01 firebase_push/models/topics.py
--rw-r--r--  2.0 unx       77 b- defN 23-May-23 15:01 firebase_push/serializers/__init__.py
--rw-r--r--  2.0 unx     2261 b- defN 23-May-23 15:01 firebase_push/serializers/devices.py
--rw-r--r--  2.0 unx      207 b- defN 23-May-23 15:01 firebase_push/serializers/topics.py
--rw-r--r--  2.0 unx      762 b- defN 23-May-23 15:01 firebase_push/templates/firebase_push/send_push.html
--rw-r--r--  2.0 unx       88 b- defN 23-May-23 15:01 firebase_push/views/__init__.py
--rw-r--r--  2.0 unx     1750 b- defN 23-May-23 15:01 firebase_push/views/device.py
--rw-r--r--  2.0 unx     1069 b- defN 23-May-23 15:01 firebase_push-0.2.2.dist-info/LICENSE
--rw-r--r--  2.0 unx       81 b- defN 16-Jan-01 00:00 firebase_push-0.2.2.dist-info/WHEEL
--rw-r--r--  2.0 unx    13216 b- defN 16-Jan-01 00:00 firebase_push-0.2.2.dist-info/METADATA
--rw-r--r--  2.0 unx     3215 b- defN 16-Jan-01 00:00 firebase_push-0.2.2.dist-info/RECORD
-36 files, 58553 bytes uncompressed, 21309 bytes compressed:  63.6%
+Zip file size: 26705 bytes, number of entries: 36
+-rw-r--r--  2.0 unx       43 b- defN 23-May-23 16:32 firebase_push/__init__.py
+-rw-r--r--  2.0 unx     3456 b- defN 23-May-23 16:32 firebase_push/admin.py
+-rw-r--r--  2.0 unx      185 b- defN 23-May-23 16:32 firebase_push/apps.py
+-rw-r--r--  2.0 unx      173 b- defN 23-May-23 16:32 firebase_push/defaults.py
+-rw-r--r--  2.0 unx     1967 b- defN 23-May-23 16:32 firebase_push/tasks.py
+-rw-r--r--  2.0 unx     1209 b- defN 23-May-23 16:32 firebase_push/utils.py
+-rw-r--r--  2.0 unx        0 b- defN 23-May-23 16:32 firebase_push/conf/__init__.py
+-rw-r--r--  2.0 unx       60 b- defN 23-May-23 16:32 firebase_push/conf/settings.py
+-rw-r--r--  2.0 unx      244 b- defN 23-May-23 16:32 firebase_push/conf/urls.py
+-rw-r--r--  2.0 unx        0 b- defN 23-May-23 16:32 firebase_push/management/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-May-23 16:32 firebase_push/management/commands/__init__.py
+-rw-r--r--  2.0 unx     1108 b- defN 23-May-23 16:32 firebase_push/management/commands/age_devices.py
+-rw-r--r--  2.0 unx     1082 b- defN 23-May-23 16:32 firebase_push/management/commands/cleanup_devices.py
+-rw-r--r--  2.0 unx     1495 b- defN 23-May-23 16:32 firebase_push/management/commands/cleanup_history.py
+-rw-r--r--  2.0 unx        0 b- defN 23-May-23 16:32 firebase_push/management/commands/test_push.py
+-rw-r--r--  2.0 unx      190 b- defN 23-May-23 16:32 firebase_push/message/__init__.py
+-rw-r--r--  2.0 unx    14246 b- defN 23-May-23 16:32 firebase_push/message/base.py
+-rw-r--r--  2.0 unx     5825 b- defN 23-May-23 16:32 firebase_push/message/localized_message.py
+-rw-r--r--  2.0 unx     1333 b- defN 23-May-23 16:32 firebase_push/message/message.py
+-rw-r--r--  2.0 unx      573 b- defN 23-May-23 16:32 firebase_push/migrations/0001_initial.py
+-rw-r--r--  2.0 unx      421 b- defN 23-May-23 16:32 firebase_push/migrations/0002_default_topic.py
+-rw-r--r--  2.0 unx        0 b- defN 23-May-23 16:32 firebase_push/migrations/__init__.py
+-rw-r--r--  2.0 unx      160 b- defN 23-May-23 16:32 firebase_push/models/__init__.py
+-rw-r--r--  2.0 unx     1252 b- defN 23-May-23 16:32 firebase_push/models/devices.py
+-rw-r--r--  2.0 unx     1044 b- defN 23-May-23 16:32 firebase_push/models/history.py
+-rw-r--r--  2.0 unx      263 b- defN 23-May-23 16:32 firebase_push/models/topics.py
+-rw-r--r--  2.0 unx       77 b- defN 23-May-23 16:32 firebase_push/serializers/__init__.py
+-rw-r--r--  2.0 unx     2261 b- defN 23-May-23 16:32 firebase_push/serializers/devices.py
+-rw-r--r--  2.0 unx      207 b- defN 23-May-23 16:32 firebase_push/serializers/topics.py
+-rw-r--r--  2.0 unx      762 b- defN 23-May-23 16:32 firebase_push/templates/firebase_push/send_push.html
+-rw-r--r--  2.0 unx       88 b- defN 23-May-23 16:32 firebase_push/views/__init__.py
+-rw-r--r--  2.0 unx     1750 b- defN 23-May-23 16:32 firebase_push/views/device.py
+-rw-r--r--  2.0 unx     1069 b- defN 23-May-23 16:32 firebase_push-0.2.3.dist-info/LICENSE
+-rw-r--r--  2.0 unx       81 b- defN 16-Jan-01 00:00 firebase_push-0.2.3.dist-info/WHEEL
+-rw-r--r--  2.0 unx    13216 b- defN 16-Jan-01 00:00 firebase_push-0.2.3.dist-info/METADATA
+-rw-r--r--  2.0 unx     3215 b- defN 16-Jan-01 00:00 firebase_push-0.2.3.dist-info/RECORD
+36 files, 59055 bytes uncompressed, 21447 bytes compressed:  63.7%
```

## zipnote {}

```diff
@@ -90,20 +90,20 @@
 
 Filename: firebase_push/views/__init__.py
 Comment: 
 
 Filename: firebase_push/views/device.py
 Comment: 
 
-Filename: firebase_push-0.2.2.dist-info/LICENSE
+Filename: firebase_push-0.2.3.dist-info/LICENSE
 Comment: 
 
-Filename: firebase_push-0.2.2.dist-info/WHEEL
+Filename: firebase_push-0.2.3.dist-info/WHEEL
 Comment: 
 
-Filename: firebase_push-0.2.2.dist-info/METADATA
+Filename: firebase_push-0.2.3.dist-info/METADATA
 Comment: 
 
-Filename: firebase_push-0.2.2.dist-info/RECORD
+Filename: firebase_push-0.2.3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## firebase_push/__init__.py

```diff
@@ -1,3 +1,3 @@
-VERSION = (0, 2, 2)
+VERSION = (0, 2, 3)
 
-__version__ = "0.2.2"
+__version__ = "0.2.3"
```

## firebase_push/tasks.py

```diff
@@ -2,16 +2,19 @@
 
 import firebase_admin
 import google
 from celery import shared_task
 from requests import HTTPError, Timeout
 
 from firebase_push.models import FCMHistoryBase
+from firebase_push.utils import get_device_model
 
 
+FCMDevice = get_device_model()
+
 FCM_RETRY_EXCEPTIONS = (HTTPError, Timeout)
 firebase = firebase_admin.initialize_app()
 
 
 @shared_task(autoretry_for=FCM_RETRY_EXCEPTIONS, retry_backoff=True)
 def send_message(message: str):
     from .message import PushMessageBase
@@ -23,21 +26,29 @@
         response = None
         try:
             response = firebase_admin.messaging.send(message, app=firebase)
         except firebase_admin.exceptions.InvalidArgumentError as e:
             error = e
         except google.auth.exceptions.DefaultCredentialsError as e:
             error = e
+        except firebase_admin._messaging_utils.UnregisteredError as e:
+            # Remove Token from devices
+            FCMDevice.objects.filter(registration_id=message.token).delete()
+            for history in history_items:
+                history.device = None
+            error = e
 
         # Now update the history objects
         for history in history_items:
             if response is not None and response.success:
                 history.status = FCMHistoryBase.Status.SUCCESS
             else:
                 history.status = FCMHistoryBase.Status.FAILED
                 if response:
                     history.error_message = repr(response.exception)
                 elif error is not None:
-                    history.error_message = format_exception(error)
+                    history.error_message = "\n".join(format_exception(error))
+                    history.error_message += "\n\nMessage:\n"
+                    history.error_message += str(message)
                 else:
                     history.error_message = "Unknown error"
             history.save()
```

## Comparing `firebase_push-0.2.2.dist-info/LICENSE` & `firebase_push-0.2.3.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `firebase_push-0.2.2.dist-info/METADATA` & `firebase_push-0.2.3.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: firebase_push
-Version: 0.2.2
+Version: 0.2.3
 Summary: Firebase push notifications for Django, based on official SDK
 Keywords: django,utils
 Author-email: Johannes Schriewer <j.schriewer@anfe.ma>
 Requires-Python: >=3.11
 Description-Content-Type: text/markdown
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Framework :: Django
```

## Comparing `firebase_push-0.2.2.dist-info/RECORD` & `firebase_push-0.2.3.dist-info/RECORD`

 * *Files 7% similar despite different names*

```diff
@@ -1,12 +1,12 @@
-firebase_push/__init__.py,sha256=UjXt43h5F7oXcrPSgUYvE_Cmfl9kk9fi6fMIDOuWSh8,43
+firebase_push/__init__.py,sha256=80rPVCA2k1dDB5iHMMActeK--qf4io2WmB96Fgl7ZME,43
 firebase_push/admin.py,sha256=SS5fqX1n4ck5TdVskcnz27cFCzNbovvMWKR6B4-F9ak,3456
 firebase_push/apps.py,sha256=T1sgyl7KJlvbSsEqQT_NNqziriO1myeF2VG_bfQGQhA,185
 firebase_push/defaults.py,sha256=749oK43c8PdV7cVsqyD5_wB8cT8uugvEkbahuo4nwaU,173
-firebase_push/tasks.py,sha256=7EvE6O3DYLzEHu2vmo6gGhCBfWDmGmWRk8EjssDJK5U,1465
+firebase_push/tasks.py,sha256=2HcZ-if705ubjbp3xWFlyzT2yJ-y3Y3MWcpeDDhc_Es,1967
 firebase_push/utils.py,sha256=ThQFubmRz6OPbWfT7w8GjsfZGA5JgDgF1e7yJ69yTEY,1209
 firebase_push/conf/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 firebase_push/conf/settings.py,sha256=qjTucT5EcIArnhUv4TVfsTR-0XJQAI__pHg-j8zYqMQ,60
 firebase_push/conf/urls.py,sha256=y3LggY7UCR6FOVLccmE_zBr753LGCg1uFHktLOFqMF8,244
 firebase_push/management/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 firebase_push/management/commands/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 firebase_push/management/commands/age_devices.py,sha256=38vuB9Hj2MaOueqJvvJFcZirK5F8TPS5GOU0GJ8DeCQ,1108
@@ -26,11 +26,11 @@
 firebase_push/models/topics.py,sha256=3zCR05e70hpWR9VaQlUUR0cdHZOBCCgsfG2s8v0PG4E,263
 firebase_push/serializers/__init__.py,sha256=ll3TMyX50a9WT_XHp-f9jCXDjnQx1jxj2KL1KDENnyc,77
 firebase_push/serializers/devices.py,sha256=iZ3B0Lbg-KKupnN6EWvkgtX7375woG6tg9PrfQXgX8o,2261
 firebase_push/serializers/topics.py,sha256=wd_Epmq_w3fiFbmeTef0Yf-QZERYbSxLjmUE67zUnFE,207
 firebase_push/templates/firebase_push/send_push.html,sha256=RP1hzOC5LQ6wUk1XZxKQBM8yXsRD-_LLQXOYKSNnYnI,762
 firebase_push/views/__init__.py,sha256=ED0EGFs0QZ7bB88rH4DHGmxn1-yyUZYtn_z_UW7RT28,88
 firebase_push/views/device.py,sha256=yudTadKfcvwN4jpgLXqVjppmphXC9m07eYzgPoi-suY,1750
-firebase_push-0.2.2.dist-info/LICENSE,sha256=ViuqcR99xiIpWNIYojA_tBBgb4ihWKYttQkrUU8zOhA,1069
-firebase_push-0.2.2.dist-info/WHEEL,sha256=EZbGkh7Ie4PoZfRQ8I0ZuP9VklN_TvcZ6DSE5Uar4z4,81
-firebase_push-0.2.2.dist-info/METADATA,sha256=w0mUTqviQwkmuxFN-xMJGY9SRKBmj5XOtwfD1frJZrA,13216
-firebase_push-0.2.2.dist-info/RECORD,,
+firebase_push-0.2.3.dist-info/LICENSE,sha256=ViuqcR99xiIpWNIYojA_tBBgb4ihWKYttQkrUU8zOhA,1069
+firebase_push-0.2.3.dist-info/WHEEL,sha256=EZbGkh7Ie4PoZfRQ8I0ZuP9VklN_TvcZ6DSE5Uar4z4,81
+firebase_push-0.2.3.dist-info/METADATA,sha256=AQQ4fEYKlFYaKVSp0zar8cMGfhrcoTQdA_tfn_fhMrg,13216
+firebase_push-0.2.3.dist-info/RECORD,,
```

